
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Recsys’20 Feature Engineering Tutorial &#8212; Reco Book</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Amazon Personalize Batch Job" href="T227901_amazon_personalize_batch_job.html" />
    <link rel="prev" title="Methods for effective online testing" href="T915054_method_for_effective_online_testing.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Reco Book</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../index.html">
   Tutorials in Jupyter notebook format
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  User Stories
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="US780867_Transformer_based_Recommenders.html">
   Transformer-based Recommenders
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="T034923_BERT4Rec_on_ML1M_in_PyTorch.html">
     BERT4Rec on ML-1M in PyTorch
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T595874_BERT4Rec_on_ML25M_in_PyTorch_Lightning.html">
     BERT4Rec on ML-25M
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T088416_BST_Implementation_in_MXNet.html">
     BST Implementation in MXNet
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T602245_BST_implementation_in_PyTorch.html">
     BST implementation in PyTorch
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T007665_BST_on_ML1M_in_Keras.html">
     A Transformer-based recommendation system
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T881207_BST_PTLightning_ML1M.html">
     Rating prediction using the Behavior Sequence Transformer (BST) model on ML-1M dataset in PyTorch Lightning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T025247_BST_using_Deepctr_library.html">
     BST using Deepctr library
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T757997_SASRec_PyTorch.html">
     SASRec implementation with PyTorch Library
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T225287_SASRec_PaddlePaddle.html">
     SASRec implementation with Paddle Library
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T701627_SR_SAN_Session_based_Model.html">
     SR-SAN Session-based Recommender
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T975104_SSEPT_ML1M_Tensorflow1x.html">
     SSE-PT Personalized Transformer Recommender on ML-1M in Tensorflow 1.x
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T472955_GCSAN_Session_based_Model.html">
     GCSAN Session-based Recommender
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T970274_Transformers4Rec_Session_based_Recommender_on_Yoochoose.html">
     End-to-end session-based recommendation with Transformers4Rec
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T382183_Transformers4Rec_XLNet_on_Synthetic_data.html">
     Transformers4Rec XLNet on Synthetic data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T793395_Session_based_recommendation_on_REES46_Dataset.html">
     End-to-end Session-based recommendation on REES46 Dataset
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Prototypes
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="T382881_DeepWalk_Karateclub.html">
   DeepWalk from scratch referencing Karateclub library
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T384270_DeepWalk_pure_python.html">
   DeepWalk in pure python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T677598_Jaccard_Cosine_SVD_DeepWalk_ML100K.html">
   Recommender System with DeepWalk Graph Embeddings
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T815556_Node2vec_Karateclub.html">
   Node2vec from scratch referencing Karateclub library
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T894941_Node2vec_MovieLens_Keras.html">
   Graph representation learning with node2vec
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T611050_Node2vec_PyG.html">
   Node2vec from scratch in PyTorch Geometric
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T186367_Node2vec_library.html">
   Node2vec from scratch referencing node2vec library
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T331379_bayesian_personalized_ranking.html">
   BPR from scratch
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T081831_Data_Poisoning_Attacks_on_Factorization_Based_Collaborative_Filtering.html">
   Data Poisoning Attacks on Factorization-Based Collaborative Filtering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T102448_Adversarial_Learning_for_Recommendation.html">
   Adversarial Training (Regularization) on a Recommender System
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T865035_Simulating_Data_Poisoning_Attacks_against_Twitter_Recommender.html">
   Load and process dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T711285_Data_Poisoning_Attack_using_LFM_and_ItemAE_on_Synthetic_Dataset.html">
   Injection attack using LFM and ItemAE model trained on Toy dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T355514_Black_box_Attack_on_Sequential_Recs.html">
   Black-box Attack on Sequential Recs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T873451_Statistics_fundamentals.html">
   Statictics Fundamentals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T890478_Batch_Learning_from_Bandit_Feedback_%28BLBF%29.html">
   Imports
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T257798_Off_Policy_Learning_in_Two_stage_Recommender_Systems.html">
   Off-Policy Learning in Two-stage Recommender Systems
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T471827_Adaptive_Estimator_Selection_for_Off_Policy_Evaluation.html">
   Adaptive Estimator Selection for Off-Policy Evaluation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T902666_Evaluating_the_Robustness_of_Off_Policy_Evaluation.html">
   Evaluating the Robustness of Off-Policy Evaluation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T705904_Evaluation_of_Multiple_Off_Policy_Estimators_on_Synthetic_Dataset.html">
   Evaluation of Multiple Off-Policy Estimators on Synthetic Dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T874693_Evaluating_Standard_Off_Policy_Estimators_with_Small_Sample_Open_Bandit_Dataset.html">
   Evaluating Standard Off-Policy Estimators with Small Sample Open-Bandit Dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T792262_Optimal_Off_Policy_Evaluation_from_Multiple_Logging_Policies.html">
   Optimal Off-Policy Evaluation from Multiple Logging Policies
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T167249_Offline_Policy_Evaluation_with_VW_Command_Line.html">
   Offline Policy Evaluation with VW Command Line
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T966055_OBP_Library_Workshop_Tutorials.html">
   OBP Library Workshop Tutorials
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T632722_PyTorch_Fundamentals_Part_1.html">
   PyTorch Fundamentals Part 1
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T472467_PyTorch_Fundamentals_Part_2.html">
   PyTorch Fundamentals Part 2
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T206654_PyTorch_Fundamentals_Part_3.html">
   PyTorch Fundamentals Part 3
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T536348_Attention_Mechanisms.html">
   Imports
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T500796_Agricultural_Satellite_Image_Segmentation.html">
   Agricultural Satellite Image Segmentation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T611432_Image_Analysis_with_Tensorflow.html">
   Image Analysis with Tensorflow
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T925716_MongoDB_to_CSV_Conversion.html">
   MongoDB to CSV conversion
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T396469_PDF_to_Word_Cloud_via_Email.html">
   PDF to WordCloud via Email
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T030890_Job_Scraping_and_Clustering.html">
   Job scraping and clustering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T897054_Scene_Text_Recognition.html">
   Scene Text Recognition
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T034809_Large_scale_Document_Retrieval_with_Elastic_Search.html">
   Large-scale Document Retrieval with ElasticSearch
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T467251_vowpal_wabbit_contextual_recommender.html">
   Simulating a news personalization scenario using Contextual Bandits
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T686684_similar_product_recommender.html">
   Similar Product Recommender system using Deep Learning for an online e-commerce store
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T132203_Retail_Product_Recommendations_using_Word2vec.html">
   Retail Product Recommendations using word2vec
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T501828_Recommender_Implicit_Negative_Feedback.html">
   Retail Product Recommendation with Negative Implicit Feedback
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T315965_Sequence_Aware_Recommenders_Music.html">
   Sequence Aware Recommender Systems
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T051777_image_similarity_recommendations.html">
   Similar Product Recommendations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990172_recobook_diversity_aware_book_recommender.html">
   Diversity Aware Book Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T488549_Goodreads_Diversity_Aware_Book_Recommender.html">
   Diversity Aware Book Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T023535_Kafka_MongoDB_Real_time_Streaming.html">
   Kafka MongoDB Real-time Streaming
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T622304_Session_based_Recommender_Using_Word2vec.html">
   Session-based recommendation using word2vec
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T416854_bandit_based_recommender_using_thompson_sampling_app.html">
   Bandit-based Online Learning using Thompson Sampling
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T198578_Booking_dot_com_Trip_Recommendation.html">
   Booking.com Trip Recommendation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T519734_Vowpal_Wabbit_Contextual_Bandit.html">
   Vowpal Wabbit Contextual Bandit
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T871537_Recommendation_Systems_using_Olist_Dataset.html">
   Recommendation systems using Olist dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T057885_Offline_Replayer_Evaluation.html">
   Offline Replayer Evaluation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T915054_method_for_effective_online_testing.html">
   Methods for effective online testing
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Recsys’20 Feature Engineering Tutorial
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T227901_amazon_personalize_batch_job.html">
   Amazon Personalize Batch Job
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T022961_Amazon_Personalize_Workshop.html">
   Amazon Personalize Workshop
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T424437_Collaborative_Filtering_on_ML_latest_small.html">
   Collaborative Filtering on ML-latest-small
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T539160_Building_and_Deploying_ASOS_Fashion_Recommender.html">
   Building and deploying ASOS fashion recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T757697_Simple_Similarity_based_Recommender.html">
   Simple Similarity based Recommmendations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T051594_Analytics_Zoo.html">
   Analytics Zoo
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T313645_A_B_Testing.html">
   A/B Testing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T475711_PinSage_Graph_based_Recommender.html">
   PinSage Graph-based Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T516490_Graph_Embeddings.html">
   Learn Embeddings using Graph Networks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T822164_movielens_milvus_redis_efficient_retrieval.html">
   Recommender with Redis and Milvus
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T845186_Anime_Recommender.html">
   RekoNet Anime Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T855843_kafka_spark_streaming_colab.html">
   Kafka and Spark Streaming in Colab
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T460437_Building_Models_From_Scratch.html">
   Building Models from scratch
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T855971_Conet_Model_for_Movie_Recommender.html">
   CoNet model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T996996_content_based_and_collaborative_movielens.html">
   Movie Recommendation with Content-Based and Collaborative Filtering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T239418_Simple_Movie_Recommenders.html">
   Simple Movie Recommenders
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T138337_Simple_Movie_Recommender.html">
   Simple movie recommender in implicit, explicit, and cold-start settings
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T935440_The_importance_of_Rating_Normalization.html">
   The importance of Rating Normalization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T612622_cornac_examples.html">
   Cornac Examples
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T561435_Flower_Classification.html">
   Flower classification
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T680910_Trivago_Session_based_Recommender.html">
   Trivago Session-based Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_ads_selection_using_bandits.html">
   Best Ads detection using bandit methods
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_book_crossing_surprise_svd_nmf.html">
   Book-Crossing Recommendation System
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_book_recommender_kubeflow.html">
   Books recommendations with Kubeflow Pipelines on Scaleway Kapsule
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_build_a_kubeflow_pipeline.html">
   Build a Kubeflow Pipeline
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_causal_inference.html">
   Causal Inference
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_concept_embedding_nlp.html">
   Exploring Word Embeddings
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_concept_neural_net.html">
   Neural Network
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_concept_nlp_basics.html">
   Natural Language Processing 101
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_concept_transformer_lm.html">
   TransformerLM Quick Start and Guide
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_content_based_music_recommender_lyricsfreak.html">
   Content-based method for song recommendation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_evaluation_metrics_basics.html">
   Recommender System Evaluations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_implicit_synthetic.html">
   Comparing Implicit Models on Synthetic Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_movie_recommender_tensorflow.html">
   Recommendation Systems with TensorFlow
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_movie_recommender_tensorflow_sagemaker.html">
   Movie recommender using Tensorflow in Sagemaker
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_movielens_eda_modeling.html">
   Movielens EDA and Modeling
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_read_data_from_cassandra_into_pandas.html">
   Read Cassandra Data Snapshot as DataFrame
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_rl_in_action.html">
   Reinforcement Learning fundamentals in action
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_rnn_cnn_basics.html">
   Processing sequences using RNNs and CNNs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_tf_serving_in_action.html">
   TF Serving in action
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_training_indexing_movie_recommender.html">
   Training and indexing movie recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T207114_EduRec_MOOCCube_Course_Recommender.html">
   EduRec MOOCCube Course Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T273184_Multi_Task_Learning.html">
   Multi-task Learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T661108_Book_Recommender_API.html">
   Book Recommender API
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T912764_Simple_Movie_Recommender_App.html">
   Simple Movie Recommender App
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T964554_Career_Village_Questions_Recommendation.html">
   CareerVillage Questions Recommendation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_amazon_women_apparel_tfidf_word2vec.html">
   Amazon Product Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_anime_recommender_graph_network.html">
   Anime Recommender with Bi-partite Graph Network
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_concept_self_attention.html">
   Self-Attention
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_course_recommender_svd_flask.html">
   Course Recommender with SVD based similarity
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_data_mining_similarity_measures.html">
   Concept - Data Mining Similarity Measures
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_jaccard_recommender.html">
   Jaccard Similarity based Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_live_streamer_recommender.html">
   Live Streamer Recommender with Implicit feedback
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_songs_embedding_skipgram_recommender.html">
   Song Embeddings - Skipgram Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_toy_example_car_recommender_knn.html">
   Toy example - Car Recommender using KNN method
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_wikirecs_recommender.html">
   WikiRecs
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/nbs/T513987_Recsys_2020_Feature_Engineering_Tutorial.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/sparsh-ai/reco-book/main?urlpath=tree/nbs/T513987_Recsys_2020_Feature_Engineering_Tutorial.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#part-1">
   Part 1
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#data-download">
     Data download
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#data-extract">
     Data extract
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#data-transform">
     Data transform
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#data-load">
     Data load
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#eda">
     EDA
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#part-2">
   Part 2
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#install-rapids">
     Install RAPIDS
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     Data load
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#missing-value-imputation">
     Missing value imputation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#feature-cross-basics">
     Feature cross - basics
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#apply-feature-cross">
     Apply feature cross
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#categorify">
     Categorify
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#target-encoding">
     Target encoding
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#smoothing">
     Smoothing
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#improve-targetencoding-with-out-of-fold">
     Improve TargetEncoding with out-of-fold
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#count-encoding">
     Count encoding
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#binning">
     Binning
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#normalization">
     Normalization
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gauss-rank">
     Gauss rank
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#timeseries-historical-events">
     Timeseries historical events
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#differences">
     Differences
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="recsys-20-feature-engineering-tutorial">
<h1>Recsys’20 Feature Engineering Tutorial<a class="headerlink" href="#recsys-20-feature-engineering-tutorial" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div><p>RecSys’20 tutorial on feature engineering on a large retail dataset</p>
</div></blockquote>
<div class="section" id="part-1">
<h2>Part 1<a class="headerlink" href="#part-1" title="Permalink to this headline">¶</a></h2>
<div class="section" id="data-download">
<h3>Data download<a class="headerlink" href="#data-download" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!pip install -q -U kaggle
!pip install --upgrade --force-reinstall --no-deps kaggle
!mkdir ~/.kaggle
!cp /content/drive/MyDrive/kaggle.json ~/.kaggle/
!chmod 600 ~/.kaggle/kaggle.json

!kaggle datasets download -d mkechinov/ecommerce-behavior-data-from-multi-category-store
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!gdown --id 1qZIwMbMgMmgDC5EoMdJ8aI9lQPsWA3-P
!gdown --id 1x5ohrrZNhWQN4Q-zww0RmXOwctKHH9PT
!gdown --id 1-Rov9fFtGJqb7_ePc6qH-Rhzxn0cIcKB
!gdown --id 1zr_RXpGvOWN2PrWI6itWL8HnRsCpyqz8
!gdown --id 1g5WoIgLe05UMdREbxAjh0bEFgVCjA1UL
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading...
From: https://drive.google.com/uc?id=1qZIwMbMgMmgDC5EoMdJ8aI9lQPsWA3-P
To: /content/2019-Dec.csv.gz
2.95GB [01:08, 42.9MB/s]
Downloading...
From: https://drive.google.com/uc?id=1x5ohrrZNhWQN4Q-zww0RmXOwctKHH9PT
To: /content/2020-Jan.csv.gz
2.39GB [00:58, 40.7MB/s]
Downloading...
From: https://drive.google.com/uc?id=1-Rov9fFtGJqb7_ePc6qH-Rhzxn0cIcKB
To: /content/2020-Feb.csv.gz
2.35GB [00:56, 41.7MB/s]
Downloading...
From: https://drive.google.com/uc?id=1zr_RXpGvOWN2PrWI6itWL8HnRsCpyqz8
To: /content/2020-Mar.csv.gz
2.42GB [00:40, 60.3MB/s]
Downloading...
From: https://drive.google.com/uc?id=1g5WoIgLe05UMdREbxAjh0bEFgVCjA1UL
To: /content/2020-Apr.csv.gz
2.93GB [00:44, 66.3MB/s]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="data-extract">
<h3>Data extract<a class="headerlink" href="#data-extract" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">gc</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!unzip /content/ecommerce-behavior-data-from-multi-category-store.zip
!rm /content/ecommerce-behavior-data-from-multi-category-store.zip
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Archive:  /content/ecommerce-behavior-data-from-multi-category-store.zip
  inflating: 2019-Nov.csv            
  inflating: 2019-Oct.csv            
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">list_gz_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;/content/*.gz&#39;</span><span class="p">)</span>
<span class="n">list_gz_files</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;/content/2020-Jan.csv.gz&#39;,
 &#39;/content/2020-Mar.csv.gz&#39;,
 &#39;/content/2019-Dec.csv.gz&#39;,
 &#39;/content/2020-Apr.csv.gz&#39;,
 &#39;/content/2020-Feb.csv.gz&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>for file in list_gz_files:
  print(file)
  !gunzip $file
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/content/2020-Jan.csv.gz
/content/2020-Mar.csv.gz
/content/2019-Dec.csv.gz
/content/2020-Apr.csv.gz
/content/2020-Feb.csv.gz
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">snapshot</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;/content/2019-Oct.csv&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">snapshot</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>event_time</th>
      <th>event_type</th>
      <th>product_id</th>
      <th>category_id</th>
      <th>category_code</th>
      <th>brand</th>
      <th>price</th>
      <th>user_id</th>
      <th>user_session</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>19704681</th>
      <td>2019-10-15 12:13:56 UTC</td>
      <td>view</td>
      <td>1307348</td>
      <td>2053013558920217191</td>
      <td>computers.notebook</td>
      <td>acer</td>
      <td>694.97</td>
      <td>515263277</td>
      <td>1f854496-4dae-4114-af89-4f027ba31e56</td>
    </tr>
    <tr>
      <th>41661471</th>
      <td>2019-10-31 09:41:21 UTC</td>
      <td>view</td>
      <td>12709169</td>
      <td>2053013553559896355</td>
      <td>NaN</td>
      <td>michelin</td>
      <td>68.21</td>
      <td>512784291</td>
      <td>caa01956-1d21-4966-8767-3fa5013ef13a</td>
    </tr>
    <tr>
      <th>14636483</th>
      <td>2019-10-12 06:19:13 UTC</td>
      <td>view</td>
      <td>11300059</td>
      <td>2053013555531219353</td>
      <td>electronics.telephone</td>
      <td>texet</td>
      <td>17.46</td>
      <td>519299950</td>
      <td>d67e54c3-88e4-4df2-bc37-d8c7cf656a6a</td>
    </tr>
    <tr>
      <th>41272837</th>
      <td>2019-10-31 03:29:40 UTC</td>
      <td>view</td>
      <td>11500273</td>
      <td>2053013554625249641</td>
      <td>NaN</td>
      <td>jbl</td>
      <td>94.71</td>
      <td>543868618</td>
      <td>a162e395-7b69-49aa-9d45-f05a60e19641</td>
    </tr>
    <tr>
      <th>3527462</th>
      <td>2019-10-03 20:29:36 UTC</td>
      <td>view</td>
      <td>1004777</td>
      <td>2053013555631882655</td>
      <td>electronics.smartphone</td>
      <td>xiaomi</td>
      <td>135.01</td>
      <td>520834671</td>
      <td>98d5af9f-c141-4b79-bdd1-dc9bd1d9a7cb</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!mkdir -p /content/data/tmp
snapshot.to_csv(&#39;/content/data/tmp/snapshot.csv&#39;, index=False)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>123
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="data-transform">
<h3>Data transform<a class="headerlink" href="#data-transform" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">gc</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">file</span> <span class="o">=</span> <span class="s1">&#39;/content/data/tmp/snapshot.csv&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_tmp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
<span class="n">df_tmp</span><span class="p">[</span><span class="s1">&#39;session_purchase&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">df_tmp</span><span class="p">[</span><span class="s1">&#39;user_session&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">df_tmp</span><span class="p">[</span><span class="s1">&#39;product_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="n">df_purchase</span> <span class="o">=</span> <span class="n">df_tmp</span><span class="p">[</span><span class="n">df_tmp</span><span class="p">[</span><span class="s1">&#39;event_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;purchase&#39;</span><span class="p">]</span>
<span class="n">df_cart</span> <span class="o">=</span> <span class="n">df_tmp</span><span class="p">[</span><span class="n">df_tmp</span><span class="p">[</span><span class="s1">&#39;event_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;cart&#39;</span><span class="p">]</span>
<span class="n">df_purchase</span> <span class="o">=</span> <span class="n">df_purchase</span><span class="p">[</span><span class="n">df_purchase</span><span class="p">[</span><span class="s1">&#39;session_purchase&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">df_cart</span><span class="p">[</span><span class="s1">&#39;session_purchase&#39;</span><span class="p">])]</span>
<span class="n">df_cart</span> <span class="o">=</span> <span class="n">df_cart</span><span class="p">[</span><span class="o">~</span><span class="p">(</span><span class="n">df_cart</span><span class="p">[</span><span class="s1">&#39;session_purchase&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">df_purchase</span><span class="p">[</span><span class="s1">&#39;session_purchase&#39;</span><span class="p">]))]</span>
<span class="n">df_cart</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">df_purchase</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_cart</span><span class="p">,</span> <span class="n">df_purchase</span><span class="p">])</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;category_id&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;session_purchase&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>event_time</th>
      <th>event_type</th>
      <th>product_id</th>
      <th>category_code</th>
      <th>brand</th>
      <th>price</th>
      <th>user_id</th>
      <th>user_session</th>
      <th>target</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>55</th>
      <td>2019-10-01 14:17:59 UTC</td>
      <td>cart</td>
      <td>4804055</td>
      <td>electronics.audio.headphone</td>
      <td>apple</td>
      <td>189.10</td>
      <td>522564858</td>
      <td>c3f614f6-bdcb-46d7-ad93-18d03b0e11ba</td>
      <td>0</td>
    </tr>
    <tr>
      <th>75</th>
      <td>2019-10-10 10:16:18 UTC</td>
      <td>cart</td>
      <td>1004708</td>
      <td>electronics.smartphone</td>
      <td>huawei</td>
      <td>153.96</td>
      <td>516882359</td>
      <td>b513996d-0335-4337-bb4d-09c3c14ee2cf</td>
      <td>0</td>
    </tr>
    <tr>
      <th>133</th>
      <td>2019-10-18 08:22:44 UTC</td>
      <td>cart</td>
      <td>2701288</td>
      <td>appliances.kitchen.refrigerators</td>
      <td>samsung</td>
      <td>849.26</td>
      <td>512762567</td>
      <td>2dd77291-d54e-4d3c-a25a-2c915df9fff9</td>
      <td>0</td>
    </tr>
    <tr>
      <th>140</th>
      <td>2019-10-10 04:24:55 UTC</td>
      <td>cart</td>
      <td>1004767</td>
      <td>electronics.smartphone</td>
      <td>samsung</td>
      <td>250.93</td>
      <td>558658709</td>
      <td>d6c93da2-f4ee-42a1-951a-45fc52bbbf82</td>
      <td>0</td>
    </tr>
    <tr>
      <th>163</th>
      <td>2019-10-12 20:19:27 UTC</td>
      <td>cart</td>
      <td>1004750</td>
      <td>electronics.smartphone</td>
      <td>samsung</td>
      <td>196.80</td>
      <td>549588267</td>
      <td>d63ac7ef-d492-4034-b846-351fd2a5c32b</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;cat_0&#39;</span><span class="p">,</span> <span class="s1">&#39;cat_1&#39;</span><span class="p">,</span> <span class="s1">&#39;cat_2&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;category_code&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;\.&quot;</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">expand</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;NA&#39;</span><span class="p">)</span>
<span class="c1"># df[[&#39;cat_0&#39;, &#39;cat_1&#39;, &#39;cat_2&#39;, &#39;cat_3&#39;]] = df[&#39;category_code&#39;].str.split(&quot;\.&quot;, n = 3, expand = True).fillna(&#39;NA&#39;)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;brand&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;brand&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;NA&#39;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;category_code&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;event_time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; UTC&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;ts_hour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;ts_minute&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">minute</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;ts_weekday&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">weekday</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;ts_day&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;ts_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;ts_year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>event_time</th>
      <th>event_type</th>
      <th>product_id</th>
      <th>brand</th>
      <th>price</th>
      <th>user_id</th>
      <th>user_session</th>
      <th>target</th>
      <th>cat_0</th>
      <th>cat_1</th>
      <th>cat_2</th>
      <th>timestamp</th>
      <th>ts_hour</th>
      <th>ts_minute</th>
      <th>ts_weekday</th>
      <th>ts_day</th>
      <th>ts_month</th>
      <th>ts_year</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>55</th>
      <td>2019-10-01 14:17:59 UTC</td>
      <td>cart</td>
      <td>4804055</td>
      <td>apple</td>
      <td>189.10</td>
      <td>522564858</td>
      <td>c3f614f6-bdcb-46d7-ad93-18d03b0e11ba</td>
      <td>0</td>
      <td>electronics</td>
      <td>audio</td>
      <td>headphone</td>
      <td>2019-10-01 14:17:59</td>
      <td>14</td>
      <td>17</td>
      <td>1</td>
      <td>1</td>
      <td>10</td>
      <td>2019</td>
    </tr>
    <tr>
      <th>75</th>
      <td>2019-10-10 10:16:18 UTC</td>
      <td>cart</td>
      <td>1004708</td>
      <td>huawei</td>
      <td>153.96</td>
      <td>516882359</td>
      <td>b513996d-0335-4337-bb4d-09c3c14ee2cf</td>
      <td>0</td>
      <td>electronics</td>
      <td>smartphone</td>
      <td>NA</td>
      <td>2019-10-10 10:16:18</td>
      <td>10</td>
      <td>16</td>
      <td>3</td>
      <td>10</td>
      <td>10</td>
      <td>2019</td>
    </tr>
    <tr>
      <th>133</th>
      <td>2019-10-18 08:22:44 UTC</td>
      <td>cart</td>
      <td>2701288</td>
      <td>samsung</td>
      <td>849.26</td>
      <td>512762567</td>
      <td>2dd77291-d54e-4d3c-a25a-2c915df9fff9</td>
      <td>0</td>
      <td>appliances</td>
      <td>kitchen</td>
      <td>refrigerators</td>
      <td>2019-10-18 08:22:44</td>
      <td>8</td>
      <td>22</td>
      <td>4</td>
      <td>18</td>
      <td>10</td>
      <td>2019</td>
    </tr>
    <tr>
      <th>140</th>
      <td>2019-10-10 04:24:55 UTC</td>
      <td>cart</td>
      <td>1004767</td>
      <td>samsung</td>
      <td>250.93</td>
      <td>558658709</td>
      <td>d6c93da2-f4ee-42a1-951a-45fc52bbbf82</td>
      <td>0</td>
      <td>electronics</td>
      <td>smartphone</td>
      <td>NA</td>
      <td>2019-10-10 04:24:55</td>
      <td>4</td>
      <td>24</td>
      <td>3</td>
      <td>10</td>
      <td>10</td>
      <td>2019</td>
    </tr>
    <tr>
      <th>163</th>
      <td>2019-10-12 20:19:27 UTC</td>
      <td>cart</td>
      <td>1004750</td>
      <td>samsung</td>
      <td>196.80</td>
      <td>549588267</td>
      <td>d63ac7ef-d492-4034-b846-351fd2a5c32b</td>
      <td>0</td>
      <td>electronics</td>
      <td>smartphone</td>
      <td>NA</td>
      <td>2019-10-12 20:19:27</td>
      <td>20</td>
      <td>19</td>
      <td>5</td>
      <td>12</td>
      <td>10</td>
      <td>2019</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">list_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;/content/*.csv&#39;</span><span class="p">)</span>
<span class="n">list_files</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;/content/2020-Apr.csv&#39;,
 &#39;/content/2019-Nov.csv&#39;,
 &#39;/content/2020-Jan.csv&#39;,
 &#39;/content/2019-Dec.csv&#39;,
 &#39;/content/2020-Mar.csv&#39;,
 &#39;/content/2019-Oct.csv&#39;,
 &#39;/content/2020-Feb.csv&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">process_files</span><span class="p">(</span><span class="n">df_tmp</span><span class="p">,</span> <span class="n">chunkname</span><span class="p">):</span>
    <span class="n">df_tmp</span><span class="p">[</span><span class="s1">&#39;session_purchase&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">df_tmp</span><span class="p">[</span><span class="s1">&#39;user_session&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">df_tmp</span><span class="p">[</span><span class="s1">&#39;product_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">df_purchase</span> <span class="o">=</span> <span class="n">df_tmp</span><span class="p">[</span><span class="n">df_tmp</span><span class="p">[</span><span class="s1">&#39;event_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;purchase&#39;</span><span class="p">]</span>
    <span class="n">df_cart</span> <span class="o">=</span> <span class="n">df_tmp</span><span class="p">[</span><span class="n">df_tmp</span><span class="p">[</span><span class="s1">&#39;event_type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;cart&#39;</span><span class="p">]</span>
    <span class="n">df_purchase</span> <span class="o">=</span> <span class="n">df_purchase</span><span class="p">[</span><span class="n">df_purchase</span><span class="p">[</span><span class="s1">&#39;session_purchase&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">df_cart</span><span class="p">[</span><span class="s1">&#39;session_purchase&#39;</span><span class="p">])]</span>
    <span class="n">df_cart</span> <span class="o">=</span> <span class="n">df_cart</span><span class="p">[</span><span class="o">~</span><span class="p">(</span><span class="n">df_cart</span><span class="p">[</span><span class="s1">&#39;session_purchase&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">df_purchase</span><span class="p">[</span><span class="s1">&#39;session_purchase&#39;</span><span class="p">]))]</span>
    <span class="n">df_cart</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">df_purchase</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_cart</span><span class="p">,</span> <span class="n">df_purchase</span><span class="p">])</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;category_id&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;session_purchase&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># df[[&#39;cat_0&#39;, &#39;cat_1&#39;, &#39;cat_2&#39;, &#39;cat_3&#39;]] = df[&#39;category_code&#39;].str.split(&quot;\.&quot;, n = 3, expand = True).fillna(&#39;NA&#39;)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;brand&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;brand&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;NA&#39;</span><span class="p">)</span>
    <span class="c1"># df = df.drop(&#39;category_code&#39;, axis=1)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;event_time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; UTC&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;ts_hour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;ts_minute&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">minute</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;ts_weekday&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">weekday</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;ts_day&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;ts_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;ts_year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>
    <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">chunkname</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>base_path_silver = &quot;/content/data/silver&quot;
!mkdir -p $base_path_silver
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">list_files</span><span class="p">[:</span><span class="mi">2</span><span class="p">]):</span>
  <span class="n">chunkname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_path_silver</span><span class="p">,</span> <span class="n">Path</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">chunkname</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/content/data/silver/2020-Apr-0.csv
/content/data/silver/2019-Nov-1.csv
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">chunksize</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">6</span>

<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">list_files</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="n">chunksize</span><span class="p">)):</span>
      <span class="n">chunkname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_path_silver</span><span class="p">,</span> <span class="n">Path</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="n">chunkname</span><span class="p">)</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">chunkname</span><span class="p">):</span>
        <span class="n">process_files</span><span class="p">(</span><span class="n">chunk</span><span class="p">,</span> <span class="n">chunkname</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>for file in list_files:
  !rm $file
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">list_chunks</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_path_silver</span><span class="p">,</span><span class="s1">&#39;*.csv&#39;</span><span class="p">))</span>
<span class="n">list_chunks</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;/content/data/silver/2020-Jan-40.csv&#39;,
 &#39;/content/data/silver/2019-Dec-54.csv&#39;,
 &#39;/content/data/silver/2019-Oct-27.csv&#39;,
 &#39;/content/data/silver/2019-Nov-12.csv&#39;,
 &#39;/content/data/silver/2020-Mar-36.csv&#39;,
 &#39;/content/data/silver/2020-Apr-14.csv&#39;,
 &#39;/content/data/silver/2020-Feb-40.csv&#39;,
 &#39;/content/data/silver/2019-Nov-3.csv&#39;,
 &#39;/content/data/silver/2020-Mar-3.csv&#39;,
 &#39;/content/data/silver/2020-Apr-39.csv&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!cd $base_path_silver &amp;&amp; zip /content/data_silver.zip ./*.csv
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!cp data_silver.zip /content/drive/MyDrive/Recommendation
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lp</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">list_chunks</span><span class="p">:</span>
  <span class="n">lp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">lp</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(16742775, 16)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>event_time</th>
      <th>event_type</th>
      <th>product_id</th>
      <th>category_code</th>
      <th>brand</th>
      <th>price</th>
      <th>user_id</th>
      <th>user_session</th>
      <th>target</th>
      <th>timestamp</th>
      <th>ts_hour</th>
      <th>ts_minute</th>
      <th>ts_weekday</th>
      <th>ts_day</th>
      <th>ts_month</th>
      <th>ts_year</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2020-01-23 04:32:33 UTC</td>
      <td>cart</td>
      <td>100039953</td>
      <td>appliances.personal.massager</td>
      <td>kivi</td>
      <td>267.44</td>
      <td>512913139</td>
      <td>9bebab16-bce8-43cd-ac97-f763ee4664dd</td>
      <td>0</td>
      <td>2020-01-23 04:32:33</td>
      <td>4</td>
      <td>32</td>
      <td>3</td>
      <td>23</td>
      <td>1</td>
      <td>2020</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2020-01-23 04:32:36 UTC</td>
      <td>cart</td>
      <td>1004767</td>
      <td>construction.tools.light</td>
      <td>samsung</td>
      <td>226.27</td>
      <td>549154456</td>
      <td>659387e4-032e-4e71-8b0b-3b90f0538f14</td>
      <td>0</td>
      <td>2020-01-23 04:32:36</td>
      <td>4</td>
      <td>32</td>
      <td>3</td>
      <td>23</td>
      <td>1</td>
      <td>2020</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2020-01-23 04:32:38 UTC</td>
      <td>cart</td>
      <td>1003306</td>
      <td>construction.tools.light</td>
      <td>apple</td>
      <td>614.79</td>
      <td>585624798</td>
      <td>41a24f4f-afb8-4342-ae6f-003aa968f82f</td>
      <td>0</td>
      <td>2020-01-23 04:32:38</td>
      <td>4</td>
      <td>32</td>
      <td>3</td>
      <td>23</td>
      <td>1</td>
      <td>2020</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2020-01-23 04:32:38 UTC</td>
      <td>cart</td>
      <td>4804055</td>
      <td>sport.bicycle</td>
      <td>apple</td>
      <td>192.07</td>
      <td>525860806</td>
      <td>70b5ed9a-4395-481e-9f91-d811ced8a4c3</td>
      <td>0</td>
      <td>2020-01-23 04:32:38</td>
      <td>4</td>
      <td>32</td>
      <td>3</td>
      <td>23</td>
      <td>1</td>
      <td>2020</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2020-01-23 04:32:43 UTC</td>
      <td>cart</td>
      <td>1005100</td>
      <td>construction.tools.light</td>
      <td>samsung</td>
      <td>141.06</td>
      <td>599724791</td>
      <td>bc35693d-9c73-457f-a7ef-8ced2f0bb729</td>
      <td>0</td>
      <td>2020-01-23 04:32:43</td>
      <td>4</td>
      <td>32</td>
      <td>3</td>
      <td>23</td>
      <td>1</td>
      <td>2020</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># df2 = df[&#39;category_code&#39;].str.split(&quot;\.&quot;, n=3, expand=True).fillna(&#39;NA&#39;)</span>
<span class="c1"># df2.columns = [&#39;cat_{}&#39;.format(x+1) for x in df2.columns]</span>
<span class="c1"># df2.to_parquet(&#39;/content/data/silver_l2/df_cat.parquet&#39;, index=False)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_test</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ts_month&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">4</span><span class="p">]</span>
<span class="n">df_valid</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ts_month&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">3</span><span class="p">]</span>
<span class="n">df_train</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ts_month&#39;</span><span class="p">]</span><span class="o">!=</span><span class="mi">3</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ts_month&#39;</span><span class="p">]</span><span class="o">!=</span><span class="mi">4</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_train</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">df_valid</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">df_test</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>((11495245, 16), (2466048, 16), (2781482, 16))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!mkdir -p /content/data/silver_l2
df_train.to_parquet(&#39;/content/data/silver_l2/train.parquet&#39;, index=False)
df_valid.to_parquet(&#39;/content/data/silver_l2/valid.parquet&#39;, index=False)
df_test.to_parquet(&#39;/content/data/silver_l2/test.parquet&#39;, index=False)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="data-load">
<h3>Data load<a class="headerlink" href="#data-load" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!cd /content/data/silver_l2 &amp;&amp; zip /content/data_silver_l2.zip ./*.parquet
!cp /content/data_silver_l2.zip /content/drive/MyDrive/Recommendation
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  adding: test.parquet (deflated 24%)
  adding: train.parquet (deflated 25%)
  adding: valid.parquet (deflated 24%)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">df_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s1">&#39;/content/data/silver_l2/train.parquet&#39;</span><span class="p">)</span>
<span class="n">df_valid</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s1">&#39;/content/data/silver_l2/valid.parquet&#39;</span><span class="p">)</span>
<span class="n">df_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s1">&#39;/content/data/silver_l2/test.parquet&#39;</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_train</span><span class="p">,</span> <span class="n">df_valid</span><span class="p">,</span> <span class="n">df_test</span><span class="p">],</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(16742775, 16)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="eda">
<h3>EDA<a class="headerlink" href="#eda" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">IPython</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">dtypes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>event_time        object
event_type        object
product_id         int64
category_code     object
brand             object
price            float64
user_id            int64
user_session      object
target             int64
timestamp         object
ts_hour            int64
ts_minute          int64
ts_weekday         int64
ts_day             int64
ts_month           int64
ts_year            int64
dtype: object
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.36775719676099095
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;event_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>cart        0.632243
purchase    0.367757
Name: event_type, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>Around 37.0% of datapoints are purchases. Lets take a look on the sparsity of the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;# of datapoints:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;# of unique users:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;# of unique products:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;product_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;# of unique sessions:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;user_session&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span># of datapoints:(16742775, 16)
# of unique users:(3584809,)
# of unique products:(214907,)
# of unique sessions:(10715053,)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_sparse</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
    <span class="n">stats</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="n">col</span><span class="p">,</span> <span class="s1">&#39;target&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">])</span>
    <span class="n">stats</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="n">stats</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">]</span>
    <span class="n">stats_sort</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="n">stats_sort</span> <span class="o">=</span> <span class="n">stats_sort</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">stats_sort</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">],</span> <span class="n">stats_sort</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Frequency of &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">col</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Number frequency&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plot_sparse</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;product_id&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/T513987_Recsys_2020_Feature_Engineering_Tutorial_46_0.png" src="../_images/T513987_Recsys_2020_Feature_Engineering_Tutorial_46_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plot_sparse</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;user_id&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/T513987_Recsys_2020_Feature_Engineering_Tutorial_47_0.png" src="../_images/T513987_Recsys_2020_Feature_Engineering_Tutorial_47_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plot_sparse</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;brand&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/T513987_Recsys_2020_Feature_Engineering_Tutorial_48_0.png" src="../_images/T513987_Recsys_2020_Feature_Engineering_Tutorial_48_0.png" />
</div>
</div>
<p>We can observe following pattern:</p>
<ul class="simple">
<li><p>There are ~45000 products which appear only once in the dataset</p></li>
<li><p>There are 1200000 users which appear only once in the dataset</p></li>
<li><p>There are 350 brands which appears only once in the dataset</p></li>
</ul>
<p>The sparsity is important for understanding which features can be better used in a model. Product_id and User_id have many values which appear only once and the model is less able to learn a good patterns from them.
On the other hand, brands has many observations and can be leveraged for prediction.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_top20</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
    <span class="n">stats</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="n">col</span><span class="p">,</span> <span class="s1">&#39;target&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">])</span>
    <span class="n">stats</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="n">stats</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">]</span>
    <span class="n">stats</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">],</span> <span class="n">stats</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">])</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">],</span> <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">20</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Mean Target&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Top20 &#39;</span> <span class="o">+</span> <span class="n">col</span> <span class="o">+</span> <span class="s1">&#39;s based on frequency&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plot_top20</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;product_id&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/T513987_Recsys_2020_Feature_Engineering_Tutorial_52_0.png" src="../_images/T513987_Recsys_2020_Feature_Engineering_Tutorial_52_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plot_top20</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;user_id&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/T513987_Recsys_2020_Feature_Engineering_Tutorial_53_0.png" src="../_images/T513987_Recsys_2020_Feature_Engineering_Tutorial_53_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plot_top20</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;brand&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/T513987_Recsys_2020_Feature_Engineering_Tutorial_54_0.png" src="../_images/T513987_Recsys_2020_Feature_Engineering_Tutorial_54_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">date</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;target&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;average mean&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;target&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">[::</span><span class="mi">3</span><span class="p">],</span> <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<img alt="../_images/T513987_Recsys_2020_Feature_Engineering_Tutorial_56_1.png" src="../_images/T513987_Recsys_2020_Feature_Engineering_Tutorial_56_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;target&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>date
2019-11-15    0.000000
2020-01-02    0.000000
2020-04-20    0.000096
2020-04-21    0.000147
2020-01-01    0.063013
2020-02-27    0.114378
2019-11-14    0.135596
2019-11-16    0.147902
2020-01-31    0.161678
2020-02-01    0.203322
2020-01-30    0.223492
2020-02-02    0.258615
2020-02-03    0.270665
2020-01-03    0.282014
2020-02-04    0.295918
2020-02-29    0.300146
2020-02-28    0.300432
2020-02-05    0.310188
2020-02-07    0.317174
2020-02-08    0.318376
Name: target, dtype: float64
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>We explored the data and saw the different raw features available in the dataset.</p></li>
<li><p>We analzyed basic statistics of the raw features and saw long-tail distribution for categorical features (user, item, brand)</p></li>
<li><p>Some categorical features (categories) have high occurances</p></li>
<li><p>In general, we see that categorical features have variance in the target, which we can leverage to engineer more powerful features</p></li>
</ul>
</div>
</div>
<div class="section" id="part-2">
<h2>Part 2<a class="headerlink" href="#part-2" title="Permalink to this headline">¶</a></h2>
<div class="section" id="install-rapids">
<h3>Install RAPIDS<a class="headerlink" href="#install-rapids" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># Check Python Version
!python --version

# Check Ubuntu Version
!lsb_release -a

# Check CUDA/cuDNN Version
!nvcc -V &amp;&amp; which nvcc

# Check GPU
!nvidia-smi
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Python 3.7.10
No LSB modules are available.
Distributor ID:	Ubuntu
Description:	Ubuntu 18.04.5 LTS
Release:	18.04
Codename:	bionic
nvcc: NVIDIA (R) Cuda compiler driver
Copyright (c) 2005-2020 NVIDIA Corporation
Built on Wed_Jul_22_19:09:09_PDT_2020
Cuda compilation tools, release 11.0, V11.0.221
Build cuda_11.0_bu.TC445_37.28845127_0
/usr/local/cuda/bin/nvcc
Sat Jun 19 07:09:44 2021       
+-----------------------------------------------------------------------------+
| NVIDIA-SMI 465.27       Driver Version: 460.32.03    CUDA Version: 11.2     |
|-------------------------------+----------------------+----------------------+
| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |
| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |
|                               |                      |               MIG M. |
|===============================+======================+======================|
|   0  Tesla T4            Off  | 00000000:00:04.0 Off |                    0 |
| N/A   54C    P8    10W /  70W |      0MiB / 15109MiB |      0%      Default |
|                               |                      |                  N/A |
+-------------------------------+----------------------+----------------------+
                                                                               
+-----------------------------------------------------------------------------+
| Processes:                                                                  |
|  GPU   GI   CI        PID   Type   Process name                  GPU Memory |
|        ID   ID                                                   Usage      |
|=============================================================================|
|  No running processes found                                                 |
+-----------------------------------------------------------------------------+
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># This get the RAPIDS-Colab install files and test check your GPU.  Run this and the next cell only.
# Please read the output of this cell.  If your Colab Instance is not RAPIDS compatible, it will warn you and give you remediation steps.
!git clone https://github.com/rapidsai/rapidsai-csp-utils.git
!python rapidsai-csp-utils/colab/env-check.py
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Cloning into &#39;rapidsai-csp-utils&#39;...
remote: Enumerating objects: 272, done.
remote: Counting objects: 100% (101/101), done.
remote: Compressing objects: 100% (82/82), done.
remote: Total 272 (delta 56), reused 38 (delta 19), pack-reused 171
Receiving objects: 100% (272/272), 79.66 KiB | 1.35 MiB/s, done.
Resolving deltas: 100% (118/118), done.
***********************************************************************
Woo! Your instance has the right kind of GPU, a Tesla T4!
***********************************************************************
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># This will update the Colab environment and restart the kernel.  Don&#39;t run the next cell until you see the session crash.
!bash rapidsai-csp-utils/colab/update_gcc.sh
import os
os._exit(00)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># This will install CondaColab.  This will restart your kernel one last time.  Run this cell by itself and only run the next cell once you see the session crash.</span>
<span class="kn">import</span> <span class="nn">condacolab</span>
<span class="n">condacolab</span><span class="o">.</span><span class="n">install</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># you can now run the rest of the cells as normal</span>
<span class="kn">import</span> <span class="nn">condacolab</span>
<span class="n">condacolab</span><span class="o">.</span><span class="n">check</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># Installing RAPIDS is now &#39;python rapidsai-csp-utils/colab/install_rapids.py &lt;release&gt; &lt;packages&gt;&#39;
# The &lt;release&gt; options are &#39;stable&#39; and &#39;nightly&#39;.  Leaving it blank or adding any other words will default to stable.
# The &lt;packages&gt; option are default blank or &#39;core&#39;.  By default, we install RAPIDSAI and BlazingSQL.  The &#39;core&#39; option will install only RAPIDSAI and not include BlazingSQL, 
!python rapidsai-csp-utils/colab/install_rapids.py stable
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">IPython</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">cudf</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">cupy</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id1">
<h3>Data load<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!cp /content/drive/MyDrive/Recommendation/data_silver_l2.zip /content
!unzip /content/data_silver_l2.zip
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Archive:  /content/data_silver_l2.zip
  inflating: test.parquet            
  inflating: train.parquet           
  inflating: valid.parquet           
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_train</span> <span class="o">=</span> <span class="n">cudf</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s1">&#39;/content/train.parquet&#39;</span><span class="p">)</span>
<span class="n">df_valid</span> <span class="o">=</span> <span class="n">cudf</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s1">&#39;/content/valid.parquet&#39;</span><span class="p">)</span>
<span class="n">df_test</span> <span class="o">=</span> <span class="n">cudf</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s1">&#39;/content/test.parquet&#39;</span><span class="p">)</span>

<span class="n">df_train</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>event_time             0
event_type             0
product_id             0
category_code    1527738
brand             949133
price                  0
user_id                0
user_session          66
target                 0
timestamp              0
ts_hour                0
ts_minute              0
ts_weekday             0
ts_day                 0
ts_month               0
ts_year                0
dtype: uint64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">_temp</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;category_code&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;NA&#39;</span><span class="p">)</span>
<span class="n">_temp</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cat_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">_temp</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
<span class="n">df_train</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;category_code&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_train</span> <span class="o">=</span> <span class="n">df_train</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_temp</span><span class="p">)</span>

<span class="n">_temp</span> <span class="o">=</span> <span class="n">df_valid</span><span class="p">[</span><span class="s1">&#39;category_code&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;NA&#39;</span><span class="p">)</span>
<span class="n">_temp</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cat_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">_temp</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
<span class="n">df_valid</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;category_code&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_valid</span> <span class="o">=</span> <span class="n">df_valid</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_temp</span><span class="p">)</span>

<span class="n">_temp</span> <span class="o">=</span> <span class="n">df_test</span><span class="p">[</span><span class="s1">&#39;category_code&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;NA&#39;</span><span class="p">)</span>
<span class="n">_temp</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cat_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">_temp</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
<span class="n">df_test</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;category_code&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_test</span> <span class="o">=</span> <span class="n">df_test</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_temp</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_train</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>event_time</th>
      <th>event_type</th>
      <th>product_id</th>
      <th>brand</th>
      <th>price</th>
      <th>user_id</th>
      <th>user_session</th>
      <th>target</th>
      <th>timestamp</th>
      <th>ts_hour</th>
      <th>ts_minute</th>
      <th>ts_weekday</th>
      <th>ts_day</th>
      <th>ts_month</th>
      <th>ts_year</th>
      <th>cat_0</th>
      <th>cat_1</th>
      <th>cat_2</th>
      <th>cat_3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>15328</th>
      <td>2020-01-23 10:22:27 UTC</td>
      <td>cart</td>
      <td>1005101</td>
      <td>xiaomi</td>
      <td>419.31</td>
      <td>602604607</td>
      <td>ec725848-03db-4a0d-94b2-d0121f79dbb5</td>
      <td>0</td>
      <td>2020-01-23 10:22:27</td>
      <td>10</td>
      <td>22</td>
      <td>3</td>
      <td>23</td>
      <td>1</td>
      <td>2020</td>
      <td>construction</td>
      <td>tools</td>
      <td>light</td>
      <td>NA</td>
    </tr>
    <tr>
      <th>15329</th>
      <td>2020-01-23 10:22:27 UTC</td>
      <td>cart</td>
      <td>17300751</td>
      <td>versace</td>
      <td>81.57</td>
      <td>543745697</td>
      <td>860e30ab-c461-40ef-aa17-1f74acc94f21</td>
      <td>0</td>
      <td>2020-01-23 10:22:27</td>
      <td>10</td>
      <td>22</td>
      <td>3</td>
      <td>23</td>
      <td>1</td>
      <td>2020</td>
      <td>apparel</td>
      <td>shoes</td>
      <td>sandals</td>
      <td>NA</td>
    </tr>
    <tr>
      <th>15330</th>
      <td>2020-01-23 10:22:37 UTC</td>
      <td>cart</td>
      <td>4802273</td>
      <td>samsung</td>
      <td>6.67</td>
      <td>512756088</td>
      <td>0b8d5157-50ee-46ae-9772-e599004d1cbc</td>
      <td>0</td>
      <td>2020-01-23 10:22:37</td>
      <td>10</td>
      <td>22</td>
      <td>3</td>
      <td>23</td>
      <td>1</td>
      <td>2020</td>
      <td>sport</td>
      <td>bicycle</td>
      <td>NA</td>
      <td>NA</td>
    </tr>
    <tr>
      <th>15331</th>
      <td>2020-01-23 10:22:38 UTC</td>
      <td>cart</td>
      <td>2900561</td>
      <td>midea</td>
      <td>48.86</td>
      <td>571387327</td>
      <td>2366dffb-a199-4aa1-b6a3-12fe807ea80d</td>
      <td>0</td>
      <td>2020-01-23 10:22:38</td>
      <td>10</td>
      <td>22</td>
      <td>3</td>
      <td>23</td>
      <td>1</td>
      <td>2020</td>
      <td>furniture</td>
      <td>bedroom</td>
      <td>blanket</td>
      <td>NA</td>
    </tr>
    <tr>
      <th>15332</th>
      <td>2020-01-23 10:22:40 UTC</td>
      <td>cart</td>
      <td>17501003</td>
      <td>enough</td>
      <td>6.69</td>
      <td>590902280</td>
      <td>38efa242-cba4-45ac-8d28-a96d964d0e57</td>
      <td>0</td>
      <td>2020-01-23 10:22:40</td>
      <td>10</td>
      <td>22</td>
      <td>3</td>
      <td>23</td>
      <td>1</td>
      <td>2020</td>
      <td>apparel</td>
      <td>costume</td>
      <td>NA</td>
      <td>NA</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="missing-value-imputation">
<h3>Missing value imputation<a class="headerlink" href="#missing-value-imputation" title="Permalink to this headline">¶</a></h3>
<p>Categorical Features: Imputing categorical features is easy - a unique category value (e.g. “UNKNOWN”) can be imputed</p>
<p>Important: Before imputing the missing values, it is beneficial to create a indicator column, which indicate if the a value was imputed or not. There is maybe a underlying pattern for the missing values and models can learn the pattern.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;brand&#39;</span><span class="p">,</span> <span class="s1">&#39;user_session&#39;</span><span class="p">,</span> <span class="s1">&#39;cat_0&#39;</span><span class="p">,</span> <span class="s1">&#39;cat_1&#39;</span><span class="p">,</span> <span class="s1">&#39;cat_2&#39;</span><span class="p">,</span> <span class="s1">&#39;cat_3&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
    <span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;NA_&#39;</span> <span class="o">+</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span>
    <span class="n">df_train</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;UNKNOWN&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_train</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>event_time         0
event_type         0
product_id         0
brand              0
price              0
user_id            0
user_session       0
target             0
timestamp          0
ts_hour            0
ts_minute          0
ts_weekday         0
ts_day             0
ts_month           0
ts_year            0
cat_0              0
cat_1              0
cat_2              0
cat_3              0
NA_brand           0
NA_user_session    0
NA_cat_0           0
NA_cat_1           0
NA_cat_2           0
NA_cat_3           0
dtype: uint64
</pre></div>
</div>
</div>
</div>
<p>Numerical Features: Imputing median for the numerical value (per group)
Imputing mean for numercial value (per group)
In some cases, we may know what value should be used as the default value (e.g. 0 for historical data or the max)</p>
<p>Important: For the same reason as in the categorical case, it is important to add a indicator column that the datapoint was imputed.</p>
<p>In our case, we do not have missing values in the numerical column price. Therefore, we artificially inject nans and then compare the difference.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">df_train</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">df_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">&lt;</span><span class="mf">0.01</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.009994654311413111
</pre></div>
</div>
</div>
</div>
<p>We calculate the median per cat_2 and merge it to the dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_median</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">[[</span><span class="s1">&#39;cat_2&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;cat_2&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">median</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">df_median</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cat_2&#39;</span><span class="p">,</span> <span class="s1">&#39;price_median_per_cat2&#39;</span><span class="p">]</span>
<span class="n">df_train</span> <span class="o">=</span> <span class="n">df_train</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_median</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;cat_2&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We create an indicator column, when price was not available and then overwrite the missing values with the median.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;NA_price&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span>
<span class="n">df_train</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">(),</span> <span class="s1">&#39;price&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_train</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">(),</span> <span class="s1">&#39;price_median_per_cat2&#39;</span><span class="p">]</span>
<span class="n">df_train</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;price_median_per_cat2&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_train</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>event_time</th>
      <th>event_type</th>
      <th>product_id</th>
      <th>brand</th>
      <th>price</th>
      <th>user_id</th>
      <th>user_session</th>
      <th>target</th>
      <th>timestamp</th>
      <th>ts_hour</th>
      <th>ts_minute</th>
      <th>ts_weekday</th>
      <th>ts_day</th>
      <th>ts_month</th>
      <th>ts_year</th>
      <th>cat_0</th>
      <th>cat_1</th>
      <th>cat_2</th>
      <th>cat_3</th>
      <th>NA_brand</th>
      <th>NA_user_session</th>
      <th>NA_cat_0</th>
      <th>NA_cat_1</th>
      <th>NA_cat_2</th>
      <th>NA_cat_3</th>
      <th>NA_price</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2020-01-23 13:55:58 UTC</td>
      <td>cart</td>
      <td>1002524</td>
      <td>apple</td>
      <td>514.81</td>
      <td>568965448</td>
      <td>ed183a73-dbce-4f24-893c-fcf8541ec69a</td>
      <td>0</td>
      <td>2020-01-23 13:55:58</td>
      <td>13</td>
      <td>55</td>
      <td>3</td>
      <td>23</td>
      <td>1</td>
      <td>2020</td>
      <td>construction</td>
      <td>tools</td>
      <td>light</td>
      <td>NA</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2020-01-23 13:55:59 UTC</td>
      <td>cart</td>
      <td>1005099</td>
      <td>samsung</td>
      <td>141.05</td>
      <td>603972321</td>
      <td>5bf2241f-6062-4403-9fd5-b746e43149e2</td>
      <td>0</td>
      <td>2020-01-23 13:55:59</td>
      <td>13</td>
      <td>55</td>
      <td>3</td>
      <td>23</td>
      <td>1</td>
      <td>2020</td>
      <td>construction</td>
      <td>tools</td>
      <td>light</td>
      <td>NA</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2020-01-23 13:55:59 UTC</td>
      <td>cart</td>
      <td>1002524</td>
      <td>apple</td>
      <td>514.81</td>
      <td>568965448</td>
      <td>ed183a73-dbce-4f24-893c-fcf8541ec69a</td>
      <td>0</td>
      <td>2020-01-23 13:55:59</td>
      <td>13</td>
      <td>55</td>
      <td>3</td>
      <td>23</td>
      <td>1</td>
      <td>2020</td>
      <td>construction</td>
      <td>tools</td>
      <td>light</td>
      <td>NA</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2020-01-23 13:55:59 UTC</td>
      <td>cart</td>
      <td>1002524</td>
      <td>apple</td>
      <td>514.81</td>
      <td>568965448</td>
      <td>ed183a73-dbce-4f24-893c-fcf8541ec69a</td>
      <td>0</td>
      <td>2020-01-23 13:55:59</td>
      <td>13</td>
      <td>55</td>
      <td>3</td>
      <td>23</td>
      <td>1</td>
      <td>2020</td>
      <td>construction</td>
      <td>tools</td>
      <td>light</td>
      <td>NA</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2020-01-23 13:55:59 UTC</td>
      <td>cart</td>
      <td>26010323</td>
      <td>UNKNOWN</td>
      <td>9.01</td>
      <td>530857374</td>
      <td>26b6aa26-d125-4cb4-9249-f74053b0b950</td>
      <td>0</td>
      <td>2020-01-23 13:55:59</td>
      <td>13</td>
      <td>55</td>
      <td>3</td>
      <td>23</td>
      <td>1</td>
      <td>2020</td>
      <td>NA</td>
      <td>NA</td>
      <td>NA</td>
      <td>NA</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0
</pre></div>
</div>
</div>
</div>
<p>Predicting missing values: In <a class="reference external" href="https://arxiv.org/abs/2002.05515">Improving Deep Learning For Airbnb Search</a>, the authors propose to use a DNN for missing user engagement features of new items (listenings). New items have no historical user engagements, such as # of views, # of bookings, etc.. In the paper, they train a DNN based on the meta information, such as price, location and predict the user engagements feature. This could be interpreted in what are the expected user engagement.</p>
<p>Instead of the hand-crafted default values for missing user engagement, the authors replaced the missing values with the prediction of the DNN and showed that it reduced the error by 43% (offline test) and improved the overall bookings by 0.38% (online A/B test).</p>
</div>
<div class="section" id="feature-cross-basics">
<h3>Feature cross - basics<a class="headerlink" href="#feature-cross-basics" title="Permalink to this headline">¶</a></h3>
<p><em>Combining Categories (CC)</em> is a simple, powerful technique, but often undervalued. We will use this strategy in other feature engineering techniques, as well, and will introduce its value in a simple example.</p>
<p>In some datasets, categories by itself provide no information to predict the target. But if we combine multiple categories, together, then we can indentify patterns.</p>
<p>For example, we have the following categories:</p>
<ul class="simple">
<li><p>Weekday</p></li>
<li><p>Hour of the day</p></li>
</ul>
<p>Each of them independently has no significant pattern in the dataset. If we combine them with Weekday_HourOfTheDay, then we can observe some strong behavior for certainn times on the weekend</p>
<p>Decision Trees determine the split in the dataset on single features. If each categorical feature by itself does not provide the information gain, then Decision Trees cannot find a good split. If we provide a combined categorical feature, the Decision Tree can easier split the dataset.</p>
<p>Combining categories, also called Cross Column or Cross Product, is used in the Wide Deep Architecture by Google and is implemented in Tensorflow.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">f1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">45</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">45</span> <span class="o">+</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="mi">10</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span> <span class="o">+</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="mi">90</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span> <span class="o">+</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="mi">90</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">45</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">45</span> <span class="o">+</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="mi">10</span>
<span class="n">f2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">45</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">45</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">10</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">90</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">90</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">45</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">45</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">10</span>
<span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">45</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">45</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">10</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">90</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">90</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">45</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">45</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">10</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">cudf</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;f1&#39;</span><span class="p">:</span> <span class="n">f1</span><span class="p">,</span>
    <span class="s1">&#39;f2&#39;</span><span class="p">:</span> <span class="n">f2</span><span class="p">,</span>
<span class="p">})</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;f&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)),</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">data</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>f1</th>
      <th>f2</th>
      <th>f3</th>
      <th>f4</th>
      <th>target</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>2</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>2</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>1</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We take a look on the features f1 and f2. Each of the feature provides no information gain as each category has a 0.5 probability for the target.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;f1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean</th>
      <th>count</th>
    </tr>
    <tr>
      <th>f1</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>0.5</td>
      <td>100</td>
    </tr>
    <tr>
      <th>0</th>
      <td>0.5</td>
      <td>100</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.5</td>
      <td>200</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;f2&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean</th>
      <th>count</th>
    </tr>
    <tr>
      <th>f2</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>0.5</td>
      <td>200</td>
    </tr>
    <tr>
      <th>0</th>
      <td>0.5</td>
      <td>200</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>If we analyze the features f1 and f2 together, we can observe a significant pattern in the target variable.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;f1&#39;</span><span class="p">,</span> <span class="s1">&#39;f2&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>mean</th>
      <th>count</th>
    </tr>
    <tr>
      <th>f1</th>
      <th>f2</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <th>0</th>
      <td>0.9</td>
      <td>50</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">1</th>
      <th>1</th>
      <td>0.1</td>
      <td>50</td>
    </tr>
    <tr>
      <th>0</th>
      <td>0.9</td>
      <td>50</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">2</th>
      <th>1</th>
      <td>0.9</td>
      <td>100</td>
    </tr>
    <tr>
      <th>0</th>
      <td>0.1</td>
      <td>100</td>
    </tr>
    <tr>
      <th>0</th>
      <th>1</th>
      <td>0.1</td>
      <td>50</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Next, we train a simple Decision Tree to show how combining categories will support the decision boundaries.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pydotplus</span>
<span class="kn">import</span> <span class="nn">sklearn.tree</span> <span class="k">as</span> <span class="nn">tree</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Image</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_hotn_features</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">col</span> <span class="o">!=</span> <span class="s1">&#39;target&#39;</span><span class="p">:</span>
            <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">prefix</span><span class="o">=</span><span class="n">col</span><span class="p">))</span>
    <span class="k">return</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">viz_tree</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">lf</span><span class="p">):</span>
    <span class="n">dt_feature_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">get_hotn_features</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="n">dt_target_names</span> <span class="o">=</span> <span class="s1">&#39;target&#39;</span>
    <span class="n">tree</span><span class="o">.</span><span class="n">export_graphviz</span><span class="p">(</span><span class="n">lf</span><span class="p">,</span> <span class="n">out_file</span><span class="o">=</span><span class="s1">&#39;tree.dot&#39;</span><span class="p">,</span> 
                         <span class="n">feature_names</span><span class="o">=</span><span class="n">dt_feature_names</span><span class="p">,</span> <span class="n">class_names</span><span class="o">=</span><span class="n">dt_target_names</span><span class="p">,</span>
                         <span class="n">filled</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  
    <span class="n">graph</span> <span class="o">=</span> <span class="n">pydotplus</span><span class="o">.</span><span class="n">graph_from_dot_file</span><span class="p">(</span><span class="s1">&#39;tree.dot&#39;</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">create_png</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<p>First, we train it without the combined categories f1 and f2. We can see, that the Decision Trees creates the split on the random features f3 and f4. The leaves have only a small information gain (e.g. 98 negative vs. 82 positive).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lf</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">lf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">get_hotn_features</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;target&#39;</span><span class="p">]])</span>
<span class="n">Image</span><span class="p">(</span><span class="n">viz_tree</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">lf</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/T513987_Recsys_2020_Feature_Engineering_Tutorial_100_0.png" src="../_images/T513987_Recsys_2020_Feature_Engineering_Tutorial_100_0.png" />
</div>
</div>
<p>Now, we combine the categories f1 and f2 as an additional feature. We can see that the Decision Tree uses that feature first and that the splits have a high information gain. For example, 190 negative vs. 110 positives.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;f1_f2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;f1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;f2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">get_hotn_features</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;target&#39;</span><span class="p">]])</span>
<span class="n">Image</span><span class="p">(</span><span class="n">viz_tree</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">lf</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/T513987_Recsys_2020_Feature_Engineering_Tutorial_103_0.png" src="../_images/T513987_Recsys_2020_Feature_Engineering_Tutorial_103_0.png" />
</div>
</div>
<p>This simple technique will be used in combination with other feature engineering techniques.</p>
<p>We may have the idea - that is great, let’s combine all categories into one feature. Unfortunately, this is not that easy. We want to balance the number of categories used, the number of observations in resulting category values and the information gain:</p>
<p>The more categories we combine, we will identify more underlying patterns - but combining more categories together reduces the number of observation per categoy in the resulting features
Higher number of observation in the resulting category shows a strong pattern and it is more generalizable
High information gain supports our model, but only if it is generalizable
The extreme example is that we combine all features f1, f2, f3 and f4 together. But the observation per category (count) is very small (4-20)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="s1">&#39;target&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">x</span> <span class="ow">and</span> <span class="s1">&#39;f1_f2&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">x</span><span class="p">])</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>mean</th>
      <th>count</th>
    </tr>
    <tr>
      <th>f1</th>
      <th>f2</th>
      <th>f3</th>
      <th>f4</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="10" valign="top">0</th>
      <th rowspan="9" valign="top">0</th>
      <th rowspan="3" valign="top">0</th>
      <th>0</th>
      <td>1.000000</td>
      <td>4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.000000</td>
      <td>6</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.000000</td>
      <td>5</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">1</th>
      <th>0</th>
      <td>0.857143</td>
      <td>7</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.000000</td>
      <td>5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.000000</td>
      <td>8</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">2</th>
      <th>0</th>
      <td>0.666667</td>
      <td>3</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.000000</td>
      <td>5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.571429</td>
      <td>7</td>
    </tr>
    <tr>
      <th>1</th>
      <th>0</th>
      <th>0</th>
      <td>0.000000</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Best practices:</p>
<ul class="simple">
<li><p>Combining low cardinal categories is a good start. For example, the dataset size is 100M rows and there are multiple categories with a caridnality (# of unique values) of 10-50, then combining them should not result in low observation count</p></li>
<li><p>Exploratory Data Analysis (EDA) is faster than training a model. Analyzing the information value for different combination of categorical features (on a sample) is really fast.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example of getting the cardinality for categories:</span>
<span class="n">df</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>f1</th>
      <th>f2</th>
      <th>f3</th>
      <th>f4</th>
      <th>target</th>
      <th>f1_f2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>400</td>
      <td>400</td>
      <td>400</td>
      <td>400</td>
      <td>400</td>
      <td>400</td>
    </tr>
    <tr>
      <th>unique</th>
      <td>3</td>
      <td>2</td>
      <td>3</td>
      <td>3</td>
      <td>2</td>
      <td>6</td>
    </tr>
    <tr>
      <th>top</th>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>21</td>
    </tr>
    <tr>
      <th>freq</th>
      <td>200</td>
      <td>200</td>
      <td>137</td>
      <td>136</td>
      <td>200</td>
      <td>100</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="apply-feature-cross">
<h3>Apply feature cross<a class="headerlink" href="#apply-feature-cross" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">explore_cat</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">cats</span><span class="p">):</span>
    <span class="n">df_agg</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">[</span><span class="n">cats</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">cats</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="n">df_agg</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">cats</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">df_agg</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>
    
<span class="n">cats</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;product_id&#39;</span><span class="p">,</span> <span class="s1">&#39;user_id&#39;</span><span class="p">]</span>  
<span class="n">explore_cat</span><span class="p">(</span><span class="n">df_train</span><span class="p">,</span> <span class="n">cats</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>         product_id    user_id      mean  count
553991      1004767  545442548  0.000000    807
2757949     1004767  525325337  0.000000    753
832745      1005107  553431815  0.598372    737
2887447    15300303  512875426  0.000000    709
4631256     1005174  563599039  0.929412    510
2162303     1004873  515032042  0.002041    490
2890567     4804718  536911254  0.000000    471
5949107     8800045  557590749  0.000000    380
5436668     1002524  515598234  0.581522    368
759242      3601537  578263741  0.000000    363
2090692     1004833  564068124  0.791667    360
5431410     1005115  516010934  0.616046    349
5744834     1005100  611998200  0.000000    333
5843134     1004249  513901034  0.648562    313
5548274     1005008  521558076  0.003236    309
1026458     1005161  512924342  0.535354    297
640836      4804718  576154686  0.548611    288
6111734   100007950  515481166  0.000000    287
2510850     3601489  513824664  0.000000    275
119345      1002544  545376441  0.896296    270
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cats</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ts_weekday&#39;</span><span class="p">,</span> <span class="s1">&#39;ts_hour&#39;</span><span class="p">]</span>  
<span class="n">explore_cat</span><span class="p">(</span><span class="n">df_train</span><span class="p">,</span> <span class="n">cats</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>     ts_weekday  ts_hour      mean   count
101           4        9  0.302715  136237
18            4        8  0.305953  134661
155           4       10  0.302520  131525
51            4        7  0.298787  128148
104           5        7  0.315947  126382
118           4        6  0.282097  126070
43            4       11  0.293566  126026
55            5        8  0.359090  125818
110           5        9  0.414171  123601
145           6       10  0.412849  123343
106           6        8  0.411147  122776
156           6        7  0.412360  121891
98            5       10  0.402228  121344
127           6        9  0.407846  121183
152           6       11  0.429601  120726
126           5        6  0.315390  120679
135           4        5  0.279342  118364
8             5       11  0.346054  117187
11            6        6  0.411512  115909
47            6       12  0.423719  113927
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cats</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cat_2&#39;</span><span class="p">,</span> <span class="s1">&#39;brand&#39;</span><span class="p">]</span>  
<span class="n">explore_cat</span><span class="p">(</span><span class="n">df_train</span><span class="p">,</span> <span class="n">cats</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                cat_2     brand      mean    count
141             light   samsung  0.478160  1216099
9278            light     apple  0.465644  1018787
5421               NA     apple  0.377829   883712
471                NA   samsung  0.400737   717738
4594               NA   UNKNOWN  0.275269   522929
192             light    xiaomi  0.393963   512147
3416               NA    xiaomi  0.288319   484502
8098            light    huawei  0.457535   229552
8266        headphone     apple  0.327196   121447
3730               NA    huawei  0.377412   117524
1929               NA  cordiant  0.245952   110062
2079               NA      sony  0.359959   109354
8914            light      oppo  0.501943    99097
1602         massager   samsung  0.403950    85726
10974          vacuum   samsung  0.388883    68545
10844          washer   samsung  0.331476    59416
2793   coffee_grinder   lucente  0.508868    58469
5568    refrigerators   samsung  0.446318    57636
9342               NA      oppo  0.391734    56084
6555               NA   lucente  0.378844    53394
</pre></div>
</div>
</div>
</div>
<p>Hypothesis:</p>
<ul class="simple">
<li><p>Some user will always buy the same one-way products e.g. cleaning supplies, food</p></li>
<li><p>Behavior changes on weekday+hour - e.g. during the week, users will not stay up late as they work next day</p></li>
<li><p>Category and brand are both powerful features, but the combination can be more important. E.g. do people buy apple smartphones or accessories?</p></li>
</ul>
</div>
<div class="section" id="categorify">
<h3>Categorify<a class="headerlink" href="#categorify" title="Permalink to this headline">¶</a></h3>
<p><em>Categorifying</em> is required for using categorical features in deep learning models with Embedding layers. An Embedding layer encodes the category into a hidden latent vector with a smaller dimension.</p>
<p>Categorical features can be from datatype String or Integer. The Embedding layer requires that categorical features are continoues, positive Integers from 0 to |C| (number of unique category values).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;product_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0           1000894
1           1000978
2           1001588
3           1001605
4           1001606
            ...    
164448    100143856
164449    100143867
164450    100144046
164451    100144443
164452    100144608
Name: product_id, Length: 164453, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Using factorize creates continous integers from a categorical feature</span>
<span class="n">codes</span><span class="p">,</span> <span class="n">uniques</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;product_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">factorize</span><span class="p">()</span>
<span class="n">codes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([   24,  1033,    24, ..., 37414,   776, 18803], dtype=int32)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">uniques</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Int64Index([  1000894,   1000978,   1001588,   1001605,   1001606,   1001618,
              1001619,   1001820,   1002042,   1002062,
            ...
            100143480, 100143510, 100143590, 100143628, 100143638, 100143856,
            100143867, 100144046, 100144443, 100144608],
           dtype=&#39;int64&#39;, length=164453)
</pre></div>
</div>
</div>
</div>
<p>Another important reason to Categorify categorical features is to reduce the size of the dataset. Often categorical features are of the datatype String and sometimes, they are hashed to protect the user / dataset privacy.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">getsizeof</span>
</pre></div>
</div>
</div>
</div>
<p>For example, we can hash the Integer 0 to a md5 hash</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;0&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;cfcd208495d565ef66e7dff9f98764da&#39;
</pre></div>
</div>
</div>
</div>
<p>We can hash the full product_id column</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hashSeries</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;product_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">())</span>
<span class="n">hashSeries</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0           869aaba3c9113c27539bb1c3232e651c
1           a545dff4990390c31fa997325f45f697
2           869aaba3c9113c27539bb1c3232e651c
3           869aaba3c9113c27539bb1c3232e651c
4           eaefcc8eeaf8ee99768f5bd0e4ded9b9
                          ...               
11495240    6c05e1b9e466725f725df0326a1b5039
11495241    8ce7e84738eb6f686d418101d520df2e
11495242    cedc44508ef5c516bc445fe2944c4b91
11495243    6b327527a0cf16326f9dd2bf455c3056
11495244    032bab49d0c08d80d8ff08f826078dd4
Name: product_id, Length: 11495245, dtype: object
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">codes</span><span class="p">,</span> <span class="n">uniques</span> <span class="o">=</span> <span class="n">hashSeries</span><span class="o">.</span><span class="n">factorize</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;product id column size is reduced from </span><span class="si">{}</span><span class="s2"> to </span><span class="si">{}</span><span class="s2">. We need only </span><span class="si">{:.2f}% o</span><span class="s2">f the original DataSeries memory.&quot;</span>\
      <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">getsizeof</span><span class="p">(</span><span class="n">hashSeries</span><span class="p">),</span> <span class="n">getsizeof</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">codes</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span>
              <span class="n">getsizeof</span><span class="p">(</span><span class="n">hashSeries</span><span class="p">)</span><span class="o">/</span><span class="n">getsizeof</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">codes</span><span class="p">)[</span><span class="mi">0</span><span class="p">])))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>product id column size is reduced from 1023076965 to 91962120. We need only 11.12% of the original DataSeries memory.
</pre></div>
</div>
</div>
</div>
<p>Finally, we can prevent overfitting for low frequency categories. Categories with low frequency can be grouped together to an new category called ‘other’. In the previous exercise we learned that it is powerful to combine categorical features together to create a new feature. However, combining categories increases the cardinality of the new feature and the number of observations per category will decrease. Therefore, we can apply a treshhold to group all categories with lower frequency count to the the new category.</p>
<p>In addition, categories, which occurs in the validation dataset and do not occur in the training dataset, should be mapped to the ‘other’ category as well.</p>
<p>We use in our example the category Ids 0 or 1 for a placeholder for the low frequency and unkown category. Then our function is independent of the cardinality of the categorical feature and we do not keep records of the cardinality to know the low frequency/unkown category.</p>
<p>In our dataset, we see that multiple product_ids occur only once in the training dataset. Our model would overfit to these low frequency categories.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">=</span> <span class="s1">&#39;product_id&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">freq</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">[</span><span class="n">cat</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="n">freq</span> <span class="o">=</span> <span class="n">freq</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">freq</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">cat</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">]</span>
<span class="n">freq</span> <span class="o">=</span> <span class="n">freq</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">freq</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">cat</span> <span class="o">+</span> <span class="s1">&#39;_Categorify&#39;</span><span class="p">,</span> <span class="n">cat</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">]</span>
<span class="n">freq_filtered</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">5</span><span class="p">]</span>
<span class="n">freq_filtered</span><span class="p">[</span><span class="n">cat</span> <span class="o">+</span> <span class="s1">&#39;_Categorify&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">freq_filtered</span><span class="p">[</span><span class="n">cat</span> <span class="o">+</span> <span class="s1">&#39;_Categorify&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
<span class="n">freq_filtered</span> <span class="o">=</span> <span class="n">freq_filtered</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">freq_filtered</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>product_id_Categorify</th>
      <th>product_id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1004767</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>1005115</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>1004856</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>4804056</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>1005100</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">freq_filtered</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(76500, 2)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_train</span> <span class="o">=</span> <span class="n">df_train</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">freq_filtered</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="n">cat</span><span class="p">)</span> <span class="c1">#giving memory error</span>
<span class="n">df_train</span><span class="p">[</span><span class="n">cat</span> <span class="o">+</span> <span class="s1">&#39;_Categorify&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">[</span><span class="n">cat</span> <span class="o">+</span> <span class="s1">&#39;_Categorify&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;product_id_Categorify&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;product_id_Categorify&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;product_id_Categorify&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
</div>
<p>We need to apply the categorify to our validation and test sets.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_valid</span> <span class="o">=</span> <span class="n">df_valid</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">freq_filtered</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="n">cat</span><span class="p">)</span>
<span class="n">df_valid</span><span class="p">[</span><span class="n">cat</span> <span class="o">+</span> <span class="s1">&#39;_Categorify&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_valid</span><span class="p">[</span><span class="n">cat</span> <span class="o">+</span> <span class="s1">&#39;_Categorify&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">df_test</span> <span class="o">=</span> <span class="n">df_test</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">freq_filtered</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="n">cat</span><span class="p">)</span>
<span class="n">df_test</span><span class="p">[</span><span class="n">cat</span> <span class="o">+</span> <span class="s1">&#39;_Categorify&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_test</span><span class="p">[</span><span class="n">cat</span> <span class="o">+</span> <span class="s1">&#39;_Categorify&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Categorify is important to enable deep learning models to use categorical features</p></li>
<li><p>Categorify can significantly reduce the dataset size by tranforming categorical features from String datatypes to Integer datatypes</p></li>
<li><p>Categorify can prevent overfitting by grouping categories with low frequency into one category together</p></li>
</ul>
<p>Categorify the category features brand, Apply a frequency treshhold of minimum 20, Map low frequency categories to the id=0, and Map unkown categories to the id=1 in the validation and test set</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">=</span> <span class="s1">&#39;brand&#39;</span>

<span class="n">freq</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">[</span><span class="n">cat</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="n">freq</span> <span class="o">=</span> <span class="n">freq</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">freq</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">cat</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">]</span>
<span class="n">freq</span> <span class="o">=</span> <span class="n">freq</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">freq</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">cat</span> <span class="o">+</span> <span class="s1">&#39;_Categorify&#39;</span><span class="p">,</span> <span class="n">cat</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">]</span>
<span class="n">freq</span><span class="p">[</span><span class="n">cat</span> <span class="o">+</span> <span class="s1">&#39;_Categorify&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">freq</span><span class="p">[</span><span class="n">cat</span> <span class="o">+</span> <span class="s1">&#39;_Categorify&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span>
<span class="n">freq</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">freq</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">20</span><span class="p">,</span> <span class="n">cat</span> <span class="o">+</span> <span class="s1">&#39;_Categorify&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">freq</span> <span class="o">=</span> <span class="n">freq</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># df_train = df_train.merge(freq, how=&#39;left&#39;, on=cat)</span>
<span class="c1"># df_train[cat + &#39;_Categorify&#39;] = df_train[cat + &#39;_Categorify&#39;].fillna(1)</span>

<span class="n">df_valid</span> <span class="o">=</span> <span class="n">df_valid</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="n">cat</span><span class="p">)</span>
<span class="n">df_valid</span><span class="p">[</span><span class="n">cat</span> <span class="o">+</span> <span class="s1">&#39;_Categorify&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_valid</span><span class="p">[</span><span class="n">cat</span> <span class="o">+</span> <span class="s1">&#39;_Categorify&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">df_test</span> <span class="o">=</span> <span class="n">df_test</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="n">cat</span><span class="p">)</span>
<span class="n">df_test</span><span class="p">[</span><span class="n">cat</span> <span class="o">+</span> <span class="s1">&#39;_Categorify&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_test</span><span class="p">[</span><span class="n">cat</span> <span class="o">+</span> <span class="s1">&#39;_Categorify&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_test</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>event_time</th>
      <th>event_type</th>
      <th>product_id</th>
      <th>brand</th>
      <th>price</th>
      <th>user_id</th>
      <th>user_session</th>
      <th>target</th>
      <th>timestamp</th>
      <th>ts_hour</th>
      <th>ts_minute</th>
      <th>ts_weekday</th>
      <th>ts_day</th>
      <th>ts_month</th>
      <th>ts_year</th>
      <th>cat_0</th>
      <th>cat_1</th>
      <th>cat_2</th>
      <th>cat_3</th>
      <th>product_id_Categorify</th>
      <th>brand_Categorify</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2020-04-09 16:47:18 UTC</td>
      <td>cart</td>
      <td>1005100</td>
      <td>samsung</td>
      <td>144.89</td>
      <td>604644674</td>
      <td>16b2649b-56d9-47e8-afe9-c16d97af142b</td>
      <td>0</td>
      <td>2020-04-09 16:47:18</td>
      <td>16</td>
      <td>47</td>
      <td>3</td>
      <td>9</td>
      <td>4</td>
      <td>2020</td>
      <td>construction</td>
      <td>tools</td>
      <td>light</td>
      <td>NA</td>
      <td>5</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2020-04-09 16:47:18 UTC</td>
      <td>cart</td>
      <td>1005100</td>
      <td>samsung</td>
      <td>144.89</td>
      <td>604644674</td>
      <td>16b2649b-56d9-47e8-afe9-c16d97af142b</td>
      <td>0</td>
      <td>2020-04-09 16:47:18</td>
      <td>16</td>
      <td>47</td>
      <td>3</td>
      <td>9</td>
      <td>4</td>
      <td>2020</td>
      <td>construction</td>
      <td>tools</td>
      <td>light</td>
      <td>NA</td>
      <td>5</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2020-04-09 16:47:18 UTC</td>
      <td>cart</td>
      <td>1005100</td>
      <td>samsung</td>
      <td>144.89</td>
      <td>604644674</td>
      <td>16b2649b-56d9-47e8-afe9-c16d97af142b</td>
      <td>0</td>
      <td>2020-04-09 16:47:18</td>
      <td>16</td>
      <td>47</td>
      <td>3</td>
      <td>9</td>
      <td>4</td>
      <td>2020</td>
      <td>construction</td>
      <td>tools</td>
      <td>light</td>
      <td>NA</td>
      <td>5</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2020-04-09 16:47:18 UTC</td>
      <td>cart</td>
      <td>1005100</td>
      <td>samsung</td>
      <td>144.89</td>
      <td>604644674</td>
      <td>16b2649b-56d9-47e8-afe9-c16d97af142b</td>
      <td>0</td>
      <td>2020-04-09 16:47:18</td>
      <td>16</td>
      <td>47</td>
      <td>3</td>
      <td>9</td>
      <td>4</td>
      <td>2020</td>
      <td>construction</td>
      <td>tools</td>
      <td>light</td>
      <td>NA</td>
      <td>5</td>
      <td>2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2020-04-09 16:47:18 UTC</td>
      <td>cart</td>
      <td>1005100</td>
      <td>samsung</td>
      <td>144.89</td>
      <td>604644674</td>
      <td>16b2649b-56d9-47e8-afe9-c16d97af142b</td>
      <td>0</td>
      <td>2020-04-09 16:47:18</td>
      <td>16</td>
      <td>47</td>
      <td>3</td>
      <td>9</td>
      <td>4</td>
      <td>2020</td>
      <td>construction</td>
      <td>tools</td>
      <td>light</td>
      <td>NA</td>
      <td>5</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_test</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>product_id</th>
      <th>price</th>
      <th>user_id</th>
      <th>target</th>
      <th>ts_hour</th>
      <th>ts_minute</th>
      <th>ts_weekday</th>
      <th>ts_day</th>
      <th>ts_month</th>
      <th>ts_year</th>
      <th>product_id_Categorify</th>
      <th>brand_Categorify</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>2.781482e+06</td>
      <td>2.781482e+06</td>
      <td>2.781482e+06</td>
      <td>2.781482e+06</td>
      <td>2.781482e+06</td>
      <td>2.781482e+06</td>
      <td>2.781482e+06</td>
      <td>2.781482e+06</td>
      <td>2781482.0</td>
      <td>2781482.0</td>
      <td>2.781482e+06</td>
      <td>2.781482e+06</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>2.927051e+07</td>
      <td>2.395021e+02</td>
      <td>5.848275e+08</td>
      <td>3.450640e-01</td>
      <td>1.072351e+01</td>
      <td>2.957519e+01</td>
      <td>2.923329e+00</td>
      <td>1.679353e+01</td>
      <td>4.0</td>
      <td>2020.0</td>
      <td>6.096862e+03</td>
      <td>8.782552e+01</td>
    </tr>
    <tr>
      <th>std</th>
      <td>4.029024e+07</td>
      <td>2.963358e+02</td>
      <td>4.832589e+07</td>
      <td>4.753890e-01</td>
      <td>4.940534e+00</td>
      <td>1.730840e+01</td>
      <td>1.923655e+00</td>
      <td>8.294825e+00</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.323384e+04</td>
      <td>2.537361e+02</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1.001402e+06</td>
      <td>0.000000e+00</td>
      <td>9.636947e+07</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>1.000000e+00</td>
      <td>4.0</td>
      <td>2020.0</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>1.005217e+06</td>
      <td>4.807000e+01</td>
      <td>5.374738e+08</td>
      <td>0.000000e+00</td>
      <td>7.000000e+00</td>
      <td>1.500000e+01</td>
      <td>1.000000e+00</td>
      <td>1.000000e+01</td>
      <td>4.0</td>
      <td>2020.0</td>
      <td>1.400000e+01</td>
      <td>2.000000e+00</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>5.801305e+06</td>
      <td>1.490400e+02</td>
      <td>5.912242e+08</td>
      <td>0.000000e+00</td>
      <td>1.000000e+01</td>
      <td>3.000000e+01</td>
      <td>3.000000e+00</td>
      <td>1.700000e+01</td>
      <td>4.0</td>
      <td>2020.0</td>
      <td>2.980000e+02</td>
      <td>6.000000e+00</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>4.050000e+07</td>
      <td>2.941900e+02</td>
      <td>6.349695e+08</td>
      <td>1.000000e+00</td>
      <td>1.500000e+01</td>
      <td>4.500000e+01</td>
      <td>5.000000e+00</td>
      <td>2.400000e+01</td>
      <td>4.0</td>
      <td>2020.0</td>
      <td>4.574000e+03</td>
      <td>4.400000e+01</td>
    </tr>
    <tr>
      <th>max</th>
      <td>1.002337e+08</td>
      <td>2.574070e+03</td>
      <td>6.497754e+08</td>
      <td>1.000000e+00</td>
      <td>2.300000e+01</td>
      <td>5.900000e+01</td>
      <td>6.000000e+00</td>
      <td>3.000000e+01</td>
      <td>4.0</td>
      <td>2020.0</td>
      <td>7.649800e+04</td>
      <td>2.704000e+03</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_test</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>event_time</th>
      <th>event_type</th>
      <th>brand</th>
      <th>user_session</th>
      <th>timestamp</th>
      <th>cat_0</th>
      <th>cat_1</th>
      <th>cat_2</th>
      <th>cat_3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>2781482</td>
      <td>2781482</td>
      <td>2518085</td>
      <td>2781438</td>
      <td>2781482</td>
      <td>2781482</td>
      <td>2781482</td>
      <td>2781482</td>
      <td>2781482</td>
    </tr>
    <tr>
      <th>unique</th>
      <td>1475322</td>
      <td>2</td>
      <td>3244</td>
      <td>1826140</td>
      <td>1475322</td>
      <td>14</td>
      <td>63</td>
      <td>91</td>
      <td>2</td>
    </tr>
    <tr>
      <th>top</th>
      <td>2020-04-07 15:50:31 UTC</td>
      <td>cart</td>
      <td>samsung</td>
      <td>c388eb36-c432-4c8f-8809-0f7bca7d732e</td>
      <td>2020-04-07 15:50:31</td>
      <td>construction</td>
      <td>tools</td>
      <td>light</td>
      <td>NA</td>
    </tr>
    <tr>
      <th>freq</th>
      <td>78</td>
      <td>1821692</td>
      <td>580038</td>
      <td>705</td>
      <td>78</td>
      <td>1040618</td>
      <td>1031554</td>
      <td>974229</td>
      <td>2774627</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="target-encoding">
<h3>Target encoding<a class="headerlink" href="#target-encoding" title="Permalink to this headline">¶</a></h3>
<p><em>Target Encoding (TE)</em> calculates the statistics from a target variable grouped by the unique values of one or more categorical features.</p>
<p>For example in a binary classification problem, it calculates the probability that the target is true for each category value - a simple mean.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;brand&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;brand&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;UNKNOWN&#39;</span><span class="p">)</span>
<span class="n">df_valid</span><span class="p">[</span><span class="s1">&#39;brand&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_valid</span><span class="p">[</span><span class="s1">&#39;brand&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;UNKNOWN&#39;</span><span class="p">)</span>
<span class="n">df_test</span><span class="p">[</span><span class="s1">&#39;brand&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_test</span><span class="p">[</span><span class="s1">&#39;brand&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;UNKNOWN&#39;</span><span class="p">)</span>
<span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;cat_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;cat_2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;UNKNOWN&#39;</span><span class="p">)</span>
<span class="n">df_valid</span><span class="p">[</span><span class="s1">&#39;cat_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_valid</span><span class="p">[</span><span class="s1">&#39;cat_2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;UNKNOWN&#39;</span><span class="p">)</span>
<span class="n">df_test</span><span class="p">[</span><span class="s1">&#39;cat_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_test</span><span class="p">[</span><span class="s1">&#39;cat_2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;UNKNOWN&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">=</span> <span class="s1">&#39;brand&#39;</span>

<span class="n">te</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">[[</span><span class="n">cat</span><span class="p">,</span> <span class="s1">&#39;target&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">cat</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">te</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>target</th>
    </tr>
    <tr>
      <th>brand</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>zajkami</th>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>sherlock</th>
      <td>0.571429</td>
    </tr>
    <tr>
      <th>ves</th>
      <td>0.239130</td>
    </tr>
    <tr>
      <th>triumphtree</th>
      <td>0.207692</td>
    </tr>
    <tr>
      <th>tigar</th>
      <td>0.182229</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
    </tr>
    <tr>
      <th>nyne</th>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>nocnezna</th>
      <td>0.350515</td>
    </tr>
    <tr>
      <th>mojdodyr</th>
      <td>0.714286</td>
    </tr>
    <tr>
      <th>joerex</th>
      <td>0.219101</td>
    </tr>
    <tr>
      <th>nord</th>
      <td>0.225352</td>
    </tr>
  </tbody>
</table>
<p>4638 rows × 1 columns</p>
</div></div></div>
</div>
<p>if you get MemoryError: std::bad_alloc: CUDA error at: /usr/local/include/rmm/mr/device/cuda_memory_resource.hpp:69: cudaErrorMemoryAllocation out of memory error, restart the session and run data loading blocks. It will free-up the GPU memory.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">te</span> <span class="o">=</span> <span class="n">te</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">te</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">cat</span><span class="p">,</span> <span class="s1">&#39;TE_&#39;</span> <span class="o">+</span> <span class="n">cat</span><span class="p">]</span>



<span class="c1"># using small sample of 1 million records</span>
<span class="n">df_train</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">1000000</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">te</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="n">cat</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>event_time</th>
      <th>event_type</th>
      <th>product_id</th>
      <th>brand</th>
      <th>price</th>
      <th>user_id</th>
      <th>user_session</th>
      <th>target</th>
      <th>timestamp</th>
      <th>ts_hour</th>
      <th>ts_minute</th>
      <th>ts_weekday</th>
      <th>ts_day</th>
      <th>ts_month</th>
      <th>ts_year</th>
      <th>cat_0</th>
      <th>cat_1</th>
      <th>cat_2</th>
      <th>cat_3</th>
      <th>NA_brand</th>
      <th>NA_user_session</th>
      <th>NA_cat_0</th>
      <th>NA_cat_1</th>
      <th>NA_cat_2</th>
      <th>NA_cat_3</th>
      <th>NA_price</th>
      <th>TE_brand</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2020-02-04 10:10:27 UTC</td>
      <td>cart</td>
      <td>32701200</td>
      <td>zemex</td>
      <td>99.69</td>
      <td>516509684</td>
      <td>b8c19628-67b7-44a5-9b84-0b53a94fc815</td>
      <td>0</td>
      <td>2020-02-04 10:10:27</td>
      <td>10</td>
      <td>10</td>
      <td>1</td>
      <td>4</td>
      <td>2</td>
      <td>2020</td>
      <td>apparel</td>
      <td>shoes</td>
      <td>NA</td>
      <td>NA</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.214815</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2019-12-17 17:28:54 UTC</td>
      <td>purchase</td>
      <td>1005119</td>
      <td>apple</td>
      <td>972.74</td>
      <td>545679084</td>
      <td>42f88377-2d87-4e61-8176-744ed7934eaa</td>
      <td>1</td>
      <td>2019-12-17 17:28:54</td>
      <td>17</td>
      <td>28</td>
      <td>1</td>
      <td>17</td>
      <td>12</td>
      <td>2019</td>
      <td>construction</td>
      <td>tools</td>
      <td>light</td>
      <td>NA</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.418314</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2019-10-09 20:29:52 UTC</td>
      <td>cart</td>
      <td>5100503</td>
      <td>xiaomi</td>
      <td>23.00</td>
      <td>517829035</td>
      <td>72999ff9-75c1-4145-b022-959c3afb9391</td>
      <td>0</td>
      <td>2019-10-09 20:29:52</td>
      <td>20</td>
      <td>29</td>
      <td>2</td>
      <td>9</td>
      <td>10</td>
      <td>2019</td>
      <td>NA</td>
      <td>NA</td>
      <td>NA</td>
      <td>NA</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.337278</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2020-01-23 11:57:48 UTC</td>
      <td>cart</td>
      <td>10301357</td>
      <td>welly</td>
      <td>6.92</td>
      <td>605023154</td>
      <td>56912ae4-4a9b-4c8a-bb88-bba0530af2a3</td>
      <td>0</td>
      <td>2020-01-23 11:57:48</td>
      <td>11</td>
      <td>57</td>
      <td>3</td>
      <td>23</td>
      <td>1</td>
      <td>2020</td>
      <td>apparel</td>
      <td>scarf</td>
      <td>NA</td>
      <td>NA</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.064536</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2020-02-08 17:22:35 UTC</td>
      <td>cart</td>
      <td>1201292</td>
      <td>apple</td>
      <td>308.61</td>
      <td>516299461</td>
      <td>c67ae3d9-ee7c-4f7e-8818-7dec5e1535d8</td>
      <td>0</td>
      <td>2020-02-08 17:22:35</td>
      <td>17</td>
      <td>22</td>
      <td>5</td>
      <td>8</td>
      <td>2</td>
      <td>2020</td>
      <td>electronics</td>
      <td>tablet</td>
      <td>NA</td>
      <td>NA</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.418314</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Similarly, we can apply Target Encoding to a group of categorical features.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">te</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">[[</span><span class="s1">&#39;brand&#39;</span><span class="p">,</span> <span class="s1">&#39;cat_2&#39;</span><span class="p">,</span> <span class="s1">&#39;target&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;brand&#39;</span><span class="p">,</span> <span class="s1">&#39;cat_2&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">te</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>target</th>
    </tr>
    <tr>
      <th>brand</th>
      <th>cat_2</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>chaod</th>
      <th>NA</th>
      <td>0.120000</td>
    </tr>
    <tr>
      <th>bugaboo</th>
      <th>chair</th>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>vplaboratory</th>
      <th>NA</th>
      <td>0.500000</td>
    </tr>
    <tr>
      <th>berber</th>
      <th>NA</th>
      <td>0.142857</td>
    </tr>
    <tr>
      <th>kubanfarfor</th>
      <th>NA</th>
      <td>0.111111</td>
    </tr>
    <tr>
      <th>...</th>
      <th>...</th>
      <td>...</td>
    </tr>
    <tr>
      <th>hitachi</th>
      <th>acoustic</th>
      <td>0.500000</td>
    </tr>
    <tr>
      <th>hyperx</th>
      <th>headphone</th>
      <td>0.256870</td>
    </tr>
    <tr>
      <th>termit</th>
      <th>NA</th>
      <td>0.333333</td>
    </tr>
    <tr>
      <th>marshal</th>
      <th>NA</th>
      <td>0.144737</td>
    </tr>
    <tr>
      <th>ducray</th>
      <th>winch</th>
      <td>0.461538</td>
    </tr>
  </tbody>
</table>
<p>11154 rows × 1 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">te</span> <span class="o">=</span> <span class="n">te</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">te</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;brand&#39;</span><span class="p">,</span> <span class="s1">&#39;cat_2&#39;</span><span class="p">,</span> <span class="s1">&#39;TE_brand_cat_2&#39;</span><span class="p">]</span>
<span class="n">df_train</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">1000000</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">te</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;brand&#39;</span><span class="p">,</span> <span class="s1">&#39;cat_2&#39;</span><span class="p">],</span> <span class="n">right_on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;brand&#39;</span><span class="p">,</span> <span class="s1">&#39;cat_2&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>event_time</th>
      <th>event_type</th>
      <th>product_id</th>
      <th>brand</th>
      <th>price</th>
      <th>user_id</th>
      <th>user_session</th>
      <th>target</th>
      <th>timestamp</th>
      <th>ts_hour</th>
      <th>ts_minute</th>
      <th>ts_weekday</th>
      <th>ts_day</th>
      <th>ts_month</th>
      <th>ts_year</th>
      <th>cat_0</th>
      <th>cat_1</th>
      <th>cat_2</th>
      <th>cat_3</th>
      <th>NA_brand</th>
      <th>NA_user_session</th>
      <th>NA_cat_0</th>
      <th>NA_cat_1</th>
      <th>NA_cat_2</th>
      <th>NA_cat_3</th>
      <th>NA_price</th>
      <th>TE_brand_cat_2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2020-02-05 04:27:22 UTC</td>
      <td>cart</td>
      <td>44100020</td>
      <td>bibalina</td>
      <td>19.51</td>
      <td>522696854</td>
      <td>f65f7a48-14a3-4f4c-be31-7da05d0b6bbd</td>
      <td>0</td>
      <td>2020-02-05 04:27:22</td>
      <td>4</td>
      <td>27</td>
      <td>2</td>
      <td>5</td>
      <td>2</td>
      <td>2020</td>
      <td>NA</td>
      <td>NA</td>
      <td>NA</td>
      <td>NA</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.235135</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2020-01-10 07:54:06 UTC</td>
      <td>purchase</td>
      <td>5000475</td>
      <td>janome</td>
      <td>172.44</td>
      <td>552041316</td>
      <td>877ef70a-85b0-4865-bef6-49a2f0b709cb</td>
      <td>1</td>
      <td>2020-01-10 07:54:06</td>
      <td>7</td>
      <td>54</td>
      <td>4</td>
      <td>10</td>
      <td>1</td>
      <td>2020</td>
      <td>appliances</td>
      <td>sewing_machine</td>
      <td>NA</td>
      <td>NA</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.310899</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2020-01-04 09:01:01 UTC</td>
      <td>cart</td>
      <td>16400237</td>
      <td>UNKNOWN</td>
      <td>154.44</td>
      <td>518785103</td>
      <td>370cd9ab-afd9-435c-8d58-47cdd5af42e0</td>
      <td>0</td>
      <td>2020-01-04 09:01:01</td>
      <td>9</td>
      <td>1</td>
      <td>5</td>
      <td>4</td>
      <td>1</td>
      <td>2020</td>
      <td>NA</td>
      <td>NA</td>
      <td>NA</td>
      <td>NA</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.275269</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2020-02-15 13:36:19 UTC</td>
      <td>cart</td>
      <td>1005253</td>
      <td>xiaomi</td>
      <td>280.43</td>
      <td>546915503</td>
      <td>e53f9922-1183-4be0-b8e9-aaf821359b9d</td>
      <td>0</td>
      <td>2020-02-15 13:36:19</td>
      <td>13</td>
      <td>36</td>
      <td>5</td>
      <td>15</td>
      <td>2</td>
      <td>2020</td>
      <td>construction</td>
      <td>tools</td>
      <td>light</td>
      <td>NA</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.393963</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2020-01-08 14:05:01 UTC</td>
      <td>purchase</td>
      <td>12600003</td>
      <td>maxwell</td>
      <td>59.18</td>
      <td>537631301</td>
      <td>4f5c64d7-3f27-4e3e-abe2-69f1286bfe51</td>
      <td>1</td>
      <td>2020-01-08 14:05:01</td>
      <td>14</td>
      <td>5</td>
      <td>2</td>
      <td>8</td>
      <td>1</td>
      <td>2020</td>
      <td>appliances</td>
      <td>environment</td>
      <td>vacuum</td>
      <td>NA</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.371530</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Target Encoding creates a new features, which can be used by the model for training. The advantage of Target Encoding is, that it process the categorical features and makes them easier accessible to the model during training and validation.</p>
<p>Tree-based model requires to create a split for each categorical value (depending on the exact model). Target Encoding saves to create many splits for the model. In particular, when applying Target Encoding to multiple columns, it reduces significantly the number of splits. The model can directly operate on the probablities/averages and creates a split based on them.
Another advantage is, that some boosted-tree libraries, such as XGBoost, cannot handle categorical features. The library requires to hot-n encode them. Categorical features with large cardinality (e.g. &gt;100) are inefficient to store as hot-n.</p>
<p>Deep learning models often apply Embedding Layers to categorical features. Embedding layer can overfit quickly and categorical values with low frequencies have ony a few gradient descent updates and can memorize the training data.</p>
</div>
<div class="section" id="smoothing">
<h3>Smoothing<a class="headerlink" href="#smoothing" title="Permalink to this headline">¶</a></h3>
<p>The introduced Target Encoding is a good first step, but it lacks to generalize well and it will tend to overfit, as well.</p>
<p>Let’s take a look on Target Encoding with the observation count:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_train</span><span class="p">[[</span><span class="n">cat</span><span class="p">,</span> <span class="s1">&#39;target&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">cat</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">target</th>
    </tr>
    <tr>
      <th></th>
      <th>mean</th>
      <th>count</th>
    </tr>
    <tr>
      <th>brand</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>zajkami</th>
      <td>0.000000</td>
      <td>7</td>
    </tr>
    <tr>
      <th>sherlock</th>
      <td>0.571429</td>
      <td>7</td>
    </tr>
    <tr>
      <th>ves</th>
      <td>0.239130</td>
      <td>184</td>
    </tr>
    <tr>
      <th>triumphtree</th>
      <td>0.207692</td>
      <td>130</td>
    </tr>
    <tr>
      <th>tigar</th>
      <td>0.182229</td>
      <td>3984</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>nyne</th>
      <td>0.000000</td>
      <td>1</td>
    </tr>
    <tr>
      <th>nocnezna</th>
      <td>0.350515</td>
      <td>194</td>
    </tr>
    <tr>
      <th>mojdodyr</th>
      <td>0.714286</td>
      <td>7</td>
    </tr>
    <tr>
      <th>joerex</th>
      <td>0.219101</td>
      <td>356</td>
    </tr>
    <tr>
      <th>nord</th>
      <td>0.225352</td>
      <td>142</td>
    </tr>
  </tbody>
</table>
<p>4638 rows × 2 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dd</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">[[</span><span class="n">cat</span><span class="p">,</span> <span class="s1">&#39;target&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">cat</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()[</span><span class="s1">&#39;target&#39;</span><span class="p">][</span><span class="s1">&#39;count&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">dd</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_array</span><span class="p">(),</span> <span class="n">dd</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">to_array</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(0.0, 50.0)
</pre></div>
</div>
<img alt="../_images/T513987_Recsys_2020_Feature_Engineering_Tutorial_154_1.png" src="../_images/T513987_Recsys_2020_Feature_Engineering_Tutorial_154_1.png" />
</div>
</div>
<p>We can observe, that the observation count for some categories are 1. This means, that we have only one data point to calculate the average and Target Encoding overfits to these values. Therefore, we need to adjust the calculation:</p>
<ul class="simple">
<li><p>if the number of observation is high, we want to use the mean of this category value</p></li>
<li><p>if the number of observation is low, we want to use the global mean</p></li>
</ul>
<p>![image.png](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAA74AAACkCAYAAACw2/JhAAAgAElEQVR4Aey9z2sbz7vv2X9GbwVefA1ZfAyzsOC7cUMWbjBDGryIIDOYxgvThMFoDBN0zQxGBMb0CYNH5HA+I8y5YWSGzx3lMhnk4X4uCvcQUDg3jHIvAeVABuULWehCFlpkoUUW7+GpH91V3S3JTmzJdp7A5+NWd3XVU6/60fVUPfWUA/7HBJgAE2ACTIAJMAEmwASYABNgAkzgDhNw7nDeOGtMgAkwASbABJgAE2ACTIAJMAEmwATAii9XAibABJgAE2ACTIAJMAEmwASYABO40wRY8b3TxcuZYwJMgAkwASbABJgAE2ACTIAJMAFWfLkOMAEmwASYABNgAkyACTABJsAEmMCdJsCK750uXs4cE2ACTIAJMAEmwASYABNgAkyACbDiy3WACTABJsAEmAATYAJMgAkwASbABO40AVZ873TxcuaYABNgAkyACTABJsAEmAATYAJMgBVfrgNMgAkwASbABJgAE2ACTIAJMAEmcKcJsOJ7p4uXM8cEmAATYAJMgAkwASbABJgAE2ACrPhyHWACTIAJMAEmwASYABNgAkyACTCBO02AFd87XbycOSbABJgAE2ACTIAJMAEmwASYABNgxZfrABNgAkyACTABJsAEmAATYAJMgAncaQKs+N7p4uXMMQEmwASYABNgAkyACTABJsAEmAArvlwHmAATYAJMgAkwASbABJgAE2ACTOBOE2DF904XL2eOCTABJsAEmAATYAJMgAkwASbABFjx5TrABJgAE2ACTIAJMAEmwASYABNgAneaACu+d7p4OXNMgAkwASbABJgAE2ACTIAJMAEmwIov1wEmwASYABNgAkyACTABJsAEmAATuNMEWPG908XLmWMCTIAJMAEmwASYABNgAkyACTABVny5DjABJsAEmAATYAJMgAkwASbABJjAnSbAiu+dLl7OHBNgAkyACTABJsAEmAATYAJMgAmw4st1gAkwASZwFwl8biF61MJQ5W30qgp/O0S4W0f3613M8ILz9KGFcDdE5YGHxjud9gjtvQitz/o3/10+gTF6xxXUX0+UKH007geo7IYIXwyWL96tl2CM7tMQ4U4Af7+DkcrP5G2MynEP41ufP84AE7gkge9DtPYqaH265HtLDj76I0J0pkcMSxbmGpNnxfca4XLUTIAJMIGlEPjcQmUlQvtLmvroLEDwYvpHbfypg8ZegPJKCeX7Hrx1H9WzASbfeqivR+h8S+Piq5RA78hB7U36G8TeDVj5NZAs73KC3lEZ5eM+tNoL9FB3aujNEGr0toX6jofVlVV49z2U1wPEb8YQZbvZAKvLBfC+tBA8SCfaAMl+7bBnsC94j28xgTtFYIjWoxKiP/QU0PzM0aS0t7EK13HgPb9Y79I/CRA8KIt3ovO0d5ufmg5BE4AeyisOHEd/30l2d+Y4Qb99m/+y4nubS49lZwJM4JcmMPkywDC3pDJC+5GLMPPhnar4fhugte/BdX3UzwcYJ9/QsVAaHMeBs20OaC+I/OsAg4t/+y8Y6c8GG6PzuCQ/9DluPxZ3TvEFMH4ZwrGUgB+Lm9/6OQKTd3WUf6uj/92MZ4bi+7WHeLsEZz1C8+0QE/0ereA8ckFtwT2cpTKb6aTXxe00fb6Uq/cNeK6DtWf9q0k+p/hStH3Ev62i9ibpVK4mLY6FCdxQAqM/KnB32onlw4XFfFOD47j2JOqcl4e/e3Ccn5lkHaL1IPN9/9pG+FNxzhH6BjxmxfcGFAKLwASYABO4NIFxB5HjYO3YHrhO3tax5lbRzazQFiq+tJq74cJZCYtXKMVH8OKz0GkeaMDrwNlp3zBTRzJF9hAcda9MriLFF5Muaq6D6p884E/rxKKvRmhtO/B/z1o5TFF8P7cRrjhwN+roFU2KvI+x5ji49OrKlHa6aBrZ9CbvYgT3IzQ/XlEdLVR8geGpD+d+M9lykZVj2u/+cQn1t9Oe8n0mcAMJTHqo/+b+UL/ff7YGxwnRvvA2JJrgduDc/wkLlMK+aYLuExfOQffOWmqw4nsD2w6LxASYABOYR2DyZ1WsQNkDcfnRKlqVyiu+cmXYccqokxln4T9SEtYQvy98OP3mpya8S5htTY/o5j8pVHwB9I5cOI87d3bwcONL5lMTfuHKRYHiO+mjvu7AcSvFE0CUWVLsLjUwlYSK2+mNp3d5AacovpJbGY2Pl4tyWru6XCwcmgksjsDkdQ2uW0NPW4pcOOmCldd57066qP6gBUoS9bRV5rd1uIn5cxL6zlyw4ntnipIzwgSYwLUTGA/QPgrh7VQRH1Tg7bYw1Asm30fonkQI7oeoHobw7ql9gSTU5w6q2yGCzRKC5+l+Q7nqUkNH6J1DtHd9eOsuvP0OBu8aCLdCVPd9rG5W0ck4TCqeIe6j7joIX+YV2aziKz7SZMY80yyL9gHVM6vHY/ROIvgk244H/0kDjeMmesZM9fhVBKdIYVaMKvTuQYDydgP9zMr0+E0D0XaA6CCEt1VD4yRG672CPIPx8I8Q/oaH0kYVrfOW4B3tePCe0h7DCXrHPirbvnjeMfY+U/GMP7RR3/FReVxFuOmj+iqzSkjlt+WhsifLtaHlEQpuZo+vqoSSQX3mXlJdX4d/NtI86pu5v0O0d3z4myWUiNuHDup7FVQPQpRXAjTejzF8WUXlYSTKZfVhni1U/fUpzK4vnBGlOZ1g8LKOykZF1DnvcYzGcYzOJRWWnNhLukEmh85vMWx7CBImr/iKVUmynniaD52IP+qgumOb/E8+tlF/6KFyUIW/ESE+iRG/svfoFbdTqnSyLykuCwDf0r6G6l503EB80k1MKGWd9RDs1VDdXoW338KA2hJZcWxSP1JCcNJB5zhEsBfCvxeiTX0IrWxvVRDQc6MvEvm8QPsckpO8jQqiXQ+rVA91/zdN8RXmzg6Cs8vte2DFN6l513AxQf9FA93MNyWXkKpL/kZJfZOaiB5FqO2rfvTzGP2TEP5uFdWtVfgHndzK/uy+df63JCfTDb7Rf+rOsHKS/WtI44N9H7J/baBL36LClVcAM753eEfKqYPVdfXd2vAy3635bKf3TdKa7K5aXLDie4MbEYvGBJjADSIgnBa5qLwYCkWq/7QsVlyFYyPhAMrB2l4bQzXbK/Z5ihWnIZqbAZqfx+gekCMJ7VhnIn+7Ujmi8LQvd/gikHsJySOziKuHGimoR7S3cILuoQfvfhkluudK5zveQUea7opVKbfQRNBWfMdo75AsxUrydOqUhzKc9VgNeClvFE+A1hdgcFoRzoBWXbqnnGTR4JgiVGbVbpIvoHdoD4hHL0OUHB+ND3I0PXhOe5iUjLMY/0sXtfU6+p9pVc6Bs15Hb9RFjRx3uHX8hz+rKJNSo1aizUE4Kcwlc9VbxGEqrDKPwalUEUcvKtZK7tQBuhiYXGT/lTRZc0X5TidPExWUh7Fa6Rd5FPMb0qSXOJWPlBddUQ9stkLhWTHCQK4y6MHN4NSH62qHaMrczTHqklCYPJRdGmAN5g54p+dkMU+oXGhvel7dyiq+yiy/aKJmlqgfm/BdN3FioyeSZDnOaafKrDopr0xZYNJHvOHCpXZNfcA3ORDVivzwrALX8RG/0xNcMg+rhz18PPVFPyLy78j+avAiEIPk4Oyf0dwM0R7ZfY/I5gXaJ7UfWkVvCoVphNZDw/R7quKrTDIvuTd6aruaVibJ5KIL/0RPLk7QfxbAe0L94wSyz76MOem0xG77fTlBavaDRTmiCSH6Jg3EXlIHad9NbYj6eFm/xLtv66Kv1v0J3Zvdt87+ltD7tG2nsunBpYm9dwO0DypycnJjFZWkjIskX8Y92Q8X9+MT9I/Jj0YVHTFBPEHnMfFT1lRihdVB7bUh96zv3WdA7u9N+UvLEg9N4Ul6PltAfTceFG1DUPVjhjNMQ9Jbd8mK760rMhaYCTCBxRPoIyZTSNpPI5TRCfrPQwQHtMoyRmePHN/QgNKQTA0EgvjvUDnqYqL2fbrJ3hn5cZH7YGmgHKL1ieKiD6IRlzJpcsyBo1Jssvt75SxwsbJlKb46zmQQa8g945JWMWmWOTWvLtpn1BOrzvb+Xq1I+erDrBTh9XJqRv21g8h1kPIBSGbH8dD4OIdx/SmCk1QplCveQ3RPYjRf/02x1YMFQwYxkLfTJKWitGc4JxF7O3012JdlRgqLXuiaOkBXZWQOBC20QjH2UX89QvfIQXDax+CUlHA5iWCFJTdBz33EbydiskAw+aBDKDO5pG4iVfCTgYuaoDD3fmvP31Rn38coZ0zTxepFYu5GEyVUJ1Va5oBXmMs5hZMtWsLF/52lbGUUXzUZQhNSXTVpNV9eoz/QgdUKTNo2tHl0dh/+nLKgsn5Gk2pGPaVVappMItN5VVb26rSe/Pgf8Hf7VXRGAzTvO8mK9+R9C/FJG4P/2Ez6ImEmmfRFF2ifQq41OFtqoCzyW0b9rWoJUxVfMvufNgmh4eX/Tm1X+aCkYk2ZXFR9rNhyoBXfYguNwmjv2E1pBRGh9WEg9r/X/hyhc+jBdcyJPp3pMToHEdqfdZuPlGUSPVeTsY/VhCspqWpCLvFwP6dvnf8t6SPerKM/UWkZk5Nycri4n9TSL/7vDGVRtVnT34DYCqP61/zK65zv3dm/yHGCadGixxtnI8xnO2OVWYBT/cmcydjFM76aFFnxvRqOHAsTYAJ3mIBezSk8akB94LP7OcUgw0lX3fTAIBkYF+2D1QqpuVKlZoPNo4ikGW2BB0jx8buA4quUMhrsz/JRO3gVGybWasBu7nMs2mckFEXHPhJBmXI5fwlQPYpRexwieBSh8TqdKdDmpgkfWt2mFXJaEb8gYzmAKM6/9DBrm3bL8A7KO3XEx1VhYh0etTHQC2lUp1V+aHXd34vR/mA+lIP6ZLBntgHFuPCZCjf+2EH8UB5jQSvk/h6ZH2qV2oxMXw+lQqOsBMRdXQbGIEVOGBj1Q+dhPUT9OEZ1L0CwW1d50UqPuZdbpaO9eX/rokZmvjQ5QSs9hnm8rtez8qmlX9xfNXAzJ4uSxDOKrxowzvbCPUbv91Zilq/7A3PiqcjDamE7nVkWpEFIx2iW05rEUuFv0vGMmAxKMiS8JwvFWNcL1d6K9vrTW9IaZQ11ff70Bdonvafbi3vPR3ScaSfzFN+pXs5H6D6PER/b/0WbDrxdapf2fbPPSAh8TBV6ciqXTJ4pC5BkZVO0Fb1inby9lIvR6wYoj85KkTn+dYk0wehtE9VN8mwvLYYqR230v87oc4q+SUl9TPtvqcilfa+uK8V96wW+JbpMVXsxJ3qK2tp1Ebt4vHIV3PxOy3d1/0oTuDq2tH8dFa28zvve/et/I/b3Ok+6OsLEUiw6/6issAzLBv2NMPvDolXmJLZZ/WcS6NZesOJ7a4uOBWcCTGBRBOTql2H2aSScVXDlI6W0aVMmrcQlK2gQs7JkKmatCKqPvKlgywGEufojTYTTs/cMYS6q+OoZ+1mK77cuqhtxehSMHhybplFKXnNPsZyNNz/ygN6PZCoKhtQ0FFcr3eagNF2t+Rvt1zQmEYoZGyufduTyl/rQp8c8qVVBU5Eveg96b5YyL3e0OZkMPHVl6sKKbxklGqy7JXi7tOdrxiB01EaFBqym06zcSqNiaazu6jpqllOaVW3qa6x4qrLOlpdWchNFQjvxyjmRGmP4nrYELObf+FMfQ2uv+KyBW0bx1ebxUxUzuYIeGFYAelCfmiYq5uYKDLE5dIwzMiWL2WVhTLQYg1r5DrUp1Sa0gqvx6lVr7UVdrcKnk0g6IP1VbMxjnlQdypa3+Za41vuO15XiZHpr/mHFN5eKuDG1XRUHF3dl/Uy96sqJB6MvIgUgU0YzorvyR3Y9leXgPinynjtGZ5+O1foJj72F0mvFdxWu6HNWEQjFtzCwvKnqhvlNSuujfk/1IZvabHZO33rBbwnFrk160++kqr9ZJ1LfR+hnJiW1dFf/t6h/m6b4FvSvqh8XTAv6Wt1HmP2s2OYktkqtIf4/pIf59Ln+fvpo/r9qcnLOd1r2YYZybEGa1X9aAW/lD1Z8b2WxsdBMgAkskoBUfNPZ7CTtr0P8M+35dDLmc6Q00sAiGSyrD4nxMUoHxQM0t2PhCVJ/5NPVM2NA8b2PeIvCqXt6kEurhufKRZEYxBd7ULVMnUkRpyMLnNV01SfJFF2MxbE/lrdnrXQZs8apkjtEe6+GrjD7Tk0s8bWH5ou+MM+ko2Bys+HfJ+rcYD1QMlag9arCiyH0QCDlQqbSGcYFA4g0Szq/ETrfJug9raApzKdJMTHSVC9M1GHGo/OqOPKlrZ1hfWjAy0xWTB2gC/mNQXcqjLyiASWdnUymzrTXmUydzyKUp5g600uJ4pmYMOuBoTFhoDiIVa8vbUR7bfyLcDaWqaMiwjEm35UyZSp+ieI0Rv8ZsZIiy8GSmSejfsog4v9C4XBr6C5C8xX5dVF7bScm2pc5QZDIl1F8hZks1YOKvVVBh//WR/zA9vac7w8M0893MSqn5OCquJ1KZWxaWaSTRGlb0ZYP5C22oKyEcuCDvLNr7+szB7VqNUkMuj+1EB52L9Q+OwcBvKQ/AwYnnrTG0JymKr5K/sKy0C/n/05tV/mg6o6ebKQ2Lm/JcjImdN7WUTL6r6lRXceDbD1Vv6Nz24IkSfrb2DhTPbn7UxeiH12P0HrfR3PbAZk6d5/S3v4iU2eZVP6bpDkbXNUEqDDlfRfDf/anmsic0rde6FtC6WuFLi1T7QgqWdVXRESdTxTvn8I09+Xi/k1OvJaf287tqB8Q1hhG/6onaMT3TE3I0iTV4PcKGu8x/3unJiOS76HeRkXt80Js1XiEtsd87aCmfYQkOZcr0uZkR/LoDlyw4nsHCpGzwASYwDUTEHt0bCVx/KGJCnlK7dOB76ZSN0b3STlzHqj6gOv9ceOOUIwdUoTfxVgTSqz+yBuzsGrVkD5A5NSofNjDRN0Tzpa+D9F8ZAzKldKTrkSlXGzFV++xJSU1QvuToTR87aO566N2npqxyViUeZoewApnX6Qw1NAbtRGKQYec9ZYmWGN0D311VJLcE7lqes0dD9B85CVHKUlTZz3AGaL1iBRzpWSp84RTZaCAcaKsGXlJsq/kItmJnxog0QDGzSg8o/MaPOGASyrj5rmuNGBxybGXsRd06gBdyGOUZSJL9kINQgxT5WwI/VsqNKZJsqoz5iqWMt2lAfXwd19ONqj905U/jDIddVDboLqjJgX+qlaXlFMV4bDsM5WbPhNam1kbx3XkBrzScJ6UTtfc//e+gfB+hPhpCH87kIrhp6ZwXFO+56OyGyL4awnhKyWfclRUfxoh2ApQedbD5PsQnaMQlScxatvk2EmVM3F2zf2HkpZgpdubBij+ZhVf8nTcQoX20G7GlnfyyZcOalshmpmVJGnqrCeYJugdSUd3VD/7x2V5jue0djqzLFJTZz2AJgc/tP9ar/L3j9fg/KWGnsr+hExC3RLCM+2fe7blQ7pvXsotz5qe0z7FYNoVHtKlmkbKj4uyeYY45dcY3KfIpTxzV5PTF2QpHRVMDmTC2D/15KL2vJ39jbRs1IuTtzGC7Srqj31R98bn5LG6jNJmhGgvQvysivJGFfFRhOi4jmjDqHdkCXJWRbBTR/NpiPKu8gvwbYDWQYDwqIn6ThnhS1Wns/VUKTyr21XETypY3VQOA6n9PZRO5Bq0j/9zG9GWh/K9CqKDCLXjqvTQrSfjqMpQ+6J4DgLRviKznduQ1C/ZH6YrhoWBDMXT7McyEzpkQ2D4YiDnh7U3E7XP1J5MSvvWi3xLZFugvejkpE7XbjlxJFf1Ry8j5VxOKZ0nWumcCOd73l6M+q6PYFtO3lG7leUboLITIvivPMTK3L+Q4ZQ+J9u/SXqqLzYsNeT9af2r/NbJSV2aVDf62nnfO6XoaouOwXNfOnQUjfMibJUyftgDOZQ09x5LmeVEXrGF0LS6cnvus+J7e8qKJWUCTGCJBIbndVTE3rYaqjuh2OPWV0f4iI/m+ir8/SrC+wEiOnYko39NPrUQrdM+zhrCh1W0zmL4K2V4W6E6O7SP+J7pdZcyO0Jn38PaZoBgr6n2no7RPfJR2gwR7dbQsgbl8qOnB80mrpziSw/1cQlkurhShr/lIzxqoTfF3JYG2eG9Mir7EYKdGJ3zBir3yvA2tYI7wfBFiNV1Ou4kRGzs4RVHOm2VEezHqJF3TtrPaqUzROfAx+pWiOghHU1Ee9BSJWse48SBj2XyqgmQM7IApY0Kwp2qPNZFPJIDpPJmiNpxDdGDEPWXfelJl8ZdH+lYpADRIe1LVjIbuiNFMU3xFSslF1yBGL9p5fYOa8nTvyO0d1zpWTW5KQcwlgIy6aOxXYJHR9YcdTBSSrrk5yOkvOzRwJz29qmIvnZR36S6WRUDaHEc1GYJ5Q0/VajUpIrptCw34P2//h80jiP45GF6pyaP3/nSFooZDYbxvYua4wploHfoIT4lk70y4tcd1O57qNLqlzhT10X0ikZxfcR/cVA+eS8UrZJSpind0vG/F3tDxT7JdSo/dTSIypJUTvVESgJMOOapF6zy6+OFvHsu3Hse/K0KopMOBpqRGQV0G6SjowJUzzpoHfgorXvw6YgzwVyHybfTmWWhFJnKPQ/h41AcwbVqTaypdrIRir3a3k4d7ffmqiEdqxajOe1s7i8dVDfWEOyECMkhnM6XOLJrWvtUSt42KV41RA+JTTepWyKKaYqv2F+Ymh/r5Ob9ndaupr+XVzBqvzmpMy6yEHmgnRNSLLKvpHrZO3RR2v/f8b89qqD5exWO64mVN3kGsQvp0V0q0q6avBOTZitk5UJxkaJAe+pJ+XFR0ubLQtn97/C/NmK5n9eop6J/WImkl18xSVISSljvaBXRaROR44Imr+h3/ZQsTUritzyOy0EyiSXal1rtFwqTfG86J3pC2zda6Gb6svw7fcTKE3zyOVOTIJFW6OklVadoUis6Hag6Na9vnfctSc3+zUkTqhdim8+Yyi/AP/67tpg4WHNc+Psx4rM+aGuMu6Imh17TxJhyzLcdofl7JCfKXjcR3Kdj4Eh+6qOyDP9Lvs85/Id8/2ZAE5O3egLRuI9vfTQersLbiRA+DOD/xVDmv3ZR23BRXjf6WtUHhDPGFOM3MYJ7PkLy13DQSvty8d2az3ZwGqD0G3276+glnYASWlgr2durzOzc9mtWfG97CbL8iyPwfYjWXgUt4S6edBI62zNAuBui/me251icWHcnpTG6T0OEO4E4X1R/k0d/RIiS1Yy7k9vryon4+BasvBQqvtclxE/Hq1YV9OryT8d3fREUD9DlIDk/k359clx7zO9jrBqeVUV6RQNeMWgqQ6xWaYdIK3V5pFXmmTCVzzj3ESs6bgXCvFyZg9b/DR2jI82ZJ6Skb9BKDQ3F5Sp0OVnpMSioVZHEHDB5VLDimzy7eRdyhcs0L795MgqJpim+tLJp7De/qPTF7WrO21Q3tlZR2grFWcWNly1xvqxQOLbNCS+KZ4AGeepfKSM46Ihjr2iLg2UyKywatPdguQrmi2PNZP9U0hYsynlQ5fh/xJpTSraPSJNWWvXM1lNlTWIpyHJrwGQ8Bq08aysG+k0rmzQJKLYOCCU5Ne0X8ur2Zck7h9UteDx+FcJ1DYsmpRAGKx78hwHqyipJcE6sPuyyERMMxl5psVprOOcjDIUM30zpczJ9mIVRbCMo2BJlBlITiDfZjFhMaF5w0tbM2m25ZsX3tpTUjZSTVhboTNEL/LcvPyyUjcmftfQcUscRs+RJHBvaw6mD4vPQlgWCTC9LyZmNQoppH3ot4vcRemd1hBurKN2TZ6+WaS/nV4COTPFze0H0i7/43xxXafaamrn+4nzmZV+YUuYHyjdX8VVnHBrHt4xfkglyOTGDnpflZT4vHKDTAIjOxNWzN8sUcMFpC0VND8ShBvhqpVYqtTV0vtKpqtI0MOvcR6zo6IGq2Acd4sW/poF/gPrLLrpvBxjpVX0xiEwVjWxWxbFAucmTG6z4fmkjpLOn9TFDtL940zw/NZvDG/Q712+TbAUm0RcV+Rr2uFpJT8YYf+6jfRIKU3JpNipNZvXYw5qYEUplGY33E4z/PzovPFU+pef3Mp7+z0GqoGqFiupyrp7KFWK9aksekWlrwEj5Fkh+f5PrrGK/uvL0L9tQhM4X2p+vVqG1JQQ5AcxMJFl5vqM/SHF1HylTc70iLfZO6z6mg7FgK5ViOXmhYRQz/Cfyi1DQ59j9m45D/5Ur/qlSS1Y65Aiuqvwd0MSKDyejzOu3b8ZfWkl3Ya3o3wzBrkwKVnyvDOUvGBF9CNwKmu9HmCjTLnkGqbEH7TudBefCOoNUoFIrOkUeVUdtcZ7nTVJ0aB+Gm5klFGZQBStrlD1hhkImQo+b6JnHk+i9ZMIs6rJ1ZoLRx2FqmnbZ168r/PsGPNfB2rP+1aRQNIASJlxzZlKvJvU7EQtNrFB9Ne0Qbq7iCwxfVRFsVsRRR9UdD3nzzZtbLHnFlwY/JVQMB1Q3V/qrlkw6vhH7e8m0/+mf+Ld7DqR5qFSCnO0mmgdkRicH/8keSCWKWH1Rg9jBcw/OZhP/SQxC1aoxhfs6QO/TWDr7opWer2SNU0dPK8Q6W2K/svE9EvdvsOJLJpE7ZC5dR3wYCVPMom0TOns36m9Rv02+EdYLTCmXLrhaFdync2hJ2S2Jfal0lFRVmRhrL7p6r7qol+sxOi8qqLTkcTLS0zCZSq+htNPG3/6swtFn4n7rofZbSZj1JyuSup7+5yY8R1lFCMsEUjQ6iDeojpNsLqKzFmrkVV9ZNZTEfmrdvtpoPyGfE0qxEyvPE3QeO8hOJC0d9bULkK6mT17XETZPhZm4OKpLOUAMfqcjnJoYCueP0qQ8FauY4aiwzyHzZ+W/QPRv6XnuSXxijKf3RKu9xlt0jFwN0baHILfFJ3nzRlyQYl8SPi5uhDjXImhXCbQAACAASURBVAQrvteC9deIlD4EtnIqTYEcx/D2pxwf2OFoTwXNmBr7HCxksiO6MRvrJz3UfyvYo1T0oSfjuz9ClBzTEYiVOQjnJMaxNvbT6b/ETGNyPM70cIt+MnkXC8+3zY/JLqCfE6GQq9q/pVdCfi6FX+Bt6bjGbHek+ApHKsfN/J6eX4DIlWfxU0ecMUp7TE1zWpp08I561qTDlad9YyOUKxql7Spqu7GoZ+RAyCcHQc/kNgbaV+YLR0BjDF73MscQ6f2CFdSfV+G7DoQ56WSI1m4Z4UkHndMaoictsd+d+h5/JUD1SYh42p5WGoiu1wylmBRfD+FRjPiVdplzY4HeAsHG6J3Gcp+lORFMkw7CedpNzMIEvWNfHOXTfhaictSV7fVDA2U3UNuZyBTaTcY44/MIpd88+DsN9Cdyss5/WEeT3j9oq33dcv915WkT8W4F1ZeyfmXr6eQ8gpNYRfTRoD2emwGiPyg8WUnQ7xDx2wnwjY6nUYo5rSKfeHBpP6g2z37fQCDaVwWrjpvu/b2J2K9FphHau3TGehXhPu2vl2XrHcSId0OE2yWsES/ak/xtiN5rvQc5FYb23OcYFvY5+f4tjSW9Eg7pDIdc6ZMbfkV95cZNnKi6Wm6s+F4tz18oNpqV1LNaKtvCFMiB6fyEnpCCbA4M6Z7c++LAdFqACZnuyLjItCf7jkpl4X+EkxTDyU4iQIGCNnknPXC6M2bMxP6JzGpcEufUCznTW3h269R3bumDAq4iJ8ILZpGzmluazwWITfvDrmg6YgHS3o0kmPnPlOMYw7dKGbZW334mTvrgjDHOrgb/ZJT8+hwCzHwOoCt4TGfXakVu1t7TK0jqzkZxXQyv21T/OgrkNsr8AxxY8f0BaPwKDSRG6L8dWoNqeaYnnUdpzqJPMHqXn9WX5+uRF8SUJh0JIcxTQHsujHMp0yBLuRKyFimqOQVNeol0nLXEuUWRwKNXVYSWGSR5WKyjslFBdd+H9zhG4zhGR52dKeNQpuEFcow/tFHf8VF5XEW46aOaXcX4NkD7KIS3U0V1y0N03JDeVpVw8n0ywamhur0Kb7+FwTeAZi39TQ/llQCN8w7inQDRro/VnbY8WuBzWzgQCdZLCJ73rbqgvQVXtkJUDwKUtxvoWwPP1AQoEmmme8CnmpArpxDpQfZFdPkeE2ACt5bAhyb8e2uITttoPK4gOjW8Dt/aTLHgTOB6CIzPayiv+KiftVDfCVHX57lfT3J3MlZmeCeLdWamWPGdiYcfXpyANE8mpS8m9/Az/6nzIE3HVuTU6re6dT7mzCgW9lA5Pig6YzOr+OoVb/NMzQvIOTilA+Qj6cWUnIE8ofNLXQgF71tXHPPh0XEzjiOO2SBHYOLYj8Ss2nACJPawGIfRT/qIN1y4dEA5raYLsyk6u5X2DkknW65DZxPq3aBSwV49/D/x95t0BACZBdKxMuRZcYDWA5KNvFySkk/P1Uq0a6QpTNzUsSvGCr55ZqBYRf+thi4lS6bkf9FnYiozeNNkLmEoj24xzXeTR3zBBJgAE2ACTIAJMAEmwARmEGDFdwYcfnQZAj3UXQdOZn9vYQzC6569v3dw4sHJHfxd+PaCb85QtjKKr3CbT0riZfJBzj8cB6kXQECuhtsmvcI8OjupIFznO3CNfa+0v7C0p7wbCjPzMhzDW644A5DKiTydqrTX9JEMgqxU9B3nv8FD2kP0kZxwaJP0CfovYjReDjD+2BT7oibqGIdUBq24G2fACQcz6ow8kYaaJFGcxAHuppfDDNe0wJVsRZMQSaAhOsex2HsZX+BvwzxnNomDL5gAE2ACTIAJMAEmwATuGgFWfO9aiS4rP3q1s8AUNytS0f5eUhoTZ1YUl46H9l980KuR2Ziu+vcYw/e2+bY+LL5wlTGjoIljOBwncYZRKN3XHpovtFmwVhLNVXK1Gm45RlCKYmafsfAy6Tgo79QRH1cRbQcIj9rC6YtIW51j6dxvYKCFEfuAHARnf1Mry9ljb6Si76gVXOlQyzZJ11HR3/HLEJZptzJHdv4SCA+9tcchgkcRbAVTWwfQUVYhqqddjNTKsIg7wzVNTym+h7301jVf0So7/8cMuA5wHeA6wHWA6wDXgV+tDlzzEGsp0bPiuxTsdy9RuSJpr1xOy6VW2OS5eSoUOcIQXnhIGSyh+qd0ySPCLuggbaHk6UPiE+Glqe9FFN9kj7O1fzeJSFwMfw+M89HUvl1zlVwpjpbTLyhv2dZ5lPJ8TKfoOCidpJ6MMFagxeqqQ8qureDqV6AUY+2gTJwfONUDtVJETRN1OnczWSFOYs1ffO2hsRfAu0em08a5lRTyBim+ecH5DhNgAkyACTABJsAEmMBtJMCK720stRsn8xi583unyqj399I+0YJAZL6bKFLyMPnyiV6vVA6R9mLUd30E2xU0yQHUpyYq5ITpno/KbojgryWEr0YicnJTH25XER8E8LfpuIAR8H2IzlGIypMYtW3a3yqVbFLy9Jl9qWRKhudahvRJTkFTpseOPkjdCEqXZFocWN6elfJp7md9UxOKYHQ+Rv+Zyp9SYPWK+OBVjM5nzbyG7PrnRM4gAEoJTZV2vR+3ht73grRpz+/vPhxHmyVPd6glsqbyK8y0P7UQHnZFHteKVr2/T+TExkSeUxk806veY3H2oLPdgiyxWYqvrDumWXgGMeWATZ3zUPgOE2ACTIAJMAEmwAR+eQKs+P7yVeAqAOj9vfa+1MKYtSmsaX6rAo4/tVFbl/tJJx/a8lxAx4W/HyM+6+Nvf1TgrtTQIz31dQ2OS86VgN6hh/g0xhopbK87whmUcP70pY2Kq5S4r22E4mB6OoDcRekxHVwP0Ep16fAf0DiO4Auz4Zrl8RhQCqaxaprkq2BlkvbY0oqnf9yTzqRE4AlG5zX4u83UDFndF46s/qpMkcVeWDIlCtD63Ee8XkX3m5SR7jU/A/jcREUpz7RC7ToVwUDLROl4WrlWps5lpbSLs+VodVWtHIvzhP+ieJJiTvt23RLCM+WVWzjKmr6KL1f5afVYnhkrV+lJbger5r7h8QDNRx7qdM6mUMaNNEBOslxjFXyW4itXvvUEgM4z/2UCTIAJMAEmwASYABNgAvMIsOI7jxA/n0qgd+yBPAwn5qqJl2a1Umm+OZYKaRq2hDK9q//TJq+GIyaxF9iN0BFbfOXqY0kpVMKR1Hq6d1WYGa9IT8U6WWEmrQ+JF6umAVpvmvAdF7XXE0y+dlHf8OSK74wz8IanPhytnOrI6W+B4ku39fFAq66L1Q0f/sMIjfOBoQgbkZAMmyV5+Pp2Fa3zFqqbJZQ3/FQB1WF2IoRPWobyLFfA6aD72nEN0YMQ9Zd9Kx1a8a7c8xA+DlHZ9rFqrcYO0TnwsboRokpmxzt1tN8b+6m/dNE4bqL31ZDXvPzSQXVjDcFOiPDEOHbkcwfVrTKC/Ri1gwoqew10v8hVdZpI6B3Lo5VoX3K4RTJnDpSfwlWaYRtOs0xZ+JoJMIHbSeBzCxFN1inp6bg3fztEuFtHd1rfcztzuhypP7QQ7oaoPPDQeKdFGKG9F6FFk6n8jwkwASbwCxFgxfcXKuzbllVSXF1tNiw8QbsgE2C9Cus+6WAszHrlqqz7pGucJSv3n2rTZbG3dSXGP72K4LgB6i+76L4dYKTOlhX7e7WSnAUlTHppFTbzYJqClgl2U35KR1VZZ1Y3RTpDjilcxQrzgvZ7G9LwJRNgAtdF4HMLlRV9lJtMhNp5uj0jn/D4U0f4ByivqMnTdR/VswEmwmLmAlZH+Sh/iTvkfLH2xsgqsXcLvmtGEL5kAkyACdw1Aqz43rUSvTP5kfs5aX/v5HUdYfMUEZ1tSzPW37qoug6C35uoCkWITGBdhC+TXaKpcixWiCdiHykpxiOh+NbFGbYC1dcBep/I/Fnt7/3UQvS0ZyjQFIoUa9c6cki8O0VBuxFF8KWNcMVwGvWtj3jTgavNoG+EkFOEKORaYBI95XW+zQSYwM0iMPkywNAwJpHSkYM+FyH5XTD+TVV8vw3Q2vfguj7qZEGjjUjIiuSIjm2zj8gzopx9+XWAgS3C7PALeUq+D+jsdm3x9POJ5hRf+rKRV37Tx8TPJ8MxMAEmwARuNAFWfG908fzKwo3Q3l2VJsD7LQy/T9A79uEdxIh3Q4TbJayt+0rZHWPwuoehWr3V1MjMN9ioIn5WwarjokIDrMkQrd0ywpMOOqc1RMJ0eIL+Mx+l7SpquzF6uQEa7a2l2fEQbdP0rlBB06kv+e836UTK360jPowQ3A8QnXQxSgaLS5ZvVvIFXGm1unQblPZZ+eJnTOBXJFDoqR4gnwNrrvRjYGIpVHxpNXfDhbMS5i1v6GXhw2G6PwIzfvt6jgM/O/ACf5EpsofgqCt8UVxFwkWKL5QfCH2KwoXTGbURPjIcEl74RQ7IBJgAE1guAVZ8l8ufU78uAnT+72u1d3TG/t3LJC+cQ5nn65KCRufVHsdovi3Sli8TO4cV+39PY+nUzFyFoEmHjXrxhARjYwJM4EYT0Oe2W8fXQZ5h7hacyZ1XfOXKMHmbFw7yCnNLx86Z56EXBsrfVMe3zfYUn3/tNt4pVHwB9I7cxOHhhfNVMDl54Xc5IBNgAkxgiQRY8V0ifE76+giMz2sor/ion7VQ3wlRP9euU34yzW/6vOGfjIdfvzgBZn5xVhySCRCB8QDtI+VE7qACb7eFobb2+D5C94SsQEJUD0N49wLE5HGd/pFjuu0QwWYJwXN95BgweRcjuF9TjgaHaO/68NZdePsdDN41hJO66r6P1c0qOhlfCPLc9oy1DORxakUe2rOK7+R1TXjKp7PFp1sk99G4Xxde8GVG6P9j9E4i+Fshqjse/CeNnLM+6fegQGFWjCr07kGA8nYD/YxF0fhNAxEdkXcQwtuqoXESo/VeQZ7BePhHCH/DQ2lDOTPcDhHtePDEFhtp2USOCOl5J3Pkn3Sc6KPyuIpw00f1Vea7JhwLeqjsyXJtaHmEgpvZ46tASQb13LF4KceCK1Z8C6DwLSbABG4DAVZ8b0MpsYxMgAkwASbABC5CQGzLcFF5McQEE/Sfyv2vwrGROjJtba+N4XcZmdjnKY5Qo330dGzaWPg8cBx9Rrg+/1sqRxSe9uUKT/qO6TdAHjfmHNHJ4hN0D8lrfxkl2nvrrkoP/gfyGDnhEZ98NrzNZ8hWfMdo79ARbw6KlOT82/oO5aEMZz1GX+iilDd1VNwXYHBaEfKsunRPOcki5ZZeV2bVpj8EOuM9OEvV7tHLECXHR+ODVHQHz71UxlmM/6WL2nodfXVUnLNeR2/URY38Mbh1/Ic/qyiTXwq1Em2mSQpzyVz1FnGYCqvMY3AqleHRi4q1kjttxVceMXdJJ1eXVnzlCQTBQx9r61Gq0H9pI7ofoPmBTkmg4wflcYa6FPkvE2ACTOCqCbDie9VEOT4mwASYABNgAkshIM/RduicdKHYTtB/HiI4aGHwTTrpcxx5/nki3tu6UNqC+O9QOepiovZ9ugfaS75cnaUV17FQaEO0PlFcpDQacU26qJKSa5ovk4LkFCgz4jzvYmXLUnx1nPoc80To2Re0iknnqafm1WQu7UBwSV5V58+LfOmb0gTbMY7VE4rwujoPnoJ97SByHaR89Fnr5DF/DuP6UwR09Nuf1VRRxhDdkxjN139D95DYAuK4PlMGcbKAnSadGV/aM1bBxZF9vjzvXa2ol49SR41TFV9VRkWTEJpK7u8lFV8ydy8fdjH+2IRnHKknTltw1EkDSvFlZ1s52nyDCTCBKyTAiu8VwuSomAATYAJMgAksi4A2Cy7cs6qUJ+dxx/JaL5WPdEUztye3aB+sVki3DQdHb+tC2TSPIpJmtK59jA7BEcr2BRRfpZSlq8/FZAevYsPEWq/uGubVSl5rT7FQFB376CTliMsh3w1HMWqPQwSPIjRep6u94lx3S6k2VsQvyFiafxfnH0gdbulUZXgH5Z066PxzMrEOj9rGme4AVH5odd3fi9H+YPudmKf4WkcdmZg/tBEfx/Z/TypYU/4t7GdtNeFiRkCr/0qhP/VhTirQSjqtdJONAP0TCv+Trvq1xD+TAdqUx9xpEUuUiZNmAkzgSgiw4nslGDkSJsAEmAATYALLJdB/6sKZZkL8R0Wu7Bomu8Ik+YBWbvU+V6XE0TE65hnn2TiVkmUq2FI589H8lDIQio0RV/LkooovlPl0YnadxJBe0PF2GzH6ynQbWnl90ESyA1bJa5pLS1PtzLnmYiW6YIU6SU2vdJNJuL6pVsQfd/C3CzEeovUgu/qs45KTArRanR7zpFaraXXdPFXAeEVeTjB4WUeozcsdzy6L7Dm++n01uTBV8dXhzL+XXPGVr8ojCp3kLHal4BsTMaT4mmVkJnnt1+QQ05wsEBM5dn3WMozPq8LsvEEm2vyPCTCBW0WAFd9bVVwsLBNgAkyACTCBYgJS8S1YSfw6xD/Tnk8n4+BInYnuJiazI7S2HTiG0pgqrwM0t2P0vmtTXHMlVykxpNR87yPeonDpyqVYe/zYQaydDIr9qWU0PubzYZk6K+/PjrMqz3DPBR+LY38sb8+jNioZk+tUyR2ivVdDV5h9O3B+i+W+3q89NF/0MSlaBaY0v0/UucFaCdX7n5Hux30xhF49t5TILOMpxzvJrGlTa5p4mKD3tIKmMJ+myQkjTcVhog4zHp1XEdyP0NbOsD404GUmK6au+IoV/cwEQI5z5saPKL5ZywFVTnpPMkB1r6DuZpK+rp9i4iZRygHxe72BQVGCVB/Sg6SLQvA9JsAEbigBVnxvaMGwWEyACTABJsAELkXgfYxyRkkcf2iici9Eu99GaOyvJK/H3SdluNZRYWpFc0utlo47qJIDKFKE38VYE/th9aqnsQKpVg1pBZj2r5YPe5ioe0Kx+T5E81ElPYNXKX+11/nc2Yqvcja1TkpqhPYn7Zqa9tr20dz1UTvXBsE6LmXqrFcShbMvpTjS+bNCuaHjjxw4wqx2jO6hr45KknukV8nBlP43HqD5yEuOUpKmznpFfIjWI1plV4qjOk84NfcuYPymJiYg0v3HOiH6q+Qi2YmfUsTknuUK2kZWR+c1eOJsc6mMm+VI5uouOfbSq+AzvDpDyGOUpSnOtOsfUXzVXvJkUiD7m9gZiidAkxQeoqMagk3KSx+NLfImvorKXhXRYQP17RICYZJeR3zgY3XX2PP8tYd4h86vb6C26SN+J+vO+E2McDtC46QGn+JVzs9oFb58otVcNQHkegiPY0QbqwhfEnw5GSE8mj+nsOSFO4S/XoK/FyHaq6O+58F/lnpE157S608jBFsBKs/SfdfT8PJ9JsAEro8AK77Xx5ZjZgJMgAkwASawUALD8zoq93xExzVUd0JEx230lYns5H0D4foq/P0qwvukFHQxMnRJEnTyqYVIDORrCB9W0TqL4a+U4W2FSnHtI77ngBwnpbtIR+jse1jbDBDsNdXe0zG6Rz5KmyGi3RpaphkppHJaFsqDjSen+NJjfTzQegnOShn+lo/wqIXel4zwKqrJxybCe2VU9iMEOzE65w1U7pXhbWoFd4LhixCr6xVEuyFiYw+vUFS2ygj2Y9QOKqjsNdC10hmiQ0rWVojoIR1NRPtUa2IlXPCbw3jyvoX4pI1B5ngkKTo5IwtQ2qgg3KminZhTS6/I5c0QteMaogch6i/7GCvFdvKxhSodrXRI+5KVzIaSTHFPW/EV+2othVNBnPXnRxRftf85eiVrjfYKric/hr8HqJ6nNUrsV6fz3Mk6wPXQaNWx+rSJxn0HpcfSOzjlyVmhFXy9b1xPDtAEhgu9mizSorhoYsgNlAm4NDn/r5/+vTw73nHh78eIz/rCwVvVceGdyAkQSsel47Te1rH6uInmngOXZPjSQuVRE80DB+6G9ApO9Zf2LYs3J33U113IPPcR/8VUrmcB5mdMgAlcFwFWfK+LLMfLBJgAE2ACTIAJFBIQK6ekjGSeFiq+mTA352d+n+rNkc2WpFjxlSub/u/ZUrDfzf36EcUXEwxOI5RXygj3KvD3W2ifhCjf8xHuBQjJ27WR0PicPHO7WN0IIc4jJvNiOv7IcVF7TRMe0vLAFcdnQR6v5dbQnQDCqZpbSUy/hXLv/iuckML6SK8Kyz3H7tM+hEM3N1LnVAPyiCe9v1cqyD4dEzUZY/y1A1KKI1LSSaZvsg6I52KCwYXex2zJIawcio/wMrLNl0yACVwzAVZ8rxkwR88EmAATYAJMgAlkCIhjgfJ7S2+u4jtB/9iDaxwzNH5Jylk5MYPO5PBG/SxUfGkV1o0sE+qLCX39e1wn4xEGr1uobblw9F5bYZYdoCX2MpPjM1eZIMvznmkVdjSeiNVtrXwmCvLjv8O/chxoBVU6QZMKLO3nTRVipUSvqFVbUvKdslC+xbZecnpFSvIXOiUbgNivrhVaqQSXT/qg/ddiRVrLTo7TXOP4r4uB5lBMgAlcMQFWfK8YKEfHBJgAE2ACTIAJzCdAZ9GSCam50ndzFV9g+KqKYLMijjqq7njwdupovzeln5/nZYXIK760YlpC5cUlV3sXkAG5UupBeE1+U4OrLAPEyq1WJIWzrLIMo1ZTo5dt1O/V8X//7sHRR20pU+n43Uc076fHdpH5s0vewCdy5Zf2905e1xGefUSXTJeVObWwTFiP0f0jQuWPkXB65e610HriIX4PtVqsFFot08smgkdt/Ptna3DUCvPguZesBC8AISfBBJjAFAKs+E4Bw7eZABNgAkyACTCB6yRAq2Jl6yxdUnxXt6uIj5vo3Q6d8joB/XzcnzriDN5o0/boTZMOnrVP++eTurIYPpOjqwjNly3UHkZoCadmE3QeOyiR4zTai34eif29PbHs2kdjwwXtga6Ss7NvfTQe+qiSY6uHIRrvZEWiPe6VrSoaz2uo7DTQF7dHaO/S2cdVhPstDL8P0Fh3hZJL+SGT69JvHnzyaP4NwnO3u+4jPJZyDE7KiWIOsmJYWRP74YV59pcOqhsV1J9X4bsOSqbTtCuDxRExASZwGQKs+F6GFodlAkyACTABJsAErpTAZDyWZqNXGitHNosAM59F5yqejTF828OQHG9Nuum+4KuImuNgAkzghwmw4vvD6PhFJsAEmAATYAJMgAkwASaQIfChCf/eGqLTNhqPK4hObeddmdD8kwkwgQURYMV3QaA5GSbABJgAE2ACTIAJMAEmwASYABNYDgFWfJfDnVNlAkyACTABJsAEmAATYAJMgAkwgQURYMV3QaA5GSbABJgAE2ACTIAJMAEmwASYABNYDgFWfJfDnVNlAkyACTABJsAEmAATYAJMgAkwgQURYMV3QaA5GSbABJgAE2ACTIAJMAEmwASYABNYDgFWfJfDnVNlAkyACTABJsAEmAATYAJMgAkwgQURYMV3QaA5GSbABJgAE2ACTIAJMAEmwASYABNYDgFWfJfDnVNlAkyACTABJsAEmAATYAJMgAkwgQURYMV3QaA5GSbABJgAE2ACTIAJMAEmwASYABNYDgFWfJfDnVNlAkyACTABJsAEmAATYAJMgAkwgQURYMV3QaA5GSbABJgAE2ACTIAJMAEmwASYABNYDgFWfJfDnVNlAkyACTABJsAEmAATYAJMgAkwgQURYMV3QaA5GSbABJgAE2ACTIAJMAEmwASYABNYDgFWfJfDnVNlAkyACTABJsAEmAATYAJMgAkwgQURYMV3QaA5GSbABJgAE2ACTIAJMAEmwASYABNYDgFWfJfDnVNlAkyACTABJsAEmAATYAJMgAkwgQURYMV3QaA5GSbABJgAE2ACTIAJMAEmwASYABNYDgFWfJfDnVNlAkyACTABJsAEmAATYAJMgAkwgQURYMV3QaA5GSbABJgAE2ACTIAJMAEmwASYABNYDgFWfJfDnVNlAkyACTABJsAEmAATYAJMgAkwgQURYMV3QaA5GSbABJgAE2ACTIAJMAEmwASYABNYDgFWfJfDnVNlAkyACTABJsAEmAATYAJMgAkwgQURYMV3QaA5GSbABJgAE2ACTIAJMAEmwASYABNYDgFWfJfDnVNlAkyACTABJsAEmAATYAJMgAkwgQURYMV3QaA5GSbABJgAE2ACTIAJMAEmwASYABNYDgFWfJfDnVNlAkyACTABJsAEmAATYAJMgAkwgQURYMV3QaA5GSbABJgAE2ACTIAJMAEmwASYABNYDgFWfJfDnVNlAkyACTABJsAEmAATYAJMgAkwgQURYMV3QaA5GSbABJgAE2ACTGB5BPonHoJHIcLdFgbLE+PupPyhhXA3ROWBh8a7u5MtzgkTuH0ExugdV1B/PblVoo/+iBCdDRcqMyu+C8XNiTEBJsAEmAATYALLINA7clB7Mz3l8acOGnsByisllO978NZ9VM8GmHzrob4eofNt+ru/8pN5XH9lNpx3JnD9BCboHZVRPu7jwmrvuwa8+2WUHAfO487F3nvXQLAdoOxe4h0r83007nsorzhwHN2fDtF65CJ4sTjllxVfq1D4BxNgAkyACTABJnAXCUxV0L4N0Nr34Lo+6ucDjJPR41gMKB0aHG63cOmh2dcBBqObRnKMzuOSHHiOr0a2qVyvJnqOhQkwgRkEJu/qKP9WR//7jEBFjz63EDjO5ZTOT014l33HSnuI1oNMf/q1jdAJ0PpsBby2H9ej+L6tgz4UwdmP9/ijs0B8aH48hmnMeqg7Dupvpz2/Wfd/mAOVwXYLV89vHp8r4vuFGmSA1pd56dFzSvOiYS8S3yLCXILTPBY/W9bz4l8EjhuZhiwjPei129IIrW2jH7kxDDNy3UiuVyDUjeF9BXn5gShI0fiZ7+sPJHknXilU0Gg1d8OFsxIWD7zEoMyB9/yyxtF9xL85cHbauCL98orKYIT2nofgqHtlctlcqd+so3dF0l4kmtnjJHt8MDvsRVK7V8qy8gAAIABJREFURJjL9FOXCVsgApWBc7RI6gVC/MQt7tN+FJ785vu/X3paDuNXERxnDfH7i6c9+qMCx/HQ+Hjxd6yQ4w4ix8Hacd+4PUH3iQvnoGusPF9fP3INiq8aeB2R8rvYzs+gOONSDmZvi+I7IyOzH/2sMjQ79hlPr4jvpT4C9odthnC389E8Fj9b1vPiv53Ufl7qmVwzCuaNYZiR6+cp3MwYbgzvJeChenmLB7hLIJYkaStodHuE9iMXjlNG/c009ZS+L5cbHIoE1crI5RXmRNxbc5HjuuA6OluZtccHs8NeMfLL9FOXCVsg5q1WfBdcXwrw3d5bn5rwf3C1tHfowHFr6F14pXiC7sFl38mgfVOD47j5LSdv63AT82f1zjXVi6tXfEXjJYX3IgqQDCNWVMiUyPiYm52TuD7qQTRsCqdWbMV99dt8l8IFZz2xIiPjNlcD83JZ8UxdOcy/l+toKO96lVVwkLLaMsiBqT1bn49bVxWTA90zGUydWKDKormYkw/WfZOJTs3+Oz0tmYc0DXP1IZsX+TsJm5RxNhxg5TX7EZjK044/ndCw75v1w84l/ZqVHzN0vuwsmUVQSldP+GTi1XUjCZddMdT1pY6WafGgWNSPgrRcdVxWmep0AVj3jXRUdsyyDY7qs1fXp7LP86DoKe60fk8vB2IXnLWEBQbVD1l2GWZZyxFLlgwng2u+vqmMZ/9YnNI2Ico1aUNaNv2yLaPI66wy0q+pPvGispllZLd1O32KT/K276dlYN/PWYKYDLZbaGVXDsznmf6RZKyfSXMpxwnwP/33dj+u21YqSwJD9mVJfyDvC+76nlXW1DbS8oHiLSxCzGsVvWCn46F7Vh6y5ZnKRFey/ua/H2Z52Pm5BF9Rp9J2KvPbMr5VuixtmdJflJbBgVYrN334GyV4+x0M3jURPYpQ2/dR2qii83mM/kkIf7eK6tYq/INOzlx3/KGN+o6PyuMqwk0f1VfmysEEg5d1VDYqqO778B7HaBzH6KjZ/snbOiqbHtyVAI13A7QPKjKejVVUTi6x3yzN4LVeURmae3wnr2twqUx22jOso2hfWh1dc3/v1x4ae77gGm74qJ00EP/es1ZQp66mfB+hexKhshWiehCgvN1A34wbwPhNA9F2gOgghLdVQ+MkRuu9sr9W7wf3Q1QPQ3j3AsRCaR+ivePDE3Whhc5ZFcFOhHDDQ/0tvTtB79hHZVvVjYw11ex6AOBzB9UtD5U9mWZDy6PajMlVt/v0e5wvVrM9iT7RaK+yDabfBnpux2V+VwKIb6P+JlpJmeFkHKLNbddR39bf23ybs/t/o71ZcasfVj+V+Sbl+qZMX2HkWfdp1nfefJ4b/9l9reCZCa/FlTxvSZ8GWY/9zRJK1DY+dFDfq6B6EKJM/cz7MYYvq6g8jFDd8bD6MN9+MB6gfRTCpzC7Pvx9s9+7W32aWIH9LYa5fqrLnf5O70umWKRM7V8otj7qtL/3L2XJdscT3530izFG7ySCT33bjgf/SQON4yZ6X1OJ+s/W4Dgh2sY98VStBNvtXLYX+14a149eXbniaw5cZjVE3TGmAwiZQf1bdk7SVFd3Qjrz+neizGQ6F5Gu2VGKQY/uvGRHaMVldpgibDowMcHKzkMbPKoO1XiX5BLyq45Qp6HzqgecZt5E/JSmEY+ZphnWvKYw2d/me2KgZ8ZpMdADQc3EelP8yMad/lYdt9HBimfJoNTka5ep5iDL2Awn00/TAPRHIB3Ymh8+JUOSP4rLzEs27qwcZn7n5ccMq5gneVfvJoqu4iqe59O024Mpo7zWdV/mXe6BELVNf1iTdDPhs/UnW4eL2kfCTufB5Gfk+bJ12TI7N/NIcdpM7HqTPk/ata7jSdlm8q25JHmZnZ6RK3k5r01kuVoRyLwkbVzLMq2MchOBNgsrap3vJF9mW1fllaSjniWMMnJlmFM6Vj3Mlq9gYgyo5jCSfa3RX4rwxm8Rv/HbzGg2rJJVMM3KpSenNBPxXNVZ81rFb+Uxm05BeFMsmae0PcjfxuDYii9fjvm007jktoyUr2wDRt8m4jbDm5Kp/kUzADA89RH+McLgd09MirmPWhiK2XvZFmhmvaKdhoi4jbTo/T9ClMzVTrHnKy2vwakP143QFkqSMkdzXKWE9BFv1tGf9FATCn26ajp8QZN0M/KRydaiflLZpAraGO0dqfyEL6et9hZI9rWL6rqTOpIRKy5pfz04rcC772GVBoiOcpJFA3iKSplVp+UE0KpL0vdT239JZeKj8UEquoPnsmyFjMLJloO1vbYqZ2D8MhSs//GshvLTPoY0aeo4KB/1MHpdE85r3KMeJn9WxXPoPXrGVrR59QAYornpIDiVQ9zRi4rlEMfmKpmJum30UyZJ0UaMeqwnpnR/Kp4b9Ue2E10v530HzJTomsKndXFemxPPc7LptIviNspP9VvJeM7qa7J9d+Z39l3d5ymGF2I2i7fBQPI15L5BfRpNRlE9Hv9ZlRP963X0RPNUvFTdFrcUM7P94HMb4Yqs/7JVyz2lum7dxT4tqW+Z6jmzL9HsVJsWr87oX8T+W9V3JP3XpIuq48ATZtZjdA/KcNZj9EXXJfsM+zugyvBBMzcBq5XqrJOrWf1IJrsX/nnFim9m4Gk1+qxMEoBVYY0gZudjXosguXhlXLpii0ZtdQBmWqaMdoeok6f3C+WizkF3iCSDmDXUHSqloa91TOlfKw8Z+aemlxkAW3GkURdfmbIWDH7ppTwnHZXJSN+b8dfKj/Gu1Zlm3zfCqUdW/qw4s++aigA9s8tRxGOVv1akp328MvHPSls80/FQunXUadVL7RknpuLa4q/jN+U08l8QVpSNWdeMj5bIsbkqZ71vtwWdcsrESFc/nJVfHcb4O7OcDFnSNI2XDX5WPEYQ69KUzYhbhzE5zUtPvyP/mn1C+sRqEwXppSEznE05VSAzrsvJVlBGacL5KyvtjFyFeUjrYV4u+b6cfJjPyMyjFMyWPR+/Kb4dVk746LZlhpPXIq6iNmHlX0mRtI8MDxXtLLlyeSKG5uSW2d/M4ZvPhd3vWnkSgTNMMhHYco/ROYjQ/qychZCZWKK/KWX0cSdZhSTFhxSiRPFTCptr7KsanlVQ2lOrn+9jlGlQY+xt7T8ls2DljfNjE5WjLibvY6zRnq2n6ZrDUCjii3NWksE09SeVbZJ/NWijgVnzwk5VxujsGQwopVEblQwn8U0ixdfa36snDnw0PykRxUCznO6x+9pB5Dowy0SUudhTp9MO0dbz7xSNqJ8OvP/WF6thwhRRr6h87ooVl+5ogu5hiNYnQJaNIcO8ekBpiDL2FSe56kOKtVqDFmOJhKvKmpRrenvWweRfu97n2qDZxnPtMTsesGMuHB/ofkQENdOm6/w4juSZOyZUyQrZdfxz5M5P8GfSLshrmjtTbrtfScPIqxzPXLxGvumZlj+JyHie3EsvzPh/rk8D+s99xG8nYkJI7CX9oNNR/dz9BgbaNFdP4ujJPTVB47jV1ELjcwuVlUi2mTvXp9FWDQfOYcHe7pl9CQr2987uX6j+561YZB2k+vIvryJhPROd615ByUblpYuwcH+vfmiOPfQ93b9dtB8x3ptxebWKb67BFA+cEnlE46NZ0XS2VD8zG495LZ6LzsQEYQ9uijqptGEanYWIR6UvZqzT68JOzkiXZKIwFK9QdOhZYWeRxpl2Jqa8dJ3p7DSEjOIrO3Ad3/R3xOtWWRh5zsadVRDpucjnnPi14pxw0+HTtHLlZqSt86IVRnpkhS+UQTUynWbCm+7r9NUHQIex/pp1xhJG/BB1JAmfxmeHNNIixjSrrlf6xYBYpiHyksSly4z+6ngznDLlMI9FWp+zq0AZRqYMlMZUrlouO7fpr0y8CXu7jZNcuu3YPE0GBqMknjQlurLflbIJJjM42e/k08ukUOjkzkrDakP223r1Oqm/BVyFPEreS8lWEFc29WmMsnLNq4ckly4vnUYqd1pH9TP6azJKw6YhzDjpOmGUBkmuzPfNeJMAok0ZZanri8nIvFYvpvFm6m22PaQJJVfpu+pWrh5QnEadNONMrjPtScho5EPVC5FnnSeRXDFzLRzJli0vaAXOjEcPCI1Vvd4RKWypMipNzhyUd+qIj6vCtDY8amMglGetpJl7W4do3s9446RVY6Hk6lVgklT2Cbm9Y99H6H9INHOdpWv6O8bw/TBRzHQixC9R0JIyqc10xDR4FaOjFWO9umsotHJCIbNnTU0GWKsXatDn/CVA9ShG7XGI4FGExutUi6UVfBoPpYNHvaeujp5OO3P0iHQ2o+uFMl+c6oE6NW/Uqc6uB4qcyo/jrsLfi9HOlKPFVcMuaJf6kf6b7Z90X5Frg0Zc+TaT/Qbq2PXftL3Snfz7RptL6oTRVlWbzrU7HdeMb5L5vc2nS9IYsom0M2MUI986Nxdmpl/Q31NTzpvep5ECS32Na/BQ/RxZL+h/koXR9nQ9XQ9RP45R3QsQ7NZVfb2GPg3F/YyW72r/FqWl+toCxXdmXyLqBH0Paugakwg+1fWp/cvf5P5e8x3lFdp5fIq/36Q2Y5gw6/IyZRP7eB3UXheRmZKXgjZQ9PZl7l2h4quETj78ZsdhVN4i6czOpmBAkOswch2ETNvsNLOdVNqRZju5zAClSL7kXpoOxSfSU8oPzW6maco06AOm72XzIH5TXikv5oAlSUteZN9Td409YVPYWh2bkWcj/kQG4564nFPRBEsqZy23FT5Nq1h2nVgaTt+xwhfEOZ0nxZWWY1rWOubZf2fnJ/8uhadyJXlF+eoypL8F9TcfA91J819UDtNZyNisPF6grBMZLK76rs1P31UpJXtwZ9ZlURfseCwZ7UjFLyuP6vmsspjHaV56tggpf/O+lYbF1QxF12lfIJ4UcDXlMa+zMeV+F8RlhpnFKCtXEeNsXLpc9f1U1vmM0rD6bXMQSu9P6Z90cGIswmR4Ggqvls/Ki8nIvFbxpnIV50EnX/Q3fVc9zdUDitNQfHU/WBSZkE1+C83vkzbnt/Ik3p8lr2SkeSTJvSOnIPbKbN7zplJ4NrWJmZqNNwcqSYR0ocKbg5zC2foxOnuUP30mI20qk147zVVLESPt7UrStxK78h9iZcKtoasXH1QKVLaJ4gttoj1D8f3WRXUjTo4JkSseqclvkq8MR2nqnfF8qsrJ9mZqZl2zNFeg1Z66xx38TXhTTccU8k2lGGvnW2ogaq7SmynQOIXqCpnHy3/z6oF+W+6LDPW5n46XrlorxSrlqt9J24m+o/+Kei/Girp/sOt9rg0abTzfZsw+R6dg/rXlyL9vpG2kY8Yw7VrEZShiFM6K34jPup9EaMgmwmoeKkD2/cswS9IoWA2+6X2asqKwlDDVftJJIdVejNVdPQlUvHXh6vu0af2Mgf7KLovTkt+E/Irv7L5kovt3YwJPs7O/L2b/ovgZ3zvdH/r/y6nw1OyYJsxqEsIsi6n7ewWlaXkx2sgV0bw6xddooJZs4v7sWf8kfDIIsjuPXIeR6yDsQVOu07RMfY1OzlA+EhnmXJAs0iGP6qBIFuEQJlW8hImPUTkoyml5ICdGdkWzBci9Zz0282I9kOZPiQzFA6Y8Jx3HjHjNGUod3Cp7412jPHXQ9K8RTt208mrGmeukszwprpS/FU+a4JQr+10RyEy76C2S54gc0ug0KQ7p1EIPbuebeRn5L8ifKBtdfgXyWGVnvV9c1mk2jHT1zYL49aOL1+UArTPbRGpeOeSfzykLK59SQpNTPr4kFwUXxZymc81GYfc55sy+DmnGdTnZCspIRzq3/WXkImYzlE8hlzVwk+//uKkzCarKkeqDFXeSCeNC5VU4yDIGfQVlbTE066x5rWJO2ReXsyFA7jJ9Vz3KyWLU00vztQehVp5EcrPKXr6b/V7oFddU8dCDFWM2Xw1CxJEX72L4z/5UCmte6ZuIQ2yVwvXAOLtWeOOk1cgx+s8qaJKDK2O1WTs4kYMhF9U/Jxi9jBAJJUuaKZZPEqM3TN43EN6PED8N4W8HqJwOQPtPyVlW+Z6Pym6I4K8lhK+kkibCb1cRHwQivIj3+xCdoxCVJzFq2z7id1LTpX2zrmHmrQuZytbiREdoOKuov9MhzL9jceyP6e1ZDw7TOAzzy89tRId0HIcadGqHM197aL7oJybh1iowJfd9os4N1kqoUSZ65f7FEPm0ac9wF1UyjVbm6ZK9uUpv5keveNEkxQS9p1SGeoBspKlekfUAGJ1XEdzX+7wBfGjAS/Z5y8A2VxVBQbuUTzJ9lLhp1/tcGzTjKmhz+XakZEji1t/q7NiBAphpm9dmHFOuc32Dat9F3+4Cua3vhplHnVzyzg8w03GoiQmrL87JTflWjJI0jQiMy/w34+r7NL0tw2wrevtEsi3BnGD70ka01xbmtrRAkrZPJfhkjMn3q+7T5P58s59ZSp9Gnpkzq7Q0AS5MoB2jXRt9iax3crJ0fF5D9dX4Av2L4pes4Kr+hHxA/Ge53cNUwNPJvyHaezV0v6mxBZk+f+2gdpBuw5GlJFf5c5N2Re3CqI8/cnlliu+sjifXiQlJ8wMSM5wZn3ktXhUgjEFSZvVFxKMbMb1gNWS7YxNxWwND+3kOqojLWO1UnWay+plLT6dvvkOBVCUw5cwlZnfSOQ5WvjIv0zPd+SYypZ2/ZGL8zrw+Pa0sH/m7yIRX59EcqKVlrPKfDIxVPFpms7Jn81lYBmZeZFxmurn8JPmdl58kYHohZHMMhUKXZb5O5j42SV0z083Iq+MvYqGkSDkWzHYLPiYPu63ZLLTsZvg0q3bbmVeXU6c9MoZMvjITQLYc9IbJJP2drVtJuWY5qfeT55n0jFzJyyynot+6DHIvS27JRIdZX1VYq4wuKVuOjZCN6tc8Rhm5dD+TtDNdhqquKoZJPkQ6RjkWMTH6LDuPKSRx33QwmD7KXemw+f7KaE9aLl0eFu9MPdP1Quc5mwdrIjQnTt73Ab2v0xXBKT3dXlT70WnRc5GelD1bjuI3rdqo8Nnn+TZgyyfCm2lpJctacVQz8+ZsvnB4RCuQ0gFJ7c1E7NdynYq1X3R0XoMnHGSpQc1f1f4s5fREmkr3Ea+rPXRKoTZXMWV50n5jcm4S4B//XRvxkwrWHBf+foz4rI/JlzYqbgkkB753UXNchC9H6B16iE9pz3AZ8esOavc9VM/HgAiv9sKKc3VdROf/Bd0DFyWl4BKb0uE/oHEcgUz2yjs1xCddy1szyWYNinW+fovQ/mQsD3/to7nro3auV0ZVOShzY73qRHuihVfow55wSiXP0pT10XnSpeVvdA99dVQScXOwauyFJu+zzUdecpSSNE/Uq+dDtMRRS2rlWJ0nnCoDY3SflOFuaOc/ciBurb5b1UfJRYNkaiNq9Z2U5en1QA6gzTRIKXHJgY02kVSKlcU10w4sMXLtT3+D0gUSUYfMem61dxk+6ed1e7faqJmi2V7tMZUMJbnoPlC2UaPvyfW52biNVfisLAVy67avx0fJb/1ukm8pl8xnJs+6Xzf62BwzQ8zcsxvdpwFyZdCcwMlMJlHeRD8rJ+KGv/sQ7ULta60kFg00COigtlFB6/PV9Wmt/0h75zP9zJL6NMFqS1vypIU+sy9Rq+e1NyPhCV74HJjbvyh+Wsn+2ICfOEZUjqz0M9pXLZz71dAbtRGKviZVnMnpVv7cYWmBY64Qi9wY39M0dz93dUWKr9lACwQSguuBgvFcN3RhvmErhuaAwLwWb4v3zI5Jdgq645KNvJ6YaKYDZ3rb7uTEHXKEomUwOhJDUuMyn9dcp6Jn2HSc1CEXMMjly0hFX9ph0g+ElLeAqX5R5dPKu+oo5r8rIxH50nlIBnpph5PGYzLJ8pW/E77mx8kq/zp6JJ9+Lp6l+bNkKeCpn+c+hlp+HW/Cx7jIcTHzY4RLLlU5JB+ooo8pBc7kPVF602e6zuoZOMlJHYmg48+wEG8nznvSuMyyFvVG590wuafQ9E/zovTkcTQpaxUk+WOGFeUzrS4XtR2rjKe38SSxeWVhxZfhRJFYz+30kjTMi1x6xkN6NqPeJIypnOaW0eVls7hfuP2pukhlr+vPzHqYac/qOKOkHRGOGYyEjEk6GXZWfTeeZS9V/FaamTqaq3dZ3qaM2y30SNEz5ErKSrWJbFqmSLk85eoBtWuzvcxq55k+W/kE0Kvwdv9OUsi4kn7BFIyuc7L0ESsPponaJswEXUQvDaXtSwfVjTW5Uno6UA6vJuKoo/JmiNpxDdGDEPWXfYy1QvO1i/pmCf5eFeF2Fa3zFqqbJZQ3fIRncn13/CqE69KgMhWUVj2CFQ/+wwB1pTiKFRw3db4lBmsrdenpWKxElNFQTmzESsGKfTyHFV4o2wFab+j8She11xNMSNYNT674ZuJLJZP9Xk5B08d3rJfgrJThb/kIj1rofUmIGlFMMDgNsbpeEfsHw+MOOicVrK578Le0AjrB8IUME+2GiI09vPJIoDKC/Rg1Ovppr4Gulc4QnQMfq1shooch/A37zEyxorS+Cn+/ivB+gIgU+0TMCfpnMRovB7m9zTIDE/SfByhtVBDuVNFOymx2PZh8bKFKRysd0r5kJbNRtShuajNZrqJuG23QgJjrp+tv7W9qrg1m27vVp2WOELISkj9EfOo7eJE2p8PrccvU9kjRW9+czDcpJ3e+P0jEFWHV+/rbbfKz0qFJgjnMkojtFVlxO9eP3KQ+jZQxF8JzcJIHqTSVj1MHepj00dguwduqIDjqYKT6LdlGfIRUX/cCkN+Cvj465wr7NOkdPe23rD4q0wddZ58mj2TTk2UJMPK+MKMvGaC5XcIa9VtP02PYZvcvAL72EG+vwt+NENA34X3qs2HysYnwXhmV/QjBTozOeQOVe2V4m3riDxicBij9Rvd0X2nIK5gZTvfUI6sfEd95U/cz3r/E5RUpvpdIcQFBc53mAtL8kSSoQGcNwH4kTn7nbhCwGvvdyNK15II5XT1W6j9/ul+iD5Q5aLt6MX/RGOVgd+ZA/AaSoUGh+0iflatWEdVKrTDPdWvofB0nZsLuEzIZ1v9knrVJoTD5XYnxT68iOG6A+ssuum8HGKmzcEV8WqnWUai/VLezClomyA36qVbu9SrKDZIsK0qeK5WZOTmUfePu/uZv0mXL9nb2aXY/s7w+jbab1Nx5/drN70tEu8n5gLiefoQV38u20SsLfz0FemXicUSLI5CbxZqz6rM4yW5WSszpystDfGzMVe3cCsWPJUkD4dumnP1YTpfw1q2bVJB7t2h/7+R1HeHZfxL7i11h8kv7kV042000D2i2n8zdpNlzSlaaOerwnccOSDEeCcVXrRpT4K8D9D6R+bPa3/uphehpeuQOBckraGkqy72aoH/swXXSFY/xSzJBTs9GXq58s1PPcb11dXR2/qY+5W/SVDSXenDr6ov0oyAm40Q/8yf+7Z4D3Uctsk8jzv1nZWOf723sS8hUOmOlRBm7pnrBiu+lWucVBRad5RWsqlyROBzN8gnQwEGbVQnzY3Uu8PIlu1kSMKerLg85257WvZ9cpdHmeLzae9UFZcVH7eCnV+WtGK/zxwjtXToGp4pwv4Xhd2DyNoa/UUX8LES4I83f/F1aER5j8LqHoVq91VIJ82kRvoJVx4XYwzcZorVbRnjSQee0huhJC4PxBP1nPkrbVdR2Y/RSSzwRVU5B0wncgL/DV1UEmxVx1FF1x4O3U0fbMCW8ASJOFcHmShO3P2+OODWxG/aAv0lXUyC3q0/L9zPL6tMEfeGrIN0Tfdv6Elo9LwnfEmZdur5+5E4qviY6vmYCTIAJMAEmwARuKQE6//e12pec2Tt32RzR4NrbpXOLO9BeqC8bB4c3CHzqID6OEW3OM7U03uFLJvCrE7jCPi1BSQ6l1mvoZSYNk+c39YLkNhz0LUJMVnwXQZnTYAJMgAkwASbABC5NgI7bKK/4wglffSdE/ZxV1ktD5BeYABO4MQSurU+bjDG+bYrvt7E6zm1xxcOK7+JYc0pMgAkwASbABJgAE2ACTIAJMAEmsAQCrPguATonyQSYABNgAkyACTABJsAEmAATYAKLI8CK7+JYc0pMgAkwASbABJgAE2ACTIAJMAEmsAQCrPguATonyQSYABNgAkyACTABJsAEmAATYAKLI8CK7+JYc0pMgAkwASbABJgAE2ACTIAJMAEmsAQCrPguATonyQSYABNgAkyACTABJsAEmAATYAKLI8CK7+JYc0pMgAkwASbABJgAE2ACTIAJMAEmsAQCrPguATonyQSYABNgAkyACTABJsAEmAATYAKLI8CK7+JYc0pMgAkwASbABJgAE2ACTIAJMAEmsAQCrPguATonyQSYABNgAkyACTABJsAEmAATYAKLI8CK7+JYc0pMgAkwASbABJgAE2ACTIAJMAEmsAQCrPguATonyQSYABNgAkyACTABJsAEmAATYAKLI8CK7+JYc0pMgAkwASbABJgAE2ACTIAJMAEmsAQCrPguATonyQSYABNgAkyACTABJsAEmAATYAKLI8CK7+JYc0pMgAkwASbABJgAE2ACTIAJMAEmsAQCrPguATonyQSYABNgAkyACTABJsAEmAATYAKLI8CK7+JYc0pMgAkwASbABJgAE2ACTIAJMAEmsAQCrPguATonyQSYABNgAkyACTABJsAEmAATYAKLI8CK7+JYc0pMgAlggv7vITzXgbdbR3xchb8eo2+QGfwRo7pdguOUER420ftqPORLJsAEmAATYAJMgAkwASbwAwRY8f0BaPwKE2ACP0ngTQ3OdgtDAJM/qygf9jAxo/zSQvBAPjdv8zUTYAJMgAkwASbABJgAE/gRAlem+PaOHDhHPVsGGrw6DoKzkX3/bR2OU0cmtB3mSn71UHcc1N9OiUzIF6D1ZcrzW3mb8mzkaU4eR2eBUEAyJXSDcj6nDE0QYjHHAAAb9ElEQVRJ5+QVyLAx3+XrxRIQfYCDNaHwTtA7KiN4QWqw+kdleVnFV8WZ6290nOrvvDpf2Jdl4uCft5jA3H7CzNv19RmiHma/mWbSM68zcl0qT/mI58oi4nfgOFP+225hsd+QEVrbxncumyXVFxTKu3BZSTj7O0Z9zNRxSTYvF/w9r1+7YDRWsOuI00rgoj+oPH+i3Oz6bZfFRUX40XCX+Z5cJmxOnp/sA3Lx8Q0mcEcJXJnii6KOSdwLEGQ6rMV1pnM6uDvZUVztgOhW1fu55Zlhc6sydzOFHb9vo74boPK4hvg4Tv8769sruFnxqW940EDrqIzonNZ6+4jXA7Q+q4BUlpdSfGkg7KB+NH9SbXH9TzbT/PtGEJjbT5hSXl+fYQ/GzTQvcp2R61J5ysd/OVko7atX3PJSzbhTNN4wgt+4Nv6T5WNkbaGXN4bjnPKeB8Wu34utv5dRZi8TNpfnW1rHcvngG0zgmglcneJb0OioEdffZmdm5QA1XZWRv5OZ2YySnMs/dYDWrLO9ciw6OP38qJ77QIuORT0PjuoIzNXRbGIiT+YM94wZZjWjm8hmzOTrTtdMm2Z7bVnt9W/rWW51PMMsSUt26FoGMaOsyqV+FKTcDMYiHfVbytkSCoSOIy0nCcfMQ3DWyvGVobJlrPJqpCtnwNOys/Nrcs58pKwyqaNlrljPzGsBm2x5f+ujsROgsrWG8uNOsoIxehnB225iAGD0RwWus4b4ffblX+33BL2nPvzDDkaWjfIFOQjFl0yZDYX3cwuV9Rp63wBQWV5G8RVlT/UpU18KxJF1vo76dtq2zdUXUceTNmW3tfoZWbEY9XNWfRRp2+9bqxb07nYLLbKWoT4pSdMQ+nMH1e0QwaYL/0RPJkzQfxbAe9LBmPZMPy3DcUK0f9G90FReslyIoy6bOdyTcKqu6W+G+KvjmNJnZL5BZt0R9daIK9t/6pK1+jujX7Tu5/p9/XaBXKIeBpjWz9ObZt9t1jcrTUMWnVrur0rLtpSyZSqq5z3qqw0LMDNd4iR+G23AkteQy3zPSicRNP/9SR4ZFxQPpWumY5Vl5ptul2WmfhlyiyTMOrLdgsy7+t6pdi9XyIlbHT3BVPUDRl4pLjO/RZx0lkS45N1MeWTl0y+pv2YaaRsq+G6b+TLbEMVj5sEoZ53UtDT0WEB8y6ntJHlQb1pppmMGsdiStDXdZnVq6V8rXRG3ZCMnSfU3wIhXvHo5fmYdyo6LxDOTv5UfW24ZVo5b5RjMfp5lbJaVfJYJrzGIsqmjZ6ZNMllllmFghs1NdGXqv1XexC5A68wcq2fi1nLxXyawBAJXp/hCNoT0w0GVX1Z2aszpR0M1CmFenP9A5ToJE4poiGbDVp2T6lRkB5c2MBGX0WDF76RT1Q3XjM9ITHUIaX5U+OR9I6zKe5pHO1+649Vx6d/JQFeklcqRzYf9W8mRdKTZ3yZf42OUhJfMtKwibpUnLZeWU35YpsuV5WsRoUFOkqaS0RzIUVma5WZyFeWsy1HKK2WyZU86bf2u7sSTdDPhxUAmzY8pLzBB96CM2usxBr97cgAtVh9HaD9y4Pz/7Z2/a1zJk8Dff3EvFTg4gQM7s+ASCzbwgIMdcLADG5jhyyEGcyyDAzOYAzEITgwOfMMG369wYE4OfIyDPcbBF7SJQQ4MMseCHOwhf8GBAgcTKJhggzqququ7qrtnRt6VZrS7ZdjVe6+7q6s/Xf2jXvfr+WooHN9Kb8vVgv4Ud+673AOY/NrSYh2zY0sOrzvgCl8s0Pe+WJccfo48yHZ9vc/tQ8REktsA2xHbvUw/v89I7Ivtj+0x6xe888H26eMHPbJynsDenSbsfZzAwUOcoPX85yFH0K8rqB6MYRoc3wp6bzIBf4oHrh/i/gKLrPtffCLrVE0QfR1w3XPaOPnGOhZ9huqbuH/lcGcPUVZ6r6tD2ixpTY5hLIfrj+O9Tp3oxbbHtuWdNrYtbccA7DSwrqkuOq/kLmWQvWxK+L/tQ/OeczJZki4bxsedYTxP8ONFKEtSf9lcg6Xy3/ncQyz/wkkxCG3XyWB+ymYStmwzIS7xYZsQjivLxnAuG9cbhyUs53Pikri/FJfkJPwL7UGlTOtT3EeZbDOxXHp+kDLX90oOZi7y4G3ggYlSzt9g/MCI08/SJRdA+TNzzzjKS+1N657VbyKeZIu5jeuP4o4I1fdQuWfrnaZVjBf1VRQuZEs92c6YAd8HvRObUfWT9nMpL7Zxztvxm81XKmbXRmD5BC7Q8fXGLxsWd1Sy06IG5wdz+TyUHRsNN6DwcOZF7FSShkspZAcmr724eR1FIces8w5xSnmHQPfGllng4yxfl94NwAU95cCVdkiZvIRflpeeRMgyyWunvdRF6ujLRrJjB++fuj8UxpM2lNOHvviuCestljevbwx3EwmhQ8FeqP6Z7YKyugE2z4sUPjuA3n1cgURno4Lqzh4dvIRpelUFNds1hn9VQe9HVdrV3JwewHCrAVW1BoN3y1QBXwY0YO/n35An1qVwbCc/dPwBV/5738e9L3B8hY2gSgU7kJrmdq7bROxTUG5iL9T+/LNF9lgIVza4QE/4sAet7QOYTg+gV1dQPzxw28c/JmcnTA+gW6GDLEu5muvTH4fQwfZzTZ/UfZnaxPryufxG7to+pA0U+kB+kUL9Q2KHCwpN+YR+pZR23rgi9SrbfMZF6aPz07qoiNnNfLkuuoyjeWK4zptSULvyYwJd89jhs1fPkrL7KOEPtSteyUv+Bt55XUo95bWTG+siD5MrozFe0CdxlDG9cpJ5/KIEko289tIkp5gBXUW9SjokkcPt/LiLZMZ6Luga8ijXF6bNxviQJrnAcgdOZZ2jLkla1UYxLNc1ljOZx7IosqnEJinM6cIvT+iRtz9+FvVarHeMyxmX04TQwo43vRPDx8zGmlwuMaD2UShTxpA1KMmfzzdJabdGYOkELtTxpbdTvnPCRhQ6d+poXKcRGxe/JUoGJrXVbAaPdGCbOekQDThr+Ci73CHrXF0jdttOCttwOLIfkChe6KBdoOxU6QnpIjvRRXq6iTnyzGSRQFkOeb14QiTlyWunuSv7bAdVhrsU8f9CD2SzfUi6x4HOlz+ty7B1KR8USb8wcXE5KZ0LdawHEqFTVFRf/bwHm1UFjb/6g5beD+BmVfnvUDEqOr4r3FZ6egTHYksrlb/uwUFhu/HkdRfWqg0Y/qSL+NvvkOMmtLfFN73y+168fokbw+f8Q5sQji+uuNMBV3gQ3tkh9G9VSfgCWarN5YO6TL3IjoLNZO1Ut6dFcihc2HPoQ9iZLtir1JOvcXW9qmro/t1VMr4kqKpNGH7wMdDxvbE8R5P14r+Tn4/gBLen0z/Hvn7knXR+TH8nMP5uDapbbveECvoNN6G+vIxfx931ZaGOgj3JPiOJI+vW90sq76SvSouo7GeGLWDZ4jgqJUi9tF1yrJQLPlf6id1QShcWUPw7o22R/nosZ71RD3YCSCSNlXL80/qT3pJtuPZpSumFrlSWUH8iQF4W2nbkNaOMlH5GGOqEeRbr0dmNY4Dp48s0zJM5kXiZvlROGS7Lw3XL5aa0vj74WRLf3Urd8giRZTmetBu65rqStk86a9vgdhbnA4mNpKowX3q+WJc0udRzkeO70P6UcNQl1qcL0vpFu9LPWYzULbOHdLcKJXJymGF4ITDHNvKXwc6OZbuMeiTyuU7xr6xX1i2EM4e8nCR7rh0yDftrBC6fwMU6vsHB1Z07FgMbNDYy2bC/uDGIDpQb7PxORTTuYqeADZQbawo7Nn4emM6lr9CRO4ksHcWRA/8iPSO3TBapLcshr/WEgksYmck31fraxXUMHOtEbsh39oDFdY06E0MsN08OuAMt1gtrin+jDlR2TuejKB4FWbKs53nRcULbnKNTgVtv8TuasJrmyyDOH5bKXvL1EQxuVNB4xrlPYLxVQf0Av/Us/PtlCpNJwSMuRP2yR6hHB8bB2fmy1BQbJzLK8cWnbmsvHXD1YQibWXgpH9d2wiQgDMI40ZJtLKZdZEfBZsieEhnCxhbJUbYZs49XQlZ8mF7hFnwsS+R9tFPTtueDX3zct31Ye6zPCEilXNr9ZAydqobej97O/H3nddEiAc4mcNEmGerLF/LLuLv+Be2n3M/Lfi/2RQt5CseD5aZplP3MsAXuQ9O0WV9WSC+5UF7UNtiedVmULnlm4olOhwGUj2prMk4+FyjWD/FC3Vx7nsUM8yumlxqWfmFChNMl5qfGEpmv1D9NWA4LOoVyyHSYhucZeM11kLORW4CDTCmqKN9FKMYnu/BOpyovCy2Xh0OjzHI8Ck/lko4uzzDuh/KzZPm3LFvGkIsqck4g4xR18RF0WJ5fLKe357RMMiN1jbK4bjlAy4/tUD/n2FK3UntP08/sqwp9AOfxaxxfnmMHGeLCtXmxEKTyzssp+QoxdmkEVkLggh1f12m4g0a4c3flQsN3H/2LTmJOJ16iITsIDo+dghy4Qqg4fClvjHlnwOn8NyTJG6ovaryibFk66iQkH6d7dDBTZ1KUTcgN2madjmCswlyKyExPIjI9hdPJ37mozpBkp7oGrdx3PNt4WBbrg3XgDqSKcgr1IkSoQQ7LntQJlYWfLShrNllU+Qg24VtKntTxt5UAk1ftuBqMST6OoPNVB/qPmtB4cgTwfgiNO5uwcb0FnYcd6D3tQ/NaE/q7PehsD6B7dx3ar+IPf0zeDKB9rwPDpz1o3BnAEfkPUzh+0YXm/T7s7bRh4y8jd9AWbXGVK7iH7lvP603oPulB63oDBu9QAB481YLNWzVsfo8rrycw2mrA5q11aG11ofM41wP8IUr9nQ407zah9ST5Xd2E1dHuTbEKngSe5xbrsuTY8gFXH875jW+hzin7ObaZ27me7MT2gbbJtusLRe3PP1tkjxRXtvMEzCzdVTTX9iOr9B7gaHcjrAZj0unbATTvdaH/oAHtH04BV/4btzdg7U4HOlsdGDzpwsbtLgy2O9DZ7UPnNtsNpS7b3tkx7D9sQnt7D/r3N6IN4+8x1x0Ys5/7tg91VcH6vS4MHrVgnW0aV/G/2YSNetPtQMB2c1e0k90uNK63YSR+Wm76fghtlPOwCY17Tei8jO1GIor15Z9+CfdCHWr7kDYg+mGpwJxrLUtHpLAwwS71g/Pyk3otesHp5MQ+F/XQ+WldtJ7qLrNZLYfiqjgYrttAiUmsw3lldppg3NmO8eL0KAV10DJkOeS1L32wk0KYZ0nySrYnnyEbHq8o3Ww28zl5vcSfUvwQLHUID/FiPq8osxwv1psSSjcxbYmZjL8oPJ2P/Upd5rS1qKueE0kty9dOF9W2yP7jvCgyWqx3jMu5iTTBBjks0VW1uxiHrrKwXG9iQIxEnokYd4v1lYyLSn5en5JvUaQ9NAJLJHDhji8aOB5kod+m8sAs3hBRIV0DU3FndtBJI+c3v3L7RZKWOpF0O1cYdHzeaQNm+Iks9yY21Z8j5x2F7MCyRk+dhBzwXHruPCm+mCzo+5RZep90SqpDcvrO0i3TszQ5EnqlfJlG+Et5y5U3r6uQgXF1+fCJ7Djz6zBhYflcpwvKeh7H9+QZfjPLE/kTf8J1D9zq2gnsfd2Nk3w8EOtRTQddnTxvQn17CC+216H/bAib1Rq4VS+n/5rf+knMvvWO7PsBbNRN/63sCex/7Q7Nwq2s9bUeHNCKKn5j/E/wr9sD6H17E6q6Ad3dAey/nwLQtmzOx7Fd2z2iFw7rD/Zgj1eD3/ZhfWcPhl9VsOZXh5Ue0yPo36qh8wN6L0cw+OcKNp4u2Kr8eQydG20Y/drvSrF9lRxfctz60Pi6ea4V39xmg/XpA43i47Ddk9uba9txIJftg67ZvvwkMZ6k6ep2pj1y/DDh4kNZfNsv2KtQ0186G6v+xW8PPjuE3o0Kqrv+G/SzA+h+PYRjXv3136j33kzh8HENa9/9F/zt2xbs/bULFTqdeBo55VtDk3YOOLupd44ov9z2aui9mcB4qwa2YSBn99/gP4cD9z3vrTb0dodw8AmAdkxc68AYt+NTPu7788Ptdeg826PVYWwXeF9qJy12bj+NoFVvuNPTP4+gXdW+PeWEZH250LRPnMN9YT+PdRxtI7UV7TjIvgo1cXoE+0hUJ9sVtpH2g+m9Tp7oVbClyCXVw/NJx0ahi84r3uXtLZXtGITdFqhXaD9eDukaHQMeW5lTVm4VP80v6uau0jpIw32sdPs15RHH5MiO7Tjqq/sE/9IslNHlz2VxbUDMG9DemHOBDcpO0+p+SoQnRYt1kzNS5UnSOf6x7HJBIMrkNjSrLaTctQ5Znc4c41Pl/D1yC4wX6ZLLoPyZu8rbxVXl9OGhHniOIvMXWaRlI9aibSn21N/MYsgv2mO4kr2oryIbjmmFioVzL1z9BNviMjKjVE/Vl6V17e7TcTGTPYOf0tNujMASCFy448sdvTR6Vw7X0EKnHwrHjcZvx0mcohCNLrwM3s7ovxsNgyw3Xh+eHiuPIrhTwu0i2U+T6MxUXOp0s85AJPCDc9hyKRq57lR5IBUDje9UJDPX4c1iknMQmgS9qeMudIayI5a6yWsnL+3gNL9sBV8qQdd5ned5+Jz4J1183UUWiQ6Ks/85I+6sF5QVc+L6l4OaUvvsGPa2NmDtVhs63zSg+2IEw/sbsH63DZ17bRi+46UtTDWB8YMaqnodNu8P3Wrt2QTw548q/u7Wb/105XHOrfv+EZ2JCmp2gv2hWfXOC9rOvOYdEaCDiypovfwHbXmV25ppGzbnQ4dw+S2n0wlMPo+hy84C3n8aiS2prl74O0z6ZrRuudU2pa8ik998HEH3ThP6r4+/aPvq8Utcccbtujeh9cg5TFq4+943OsZO37zOnG3kz720Ge2VbJB2InD7ipNaTCnbBzsv3K6z3Szz7JHUmNO/FexVc/B3nw+gf3cd1u62oX23BcNX+7RzYPN+h1ZE9cuHYxji99HXNqD50P0k13SCP390Mx7YRt+t8wTJHd7mts+7rfSZ7e3+O9ys1qDvD1Bz3xy3YHTqDnqLL0ncCehsV85Bdt+fTycTWnnm1WG8V+2EWMQt06TvtT6QO670zQnp+uLw83PnPoHqGPvtxG44nO2M7IfHILFFmnKmtNGu8vGO9eNxAOPGsUDLjs9FqnCp9CrYkuKi7BTtPembQ/g58uT+ljUJabEsTdh/i4eveTl4ojN+t5/+k5x8W4x9fuynXbtjW3VCVLnnyRV1FNrvW0yAZdcyyfkTY3bW7ildzIx1CDYTg8KJ2RxGP1fmmWG6UE5koFi6OgnhKHMBJ5mtGltVnQjHWyYQ19ruoo5KZqqPfCGUhS36HjTmoV90C6XUJbdnUW+STaqLSpu2NSdLcs7K+YX8pD2k8yIKk/U8R2+My/PWebbPtqX6KtJZ8JEMsrDc1oiB0DO1CdWOszI4pi7OIr55uFTVro3AZRO4eMf3sjU2+VeIAHZgMzraJWmZdtZLytZlg9/Qnh7DwYseNOq4Snr4WEw0aHWsDSOc+/HKFW4/xa2feIgWf6/L30Y+/xs05TeTNOnH7c3olNQQVsTQQXssHGfcYopbTj9NYIqrf+Eef/AGgJwQrivOi/Twk0w+cOgdyvH6ngvmFE7fj2H/aXLQ1Qv+zdlzCSlEmsDJh8KEuRBzqY9oAjHbOVipPSIIfMnx8QhGT9uwEQ5l8y9c/KQGdyeEU5fZvt5PYfJ/6LBE5xN82M5/NOOLHNwTgE402gvZUXSIcQLbq6KNHm7X9P35qf+oN9yfue+BZTtxL1/Yft2kjF/y0AueJZ4SvVR7sswKq1EGpUggc16Ksezhygmsfl60cgSmgBG4wgTM8b3ClXO1VHOTUfnWjyb56i35JWtMbxml07HKN4cTt2J7221BxW2lzed46JReBaOtn96p5Mn96BVuPf4f+lkk5um2Sg/gaII/TcNvw3G76k1Yuz+CU9rWjA7wFA522rD/s8zHbYett0Yw3t2klTl0Tuqtfdh/tEnbRd0WVHfyL63Y1R0YvezB+s6Rc2T8yvPx95txZfCSq/Pqi8/tS729v1L2iDT9iu13eNgZOrtrgFue3a4B3irsDstip9I5sQMYP29Ba/+/i7b3j7/jqdK+3dFW6zX6xpftaPz5BPa3+nD4v3giuv8GnX6CqYbOqzEMbuPKrXtx03mxD73baIfOfmlrPv2GNh7SNoLRo3Xov/Nti3Y9TGH8oIKwinz1jcY0nEsgH0dUm5qb9s8UaJx+H7Wd19PS50W/D1CmpRG4MgTM8b0yVfE7UITeOON2Nv/fMp1ej4cmSZx/cBBXw+7kZRsaD/Zg9LwHra19OMGFrDM85dY7HOAm7XjiLq1xvR/CZr0BjftdGH8CwMN7Wne7MPy+By3cKu13UZ/80IXGN33Ye9KG1sMRnOAK7qcRtK83oPOwDd0XJyEf3n569HQT6lsNaG6N6PeHcZUM79u7mPd8PeDTGLq3W9D/vksr12Gr62qwXq1c1ZauL9m+t4piTOFwtwHN7RGM0Ha2D9xp3z8N6VvyffrdZdwKzS9pACavO7B2YxMafqt+0fbgBMYPG9Da2YPBX1rQfeVOFZ++G0DjWhO6j9oweDOB6esOVLw9GY5geLuGjTt4KBXGx23QeN+GwdtpsF9yzNFl9/bb5u3Z74fQxAO4nrRgXawir4Kq5XnBBK7AOHLBJbocccbpcrhetFSrp4smavKMwKUSMMf3UvGacCNw1QlM4OTtofsdVvqemFcGr7rept8flsAvp3D047Fz2sNOhz9saa1gRsAIGAEjYASMwJIImOO7JNCWjRG4kgR+2oPG9ZvQeTaC4YMWdJ4dlX8T+Eoqb0r9EQlMXvdg41qDDh/s329D/zX/bvUfsbRWJiNgBIyAETACRmBZBMzxXRZpy8cIGAEjYASMgBEwAkbACBgBI2AEVkLAHN+VYLdMjYARMAJGwAgYASNgBIyAETACRmBZBMzxXRZpy8cIGAEjYASMgBEwAkbACBgBI2AEVkLAHN+VYLdMjYARMAJGwAgYASNgBIyAETACRmBZBMzxXRZpy8cIGAEjYASMgBEwAkbACBgBI2AEVkLAHN+VYLdMjYARMAJGwAgYASNgBIyAETACRmBZBMzxXRZpy8cIGAEjYASMgBEwAkbACBgBI2AEVkLAHN+VYLdMjYARMAJGwAgYASNgBIyAETACRmBZBMzxXRZpy8cIGAEjYASMgBEwAkbACBgBI2AEVkLAHN+VYLdMjYARMAJGwAgYASNgBIyAETACRmBZBMzxXRZpy8cIGAEjYASMgBEwAkbACBgBI2AEVkLAHN+VYLdMjYARMAJGwAgYASNgBIyAETACRmBZBMzxXRZpy8cIGAEjYASMgBEwAkbACBgBI2AEVkLAHN+VYLdMjYARMAJGwAgYASNgBIyAETACRmBZBMzxXRZpy8cIGAEjYASMgBEwAkbACBgBI2AEVkLAHN+VYLdMjYARMAJGwAgYASNgBIyAETACRmBZBMzxXRZpy8cIGAEjYASMgBEwAkbACBgBI2AEVkLg/wGnnlTfYqLGAwAAAABJRU5ErkJggg==)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">feat</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;brand&#39;</span><span class="p">,</span> <span class="s1">&#39;cat_2&#39;</span><span class="p">]</span>
<span class="n">w</span> <span class="o">=</span> <span class="mi">20</span>

<span class="n">mean_global</span> <span class="o">=</span> <span class="n">df_train</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">te</span> <span class="o">=</span> <span class="n">df_train</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">feat</span><span class="p">)[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span><span class="s1">&#39;count&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">te</span><span class="p">[</span><span class="s1">&#39;TE_brand_cat_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">te</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">te</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">])</span><span class="o">+</span><span class="p">(</span><span class="n">mean_global</span><span class="o">*</span><span class="n">w</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">te</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">w</span><span class="p">)</span>

<span class="n">df_train</span> <span class="o">=</span> <span class="n">df_train</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mf">1e6</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">te</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="n">feat</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
<span class="n">df_valid</span> <span class="o">=</span> <span class="n">df_valid</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span> <span class="n">te</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="n">feat</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span> <span class="p">)</span>
<span class="n">df_test</span> <span class="o">=</span> <span class="n">df_test</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span> <span class="n">te</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="n">feat</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span> <span class="p">)</span>
<span class="n">df_valid</span><span class="p">[</span><span class="s1">&#39;TE_brand_cat_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_valid</span><span class="p">[</span><span class="s1">&#39;TE_brand_cat_2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">mean_global</span><span class="p">)</span>
<span class="n">df_test</span><span class="p">[</span><span class="s1">&#39;TE_brand_cat_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_test</span><span class="p">[</span><span class="s1">&#39;TE_brand_cat_2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">mean_global</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_test</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>event_time</th>
      <th>event_type</th>
      <th>product_id</th>
      <th>brand</th>
      <th>price</th>
      <th>user_id</th>
      <th>user_session</th>
      <th>target</th>
      <th>timestamp</th>
      <th>ts_hour</th>
      <th>ts_minute</th>
      <th>ts_weekday</th>
      <th>ts_day</th>
      <th>ts_month</th>
      <th>ts_year</th>
      <th>cat_0</th>
      <th>cat_1</th>
      <th>cat_2</th>
      <th>cat_3</th>
      <th>product_id_Categorify</th>
      <th>brand_Categorify</th>
      <th>mean</th>
      <th>count</th>
      <th>TE_brand_cat_2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2020-04-09 16:47:18 UTC</td>
      <td>cart</td>
      <td>1005100</td>
      <td>samsung</td>
      <td>144.89</td>
      <td>604644674</td>
      <td>16b2649b-56d9-47e8-afe9-c16d97af142b</td>
      <td>0</td>
      <td>2020-04-09 16:47:18</td>
      <td>16</td>
      <td>47</td>
      <td>3</td>
      <td>9</td>
      <td>4</td>
      <td>2020</td>
      <td>construction</td>
      <td>tools</td>
      <td>light</td>
      <td>NA</td>
      <td>5</td>
      <td>2</td>
      <td>0.47816</td>
      <td>1216099</td>
      <td>0.478158</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2020-04-09 16:47:18 UTC</td>
      <td>cart</td>
      <td>1005100</td>
      <td>samsung</td>
      <td>144.89</td>
      <td>604644674</td>
      <td>16b2649b-56d9-47e8-afe9-c16d97af142b</td>
      <td>0</td>
      <td>2020-04-09 16:47:18</td>
      <td>16</td>
      <td>47</td>
      <td>3</td>
      <td>9</td>
      <td>4</td>
      <td>2020</td>
      <td>construction</td>
      <td>tools</td>
      <td>light</td>
      <td>NA</td>
      <td>5</td>
      <td>2</td>
      <td>0.47816</td>
      <td>1216099</td>
      <td>0.478158</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2020-04-09 16:47:18 UTC</td>
      <td>cart</td>
      <td>1005100</td>
      <td>samsung</td>
      <td>144.89</td>
      <td>604644674</td>
      <td>16b2649b-56d9-47e8-afe9-c16d97af142b</td>
      <td>0</td>
      <td>2020-04-09 16:47:18</td>
      <td>16</td>
      <td>47</td>
      <td>3</td>
      <td>9</td>
      <td>4</td>
      <td>2020</td>
      <td>construction</td>
      <td>tools</td>
      <td>light</td>
      <td>NA</td>
      <td>5</td>
      <td>2</td>
      <td>0.47816</td>
      <td>1216099</td>
      <td>0.478158</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2020-04-09 16:47:18 UTC</td>
      <td>cart</td>
      <td>1005100</td>
      <td>samsung</td>
      <td>144.89</td>
      <td>604644674</td>
      <td>16b2649b-56d9-47e8-afe9-c16d97af142b</td>
      <td>0</td>
      <td>2020-04-09 16:47:18</td>
      <td>16</td>
      <td>47</td>
      <td>3</td>
      <td>9</td>
      <td>4</td>
      <td>2020</td>
      <td>construction</td>
      <td>tools</td>
      <td>light</td>
      <td>NA</td>
      <td>5</td>
      <td>2</td>
      <td>0.47816</td>
      <td>1216099</td>
      <td>0.478158</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2020-04-09 16:47:18 UTC</td>
      <td>cart</td>
      <td>1005100</td>
      <td>samsung</td>
      <td>144.89</td>
      <td>604644674</td>
      <td>16b2649b-56d9-47e8-afe9-c16d97af142b</td>
      <td>0</td>
      <td>2020-04-09 16:47:18</td>
      <td>16</td>
      <td>47</td>
      <td>3</td>
      <td>9</td>
      <td>4</td>
      <td>2020</td>
      <td>construction</td>
      <td>tools</td>
      <td>light</td>
      <td>NA</td>
      <td>5</td>
      <td>2</td>
      <td>0.47816</td>
      <td>1216099</td>
      <td>0.478158</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="improve-targetencoding-with-out-of-fold">
<h3>Improve TargetEncoding with out-of-fold<a class="headerlink" href="#improve-targetencoding-with-out-of-fold" title="Permalink to this headline">¶</a></h3>
<p>We can still improve our Target Encoding function. We can even make it more generalizable, if we apply an out of fold calculation.</p>
<p>In our current definition, we use the full training dataset to Target Encode the training dataset and validation/test dataset. Therefore, we will likely overfit slightly on our training dataset, because we use the information from it to encode the categorical values. A better strategy is to use out of fold:</p>
<ul class="simple">
<li><p>use the full training dataset to encode the validation/test dataset</p></li>
<li><p>split the training dataset in k-folds and encode the i-th fold by using all folds except of the i-th one</p></li>
</ul>
<p>The following figure visualize the strategy for k=5:</p>
<img src='https://www.notion.so/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F5c5de229-9394-48fa-b715-c642502ee966%2FUntitled.png?table=block&id=e30c8b87-e677-4a07-b27e-13eed7c69c1b&spaceId=63b72b1f-0e90-4ab8-a6df-a060a6545a56&width=2000&userId=21ec183f-f0be-4b6b-9b3e-6f0d4e5c5469&cache=v2'><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">target_encode</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">valid</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">kfold</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">smooth</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        train:  train dataset</span>
<span class="sd">        valid:  validation dataset</span>
<span class="sd">        col:   column which will be encoded (in the example RESOURCE)</span>
<span class="sd">        target: target column which will be used to calculate the statistic</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># We assume that the train dataset is shuffled</span>
    <span class="n">train</span><span class="p">[</span><span class="s1">&#39;kfold&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">train</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">%</span> <span class="n">kfold</span><span class="p">)</span>
    <span class="c1"># We keep the original order as cudf merge will not preserve the original order</span>
    <span class="n">train</span><span class="p">[</span><span class="s1">&#39;org_sorting&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cupy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">train</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;int32&quot;</span><span class="p">)</span>
    <span class="c1"># We create the output column, we fill with 0</span>
    <span class="n">col_name</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
    <span class="n">train</span><span class="p">[</span><span class="s1">&#39;TE_&#39;</span> <span class="o">+</span> <span class="n">col_name</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">kfold</span><span class="p">):</span>
        <span class="c1">###################################</span>
        <span class="c1"># filter for out of fold</span>
        <span class="c1"># calculate the mean/counts per group category</span>
        <span class="c1"># calculate the global mean for the oof</span>
        <span class="c1"># calculate the smoothed TE</span>
        <span class="c1"># merge it to the original dataframe</span>
        <span class="c1">###################################</span>
        
        <span class="n">df_tmp</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="n">train</span><span class="p">[</span><span class="s1">&#39;kfold&#39;</span><span class="p">]</span><span class="o">!=</span><span class="n">i</span><span class="p">]</span>
        <span class="n">mn</span> <span class="o">=</span> <span class="n">df_tmp</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">df_tmp</span> <span class="o">=</span> <span class="n">df_tmp</span><span class="p">[</span><span class="n">col</span> <span class="o">+</span> <span class="p">[</span><span class="n">target</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="n">df_tmp</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">col</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">]</span>
        <span class="n">df_tmp</span><span class="p">[</span><span class="s1">&#39;TE_tmp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">df_tmp</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">df_tmp</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">])</span><span class="o">+</span><span class="p">(</span><span class="n">mn</span><span class="o">*</span><span class="n">smooth</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">df_tmp</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">smooth</span><span class="p">)</span>
        <span class="n">df_tmp_m</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="n">col</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;kfold&#39;</span><span class="p">,</span> <span class="s1">&#39;org_sorting&#39;</span><span class="p">,</span> <span class="s1">&#39;TE_&#39;</span> <span class="o">+</span> <span class="n">col_name</span><span class="p">]]</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_tmp</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;org_sorting&#39;</span><span class="p">)</span>
        <span class="n">df_tmp_m</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_tmp_m</span><span class="p">[</span><span class="s1">&#39;kfold&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;TE_&#39;</span> <span class="o">+</span> <span class="n">col_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_tmp_m</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_tmp_m</span><span class="p">[</span><span class="s1">&#39;kfold&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;TE_tmp&#39;</span><span class="p">]</span>
        <span class="n">train</span><span class="p">[</span><span class="s1">&#39;TE_&#39;</span> <span class="o">+</span> <span class="n">col_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_tmp_m</span><span class="p">[</span><span class="s1">&#39;TE_&#39;</span> <span class="o">+</span> <span class="n">col_name</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">mn</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>

    
    <span class="c1">###################################</span>
    <span class="c1"># calculate the mean/counts per group for the full training dataset</span>
    <span class="c1"># calculate the global mean</span>
    <span class="c1"># calculate the smoothed TE</span>
    <span class="c1"># merge it to the original dataframe</span>
    <span class="c1"># drop all temp columns</span>
    <span class="c1">###################################    </span>
    
    <span class="n">df_tmp</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="n">col</span> <span class="o">+</span> <span class="p">[</span><span class="n">target</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="n">mn</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">df_tmp</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">col</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">]</span>
    <span class="n">df_tmp</span><span class="p">[</span><span class="s1">&#39;TE_tmp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">df_tmp</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">df_tmp</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">])</span><span class="o">+</span><span class="p">(</span><span class="n">mn</span><span class="o">*</span><span class="n">smooth</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">df_tmp</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">smooth</span><span class="p">)</span>
    <span class="n">valid</span><span class="p">[</span><span class="s1">&#39;org_sorting&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cupy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">valid</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;int32&quot;</span><span class="p">)</span>
    <span class="n">df_tmp_m</span> <span class="o">=</span> <span class="n">valid</span><span class="p">[</span><span class="n">col</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;org_sorting&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_tmp</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;org_sorting&#39;</span><span class="p">)</span>
    <span class="n">valid</span><span class="p">[</span><span class="s1">&#39;TE_&#39;</span> <span class="o">+</span> <span class="n">col_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_tmp_m</span><span class="p">[</span><span class="s1">&#39;TE_tmp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">mn</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
    
    <span class="n">valid</span> <span class="o">=</span> <span class="n">valid</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;org_sorting&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;kfold&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;org_sorting&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">valid</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Target Encoding calculates statistics of a target column given one or more categorical features</p></li>
<li><p>Target Encoding smooths the statistics as a weighted average of the category value and the global statistic</p></li>
<li><p>Target Encoding uses a out-of-fold strategy to prevent overfitting to the training dataset.</p></li>
</ul>
<p>We can see the advantage of using Target Encoding as a feature engineering step. A tree-based model or a neural network learns the average probability for the category value. However, neither model is designed to prevent overfitting.</p>
</div>
<div class="section" id="count-encoding">
<h3>Count encoding<a class="headerlink" href="#count-encoding" title="Permalink to this headline">¶</a></h3>
<p><em>Count Encoding (CE)</em> calculates the frequency from one or more categorical features given the training dataset.</p>
<p>For example we can consider Count Encoding as the populiarity of an item or activity of an user.</p>
<p>Count Encoding creates a new feature, which can be used by the model for training. It groups categorical values based on the frequency together.</p>
<p>For example,</p>
<p>users, which have only 1 interaction in the datasets, are encoded with 1. Instead of having 1 datapoint per user, now, the model can learn a behavior pattern of these users at once.
products, which have many interactions in the datasets, are encoded with a high number. The model can learn to see them as top sellers and treat them, accordingly.</p>
<p>The advantage of Count Encoding is that the category values are grouped together based on behavior. Particularly in cases with only a few observation, a decision tree is not able to create a split and neural networks have only a few gradient descent updates for these values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">col</span> <span class="o">=</span> <span class="s1">&#39;user_id&#39;</span>

<span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;org_sorting&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cupy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_train</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;int32&quot;</span><span class="p">)</span>
    
<span class="n">train_tmp</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">train_tmp</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span><span class="p">,</span>  <span class="s1">&#39;CE_&#39;</span> <span class="o">+</span> <span class="n">col</span><span class="p">]</span>
<span class="n">df_tmp</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">[[</span><span class="n">col</span><span class="p">,</span> <span class="s1">&#39;org_sorting&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">train_tmp</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;org_sorting&#39;</span><span class="p">)</span>
<span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;CE_&#39;</span> <span class="o">+</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_tmp</span><span class="p">[</span><span class="s1">&#39;CE_&#39;</span> <span class="o">+</span> <span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
<span class="n">df_train</span> <span class="o">=</span> <span class="n">df_train</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;org_sorting&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
<span class="n">df_valid</span><span class="p">[</span><span class="s1">&#39;org_sorting&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cupy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_valid</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;int32&quot;</span><span class="p">)</span>
<span class="n">df_tmp</span> <span class="o">=</span> <span class="n">df_valid</span><span class="p">[[</span><span class="n">col</span><span class="p">,</span> <span class="s1">&#39;org_sorting&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">train_tmp</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;org_sorting&#39;</span><span class="p">)</span>
<span class="n">df_valid</span><span class="p">[</span><span class="s1">&#39;CE_&#39;</span> <span class="o">+</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_tmp</span><span class="p">[</span><span class="s1">&#39;CE_&#39;</span> <span class="o">+</span> <span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
<span class="n">df_valid</span> <span class="o">=</span> <span class="n">df_valid</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;org_sorting&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_train</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>event_time</th>
      <th>event_type</th>
      <th>product_id</th>
      <th>category_code</th>
      <th>brand</th>
      <th>price</th>
      <th>user_id</th>
      <th>user_session</th>
      <th>target</th>
      <th>timestamp</th>
      <th>ts_hour</th>
      <th>ts_minute</th>
      <th>ts_weekday</th>
      <th>ts_day</th>
      <th>ts_month</th>
      <th>ts_year</th>
      <th>CE_user_id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2020-01-23 04:32:33 UTC</td>
      <td>cart</td>
      <td>100039953</td>
      <td>appliances.personal.massager</td>
      <td>kivi</td>
      <td>267.44</td>
      <td>512913139</td>
      <td>9bebab16-bce8-43cd-ac97-f763ee4664dd</td>
      <td>0</td>
      <td>2020-01-23 04:32:33</td>
      <td>4</td>
      <td>32</td>
      <td>3</td>
      <td>23</td>
      <td>1</td>
      <td>2020</td>
      <td>3</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2020-01-23 04:32:36 UTC</td>
      <td>cart</td>
      <td>1004767</td>
      <td>construction.tools.light</td>
      <td>samsung</td>
      <td>226.27</td>
      <td>549154456</td>
      <td>659387e4-032e-4e71-8b0b-3b90f0538f14</td>
      <td>0</td>
      <td>2020-01-23 04:32:36</td>
      <td>4</td>
      <td>32</td>
      <td>3</td>
      <td>23</td>
      <td>1</td>
      <td>2020</td>
      <td>5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2020-01-23 04:32:38 UTC</td>
      <td>cart</td>
      <td>1003306</td>
      <td>construction.tools.light</td>
      <td>apple</td>
      <td>614.79</td>
      <td>585624798</td>
      <td>41a24f4f-afb8-4342-ae6f-003aa968f82f</td>
      <td>0</td>
      <td>2020-01-23 04:32:38</td>
      <td>4</td>
      <td>32</td>
      <td>3</td>
      <td>23</td>
      <td>1</td>
      <td>2020</td>
      <td>26</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2020-01-23 04:32:38 UTC</td>
      <td>cart</td>
      <td>4804055</td>
      <td>sport.bicycle</td>
      <td>apple</td>
      <td>192.07</td>
      <td>525860806</td>
      <td>70b5ed9a-4395-481e-9f91-d811ced8a4c3</td>
      <td>0</td>
      <td>2020-01-23 04:32:38</td>
      <td>4</td>
      <td>32</td>
      <td>3</td>
      <td>23</td>
      <td>1</td>
      <td>2020</td>
      <td>21</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2020-01-23 04:32:43 UTC</td>
      <td>cart</td>
      <td>1005100</td>
      <td>construction.tools.light</td>
      <td>samsung</td>
      <td>141.06</td>
      <td>599724791</td>
      <td>bc35693d-9c73-457f-a7ef-8ced2f0bb729</td>
      <td>0</td>
      <td>2020-01-23 04:32:43</td>
      <td>4</td>
      <td>32</td>
      <td>3</td>
      <td>23</td>
      <td>1</td>
      <td>2020</td>
      <td>23</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="binning">
<h3>Binning<a class="headerlink" href="#binning" title="Permalink to this headline">¶</a></h3>
<p><em>Binning</em> maps multiple ordinal categorical or numerical features into groups. It is mainly applied to numerical features:</p>
<ul class="simple">
<li><p>prevent overfitting by grouping values together</p></li>
<li><p>enables us to add some expert knowledge into the model</p></li>
<li><p>most simple case: binary flags, e.g. features is greater than 0</p></li>
</ul>
<p>Examples:</p>
<ul class="simple">
<li><p>binning weekdays into weekday and weekend</p></li>
<li><p>binning hours into morning, early afternoon, late afternoon, evening and night</p></li>
<li><p>binning age into child, adlult and retired</p></li>
</ul>
<p>We can take a look on the hour of the day. We can see multiple patterns:</p>
<ul class="simple">
<li><p>0-3 Night: Low purchase probability</p></li>
<li><p>4-7 Early morning: Mid purchase probability</p></li>
<li><p>8-14 Morning/Lunch: Higher purchase probability</p></li>
<li><p>15-20 Afternoon: Low purchase probability</p></li>
<li><p>21-23: Evening: High purchase probability</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_train</span><span class="p">[[</span><span class="s1">&#39;ts_hour&#39;</span><span class="p">,</span> <span class="s1">&#39;target&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;ts_hour&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">target</th>
    </tr>
    <tr>
      <th></th>
      <th>count</th>
      <th>mean</th>
    </tr>
    <tr>
      <th>ts_hour</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>21</th>
      <td>117724</td>
      <td>0.363027</td>
    </tr>
    <tr>
      <th>1</th>
      <td>99235</td>
      <td>0.251756</td>
    </tr>
    <tr>
      <th>20</th>
      <td>197950</td>
      <td>0.348790</td>
    </tr>
    <tr>
      <th>14</th>
      <td>646275</td>
      <td>0.358253</td>
    </tr>
    <tr>
      <th>22</th>
      <td>73302</td>
      <td>0.377643</td>
    </tr>
    <tr>
      <th>2</th>
      <td>207125</td>
      <td>0.281960</td>
    </tr>
    <tr>
      <th>0</th>
      <td>58535</td>
      <td>0.304860</td>
    </tr>
    <tr>
      <th>19</th>
      <td>321995</td>
      <td>0.341636</td>
    </tr>
    <tr>
      <th>23</th>
      <td>50577</td>
      <td>0.379461</td>
    </tr>
    <tr>
      <th>17</th>
      <td>548159</td>
      <td>0.338296</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hour</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">24</span><span class="p">))</span>
<span class="n">hour_bin</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">4</span> <span class="o">+</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="mi">7</span> <span class="o">+</span> <span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="mi">6</span> <span class="o">+</span> <span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">cudf</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;hour&#39;</span><span class="p">:</span> <span class="n">hour</span><span class="p">,</span>
    <span class="s1">&#39;hour_bin&#39;</span><span class="p">:</span> <span class="n">hour_bin</span><span class="p">,</span>
<span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>hour</th>
      <th>hour_bin</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>1</td>
    </tr>
    <tr>
      <th>5</th>
      <td>5</td>
      <td>1</td>
    </tr>
    <tr>
      <th>6</th>
      <td>6</td>
      <td>1</td>
    </tr>
    <tr>
      <th>7</th>
      <td>7</td>
      <td>1</td>
    </tr>
    <tr>
      <th>8</th>
      <td>8</td>
      <td>2</td>
    </tr>
    <tr>
      <th>9</th>
      <td>9</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_train</span> <span class="o">=</span> <span class="n">df_train</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;hour&#39;</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;ts_hour&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_train</span><span class="p">[[</span><span class="s1">&#39;hour_bin&#39;</span><span class="p">,</span> <span class="s1">&#39;target&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;hour_bin&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">target</th>
    </tr>
    <tr>
      <th></th>
      <th>count</th>
      <th>mean</th>
    </tr>
    <tr>
      <th>hour_bin</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>2714395</td>
      <td>0.375762</td>
    </tr>
    <tr>
      <th>2</th>
      <td>4996207</td>
      <td>0.383043</td>
    </tr>
    <tr>
      <th>0</th>
      <td>752027</td>
      <td>0.308982</td>
    </tr>
    <tr>
      <th>4</th>
      <td>241603</td>
      <td>0.370902</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2791013</td>
      <td>0.334824</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Binning the numerical features reduces the cardinality (# of unique values). Therefore, a model can easier learn the relationship to the target variables, as there are more observation per category. In addition, binning prevents overfitting.</p>
<p>Another reason to apply binning is to standardize numeric variables per category group. The datasets provides information about the product category (cat_1) and price information.</p>
<p>For example, the headphones and smartphones have a different price distribution.</p>
<ul class="simple">
<li><p>We can probably buy good headphones between 100−200</p></li>
<li><p>For a good smartphone, prices are probably in the range of 400−1200</p></li>
</ul>
<p>Therefore, the buying behavior should be different depending on the price per category (what is a good deal).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df_train</span><span class="p">[</span><span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;cat_2&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;headphone&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">price</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/T513987_Recsys_2020_Feature_Engineering_Tutorial_176_0.png" src="../_images/T513987_Recsys_2020_Feature_Engineering_Tutorial_176_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df_train</span><span class="p">[</span><span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;cat_1&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;smartphone&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">price</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/T513987_Recsys_2020_Feature_Engineering_Tutorial_177_0.png" src="../_images/T513987_Recsys_2020_Feature_Engineering_Tutorial_177_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Headphones mean price: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">df_train</span><span class="p">[</span><span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;cat_2&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;headphone&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">price</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="o">+</span> <span class="s1">&#39; median price: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">df_train</span><span class="p">[</span><span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;cat_2&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;headphone&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">price</span><span class="o">.</span><span class="n">median</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Smartphones mean price: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">df_train</span><span class="p">[</span><span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;cat_1&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;smartphone&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">price</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="o">+</span> <span class="s1">&#39; median price: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">df_train</span><span class="p">[</span><span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;cat_1&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;smartphone&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">price</span><span class="o">.</span><span class="n">median</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Headphones mean price: 317.2112100416274 median price: 189.84
Smartphones mean price: 456.26767214233337 median price: 263.84
</pre></div>
</div>
</div>
</div>
<p>Based on the category tree, we want to bin the prices as a combination of cat_0, cat_1 and cat_2.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;cat_012&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;cat_0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;cat_1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;cat_2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="n">q_list</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>We calculate the quantiles per category group and then merge the quantile to the original dataframe.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">q_value</span> <span class="ow">in</span> <span class="n">q_list</span><span class="p">:</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">[[</span><span class="s1">&#39;cat_012&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;cat_012&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">q_value</span><span class="p">)</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="n">q</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cat_012&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">q_value</span><span class="p">)]</span>
    <span class="n">df_train</span> <span class="o">=</span> <span class="n">df_train</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;cat_012&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Afterwards, we loop through the columns and update the price_bin depending, if the price is between quantiles.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;price_bin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">q_value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">q_list</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">df_train</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;price&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">q_value</span><span class="p">)],</span> <span class="s1">&#39;price_bin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">df_train</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;price&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">q_list</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span><span class="o">&lt;=</span><span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;price&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">q_value</span><span class="p">)]),</span> <span class="s1">&#39;price_bin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
        
<span class="n">df_train</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;price&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">q_value</span><span class="p">)],</span> <span class="s1">&#39;price_bin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_train</span><span class="p">[</span><span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;price_bin&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">3</span><span class="p">][[</span><span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="s1">&#39;price0.1&#39;</span><span class="p">,</span> <span class="s1">&#39;price0.25&#39;</span><span class="p">,</span> <span class="s1">&#39;price0.5&#39;</span><span class="p">,</span> <span class="s1">&#39;price0.75&#39;</span><span class="p">,</span> <span class="s1">&#39;price0.9&#39;</span><span class="p">,</span> <span class="s1">&#39;price_bin&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>price</th>
      <th>price0.1</th>
      <th>price0.25</th>
      <th>price0.5</th>
      <th>price0.75</th>
      <th>price0.9</th>
      <th>price_bin</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>309305</th>
      <td>7.70</td>
      <td>4.12</td>
      <td>5.56</td>
      <td>7.68</td>
      <td>11.58</td>
      <td>16.99</td>
      <td>3</td>
    </tr>
    <tr>
      <th>1105820</th>
      <td>7.72</td>
      <td>3.06</td>
      <td>6.15</td>
      <td>7.70</td>
      <td>12.87</td>
      <td>25.71</td>
      <td>3</td>
    </tr>
    <tr>
      <th>143278</th>
      <td>7.72</td>
      <td>3.73</td>
      <td>4.63</td>
      <td>7.71</td>
      <td>15.37</td>
      <td>24.66</td>
      <td>3</td>
    </tr>
    <tr>
      <th>29097</th>
      <td>7.72</td>
      <td>4.12</td>
      <td>5.56</td>
      <td>7.68</td>
      <td>11.58</td>
      <td>16.99</td>
      <td>3</td>
    </tr>
    <tr>
      <th>9451362</th>
      <td>7.74</td>
      <td>3.73</td>
      <td>4.63</td>
      <td>7.71</td>
      <td>15.37</td>
      <td>24.66</td>
      <td>3</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>107240</th>
      <td>766.73</td>
      <td>254.81</td>
      <td>308.63</td>
      <td>514.56</td>
      <td>767.81</td>
      <td>1283.73</td>
      <td>3</td>
    </tr>
    <tr>
      <th>775100</th>
      <td>766.82</td>
      <td>254.81</td>
      <td>308.63</td>
      <td>514.56</td>
      <td>767.81</td>
      <td>1283.73</td>
      <td>3</td>
    </tr>
    <tr>
      <th>1729643</th>
      <td>767.05</td>
      <td>254.81</td>
      <td>308.63</td>
      <td>514.56</td>
      <td>767.81</td>
      <td>1283.73</td>
      <td>3</td>
    </tr>
    <tr>
      <th>716072</th>
      <td>767.79</td>
      <td>254.81</td>
      <td>308.63</td>
      <td>514.56</td>
      <td>767.81</td>
      <td>1283.73</td>
      <td>3</td>
    </tr>
    <tr>
      <th>369944</th>
      <td>767.81</td>
      <td>254.81</td>
      <td>308.63</td>
      <td>514.56</td>
      <td>767.81</td>
      <td>1283.73</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
<p>52053 rows × 7 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_train</span> <span class="o">=</span> <span class="n">df_train</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;price&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">q_list</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can see the pattern, that products in a lower quantile 0-10% and 10-25% have lower purchase probabilities.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_train</span><span class="p">[[</span><span class="s1">&#39;price_bin&#39;</span><span class="p">,</span> <span class="s1">&#39;target&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;price_bin&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">target</th>
    </tr>
    <tr>
      <th></th>
      <th>count</th>
      <th>mean</th>
    </tr>
    <tr>
      <th>price_bin</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>1729591</td>
      <td>0.357154</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2849441</td>
      <td>0.366890</td>
    </tr>
    <tr>
      <th>0</th>
      <td>1193665</td>
      <td>0.335035</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1139560</td>
      <td>0.365359</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1696056</td>
      <td>0.373025</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2886932</td>
      <td>0.373441</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Now, let’s take a look on ts_weekday.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_train</span><span class="p">[[</span><span class="s1">&#39;ts_weekday&#39;</span><span class="p">,</span> <span class="s1">&#39;target&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;ts_weekday&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">target</th>
    </tr>
    <tr>
      <th></th>
      <th>count</th>
      <th>mean</th>
    </tr>
    <tr>
      <th>ts_weekday</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>1428105</td>
      <td>0.401288</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1419514</td>
      <td>0.404012</td>
    </tr>
    <tr>
      <th>0</th>
      <td>1509801</td>
      <td>0.411447</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1839756</td>
      <td>0.329605</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2015682</td>
      <td>0.280888</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1788988</td>
      <td>0.406825</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1493399</td>
      <td>0.349564</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">weekday</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
<span class="n">weekday_bin</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">cudf</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;weekday&#39;</span><span class="p">:</span> <span class="n">weekday</span><span class="p">,</span>
    <span class="s1">&#39;weekday_bin&#39;</span><span class="p">:</span> <span class="n">weekday_bin</span><span class="p">,</span>
<span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_train</span> <span class="o">=</span> <span class="n">df_train</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;weekday&#39;</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;ts_weekday&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_train</span><span class="p">[[</span><span class="s1">&#39;weekday_bin&#39;</span><span class="p">,</span> <span class="s1">&#39;target&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;weekday_bin&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">target</th>
    </tr>
    <tr>
      <th></th>
      <th>count</th>
      <th>mean</th>
    </tr>
    <tr>
      <th>weekday_bin</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>2847619</td>
      <td>0.402646</td>
    </tr>
    <tr>
      <th>2</th>
      <td>5348837</td>
      <td>0.316819</td>
    </tr>
    <tr>
      <th>0</th>
      <td>3298789</td>
      <td>0.408940</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>It is maybe counterintuitive:</p>
<ul class="simple">
<li><p>the highest days are Sunday and Monday - a hypothesis could be that people shop on Sunday evening and the first day of the week</p></li>
<li><p>the lowest days are Thur-Sat - a hypothesis could be that Thu/Fri is end of
week and people are finishing up their work and have no time to do online shopping</p></li>
<li><p>Saturday is maybe a day go outside</p></li>
</ul>
</div>
<div class="section" id="normalization">
<h3>Normalization<a class="headerlink" href="#normalization" title="Permalink to this headline">¶</a></h3>
<p><em>Normalization</em> is required to enable neural networks to leverage numerical features. Tree-based models do not require normalization as they define the split independent of the scale of a feature. Without normalization, neural networks are difficult to train. The image visualizes the loss surface and the gradient updates for non-normalized input (left) and normalized input (right).</p>
<p>We will first generate some numerical features with the feature engineering that we also covered in previous steps.</p>
<p>The reason is that different numerical features have different scales. When we combine the features in a hidden layer, the different scales make it more difficult to extract patterns from it.</p>
<p>Normalization Techniques
After we outline the importance for normalizing the numerical input feature, we will discuss different strategy to achieve a normal distributed input feature:</p>
<ul class="simple">
<li><p>Normalization with mean/std</p></li>
<li><p>Log-based normalization</p></li>
<li><p>Scale to 0-1</p></li>
<li><p>Gauss Rank (separate notebook)</p></li>
<li><p>Power transfomer</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">target_encode</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">valid</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">kfold</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">smooth</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">gpu</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        train:  train dataset</span>
<span class="sd">        valid:  validation dataset</span>
<span class="sd">        col:   column which will be encoded (in the example RESOURCE)</span>
<span class="sd">        target: target column which will be used to calculate the statistic</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># We assume that the train dataset is shuffled</span>
    <span class="n">train</span><span class="p">[</span><span class="s1">&#39;kfold&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">train</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">%</span> <span class="n">kfold</span><span class="p">)</span>
    <span class="c1"># We keep the original order as cudf merge will not preserve the original order</span>
    <span class="k">if</span> <span class="n">gpu</span><span class="p">:</span>
        <span class="n">train</span><span class="p">[</span><span class="s1">&#39;org_sorting&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cupy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">train</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;int32&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">train</span><span class="p">[</span><span class="s1">&#39;org_sorting&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">train</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;int32&quot;</span><span class="p">)</span>
    <span class="c1"># We create the output column, we fill with 0</span>
    <span class="n">col_name</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
    <span class="n">train</span><span class="p">[</span><span class="s1">&#39;TE_&#39;</span> <span class="o">+</span> <span class="n">col_name</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">kfold</span><span class="p">):</span>
        <span class="c1">###################################</span>
        <span class="c1"># filter for out of fold</span>
        <span class="c1"># calculate the mean/counts per group category</span>
        <span class="c1"># calculate the global mean for the oof</span>
        <span class="c1"># calculate the smoothed TE</span>
        <span class="c1"># merge it to the original dataframe</span>
        <span class="c1">###################################</span>
        
        <span class="n">df_tmp</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="n">train</span><span class="p">[</span><span class="s1">&#39;kfold&#39;</span><span class="p">]</span><span class="o">!=</span><span class="n">i</span><span class="p">]</span>
        <span class="n">mn</span> <span class="o">=</span> <span class="n">df_tmp</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">df_tmp</span> <span class="o">=</span> <span class="n">df_tmp</span><span class="p">[</span><span class="n">col</span> <span class="o">+</span> <span class="p">[</span><span class="n">target</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="n">df_tmp</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">col</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">]</span>
        <span class="n">df_tmp</span><span class="p">[</span><span class="s1">&#39;TE_tmp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">df_tmp</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">df_tmp</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">])</span><span class="o">+</span><span class="p">(</span><span class="n">mn</span><span class="o">*</span><span class="n">smooth</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">df_tmp</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">smooth</span><span class="p">)</span>
        <span class="n">df_tmp_m</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="n">col</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;kfold&#39;</span><span class="p">,</span> <span class="s1">&#39;org_sorting&#39;</span><span class="p">,</span> <span class="s1">&#39;TE_&#39;</span> <span class="o">+</span> <span class="n">col_name</span><span class="p">]]</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_tmp</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;org_sorting&#39;</span><span class="p">)</span>
        <span class="n">df_tmp_m</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_tmp_m</span><span class="p">[</span><span class="s1">&#39;kfold&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;TE_&#39;</span> <span class="o">+</span> <span class="n">col_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_tmp_m</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_tmp_m</span><span class="p">[</span><span class="s1">&#39;kfold&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;TE_tmp&#39;</span><span class="p">]</span>
        <span class="n">train</span><span class="p">[</span><span class="s1">&#39;TE_&#39;</span> <span class="o">+</span> <span class="n">col_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_tmp_m</span><span class="p">[</span><span class="s1">&#39;TE_&#39;</span> <span class="o">+</span> <span class="n">col_name</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">mn</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>

    
    <span class="c1">###################################</span>
    <span class="c1"># calculate the mean/counts per group for the full training dataset</span>
    <span class="c1"># calculate the global mean</span>
    <span class="c1"># calculate the smoothed TE</span>
    <span class="c1"># merge it to the original dataframe</span>
    <span class="c1"># drop all temp columns</span>
    <span class="c1">###################################    </span>
    
    <span class="n">df_tmp</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="n">col</span> <span class="o">+</span> <span class="p">[</span><span class="n">target</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="n">mn</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">df_tmp</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">col</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">]</span>
    <span class="n">df_tmp</span><span class="p">[</span><span class="s1">&#39;TE_tmp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">df_tmp</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">df_tmp</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">])</span><span class="o">+</span><span class="p">(</span><span class="n">mn</span><span class="o">*</span><span class="n">smooth</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">df_tmp</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">smooth</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gpu</span><span class="p">:</span>
        <span class="n">valid</span><span class="p">[</span><span class="s1">&#39;org_sorting&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cupy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">valid</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;int32&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">valid</span><span class="p">[</span><span class="s1">&#39;org_sorting&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">valid</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;int32&quot;</span><span class="p">)</span>
    <span class="n">df_tmp_m</span> <span class="o">=</span> <span class="n">valid</span><span class="p">[</span><span class="n">col</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;org_sorting&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_tmp</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;org_sorting&#39;</span><span class="p">)</span>
    <span class="n">valid</span><span class="p">[</span><span class="s1">&#39;TE_&#39;</span> <span class="o">+</span> <span class="n">col_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_tmp_m</span><span class="p">[</span><span class="s1">&#39;TE_tmp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">mn</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
    
    <span class="n">valid</span> <span class="o">=</span> <span class="n">valid</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;org_sorting&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;kfold&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;org_sorting&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">valid</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cats</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;cat_0&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;cat_1&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;cat_2&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;cat_0&#39;</span><span class="p">,</span> <span class="s1">&#39;cat_1&#39;</span><span class="p">,</span> <span class="s1">&#39;cat_2&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;ts_hour&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;ts_weekday&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;ts_weekday&#39;</span><span class="p">,</span> <span class="s1">&#39;ts_hour&#39;</span><span class="p">,</span> <span class="s1">&#39;cat_2&#39;</span><span class="p">,</span> <span class="s1">&#39;brand&#39;</span><span class="p">]]</span>

<span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">cats</span><span class="p">:</span>
    <span class="n">df_train</span><span class="p">,</span> <span class="n">df_valid</span> <span class="o">=</span> <span class="n">target_encode</span><span class="p">(</span><span class="n">df_train</span><span class="p">,</span> <span class="n">df_valid</span><span class="p">,</span> <span class="n">cat</span><span class="p">,</span> <span class="s1">&#39;target&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">count_encode</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">valid</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">gpu</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        train:  train dataset</span>
<span class="sd">        valid:  validation dataset</span>
<span class="sd">        col:    column which will be count encoded (in the example RESOURCE)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># We keep the original order as cudf merge will not preserve the original order</span>
    <span class="k">if</span> <span class="n">gpu</span><span class="p">:</span>
        <span class="n">train</span><span class="p">[</span><span class="s1">&#39;org_sorting&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cupy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">train</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;int32&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">train</span><span class="p">[</span><span class="s1">&#39;org_sorting&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">train</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;int32&quot;</span><span class="p">)</span>
    
    <span class="n">train_tmp</span> <span class="o">=</span> <span class="n">train</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="n">train_tmp</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span><span class="p">,</span>  <span class="s1">&#39;CE_&#39;</span> <span class="o">+</span> <span class="n">col</span><span class="p">]</span>
    <span class="n">df_tmp</span> <span class="o">=</span> <span class="n">train</span><span class="p">[[</span><span class="n">col</span><span class="p">,</span> <span class="s1">&#39;org_sorting&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">train_tmp</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;org_sorting&#39;</span><span class="p">)</span>
    <span class="n">train</span><span class="p">[</span><span class="s1">&#39;CE_&#39;</span> <span class="o">+</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_tmp</span><span class="p">[</span><span class="s1">&#39;CE_&#39;</span> <span class="o">+</span> <span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
        
    <span class="k">if</span> <span class="n">gpu</span><span class="p">:</span>
        <span class="n">valid</span><span class="p">[</span><span class="s1">&#39;org_sorting&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cupy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">valid</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;int32&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">valid</span><span class="p">[</span><span class="s1">&#39;org_sorting&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">valid</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;int32&quot;</span><span class="p">)</span>
    <span class="n">df_tmp</span> <span class="o">=</span> <span class="n">valid</span><span class="p">[[</span><span class="n">col</span><span class="p">,</span> <span class="s1">&#39;org_sorting&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">train_tmp</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="n">col</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;org_sorting&#39;</span><span class="p">)</span>
    <span class="n">valid</span><span class="p">[</span><span class="s1">&#39;CE_&#39;</span> <span class="o">+</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_tmp</span><span class="p">[</span><span class="s1">&#39;CE_&#39;</span> <span class="o">+</span> <span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
    
    <span class="n">valid</span> <span class="o">=</span> <span class="n">valid</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;org_sorting&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">train</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;org_sorting&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">valid</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cats</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;brand&#39;</span><span class="p">,</span> <span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;product_id&#39;</span><span class="p">,</span> <span class="s1">&#39;cat_0&#39;</span><span class="p">,</span> <span class="s1">&#39;cat_1&#39;</span><span class="p">,</span> <span class="s1">&#39;cat_2&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">cats</span><span class="p">:</span>
    <span class="n">df_train</span><span class="p">,</span> <span class="n">df_valid</span> <span class="o">=</span> <span class="n">count_encode</span><span class="p">(</span><span class="n">df_train</span><span class="p">,</span> <span class="n">df_valid</span><span class="p">,</span> <span class="n">cat</span><span class="p">,</span> <span class="n">gpu</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_train</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>event_time</th>
      <th>event_type</th>
      <th>product_id</th>
      <th>brand</th>
      <th>price</th>
      <th>user_id</th>
      <th>user_session</th>
      <th>target</th>
      <th>timestamp</th>
      <th>ts_hour</th>
      <th>ts_minute</th>
      <th>ts_weekday</th>
      <th>ts_day</th>
      <th>ts_month</th>
      <th>ts_year</th>
      <th>cat_0</th>
      <th>cat_1</th>
      <th>cat_2</th>
      <th>cat_3</th>
      <th>hour</th>
      <th>hour_bin</th>
      <th>cat_012</th>
      <th>price_bin</th>
      <th>weekday</th>
      <th>weekday_bin</th>
      <th>TE_cat_0</th>
      <th>TE_cat_1</th>
      <th>TE_cat_2</th>
      <th>TE_cat_0_cat_1_cat_2</th>
      <th>TE_ts_hour</th>
      <th>TE_ts_weekday</th>
      <th>TE_ts_weekday_ts_hour_cat_2_brand</th>
      <th>CE_brand</th>
      <th>CE_user_id</th>
      <th>CE_product_id</th>
      <th>CE_cat_0</th>
      <th>CE_cat_1</th>
      <th>CE_cat_2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2020-01-23 08:22:39 UTC</td>
      <td>cart</td>
      <td>13201032</td>
      <td>brw</td>
      <td>207.47</td>
      <td>513115689</td>
      <td>520e7567-c1f3-4322-993e-aa4df1ff42ac</td>
      <td>0</td>
      <td>2020-01-23 08:22:39</td>
      <td>8</td>
      <td>22</td>
      <td>3</td>
      <td>23</td>
      <td>1</td>
      <td>2020</td>
      <td>furniture</td>
      <td>bedroom</td>
      <td>bed</td>
      <td>NA</td>
      <td>8</td>
      <td>2</td>
      <td>furniture_bedroom_bed</td>
      <td>4</td>
      <td>3</td>
      <td>2</td>
      <td>0.312571</td>
      <td>0.359570</td>
      <td>0.324688</td>
      <td>0.324688</td>
      <td>0.390130</td>
      <td>0.349599</td>
      <td>0.273233</td>
      <td>11364</td>
      <td>7</td>
      <td>50</td>
      <td>336494</td>
      <td>125236</td>
      <td>50304</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2020-01-23 08:22:41 UTC</td>
      <td>cart</td>
      <td>1307058</td>
      <td>apple</td>
      <td>1281.89</td>
      <td>573953156</td>
      <td>11b2fb95-fcaa-41c2-904c-7c456cc9e9f3</td>
      <td>0</td>
      <td>2020-01-23 08:22:41</td>
      <td>8</td>
      <td>22</td>
      <td>3</td>
      <td>23</td>
      <td>1</td>
      <td>2020</td>
      <td>electronics</td>
      <td>audio</td>
      <td>headphone</td>
      <td>NA</td>
      <td>8</td>
      <td>2</td>
      <td>electronics_audio_headphone</td>
      <td>5</td>
      <td>3</td>
      <td>2</td>
      <td>0.360921</td>
      <td>0.361619</td>
      <td>0.365271</td>
      <td>0.365271</td>
      <td>0.390216</td>
      <td>0.349541</td>
      <td>0.421725</td>
      <td>2040287</td>
      <td>8</td>
      <td>969</td>
      <td>2577712</td>
      <td>387516</td>
      <td>305568</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2020-01-23 08:22:42 UTC</td>
      <td>cart</td>
      <td>1005177</td>
      <td>samsung</td>
      <td>849.16</td>
      <td>515852078</td>
      <td>05622990-d291-4ce3-8e2f-4be65c96707e</td>
      <td>0</td>
      <td>2020-01-23 08:22:42</td>
      <td>8</td>
      <td>22</td>
      <td>3</td>
      <td>23</td>
      <td>1</td>
      <td>2020</td>
      <td>construction</td>
      <td>tools</td>
      <td>light</td>
      <td>NA</td>
      <td>8</td>
      <td>2</td>
      <td>construction_tools_light</td>
      <td>4</td>
      <td>3</td>
      <td>2</td>
      <td>0.450553</td>
      <td>0.450018</td>
      <td>0.456834</td>
      <td>0.457670</td>
      <td>0.390174</td>
      <td>0.349531</td>
      <td>0.490076</td>
      <td>2329847</td>
      <td>48</td>
      <td>18073</td>
      <td>3375478</td>
      <td>3319883</td>
      <td>3184510</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2020-01-23 08:22:43 UTC</td>
      <td>cart</td>
      <td>5701000</td>
      <td>pioneer</td>
      <td>61.78</td>
      <td>545280126</td>
      <td>1f03212a-2582-4d59-844e-05b27e82f54b</td>
      <td>0</td>
      <td>2020-01-23 08:22:43</td>
      <td>8</td>
      <td>22</td>
      <td>3</td>
      <td>23</td>
      <td>1</td>
      <td>2020</td>
      <td>electronics</td>
      <td>video</td>
      <td>tv</td>
      <td>NA</td>
      <td>8</td>
      <td>2</td>
      <td>electronics_video_tv</td>
      <td>0</td>
      <td>3</td>
      <td>2</td>
      <td>0.361095</td>
      <td>0.315736</td>
      <td>0.313373</td>
      <td>0.313373</td>
      <td>0.390190</td>
      <td>0.349571</td>
      <td>0.409333</td>
      <td>19737</td>
      <td>8</td>
      <td>152</td>
      <td>2577712</td>
      <td>176316</td>
      <td>164102</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2020-01-23 08:22:44 UTC</td>
      <td>cart</td>
      <td>1005023</td>
      <td>xiaomi</td>
      <td>322.95</td>
      <td>581301439</td>
      <td>94ead800-d5dc-43fc-b690-508afd45936f</td>
      <td>0</td>
      <td>2020-01-23 08:22:44</td>
      <td>8</td>
      <td>22</td>
      <td>3</td>
      <td>23</td>
      <td>1</td>
      <td>2020</td>
      <td>construction</td>
      <td>tools</td>
      <td>light</td>
      <td>NA</td>
      <td>8</td>
      <td>2</td>
      <td>construction_tools_light</td>
      <td>3</td>
      <td>3</td>
      <td>2</td>
      <td>0.450266</td>
      <td>0.449712</td>
      <td>0.456533</td>
      <td>0.457381</td>
      <td>0.390178</td>
      <td>0.349578</td>
      <td>0.369724</td>
      <td>1085216</td>
      <td>6</td>
      <td>2688</td>
      <td>3375478</td>
      <td>3319883</td>
      <td>3184510</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_train</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;event_time&#39;, &#39;event_type&#39;, &#39;product_id&#39;, &#39;brand&#39;, &#39;price&#39;, &#39;user_id&#39;,
       &#39;user_session&#39;, &#39;target&#39;, &#39;timestamp&#39;, &#39;ts_hour&#39;, &#39;ts_minute&#39;,
       &#39;ts_weekday&#39;, &#39;ts_day&#39;, &#39;ts_month&#39;, &#39;ts_year&#39;, &#39;cat_0&#39;, &#39;cat_1&#39;,
       &#39;cat_2&#39;, &#39;cat_3&#39;, &#39;hour&#39;, &#39;hour_bin&#39;, &#39;cat_012&#39;, &#39;price_bin&#39;, &#39;weekday&#39;,
       &#39;weekday_bin&#39;, &#39;TE_cat_0&#39;, &#39;TE_cat_1&#39;, &#39;TE_cat_2&#39;,
       &#39;TE_cat_0_cat_1_cat_2&#39;, &#39;TE_ts_hour&#39;, &#39;TE_ts_weekday&#39;,
       &#39;TE_ts_weekday_ts_hour_cat_2_brand&#39;, &#39;CE_brand&#39;, &#39;CE_user_id&#39;,
       &#39;CE_product_id&#39;, &#39;CE_cat_0&#39;, &#39;CE_cat_1&#39;, &#39;CE_cat_2&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<p>Let’s normalize the features: price, TE_ts_weekday_ts_hour_cat_2_brand, CE_cat_2</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">=</span> <span class="s1">&#39;price&#39;</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">[</span><span class="n">cat</span><span class="p">]</span>
<span class="n">X_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">X</span><span class="o">-</span><span class="n">X</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">/</span><span class="n">X</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

<span class="n">X_log</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">X_log_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">X_log</span><span class="o">-</span><span class="n">X_log</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">/</span><span class="n">X_log</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

<span class="n">X_minmax</span> <span class="o">=</span> <span class="p">((</span><span class="n">X</span><span class="o">-</span><span class="n">X</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">/</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">-</span><span class="n">X</span><span class="o">.</span><span class="n">min</span><span class="p">()))</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Histogram non-normalised&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">X_norm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Histogram normalised&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">X_log_norm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Histogram log-normalised&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">X_minmax</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Histogram minmax&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Histogram minmax&#39;)
</pre></div>
</div>
<img alt="../_images/T513987_Recsys_2020_Feature_Engineering_Tutorial_204_1.png" src="../_images/T513987_Recsys_2020_Feature_Engineering_Tutorial_204_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">=</span> <span class="s1">&#39;TE_ts_weekday_ts_hour_cat_2_brand&#39;</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">[</span><span class="n">cat</span><span class="p">]</span>
<span class="n">X_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">X</span><span class="o">-</span><span class="n">X</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">/</span><span class="n">X</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

<span class="n">X_log</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">X_log_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">X_log</span><span class="o">-</span><span class="n">X_log</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">/</span><span class="n">X_log</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

<span class="n">X_minmax</span> <span class="o">=</span> <span class="p">((</span><span class="n">X</span><span class="o">-</span><span class="n">X</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">/</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">-</span><span class="n">X</span><span class="o">.</span><span class="n">min</span><span class="p">()))</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Histogram non-normalised&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">X_norm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Histogram normalised&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">X_log_norm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Histogram log-normalised&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">X_minmax</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Histogram minmax&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Histogram minmax&#39;)
</pre></div>
</div>
<img alt="../_images/T513987_Recsys_2020_Feature_Engineering_Tutorial_205_1.png" src="../_images/T513987_Recsys_2020_Feature_Engineering_Tutorial_205_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cat</span> <span class="o">=</span> <span class="s1">&#39;CE_cat_2&#39;</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">[</span><span class="n">cat</span><span class="p">]</span>
<span class="n">X_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">X</span><span class="o">-</span><span class="n">X</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">/</span><span class="n">X</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

<span class="n">X_log</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">X_log_norm</span> <span class="o">=</span> <span class="p">(</span><span class="n">X_log</span><span class="o">-</span><span class="n">X_log</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">/</span><span class="n">X_log</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

<span class="n">X_minmax</span> <span class="o">=</span> <span class="p">((</span><span class="n">X</span><span class="o">-</span><span class="n">X</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">/</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">-</span><span class="n">X</span><span class="o">.</span><span class="n">min</span><span class="p">()))</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Histogram non-normalised&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">X_norm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Histogram normalised&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">X_log_norm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Histogram log-normalised&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">X_minmax</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Histogram minmax&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Histogram minmax&#39;)
</pre></div>
</div>
<img alt="../_images/T513987_Recsys_2020_Feature_Engineering_Tutorial_206_1.png" src="../_images/T513987_Recsys_2020_Feature_Engineering_Tutorial_206_1.png" />
</div>
</div>
</div>
<div class="section" id="gauss-rank">
<h3>Gauss rank<a class="headerlink" href="#gauss-rank" title="Permalink to this headline">¶</a></h3>
<p>Gauss Rank* transforms any arbitrary distribution to a Gaussian normal distribution by</p>
<ol class="simple">
<li><p>Compute the rank (or sort the values ascending)</p></li>
<li><p>Scale the values linearly from -1 to +1</p></li>
<li><p>Apply the erfinv function</p></li>
</ol>
<p>![image.png](data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABXgAAAERCAYAAADBv8+2AAAgAElEQVR4AezdB3gc1aE2YFFDKAEM2HRSLvnJTUiDBEhybwq5KZCbQm56uTcVkxASijGEEAKhBDBuKu7d2Jat3iy5y11lV71avfe+vXz/c6btrLRrS7J2tbv6/DyLdlezM+e858yI+ebsmSjwHwUoQAEKUIACFKAABShAAQpQgAIUoAAFKEABCoSlQFRYlpqFpgAFKEABClCAAhSgAAUoQAEKUIACFKAABShAATDgZSegAAUoQAEKUIACFKAABShAAQpQgAIUoAAFKBCmAgx4w7ThWGwKUIACFKAABShAAQpQgAIUoAAFKEABClCAAgx42QcoQAEKUIACFKAABShAAQpQgAIUoAAFKEABCoSpAAPeMG04FpsCFKAABShAAQpQgAIUoAAFKEABClCAAhSgAANe9gEKUIACFKAABShAAQpQgAIUoAAFKEABClCAAmEqwIA3TBuOxaYABShAAQpQgAIUoAAFKEABClCAAhSgAAUowICXfYACFKAABShAAQpQgAIUoAAFKEABClCAAhSgQJgKMOAN04ZjsSlAAQpQgAIUoAAFKEABClCAAhSgAAUoQAEKMOBlH6AABShAAQpQgAIUoAAFKEABClCAAhSgAAUoEKYCDHjDtOFYbApQgAIUoAAFKEABClCAAhSgAAUoQAEKUIACDHjZByhAAQpQgAIUoAAFKEABClCAAhSgAAUoQAEKhKkAA94wbTgWmwIUoAAFKEABClCAAhSgAAUoQAEKUIACFKAAA172AQpQgAIUoAAFKEABClCAAhSgAAUoQAEKUIACYSrAgDdMG47FpgAFKEABClCAAhSgAAUoQAEKUIACFKAABSjAgJd9gAIUoAAFKEABClCAAhSgAAUoQAEKUIACFKBAmAow4A3ThmOxKUABClCAAhSgAAUoQAEKUIACFKAABShAAQow4GUfoAAFKEABClCAAhSgAAUoQAEKUIACFKAABSgQpgIMeMO04VhsClCAAhSgAAUoQAEKUIACFKAABShAAQpQgAIMeNkHKEABClCAAhSgAAUoQAEKUIACFKAABShAAQqEqQAD3jBtOBabAhSgAAUoQAEKUIACFKAABShAAQpQgAIUoAADXvYBClCAAhSgAAUoQAEKUIACFKAABShAAQpQgAJhKsCA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)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cupy</span> <span class="k">as</span> <span class="nn">cp</span>
<span class="kn">from</span> <span class="nn">cupyx.scipy.special</span> <span class="kn">import</span> <span class="n">erfinv</span>
<span class="kn">import</span> <span class="nn">cudf</span> <span class="k">as</span> <span class="nn">gd</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">scipy.special</span> <span class="kn">import</span> <span class="n">erfinv</span> <span class="k">as</span> <span class="n">sp_erfinv</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">gaussrank_cpu</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">epsilon</span> <span class="o">=</span> <span class="mf">1e-6</span><span class="p">):</span>
    <span class="n">r_cpu</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>
    <span class="n">r_cpu</span> <span class="o">=</span> <span class="p">(</span><span class="n">r_cpu</span><span class="o">/</span><span class="n">r_cpu</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span> <span class="c1"># scale to (-1,1)</span>
    <span class="n">r_cpu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">r_cpu</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="n">epsilon</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="n">epsilon</span><span class="p">)</span>
    <span class="n">r_cpu</span> <span class="o">=</span> <span class="n">sp_erfinv</span><span class="p">(</span><span class="n">r_cpu</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">r_cpu</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">gaussrank_gpu</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">epsilon</span> <span class="o">=</span> <span class="mf">1e-6</span><span class="p">):</span>
    <span class="n">r_gpu</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>
    <span class="n">r_gpu</span> <span class="o">=</span> <span class="p">(</span><span class="n">r_gpu</span><span class="o">/</span><span class="n">r_gpu</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span> <span class="c1"># scale to (-1,1)</span>
    <span class="n">r_gpu</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">r_gpu</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="n">epsilon</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="n">epsilon</span><span class="p">)</span>
    <span class="n">r_gpu</span> <span class="o">=</span> <span class="n">erfinv</span><span class="p">(</span><span class="n">r_gpu</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">r_gpu</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">col</span> <span class="o">=</span> <span class="s1">&#39;CE_product_id&#39;</span>
<span class="n">data_sample</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data_sample</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">cp</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(</span><span class="n">gaussrank_gpu</span><span class="p">(</span><span class="n">df_train</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Histogram non-normalized&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Histogram Gauss Rank&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Histogram Gauss Rank&#39;)
</pre></div>
</div>
<img alt="../_images/T513987_Recsys_2020_Feature_Engineering_Tutorial_212_1.png" src="../_images/T513987_Recsys_2020_Feature_Engineering_Tutorial_212_1.png" />
</div>
</div>
<p>Let’s normalize the features price, TE_ts_weekday_ts_hour_cat_2_brand and CE_cat_2 with GaussRank, and plot the non-normalized and normalized values</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="s1">&#39;TE_ts_weekday_ts_hour_cat_2_brand&#39;</span><span class="p">,</span> <span class="s1">&#39;CE_cat_2&#39;</span><span class="p">]):</span>
    <span class="n">data_sample</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">data_sample</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">cp</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(</span><span class="n">gaussrank_gpu</span><span class="p">(</span><span class="n">data_sample</span><span class="o">.</span><span class="n">values</span><span class="p">)),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Histogram non-normalized&#39;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Histogram Gauss Rank&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/T513987_Recsys_2020_Feature_Engineering_Tutorial_214_0.png" src="../_images/T513987_Recsys_2020_Feature_Engineering_Tutorial_214_0.png" />
</div>
</div>
</div>
<div class="section" id="timeseries-historical-events">
<h3>Timeseries historical events<a class="headerlink" href="#timeseries-historical-events" title="Permalink to this headline">¶</a></h3>
<p>Many real-world recommendation systems contain time information. The system normally logs events with a timestamp. Tree-based or deep learning based models usually only uses the information from the datapoint itself for the prediction and they have difficulties to capture relationships over multiple datapoints.</p>
<p>Let’s take a look at a simple example. Let’s assume we have the interaction events of an itemid, userid and action with the timestamp.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">itemid</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1000001</span><span class="p">]</span><span class="o">*</span><span class="mi">10</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1000002</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1000001</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1000002</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1000001</span><span class="p">]</span><span class="o">*</span><span class="mi">1</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1000002</span><span class="p">]</span><span class="o">*</span><span class="mi">1</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1000001</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1000002</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span>
<span class="n">itemid</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">1000001</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1000002</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1000001</span><span class="p">]</span><span class="o">*</span><span class="mi">1</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1000002</span><span class="p">]</span><span class="o">*</span><span class="mi">1</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1000001</span><span class="p">]</span><span class="o">*</span><span class="mi">6</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1000002</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1000001</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1000002</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span>
<span class="n">userid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">)),</span> <span class="nb">len</span><span class="p">(</span><span class="n">itemid</span><span class="p">))</span>
<span class="n">action</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span> <span class="nb">len</span><span class="p">(</span><span class="n">itemid</span><span class="p">),</span> <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">])</span>
<span class="n">timestamp</span> <span class="o">=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;2020-01-01&#39;</span><span class="p">)]</span><span class="o">*</span><span class="mi">15</span>
<span class="n">timestamp</span> <span class="o">+=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;2020-01-02&#39;</span><span class="p">)]</span><span class="o">*</span><span class="mi">10</span>
<span class="n">timestamp</span> <span class="o">+=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;2020-01-03&#39;</span><span class="p">)]</span><span class="o">*</span><span class="mi">2</span>
<span class="n">timestamp</span> <span class="o">+=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;2020-01-04&#39;</span><span class="p">)]</span><span class="o">*</span><span class="mi">4</span>
<span class="n">timestamp</span> <span class="o">+=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;2020-01-05&#39;</span><span class="p">)]</span><span class="o">*</span><span class="mi">5</span>
<span class="n">timestamp</span> <span class="o">+=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;2020-01-07&#39;</span><span class="p">)]</span><span class="o">*</span><span class="mi">2</span>
<span class="n">timestamp</span> <span class="o">+=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;2020-01-08&#39;</span><span class="p">)]</span><span class="o">*</span><span class="mi">9</span>
<span class="n">timestamp</span> <span class="o">+=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;2020-01-09&#39;</span><span class="p">)]</span><span class="o">*</span><span class="mi">4</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;itemid&#39;</span><span class="p">:</span> <span class="n">itemid</span><span class="p">,</span>
    <span class="s1">&#39;userid&#39;</span><span class="p">:</span> <span class="n">userid</span><span class="p">,</span>
    <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="n">action</span><span class="p">,</span>
    <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">timestamp</span>
<span class="p">})</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">cudf</span><span class="o">.</span><span class="n">from_pandas</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;itemid&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1000001</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>itemid</th>
      <th>userid</th>
      <th>action</th>
      <th>timestamp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1000001</td>
      <td>6491</td>
      <td>1</td>
      <td>2020-01-01</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1000001</td>
      <td>5429</td>
      <td>0</td>
      <td>2020-01-01</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1000001</td>
      <td>7591</td>
      <td>1</td>
      <td>2020-01-01</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1000001</td>
      <td>9085</td>
      <td>1</td>
      <td>2020-01-01</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1000001</td>
      <td>8408</td>
      <td>0</td>
      <td>2020-01-01</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1000001</td>
      <td>1771</td>
      <td>1</td>
      <td>2020-01-01</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1000001</td>
      <td>2784</td>
      <td>1</td>
      <td>2020-01-01</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1000001</td>
      <td>3083</td>
      <td>0</td>
      <td>2020-01-01</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1000001</td>
      <td>3395</td>
      <td>1</td>
      <td>2020-01-01</td>
    </tr>
    <tr>
      <th>9</th>
      <td>1000001</td>
      <td>6500</td>
      <td>1</td>
      <td>2020-01-01</td>
    </tr>
    <tr>
      <th>15</th>
      <td>1000001</td>
      <td>640</td>
      <td>1</td>
      <td>2020-01-02</td>
    </tr>
    <tr>
      <th>16</th>
      <td>1000001</td>
      <td>8694</td>
      <td>1</td>
      <td>2020-01-02</td>
    </tr>
    <tr>
      <th>17</th>
      <td>1000001</td>
      <td>6148</td>
      <td>1</td>
      <td>2020-01-02</td>
    </tr>
    <tr>
      <th>18</th>
      <td>1000001</td>
      <td>3544</td>
      <td>0</td>
      <td>2020-01-02</td>
    </tr>
    <tr>
      <th>19</th>
      <td>1000001</td>
      <td>8871</td>
      <td>1</td>
      <td>2020-01-02</td>
    </tr>
    <tr>
      <th>25</th>
      <td>1000001</td>
      <td>9028</td>
      <td>1</td>
      <td>2020-01-03</td>
    </tr>
    <tr>
      <th>27</th>
      <td>1000001</td>
      <td>9903</td>
      <td>1</td>
      <td>2020-01-04</td>
    </tr>
    <tr>
      <th>28</th>
      <td>1000001</td>
      <td>9226</td>
      <td>1</td>
      <td>2020-01-04</td>
    </tr>
    <tr>
      <th>31</th>
      <td>1000001</td>
      <td>474</td>
      <td>1</td>
      <td>2020-01-05</td>
    </tr>
    <tr>
      <th>32</th>
      <td>1000001</td>
      <td>7779</td>
      <td>1</td>
      <td>2020-01-05</td>
    </tr>
    <tr>
      <th>33</th>
      <td>1000001</td>
      <td>8992</td>
      <td>1</td>
      <td>2020-01-05</td>
    </tr>
    <tr>
      <th>36</th>
      <td>1000001</td>
      <td>3554</td>
      <td>1</td>
      <td>2020-01-07</td>
    </tr>
    <tr>
      <th>38</th>
      <td>1000001</td>
      <td>3704</td>
      <td>1</td>
      <td>2020-01-08</td>
    </tr>
    <tr>
      <th>39</th>
      <td>1000001</td>
      <td>6929</td>
      <td>1</td>
      <td>2020-01-08</td>
    </tr>
    <tr>
      <th>40</th>
      <td>1000001</td>
      <td>7574</td>
      <td>1</td>
      <td>2020-01-08</td>
    </tr>
    <tr>
      <th>41</th>
      <td>1000001</td>
      <td>4624</td>
      <td>1</td>
      <td>2020-01-08</td>
    </tr>
    <tr>
      <th>42</th>
      <td>1000001</td>
      <td>2106</td>
      <td>0</td>
      <td>2020-01-08</td>
    </tr>
    <tr>
      <th>43</th>
      <td>1000001</td>
      <td>8194</td>
      <td>1</td>
      <td>2020-01-08</td>
    </tr>
    <tr>
      <th>47</th>
      <td>1000001</td>
      <td>9245</td>
      <td>1</td>
      <td>2020-01-09</td>
    </tr>
    <tr>
      <th>48</th>
      <td>1000001</td>
      <td>8382</td>
      <td>1</td>
      <td>2020-01-09</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We can extract many interesting features based on the history, such as</p>
<ul class="simple">
<li><p>the sum number of actions of the last day, last 3 days or last 7 days</p></li>
<li><p>the average number of actions of the last day, last 3 days or last 7 days</p></li>
<li><p>the average probability of the last day, last 3 days or last 7 days
etc.</p></li>
</ul>
<p>In general, these operations are called window function and uses .rolling() function. For each row, the function looks at a window (# of rows around it) and apply a certain function to it.</p>
<p>Current, our data is on a userid and itemid level. First, we need to aggregate it on the level, we want to apply the window function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data_window</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;itemid&#39;</span><span class="p">,</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="s1">&#39;action&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;itemid&#39;</span><span class="p">,</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">data_window</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;itemid&#39;</span><span class="p">,</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">]</span>
<span class="n">data_window</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">data_window</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span>

<span class="n">data_window</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>itemid</th>
      <th>timestamp</th>
      <th>count</th>
      <th>sum</th>
    </tr>
    <tr>
      <th>timestamp</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2020-01-01</th>
      <td>1000002</td>
      <td>2020-01-01</td>
      <td>5</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2020-01-08</th>
      <td>1000001</td>
      <td>2020-01-08</td>
      <td>6</td>
      <td>5</td>
    </tr>
    <tr>
      <th>2020-01-02</th>
      <td>1000001</td>
      <td>2020-01-02</td>
      <td>5</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2020-01-07</th>
      <td>1000001</td>
      <td>2020-01-07</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2020-01-03</th>
      <td>1000001</td>
      <td>2020-01-03</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2020-01-09</th>
      <td>1000001</td>
      <td>2020-01-09</td>
      <td>2</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2020-01-04</th>
      <td>1000001</td>
      <td>2020-01-04</td>
      <td>2</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2020-01-05</th>
      <td>1000001</td>
      <td>2020-01-05</td>
      <td>3</td>
      <td>3</td>
    </tr>
    <tr>
      <th>2020-01-08</th>
      <td>1000002</td>
      <td>2020-01-08</td>
      <td>3</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2020-01-07</th>
      <td>1000002</td>
      <td>2020-01-07</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2020-01-09</th>
      <td>1000002</td>
      <td>2020-01-09</td>
      <td>2</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2020-01-03</th>
      <td>1000002</td>
      <td>2020-01-03</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2020-01-05</th>
      <td>1000002</td>
      <td>2020-01-05</td>
      <td>2</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2020-01-04</th>
      <td>1000002</td>
      <td>2020-01-04</td>
      <td>2</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2020-01-01</th>
      <td>1000001</td>
      <td>2020-01-01</td>
      <td>10</td>
      <td>7</td>
    </tr>
    <tr>
      <th>2020-01-02</th>
      <td>1000002</td>
      <td>2020-01-02</td>
      <td>5</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We are interested how many positive interaction an item had on the previous day. Next, we want to groupby our dataframe by itemid. Then we apply the rolling function for two days (2D).</p>
<p>Note: To use the rolling function with days, the dataframe index has to by a timestamp.</p>
<p>We can see that every row contains the sum of the row value + the previous row value. For example, itemid=1000001 for data 2020-01-02 counts 15 observations and sums 12 positive interactions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">offset</span> <span class="o">=</span> <span class="s1">&#39;3D&#39;</span>

<span class="n">data_window_roll</span> <span class="o">=</span> <span class="n">data_window</span><span class="p">[[</span><span class="s1">&#39;itemid&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;itemid&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;itemid&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">data_window_roll</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>count</th>
      <th>sum</th>
    </tr>
    <tr>
      <th>itemid</th>
      <th>timestamp</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="8" valign="top">1000001</th>
      <th>2020-01-08</th>
      <td>6</td>
      <td>5</td>
    </tr>
    <tr>
      <th>2020-01-02</th>
      <td>11</td>
      <td>9</td>
    </tr>
    <tr>
      <th>2020-01-07</th>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2020-01-03</th>
      <td>13</td>
      <td>11</td>
    </tr>
    <tr>
      <th>2020-01-09</th>
      <td>2</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2020-01-04</th>
      <td>17</td>
      <td>15</td>
    </tr>
    <tr>
      <th>2020-01-05</th>
      <td>9</td>
      <td>9</td>
    </tr>
    <tr>
      <th>2020-01-01</th>
      <td>30</td>
      <td>25</td>
    </tr>
    <tr>
      <th rowspan="8" valign="top">1000002</th>
      <th>2020-01-01</th>
      <td>5</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2020-01-08</th>
      <td>3</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2020-01-07</th>
      <td>4</td>
      <td>3</td>
    </tr>
    <tr>
      <th>2020-01-09</th>
      <td>6</td>
      <td>5</td>
    </tr>
    <tr>
      <th>2020-01-03</th>
      <td>12</td>
      <td>10</td>
    </tr>
    <tr>
      <th>2020-01-05</th>
      <td>9</td>
      <td>8</td>
    </tr>
    <tr>
      <th>2020-01-04</th>
      <td>11</td>
      <td>10</td>
    </tr>
    <tr>
      <th>2020-01-02</th>
      <td>21</td>
      <td>18</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>If we take a look on the calculations, we see that the .rolling() inclues the value from the current row, as well. This could be a kind of data leakage. Therefore, we shift the values by one row.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data_window_roll</span> <span class="o">=</span> <span class="n">data_window_roll</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">data_window_roll</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;itemid&#39;</span><span class="p">,</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="s1">&#39;count_&#39;</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="s1">&#39;sum_&#39;</span> <span class="o">+</span> <span class="n">offset</span><span class="p">]</span>
<span class="n">data_window_roll</span><span class="p">[[</span><span class="s1">&#39;count_&#39;</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="s1">&#39;sum_&#39;</span> <span class="o">+</span> <span class="n">offset</span><span class="p">]]</span> <span class="o">=</span> <span class="n">data_window_roll</span><span class="p">[[</span><span class="s1">&#39;count_&#39;</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="s1">&#39;sum_&#39;</span> <span class="o">+</span> <span class="n">offset</span><span class="p">]]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">data_window_roll</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_window_roll</span><span class="p">[</span><span class="s1">&#39;itemid&#39;</span><span class="p">]</span><span class="o">!=</span><span class="n">data_window_roll</span><span class="p">[</span><span class="s1">&#39;itemid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="p">[</span><span class="s1">&#39;count_&#39;</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="s1">&#39;sum_&#39;</span> <span class="o">+</span> <span class="n">offset</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">data_window_roll</span><span class="p">[</span><span class="s1">&#39;avg_&#39;</span> <span class="o">+</span> <span class="n">offset</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_window_roll</span><span class="p">[</span><span class="s1">&#39;sum_&#39;</span> <span class="o">+</span> <span class="n">offset</span><span class="p">]</span><span class="o">/</span><span class="n">data_window_roll</span><span class="p">[</span><span class="s1">&#39;count_&#39;</span> <span class="o">+</span> <span class="n">offset</span><span class="p">]</span>
<span class="n">data_window_roll</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>itemid</th>
      <th>timestamp</th>
      <th>count_3D</th>
      <th>sum_3D</th>
      <th>avg_3D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1000001</td>
      <td>2020-01-08</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1000001</td>
      <td>2020-01-02</td>
      <td>6</td>
      <td>5</td>
      <td>0.833333333</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1000001</td>
      <td>2020-01-07</td>
      <td>11</td>
      <td>9</td>
      <td>0.818181818</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1000001</td>
      <td>2020-01-03</td>
      <td>1</td>
      <td>1</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1000001</td>
      <td>2020-01-09</td>
      <td>13</td>
      <td>11</td>
      <td>0.846153846</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1000001</td>
      <td>2020-01-04</td>
      <td>2</td>
      <td>2</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1000001</td>
      <td>2020-01-05</td>
      <td>17</td>
      <td>15</td>
      <td>0.882352941</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1000001</td>
      <td>2020-01-01</td>
      <td>9</td>
      <td>9</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1000002</td>
      <td>2020-01-01</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>9</th>
      <td>1000002</td>
      <td>2020-01-08</td>
      <td>5</td>
      <td>4</td>
      <td>0.8</td>
    </tr>
    <tr>
      <th>10</th>
      <td>1000002</td>
      <td>2020-01-07</td>
      <td>3</td>
      <td>2</td>
      <td>0.666666667</td>
    </tr>
    <tr>
      <th>11</th>
      <td>1000002</td>
      <td>2020-01-09</td>
      <td>4</td>
      <td>3</td>
      <td>0.75</td>
    </tr>
    <tr>
      <th>12</th>
      <td>1000002</td>
      <td>2020-01-03</td>
      <td>6</td>
      <td>5</td>
      <td>0.833333333</td>
    </tr>
    <tr>
      <th>13</th>
      <td>1000002</td>
      <td>2020-01-05</td>
      <td>12</td>
      <td>10</td>
      <td>0.833333333</td>
    </tr>
    <tr>
      <th>14</th>
      <td>1000002</td>
      <td>2020-01-04</td>
      <td>9</td>
      <td>8</td>
      <td>0.888888889</td>
    </tr>
    <tr>
      <th>15</th>
      <td>1000002</td>
      <td>2020-01-02</td>
      <td>11</td>
      <td>10</td>
      <td>0.909090909</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>After we calculated the aggregated values and applied the window function, we want to merge it to our original dataframe.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">data_window_roll</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;itemid&#39;</span><span class="p">,</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">])</span>
<span class="n">data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>itemid</th>
      <th>userid</th>
      <th>action</th>
      <th>timestamp</th>
      <th>count_3D</th>
      <th>sum_3D</th>
      <th>avg_3D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1000001</td>
      <td>6491</td>
      <td>1</td>
      <td>2020-01-01</td>
      <td>9</td>
      <td>9</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1000001</td>
      <td>5429</td>
      <td>0</td>
      <td>2020-01-01</td>
      <td>9</td>
      <td>9</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1000001</td>
      <td>7591</td>
      <td>1</td>
      <td>2020-01-01</td>
      <td>9</td>
      <td>9</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1000001</td>
      <td>9085</td>
      <td>1</td>
      <td>2020-01-01</td>
      <td>9</td>
      <td>9</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1000001</td>
      <td>8408</td>
      <td>0</td>
      <td>2020-01-01</td>
      <td>9</td>
      <td>9</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1000001</td>
      <td>1771</td>
      <td>1</td>
      <td>2020-01-01</td>
      <td>9</td>
      <td>9</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1000001</td>
      <td>2784</td>
      <td>1</td>
      <td>2020-01-01</td>
      <td>9</td>
      <td>9</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1000001</td>
      <td>3083</td>
      <td>0</td>
      <td>2020-01-01</td>
      <td>9</td>
      <td>9</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1000001</td>
      <td>3395</td>
      <td>1</td>
      <td>2020-01-01</td>
      <td>9</td>
      <td>9</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>1000001</td>
      <td>6500</td>
      <td>1</td>
      <td>2020-01-01</td>
      <td>9</td>
      <td>9</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>1000002</td>
      <td>8765</td>
      <td>0</td>
      <td>2020-01-01</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>11</th>
      <td>1000002</td>
      <td>3912</td>
      <td>1</td>
      <td>2020-01-01</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>12</th>
      <td>1000002</td>
      <td>653</td>
      <td>1</td>
      <td>2020-01-01</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>13</th>
      <td>1000002</td>
      <td>6661</td>
      <td>1</td>
      <td>2020-01-01</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>14</th>
      <td>1000002</td>
      <td>8473</td>
      <td>1</td>
      <td>2020-01-01</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>15</th>
      <td>1000001</td>
      <td>640</td>
      <td>1</td>
      <td>2020-01-02</td>
      <td>6</td>
      <td>5</td>
      <td>0.833333333</td>
    </tr>
    <tr>
      <th>16</th>
      <td>1000001</td>
      <td>8694</td>
      <td>1</td>
      <td>2020-01-02</td>
      <td>6</td>
      <td>5</td>
      <td>0.833333333</td>
    </tr>
    <tr>
      <th>17</th>
      <td>1000001</td>
      <td>6148</td>
      <td>1</td>
      <td>2020-01-02</td>
      <td>6</td>
      <td>5</td>
      <td>0.833333333</td>
    </tr>
    <tr>
      <th>18</th>
      <td>1000001</td>
      <td>3544</td>
      <td>0</td>
      <td>2020-01-02</td>
      <td>6</td>
      <td>5</td>
      <td>0.833333333</td>
    </tr>
    <tr>
      <th>19</th>
      <td>1000001</td>
      <td>8871</td>
      <td>1</td>
      <td>2020-01-02</td>
      <td>6</td>
      <td>5</td>
      <td>0.833333333</td>
    </tr>
    <tr>
      <th>20</th>
      <td>1000002</td>
      <td>7850</td>
      <td>1</td>
      <td>2020-01-02</td>
      <td>11</td>
      <td>10</td>
      <td>0.909090909</td>
    </tr>
    <tr>
      <th>21</th>
      <td>1000002</td>
      <td>9412</td>
      <td>1</td>
      <td>2020-01-02</td>
      <td>11</td>
      <td>10</td>
      <td>0.909090909</td>
    </tr>
    <tr>
      <th>22</th>
      <td>1000002</td>
      <td>7570</td>
      <td>1</td>
      <td>2020-01-02</td>
      <td>11</td>
      <td>10</td>
      <td>0.909090909</td>
    </tr>
    <tr>
      <th>23</th>
      <td>1000002</td>
      <td>1592</td>
      <td>1</td>
      <td>2020-01-02</td>
      <td>11</td>
      <td>10</td>
      <td>0.909090909</td>
    </tr>
    <tr>
      <th>24</th>
      <td>1000002</td>
      <td>5350</td>
      <td>0</td>
      <td>2020-01-02</td>
      <td>11</td>
      <td>10</td>
      <td>0.909090909</td>
    </tr>
    <tr>
      <th>25</th>
      <td>1000001</td>
      <td>9028</td>
      <td>1</td>
      <td>2020-01-03</td>
      <td>1</td>
      <td>1</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>26</th>
      <td>1000002</td>
      <td>8950</td>
      <td>1</td>
      <td>2020-01-03</td>
      <td>6</td>
      <td>5</td>
      <td>0.833333333</td>
    </tr>
    <tr>
      <th>27</th>
      <td>1000001</td>
      <td>9903</td>
      <td>1</td>
      <td>2020-01-04</td>
      <td>2</td>
      <td>2</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>28</th>
      <td>1000001</td>
      <td>9226</td>
      <td>1</td>
      <td>2020-01-04</td>
      <td>2</td>
      <td>2</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>29</th>
      <td>1000002</td>
      <td>8482</td>
      <td>1</td>
      <td>2020-01-04</td>
      <td>9</td>
      <td>8</td>
      <td>0.888888889</td>
    </tr>
    <tr>
      <th>30</th>
      <td>1000002</td>
      <td>9633</td>
      <td>1</td>
      <td>2020-01-04</td>
      <td>9</td>
      <td>8</td>
      <td>0.888888889</td>
    </tr>
    <tr>
      <th>31</th>
      <td>1000001</td>
      <td>474</td>
      <td>1</td>
      <td>2020-01-05</td>
      <td>17</td>
      <td>15</td>
      <td>0.882352941</td>
    </tr>
    <tr>
      <th>32</th>
      <td>1000001</td>
      <td>7779</td>
      <td>1</td>
      <td>2020-01-05</td>
      <td>17</td>
      <td>15</td>
      <td>0.882352941</td>
    </tr>
    <tr>
      <th>33</th>
      <td>1000001</td>
      <td>8992</td>
      <td>1</td>
      <td>2020-01-05</td>
      <td>17</td>
      <td>15</td>
      <td>0.882352941</td>
    </tr>
    <tr>
      <th>34</th>
      <td>1000002</td>
      <td>4096</td>
      <td>1</td>
      <td>2020-01-05</td>
      <td>12</td>
      <td>10</td>
      <td>0.833333333</td>
    </tr>
    <tr>
      <th>35</th>
      <td>1000002</td>
      <td>3889</td>
      <td>1</td>
      <td>2020-01-05</td>
      <td>12</td>
      <td>10</td>
      <td>0.833333333</td>
    </tr>
    <tr>
      <th>36</th>
      <td>1000001</td>
      <td>3554</td>
      <td>1</td>
      <td>2020-01-07</td>
      <td>11</td>
      <td>9</td>
      <td>0.818181818</td>
    </tr>
    <tr>
      <th>37</th>
      <td>1000002</td>
      <td>6203</td>
      <td>1</td>
      <td>2020-01-07</td>
      <td>3</td>
      <td>2</td>
      <td>0.666666667</td>
    </tr>
    <tr>
      <th>38</th>
      <td>1000001</td>
      <td>3704</td>
      <td>1</td>
      <td>2020-01-08</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>39</th>
      <td>1000001</td>
      <td>6929</td>
      <td>1</td>
      <td>2020-01-08</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>40</th>
      <td>1000001</td>
      <td>7574</td>
      <td>1</td>
      <td>2020-01-08</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>41</th>
      <td>1000001</td>
      <td>4624</td>
      <td>1</td>
      <td>2020-01-08</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>42</th>
      <td>1000001</td>
      <td>2106</td>
      <td>0</td>
      <td>2020-01-08</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>43</th>
      <td>1000001</td>
      <td>8194</td>
      <td>1</td>
      <td>2020-01-08</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>44</th>
      <td>1000002</td>
      <td>7604</td>
      <td>1</td>
      <td>2020-01-08</td>
      <td>5</td>
      <td>4</td>
      <td>0.8</td>
    </tr>
    <tr>
      <th>45</th>
      <td>1000002</td>
      <td>5752</td>
      <td>1</td>
      <td>2020-01-08</td>
      <td>5</td>
      <td>4</td>
      <td>0.8</td>
    </tr>
    <tr>
      <th>46</th>
      <td>1000002</td>
      <td>6588</td>
      <td>0</td>
      <td>2020-01-08</td>
      <td>5</td>
      <td>4</td>
      <td>0.8</td>
    </tr>
    <tr>
      <th>47</th>
      <td>1000001</td>
      <td>9245</td>
      <td>1</td>
      <td>2020-01-09</td>
      <td>13</td>
      <td>11</td>
      <td>0.846153846</td>
    </tr>
    <tr>
      <th>48</th>
      <td>1000001</td>
      <td>8382</td>
      <td>1</td>
      <td>2020-01-09</td>
      <td>13</td>
      <td>11</td>
      <td>0.846153846</td>
    </tr>
    <tr>
      <th>49</th>
      <td>1000002</td>
      <td>1966</td>
      <td>1</td>
      <td>2020-01-09</td>
      <td>4</td>
      <td>3</td>
      <td>0.75</td>
    </tr>
    <tr>
      <th>50</th>
      <td>1000002</td>
      <td>642</td>
      <td>1</td>
      <td>2020-01-09</td>
      <td>4</td>
      <td>3</td>
      <td>0.75</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">offset</span> <span class="o">=</span> <span class="s1">&#39;7D&#39;</span>

<span class="n">data_window_roll</span> <span class="o">=</span> <span class="n">data_window</span><span class="p">[[</span><span class="s1">&#39;itemid&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;itemid&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;itemid&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">data_window_roll</span> <span class="o">=</span> <span class="n">data_window_roll</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">data_window_roll</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;itemid&#39;</span><span class="p">,</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="s1">&#39;count_&#39;</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="s1">&#39;sum_&#39;</span> <span class="o">+</span> <span class="n">offset</span><span class="p">]</span>
<span class="n">data_window_roll</span><span class="p">[[</span><span class="s1">&#39;count_&#39;</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="s1">&#39;sum_&#39;</span> <span class="o">+</span> <span class="n">offset</span><span class="p">]]</span> <span class="o">=</span> <span class="n">data_window_roll</span><span class="p">[[</span><span class="s1">&#39;count_&#39;</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="s1">&#39;sum_&#39;</span> <span class="o">+</span> <span class="n">offset</span><span class="p">]]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">data_window_roll</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_window_roll</span><span class="p">[</span><span class="s1">&#39;itemid&#39;</span><span class="p">]</span><span class="o">!=</span><span class="n">data_window_roll</span><span class="p">[</span><span class="s1">&#39;itemid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="p">[</span><span class="s1">&#39;count_&#39;</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="s1">&#39;sum_&#39;</span> <span class="o">+</span> <span class="n">offset</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">data_window_roll</span><span class="p">[</span><span class="s1">&#39;avg_&#39;</span> <span class="o">+</span> <span class="n">offset</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_window_roll</span><span class="p">[</span><span class="s1">&#39;sum_&#39;</span> <span class="o">+</span> <span class="n">offset</span><span class="p">]</span><span class="o">/</span><span class="n">data_window_roll</span><span class="p">[</span><span class="s1">&#39;count_&#39;</span> <span class="o">+</span> <span class="n">offset</span><span class="p">]</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">data_window_roll</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;itemid&#39;</span><span class="p">,</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">])</span>
<span class="n">data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>itemid</th>
      <th>userid</th>
      <th>action</th>
      <th>timestamp</th>
      <th>count_3D</th>
      <th>sum_3D</th>
      <th>avg_3D</th>
      <th>count_7D</th>
      <th>sum_7D</th>
      <th>avg_7D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1000001</td>
      <td>6491</td>
      <td>1</td>
      <td>2020-01-01</td>
      <td>9</td>
      <td>9</td>
      <td>1.0</td>
      <td>20</td>
      <td>18</td>
      <td>0.9</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1000001</td>
      <td>5429</td>
      <td>0</td>
      <td>2020-01-01</td>
      <td>9</td>
      <td>9</td>
      <td>1.0</td>
      <td>20</td>
      <td>18</td>
      <td>0.9</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1000001</td>
      <td>7591</td>
      <td>1</td>
      <td>2020-01-01</td>
      <td>9</td>
      <td>9</td>
      <td>1.0</td>
      <td>20</td>
      <td>18</td>
      <td>0.9</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1000001</td>
      <td>9085</td>
      <td>1</td>
      <td>2020-01-01</td>
      <td>9</td>
      <td>9</td>
      <td>1.0</td>
      <td>20</td>
      <td>18</td>
      <td>0.9</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1000001</td>
      <td>8408</td>
      <td>0</td>
      <td>2020-01-01</td>
      <td>9</td>
      <td>9</td>
      <td>1.0</td>
      <td>20</td>
      <td>18</td>
      <td>0.9</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1000001</td>
      <td>1771</td>
      <td>1</td>
      <td>2020-01-01</td>
      <td>9</td>
      <td>9</td>
      <td>1.0</td>
      <td>20</td>
      <td>18</td>
      <td>0.9</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1000001</td>
      <td>2784</td>
      <td>1</td>
      <td>2020-01-01</td>
      <td>9</td>
      <td>9</td>
      <td>1.0</td>
      <td>20</td>
      <td>18</td>
      <td>0.9</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1000001</td>
      <td>3083</td>
      <td>0</td>
      <td>2020-01-01</td>
      <td>9</td>
      <td>9</td>
      <td>1.0</td>
      <td>20</td>
      <td>18</td>
      <td>0.9</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1000001</td>
      <td>3395</td>
      <td>1</td>
      <td>2020-01-01</td>
      <td>9</td>
      <td>9</td>
      <td>1.0</td>
      <td>20</td>
      <td>18</td>
      <td>0.9</td>
    </tr>
    <tr>
      <th>9</th>
      <td>1000001</td>
      <td>6500</td>
      <td>1</td>
      <td>2020-01-01</td>
      <td>9</td>
      <td>9</td>
      <td>1.0</td>
      <td>20</td>
      <td>18</td>
      <td>0.9</td>
    </tr>
    <tr>
      <th>10</th>
      <td>1000002</td>
      <td>8765</td>
      <td>0</td>
      <td>2020-01-01</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>11</th>
      <td>1000002</td>
      <td>3912</td>
      <td>1</td>
      <td>2020-01-01</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>12</th>
      <td>1000002</td>
      <td>653</td>
      <td>1</td>
      <td>2020-01-01</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>13</th>
      <td>1000002</td>
      <td>6661</td>
      <td>1</td>
      <td>2020-01-01</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>14</th>
      <td>1000002</td>
      <td>8473</td>
      <td>1</td>
      <td>2020-01-01</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>15</th>
      <td>1000001</td>
      <td>640</td>
      <td>1</td>
      <td>2020-01-02</td>
      <td>6</td>
      <td>5</td>
      <td>0.833333333</td>
      <td>6</td>
      <td>5</td>
      <td>0.833333333</td>
    </tr>
    <tr>
      <th>16</th>
      <td>1000001</td>
      <td>8694</td>
      <td>1</td>
      <td>2020-01-02</td>
      <td>6</td>
      <td>5</td>
      <td>0.833333333</td>
      <td>6</td>
      <td>5</td>
      <td>0.833333333</td>
    </tr>
    <tr>
      <th>17</th>
      <td>1000001</td>
      <td>6148</td>
      <td>1</td>
      <td>2020-01-02</td>
      <td>6</td>
      <td>5</td>
      <td>0.833333333</td>
      <td>6</td>
      <td>5</td>
      <td>0.833333333</td>
    </tr>
    <tr>
      <th>18</th>
      <td>1000001</td>
      <td>3544</td>
      <td>0</td>
      <td>2020-01-02</td>
      <td>6</td>
      <td>5</td>
      <td>0.833333333</td>
      <td>6</td>
      <td>5</td>
      <td>0.833333333</td>
    </tr>
    <tr>
      <th>19</th>
      <td>1000001</td>
      <td>8871</td>
      <td>1</td>
      <td>2020-01-02</td>
      <td>6</td>
      <td>5</td>
      <td>0.833333333</td>
      <td>6</td>
      <td>5</td>
      <td>0.833333333</td>
    </tr>
    <tr>
      <th>20</th>
      <td>1000002</td>
      <td>7850</td>
      <td>1</td>
      <td>2020-01-02</td>
      <td>11</td>
      <td>10</td>
      <td>0.909090909</td>
      <td>16</td>
      <td>14</td>
      <td>0.875</td>
    </tr>
    <tr>
      <th>21</th>
      <td>1000002</td>
      <td>9412</td>
      <td>1</td>
      <td>2020-01-02</td>
      <td>11</td>
      <td>10</td>
      <td>0.909090909</td>
      <td>16</td>
      <td>14</td>
      <td>0.875</td>
    </tr>
    <tr>
      <th>22</th>
      <td>1000002</td>
      <td>7570</td>
      <td>1</td>
      <td>2020-01-02</td>
      <td>11</td>
      <td>10</td>
      <td>0.909090909</td>
      <td>16</td>
      <td>14</td>
      <td>0.875</td>
    </tr>
    <tr>
      <th>23</th>
      <td>1000002</td>
      <td>1592</td>
      <td>1</td>
      <td>2020-01-02</td>
      <td>11</td>
      <td>10</td>
      <td>0.909090909</td>
      <td>16</td>
      <td>14</td>
      <td>0.875</td>
    </tr>
    <tr>
      <th>24</th>
      <td>1000002</td>
      <td>5350</td>
      <td>0</td>
      <td>2020-01-02</td>
      <td>11</td>
      <td>10</td>
      <td>0.909090909</td>
      <td>16</td>
      <td>14</td>
      <td>0.875</td>
    </tr>
    <tr>
      <th>25</th>
      <td>1000001</td>
      <td>9028</td>
      <td>1</td>
      <td>2020-01-03</td>
      <td>1</td>
      <td>1</td>
      <td>1.0</td>
      <td>12</td>
      <td>10</td>
      <td>0.833333333</td>
    </tr>
    <tr>
      <th>26</th>
      <td>1000002</td>
      <td>8950</td>
      <td>1</td>
      <td>2020-01-03</td>
      <td>6</td>
      <td>5</td>
      <td>0.833333333</td>
      <td>6</td>
      <td>5</td>
      <td>0.833333333</td>
    </tr>
    <tr>
      <th>27</th>
      <td>1000001</td>
      <td>9903</td>
      <td>1</td>
      <td>2020-01-04</td>
      <td>2</td>
      <td>2</td>
      <td>1.0</td>
      <td>4</td>
      <td>4</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>28</th>
      <td>1000001</td>
      <td>9226</td>
      <td>1</td>
      <td>2020-01-04</td>
      <td>2</td>
      <td>2</td>
      <td>1.0</td>
      <td>4</td>
      <td>4</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>29</th>
      <td>1000002</td>
      <td>8482</td>
      <td>1</td>
      <td>2020-01-04</td>
      <td>9</td>
      <td>8</td>
      <td>0.888888889</td>
      <td>14</td>
      <td>12</td>
      <td>0.857142857</td>
    </tr>
    <tr>
      <th>30</th>
      <td>1000002</td>
      <td>9633</td>
      <td>1</td>
      <td>2020-01-04</td>
      <td>9</td>
      <td>8</td>
      <td>0.888888889</td>
      <td>14</td>
      <td>12</td>
      <td>0.857142857</td>
    </tr>
    <tr>
      <th>31</th>
      <td>1000001</td>
      <td>474</td>
      <td>1</td>
      <td>2020-01-05</td>
      <td>17</td>
      <td>15</td>
      <td>0.882352941</td>
      <td>17</td>
      <td>15</td>
      <td>0.882352941</td>
    </tr>
    <tr>
      <th>32</th>
      <td>1000001</td>
      <td>7779</td>
      <td>1</td>
      <td>2020-01-05</td>
      <td>17</td>
      <td>15</td>
      <td>0.882352941</td>
      <td>17</td>
      <td>15</td>
      <td>0.882352941</td>
    </tr>
    <tr>
      <th>33</th>
      <td>1000001</td>
      <td>8992</td>
      <td>1</td>
      <td>2020-01-05</td>
      <td>17</td>
      <td>15</td>
      <td>0.882352941</td>
      <td>17</td>
      <td>15</td>
      <td>0.882352941</td>
    </tr>
    <tr>
      <th>34</th>
      <td>1000002</td>
      <td>4096</td>
      <td>1</td>
      <td>2020-01-05</td>
      <td>12</td>
      <td>10</td>
      <td>0.833333333</td>
      <td>12</td>
      <td>10</td>
      <td>0.833333333</td>
    </tr>
    <tr>
      <th>35</th>
      <td>1000002</td>
      <td>3889</td>
      <td>1</td>
      <td>2020-01-05</td>
      <td>12</td>
      <td>10</td>
      <td>0.833333333</td>
      <td>12</td>
      <td>10</td>
      <td>0.833333333</td>
    </tr>
    <tr>
      <th>36</th>
      <td>1000001</td>
      <td>3554</td>
      <td>1</td>
      <td>2020-01-07</td>
      <td>11</td>
      <td>9</td>
      <td>0.818181818</td>
      <td>11</td>
      <td>9</td>
      <td>0.818181818</td>
    </tr>
    <tr>
      <th>37</th>
      <td>1000002</td>
      <td>6203</td>
      <td>1</td>
      <td>2020-01-07</td>
      <td>3</td>
      <td>2</td>
      <td>0.666666667</td>
      <td>3</td>
      <td>2</td>
      <td>0.666666667</td>
    </tr>
    <tr>
      <th>38</th>
      <td>1000001</td>
      <td>3704</td>
      <td>1</td>
      <td>2020-01-08</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>39</th>
      <td>1000001</td>
      <td>6929</td>
      <td>1</td>
      <td>2020-01-08</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>40</th>
      <td>1000001</td>
      <td>7574</td>
      <td>1</td>
      <td>2020-01-08</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>41</th>
      <td>1000001</td>
      <td>4624</td>
      <td>1</td>
      <td>2020-01-08</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>42</th>
      <td>1000001</td>
      <td>2106</td>
      <td>0</td>
      <td>2020-01-08</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>43</th>
      <td>1000001</td>
      <td>8194</td>
      <td>1</td>
      <td>2020-01-08</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>44</th>
      <td>1000002</td>
      <td>7604</td>
      <td>1</td>
      <td>2020-01-08</td>
      <td>5</td>
      <td>4</td>
      <td>0.8</td>
      <td>5</td>
      <td>4</td>
      <td>0.8</td>
    </tr>
    <tr>
      <th>45</th>
      <td>1000002</td>
      <td>5752</td>
      <td>1</td>
      <td>2020-01-08</td>
      <td>5</td>
      <td>4</td>
      <td>0.8</td>
      <td>5</td>
      <td>4</td>
      <td>0.8</td>
    </tr>
    <tr>
      <th>46</th>
      <td>1000002</td>
      <td>6588</td>
      <td>0</td>
      <td>2020-01-08</td>
      <td>5</td>
      <td>4</td>
      <td>0.8</td>
      <td>5</td>
      <td>4</td>
      <td>0.8</td>
    </tr>
    <tr>
      <th>47</th>
      <td>1000001</td>
      <td>9245</td>
      <td>1</td>
      <td>2020-01-09</td>
      <td>13</td>
      <td>11</td>
      <td>0.846153846</td>
      <td>13</td>
      <td>11</td>
      <td>0.846153846</td>
    </tr>
    <tr>
      <th>48</th>
      <td>1000001</td>
      <td>8382</td>
      <td>1</td>
      <td>2020-01-09</td>
      <td>13</td>
      <td>11</td>
      <td>0.846153846</td>
      <td>13</td>
      <td>11</td>
      <td>0.846153846</td>
    </tr>
    <tr>
      <th>49</th>
      <td>1000002</td>
      <td>1966</td>
      <td>1</td>
      <td>2020-01-09</td>
      <td>4</td>
      <td>3</td>
      <td>0.75</td>
      <td>9</td>
      <td>7</td>
      <td>0.777777778</td>
    </tr>
    <tr>
      <th>50</th>
      <td>1000002</td>
      <td>642</td>
      <td>1</td>
      <td>2020-01-09</td>
      <td>4</td>
      <td>3</td>
      <td>0.75</td>
      <td>9</td>
      <td>7</td>
      <td>0.777777778</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Let’s get the # of purchases per product in the 7 days before.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># cuDF does not support date32, right now. We use pandas to transform the timestamp in only date values.</span>
<span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cudf</span><span class="o">.</span><span class="n">from_pandas</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">())</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">offset</span> <span class="o">=</span> <span class="s1">&#39;7D&#39;</span>

<span class="n">data_window</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">[[</span><span class="s1">&#39;product_id&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;target&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;product_id&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">data_window</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;product_id&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">]</span>
<span class="n">data_window</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">data_window</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span>

<span class="n">data_window_roll</span> <span class="o">=</span> <span class="n">data_window</span><span class="p">[[</span><span class="s1">&#39;product_id&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;product_id&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;product_id&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">data_window_roll</span> <span class="o">=</span> <span class="n">data_window_roll</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">data_window_roll</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;product_id&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;count_&#39;</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="s1">&#39;sum_&#39;</span> <span class="o">+</span> <span class="n">offset</span><span class="p">]</span>
<span class="n">data_window_roll</span><span class="p">[[</span><span class="s1">&#39;count_&#39;</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="s1">&#39;sum_&#39;</span> <span class="o">+</span> <span class="n">offset</span><span class="p">]]</span> <span class="o">=</span> <span class="n">data_window_roll</span><span class="p">[[</span><span class="s1">&#39;count_&#39;</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="s1">&#39;sum_&#39;</span> <span class="o">+</span> <span class="n">offset</span><span class="p">]]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">data_window_roll</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_window_roll</span><span class="p">[</span><span class="s1">&#39;product_id&#39;</span><span class="p">]</span><span class="o">!=</span><span class="n">data_window_roll</span><span class="p">[</span><span class="s1">&#39;product_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="p">[</span><span class="s1">&#39;count_&#39;</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="s1">&#39;sum_&#39;</span> <span class="o">+</span> <span class="n">offset</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">data_window_roll</span><span class="p">[</span><span class="s1">&#39;avg_&#39;</span> <span class="o">+</span> <span class="n">offset</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_window_roll</span><span class="p">[</span><span class="s1">&#39;sum_&#39;</span> <span class="o">+</span> <span class="n">offset</span><span class="p">]</span><span class="o">/</span><span class="n">data_window_roll</span><span class="p">[</span><span class="s1">&#39;count_&#39;</span> <span class="o">+</span> <span class="n">offset</span><span class="p">]</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">df_train</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">data_window_roll</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;product_id&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">])</span>
<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>event_time</th>
      <th>event_type</th>
      <th>product_id</th>
      <th>brand</th>
      <th>price</th>
      <th>user_id</th>
      <th>user_session</th>
      <th>target</th>
      <th>timestamp</th>
      <th>ts_hour</th>
      <th>ts_minute</th>
      <th>ts_weekday</th>
      <th>ts_day</th>
      <th>ts_month</th>
      <th>ts_year</th>
      <th>cat_0</th>
      <th>cat_1</th>
      <th>cat_2</th>
      <th>cat_3</th>
      <th>hour</th>
      <th>hour_bin</th>
      <th>price_bin</th>
      <th>weekday</th>
      <th>weekday_bin</th>
      <th>TE_cat_0</th>
      <th>TE_cat_1</th>
      <th>TE_cat_2</th>
      <th>TE_cat_0_cat_1_cat_2</th>
      <th>TE_ts_hour</th>
      <th>TE_ts_weekday</th>
      <th>TE_ts_weekday_ts_hour_cat_2_brand</th>
      <th>CE_brand</th>
      <th>CE_user_id</th>
      <th>CE_product_id</th>
      <th>CE_cat_0</th>
      <th>CE_cat_1</th>
      <th>CE_cat_2</th>
      <th>date</th>
      <th>count_7D</th>
      <th>sum_7D</th>
      <th>avg_7D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2020-01-23 05:51:54 UTC</td>
      <td>cart</td>
      <td>1004767</td>
      <td>samsung</td>
      <td>226.27</td>
      <td>604877512</td>
      <td>d8340c6c-ea06-4e9d-8c35-91a794ec4fe1</td>
      <td>0</td>
      <td>2020-01-23 05:51:54</td>
      <td>5</td>
      <td>51</td>
      <td>3</td>
      <td>23</td>
      <td>1</td>
      <td>2020</td>
      <td>construction</td>
      <td>tools</td>
      <td>light</td>
      <td>NA</td>
      <td>5</td>
      <td>1</td>
      <td>2</td>
      <td>3</td>
      <td>2</td>
      <td>0.450266</td>
      <td>0.449712</td>
      <td>0.456533</td>
      <td>0.457381</td>
      <td>0.373932</td>
      <td>0.349578</td>
      <td>0.484851</td>
      <td>2329847</td>
      <td>2</td>
      <td>318753</td>
      <td>3375478</td>
      <td>3319883</td>
      <td>3184510</td>
      <td>2020-01-23</td>
      <td>4584</td>
      <td>2499</td>
      <td>0.545157</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2020-01-23 05:51:57 UTC</td>
      <td>cart</td>
      <td>100043749</td>
      <td>defacto</td>
      <td>7.70</td>
      <td>584393413</td>
      <td>e6825e0a-2882-46c4-a181-66b4d3f51d77</td>
      <td>0</td>
      <td>2020-01-23 05:51:57</td>
      <td>5</td>
      <td>51</td>
      <td>3</td>
      <td>23</td>
      <td>1</td>
      <td>2020</td>
      <td>appliances</td>
      <td>personal</td>
      <td>massager</td>
      <td>NA</td>
      <td>5</td>
      <td>1</td>
      <td>0</td>
      <td>3</td>
      <td>2</td>
      <td>0.343637</td>
      <td>0.386527</td>
      <td>0.393561</td>
      <td>0.393561</td>
      <td>0.373823</td>
      <td>0.349599</td>
      <td>0.345413</td>
      <td>19306</td>
      <td>18</td>
      <td>42</td>
      <td>1531852</td>
      <td>306000</td>
      <td>277531</td>
      <td>2020-01-23</td>
      <td>8</td>
      <td>2</td>
      <td>0.250000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2020-01-23 05:51:58 UTC</td>
      <td>cart</td>
      <td>1005160</td>
      <td>xiaomi</td>
      <td>167.57</td>
      <td>593241453</td>
      <td>8768b7f8-67aa-437d-9750-27008f77354a</td>
      <td>0</td>
      <td>2020-01-23 05:51:58</td>
      <td>5</td>
      <td>51</td>
      <td>3</td>
      <td>23</td>
      <td>1</td>
      <td>2020</td>
      <td>construction</td>
      <td>tools</td>
      <td>light</td>
      <td>NA</td>
      <td>5</td>
      <td>1</td>
      <td>2</td>
      <td>3</td>
      <td>2</td>
      <td>0.450141</td>
      <td>0.449635</td>
      <td>0.456450</td>
      <td>0.457303</td>
      <td>0.373849</td>
      <td>0.349541</td>
      <td>0.368587</td>
      <td>1085216</td>
      <td>5</td>
      <td>120163</td>
      <td>3375478</td>
      <td>3319883</td>
      <td>3184510</td>
      <td>2020-01-23</td>
      <td>1547</td>
      <td>467</td>
      <td>0.301875</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2020-01-23 05:52:00 UTC</td>
      <td>cart</td>
      <td>1005160</td>
      <td>xiaomi</td>
      <td>167.57</td>
      <td>593241453</td>
      <td>8768b7f8-67aa-437d-9750-27008f77354a</td>
      <td>0</td>
      <td>2020-01-23 05:52:00</td>
      <td>5</td>
      <td>52</td>
      <td>3</td>
      <td>23</td>
      <td>1</td>
      <td>2020</td>
      <td>construction</td>
      <td>tools</td>
      <td>light</td>
      <td>NA</td>
      <td>5</td>
      <td>1</td>
      <td>2</td>
      <td>3</td>
      <td>2</td>
      <td>0.450553</td>
      <td>0.450018</td>
      <td>0.456834</td>
      <td>0.457670</td>
      <td>0.374013</td>
      <td>0.349531</td>
      <td>0.374806</td>
      <td>1085216</td>
      <td>5</td>
      <td>120163</td>
      <td>3375478</td>
      <td>3319883</td>
      <td>3184510</td>
      <td>2020-01-23</td>
      <td>1547</td>
      <td>467</td>
      <td>0.301875</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2020-01-23 05:52:01 UTC</td>
      <td>cart</td>
      <td>100009497</td>
      <td>arcodoro</td>
      <td>21.36</td>
      <td>516498608</td>
      <td>543260b0-6e6f-492d-b4e3-4380f4bb7329</td>
      <td>0</td>
      <td>2020-01-23 05:52:01</td>
      <td>5</td>
      <td>52</td>
      <td>3</td>
      <td>23</td>
      <td>1</td>
      <td>2020</td>
      <td>medicine</td>
      <td>tools</td>
      <td>tonometer</td>
      <td>NA</td>
      <td>5</td>
      <td>1</td>
      <td>2</td>
      <td>3</td>
      <td>2</td>
      <td>0.303333</td>
      <td>0.449727</td>
      <td>0.303333</td>
      <td>0.303333</td>
      <td>0.374066</td>
      <td>0.349571</td>
      <td>0.418171</td>
      <td>714</td>
      <td>9</td>
      <td>129</td>
      <td>5011</td>
      <td>3319883</td>
      <td>5011</td>
      <td>2020-01-23</td>
      <td>5</td>
      <td>2</td>
      <td>0.400000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="differences">
<h3>Differences<a class="headerlink" href="#differences" title="Permalink to this headline">¶</a></h3>
<p>Another category of powerful features is to calculate the differences to previous datapoints based on a timestamp. For example, we can calculate if the price changed of a product and how much the price change was.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">itemid</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1000001</span><span class="p">]</span><span class="o">*</span><span class="mi">10</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1000002</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1000001</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1000002</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1000001</span><span class="p">]</span><span class="o">*</span><span class="mi">1</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1000002</span><span class="p">]</span><span class="o">*</span><span class="mi">1</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1000001</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1000002</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span>
<span class="n">itemid</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">1000001</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1000002</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1000001</span><span class="p">]</span><span class="o">*</span><span class="mi">1</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1000002</span><span class="p">]</span><span class="o">*</span><span class="mi">1</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1000001</span><span class="p">]</span><span class="o">*</span><span class="mi">6</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1000002</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1000001</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1000002</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span>
<span class="n">userid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">)),</span> <span class="nb">len</span><span class="p">(</span><span class="n">itemid</span><span class="p">))</span>
<span class="n">action</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span> <span class="nb">len</span><span class="p">(</span><span class="n">itemid</span><span class="p">),</span> <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">])</span>

<span class="n">price</span> <span class="o">=</span> <span class="p">[</span><span class="mf">100.00</span><span class="p">]</span><span class="o">*</span><span class="mi">10</span> <span class="o">+</span> <span class="p">[</span><span class="mf">25.00</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span> <span class="o">+</span> <span class="p">[</span><span class="mf">100.00</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span> <span class="o">+</span> <span class="p">[</span><span class="mf">30.00</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span> <span class="o">+</span> <span class="p">[</span><span class="mf">125.00</span><span class="p">]</span><span class="o">*</span><span class="mi">1</span> <span class="o">+</span> <span class="p">[</span><span class="mf">30.00</span><span class="p">]</span><span class="o">*</span><span class="mi">1</span> <span class="o">+</span> <span class="p">[</span><span class="mf">125.00</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="p">[</span><span class="mf">30.00</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span>
<span class="n">price</span> <span class="o">+=</span> <span class="p">[</span><span class="mf">110.00</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span> <span class="o">+</span> <span class="p">[</span><span class="mf">30.00</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="p">[</span><span class="mf">110.00</span><span class="p">]</span><span class="o">*</span><span class="mi">1</span> <span class="o">+</span> <span class="p">[</span><span class="mf">20.00</span><span class="p">]</span><span class="o">*</span><span class="mi">1</span> <span class="o">+</span> <span class="p">[</span><span class="mf">90.00</span><span class="p">]</span><span class="o">*</span><span class="mi">6</span> <span class="o">+</span> <span class="p">[</span><span class="mf">20.00</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span> <span class="o">+</span> <span class="p">[</span><span class="mf">90.00</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="p">[</span><span class="mf">20.00</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span>

<span class="n">timestamp</span> <span class="o">=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;2020-01-01&#39;</span><span class="p">)]</span><span class="o">*</span><span class="mi">15</span>
<span class="n">timestamp</span> <span class="o">+=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;2020-01-02&#39;</span><span class="p">)]</span><span class="o">*</span><span class="mi">10</span>
<span class="n">timestamp</span> <span class="o">+=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;2020-01-03&#39;</span><span class="p">)]</span><span class="o">*</span><span class="mi">2</span>
<span class="n">timestamp</span> <span class="o">+=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;2020-01-04&#39;</span><span class="p">)]</span><span class="o">*</span><span class="mi">4</span>
<span class="n">timestamp</span> <span class="o">+=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;2020-01-05&#39;</span><span class="p">)]</span><span class="o">*</span><span class="mi">5</span>
<span class="n">timestamp</span> <span class="o">+=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;2020-01-07&#39;</span><span class="p">)]</span><span class="o">*</span><span class="mi">2</span>
<span class="n">timestamp</span> <span class="o">+=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;2020-01-08&#39;</span><span class="p">)]</span><span class="o">*</span><span class="mi">9</span>
<span class="n">timestamp</span> <span class="o">+=</span> <span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;2020-01-09&#39;</span><span class="p">)]</span><span class="o">*</span><span class="mi">4</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;itemid&#39;</span><span class="p">:</span> <span class="n">itemid</span><span class="p">,</span>
    <span class="s1">&#39;userid&#39;</span><span class="p">:</span> <span class="n">userid</span><span class="p">,</span>
    <span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="n">price</span><span class="p">,</span>
    <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="n">action</span><span class="p">,</span>
    <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">timestamp</span>
<span class="p">})</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">cudf</span><span class="o">.</span><span class="n">from_pandas</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;itemid&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1000001</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>itemid</th>
      <th>userid</th>
      <th>price</th>
      <th>action</th>
      <th>timestamp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1000001</td>
      <td>6916</td>
      <td>100.0</td>
      <td>1</td>
      <td>2020-01-01</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1000001</td>
      <td>8981</td>
      <td>100.0</td>
      <td>0</td>
      <td>2020-01-01</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1000001</td>
      <td>9272</td>
      <td>100.0</td>
      <td>1</td>
      <td>2020-01-01</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1000001</td>
      <td>5939</td>
      <td>100.0</td>
      <td>1</td>
      <td>2020-01-01</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1000001</td>
      <td>9305</td>
      <td>100.0</td>
      <td>1</td>
      <td>2020-01-01</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1000001</td>
      <td>4431</td>
      <td>100.0</td>
      <td>1</td>
      <td>2020-01-01</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1000001</td>
      <td>3954</td>
      <td>100.0</td>
      <td>1</td>
      <td>2020-01-01</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1000001</td>
      <td>8092</td>
      <td>100.0</td>
      <td>1</td>
      <td>2020-01-01</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1000001</td>
      <td>1204</td>
      <td>100.0</td>
      <td>1</td>
      <td>2020-01-01</td>
    </tr>
    <tr>
      <th>9</th>
      <td>1000001</td>
      <td>3582</td>
      <td>100.0</td>
      <td>1</td>
      <td>2020-01-01</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Tree-based or deep learning based models have difficulties processing these relationships on their own. Providing the models with these features can significantly improve the performance.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">offset</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">data_shift</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;itemid&#39;</span><span class="p">,</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;itemid&#39;</span><span class="p">,</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">data_shift</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;itemid&#39;</span><span class="p">,</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">]</span>
<span class="n">data_shift</span><span class="p">[</span><span class="s1">&#39;mean_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">offset</span><span class="p">)]</span> <span class="o">=</span> <span class="n">data_shift</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">data_shift</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_shift</span><span class="p">[</span><span class="s1">&#39;itemid&#39;</span><span class="p">]</span><span class="o">!=</span><span class="n">data_shift</span><span class="p">[</span><span class="s1">&#39;itemid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;mean_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">offset</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">data_shift</span><span class="p">[</span><span class="s1">&#39;diff_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">offset</span><span class="p">)]</span> <span class="o">=</span> <span class="n">data_shift</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">data_shift</span><span class="p">[</span><span class="s1">&#39;mean_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">offset</span><span class="p">)]</span>
<span class="n">data_shift</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>itemid</th>
      <th>timestamp</th>
      <th>mean</th>
      <th>mean_1</th>
      <th>diff_1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1000002</td>
      <td>2020-01-01</td>
      <td>25.0</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1000001</td>
      <td>2020-01-08</td>
      <td>90.0</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1000001</td>
      <td>2020-01-02</td>
      <td>100.0</td>
      <td>90.0</td>
      <td>10.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1000001</td>
      <td>2020-01-07</td>
      <td>110.0</td>
      <td>100.0</td>
      <td>10.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1000001</td>
      <td>2020-01-03</td>
      <td>125.0</td>
      <td>110.0</td>
      <td>15.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1000001</td>
      <td>2020-01-09</td>
      <td>90.0</td>
      <td>125.0</td>
      <td>-35.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1000001</td>
      <td>2020-01-04</td>
      <td>125.0</td>
      <td>90.0</td>
      <td>35.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1000001</td>
      <td>2020-01-05</td>
      <td>110.0</td>
      <td>125.0</td>
      <td>-15.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1000002</td>
      <td>2020-01-08</td>
      <td>20.0</td>
      <td>&lt;NA&gt;</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>9</th>
      <td>1000002</td>
      <td>2020-01-07</td>
      <td>20.0</td>
      <td>20.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data_shift</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;itemid&#39;</span><span class="p">,</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="s1">&#39;c1&#39;</span><span class="p">,</span> <span class="s1">&#39;c2&#39;</span><span class="p">,</span> <span class="s1">&#39;price_diff_1&#39;</span><span class="p">]</span>
<span class="n">data_shift</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;c1&#39;</span><span class="p">,</span> <span class="s1">&#39;c2&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">data_shift</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>itemid</th>
      <th>timestamp</th>
      <th>price_diff_1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1000002</td>
      <td>2020-01-01</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1000001</td>
      <td>2020-01-08</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1000001</td>
      <td>2020-01-02</td>
      <td>10.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1000001</td>
      <td>2020-01-07</td>
      <td>10.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1000001</td>
      <td>2020-01-03</td>
      <td>15.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1000001</td>
      <td>2020-01-09</td>
      <td>-35.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1000001</td>
      <td>2020-01-04</td>
      <td>35.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1000001</td>
      <td>2020-01-05</td>
      <td>-15.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1000002</td>
      <td>2020-01-08</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>9</th>
      <td>1000002</td>
      <td>2020-01-07</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">data_shift</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;itemid&#39;</span><span class="p">,</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">])</span>
<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>itemid</th>
      <th>userid</th>
      <th>price</th>
      <th>action</th>
      <th>timestamp</th>
      <th>price_diff_1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1000001</td>
      <td>9289</td>
      <td>100.0</td>
      <td>1</td>
      <td>2020-01-01</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1000001</td>
      <td>7503</td>
      <td>100.0</td>
      <td>1</td>
      <td>2020-01-01</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1000001</td>
      <td>3793</td>
      <td>100.0</td>
      <td>1</td>
      <td>2020-01-01</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1000001</td>
      <td>1575</td>
      <td>100.0</td>
      <td>1</td>
      <td>2020-01-01</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1000001</td>
      <td>5868</td>
      <td>100.0</td>
      <td>1</td>
      <td>2020-01-01</td>
      <td>&lt;NA&gt;</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We can combine techniques of TimeSeries data and chain them together. For example, we can calculate the # of purchases per item and then compare the previous week with a the week, 2, 3 or 5 weeks ago. We can recognize patterns over time.</p>
<p>Let’s get the price difference of the previous price to the current price per item</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># cuDF does not support date32, right now. We use pandas to transform the timestamp in only date values.</span>
<span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cudf</span><span class="o">.</span><span class="n">from_pandas</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">())</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">offset</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">data_shift</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">[[</span><span class="s1">&#39;product_id&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;product_id&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">data_shift</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;product_id&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">]</span>
<span class="n">data_shift</span><span class="p">[</span><span class="s1">&#39;mean_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">offset</span><span class="p">)]</span> <span class="o">=</span> <span class="n">data_shift</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">data_shift</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_shift</span><span class="p">[</span><span class="s1">&#39;product_id&#39;</span><span class="p">]</span><span class="o">!=</span><span class="n">data_shift</span><span class="p">[</span><span class="s1">&#39;product_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;mean_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">offset</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">data_shift</span><span class="p">[</span><span class="s1">&#39;diff_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">offset</span><span class="p">)]</span> <span class="o">=</span> <span class="n">data_shift</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">data_shift</span><span class="p">[</span><span class="s1">&#39;mean_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">offset</span><span class="p">)]</span>
<span class="n">data_shift</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;product_id&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;c1&#39;</span><span class="p">,</span> <span class="s1">&#39;c2&#39;</span><span class="p">,</span> <span class="s1">&#39;price_diff_1&#39;</span><span class="p">]</span>
<span class="n">data_shift</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;c1&#39;</span><span class="p">,</span> <span class="s1">&#39;c2&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">df_train</span> <span class="o">=</span> <span class="n">df_train</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">data_shift</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;product_id&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">])</span>
<span class="n">df_train</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>event_time</th>
      <th>event_type</th>
      <th>product_id</th>
      <th>brand</th>
      <th>price</th>
      <th>user_id</th>
      <th>user_session</th>
      <th>target</th>
      <th>timestamp</th>
      <th>ts_hour</th>
      <th>ts_minute</th>
      <th>ts_weekday</th>
      <th>ts_day</th>
      <th>ts_month</th>
      <th>ts_year</th>
      <th>cat_0</th>
      <th>cat_1</th>
      <th>cat_2</th>
      <th>cat_3</th>
      <th>date</th>
      <th>price_diff_1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2020-01-23 14:14:26 UTC</td>
      <td>cart</td>
      <td>1002544</td>
      <td>apple</td>
      <td>411.31</td>
      <td>536990227</td>
      <td>8d30039f-25b6-4692-b6ef-14f2edc322a9</td>
      <td>0</td>
      <td>2020-01-23 14:14:26</td>
      <td>14</td>
      <td>14</td>
      <td>3</td>
      <td>23</td>
      <td>1</td>
      <td>2020</td>
      <td>construction</td>
      <td>tools</td>
      <td>light</td>
      <td>NA</td>
      <td>2020-01-23</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2020-01-23 14:14:26 UTC</td>
      <td>cart</td>
      <td>1002544</td>
      <td>apple</td>
      <td>411.31</td>
      <td>536990227</td>
      <td>8d30039f-25b6-4692-b6ef-14f2edc322a9</td>
      <td>0</td>
      <td>2020-01-23 14:14:26</td>
      <td>14</td>
      <td>14</td>
      <td>3</td>
      <td>23</td>
      <td>1</td>
      <td>2020</td>
      <td>construction</td>
      <td>tools</td>
      <td>light</td>
      <td>NA</td>
      <td>2020-01-23</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2020-01-23 14:14:26 UTC</td>
      <td>cart</td>
      <td>1002544</td>
      <td>apple</td>
      <td>411.31</td>
      <td>536990227</td>
      <td>8d30039f-25b6-4692-b6ef-14f2edc322a9</td>
      <td>0</td>
      <td>2020-01-23 14:14:26</td>
      <td>14</td>
      <td>14</td>
      <td>3</td>
      <td>23</td>
      <td>1</td>
      <td>2020</td>
      <td>construction</td>
      <td>tools</td>
      <td>light</td>
      <td>NA</td>
      <td>2020-01-23</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2020-01-23 14:14:26 UTC</td>
      <td>cart</td>
      <td>1002544</td>
      <td>apple</td>
      <td>411.31</td>
      <td>536990227</td>
      <td>8d30039f-25b6-4692-b6ef-14f2edc322a9</td>
      <td>0</td>
      <td>2020-01-23 14:14:26</td>
      <td>14</td>
      <td>14</td>
      <td>3</td>
      <td>23</td>
      <td>1</td>
      <td>2020</td>
      <td>construction</td>
      <td>tools</td>
      <td>light</td>
      <td>NA</td>
      <td>2020-01-23</td>
      <td>&lt;NA&gt;</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2020-01-23 14:14:26 UTC</td>
      <td>cart</td>
      <td>1002544</td>
      <td>apple</td>
      <td>411.31</td>
      <td>536990227</td>
      <td>8d30039f-25b6-4692-b6ef-14f2edc322a9</td>
      <td>0</td>
      <td>2020-01-23 14:14:26</td>
      <td>14</td>
      <td>14</td>
      <td>3</td>
      <td>23</td>
      <td>1</td>
      <td>2020</td>
      <td>construction</td>
      <td>tools</td>
      <td>light</td>
      <td>NA</td>
      <td>2020-01-23</td>
      <td>&lt;NA&gt;</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./nbs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="T915054_method_for_effective_online_testing.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">Methods for effective online testing</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="T227901_amazon_personalize_batch_job.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">Amazon Personalize Batch Job</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Sparsh A.<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>