
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>A/B Testing &#8212; Reco Book</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="PinSage Graph-based Recommender" href="T475711_PinSage_Graph_based_Recommender.html" />
    <link rel="prev" title="Analytics Zoo" href="T051594_Analytics_Zoo.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Reco Book</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../index.html">
   Tutorials in Jupyter notebook format
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  User Stories
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="US780867_Transformer_based_Recommenders.html">
   Transformer-based Recommenders
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="T034923_BERT4Rec_on_ML1M_in_PyTorch.html">
     BERT4Rec on ML-1M in PyTorch
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T595874_BERT4Rec_on_ML25M_in_PyTorch_Lightning.html">
     BERT4Rec on ML-25M
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T088416_BST_Implementation_in_MXNet.html">
     BST Implementation in MXNet
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T602245_BST_implementation_in_PyTorch.html">
     BST implementation in PyTorch
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T007665_BST_on_ML1M_in_Keras.html">
     A Transformer-based recommendation system
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T881207_BST_PTLightning_ML1M.html">
     Rating prediction using the Behavior Sequence Transformer (BST) model on ML-1M dataset in PyTorch Lightning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T757997_SASRec_PyTorch.html">
     SASRec implementation with PyTorch Library
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T225287_SASRec_PaddlePaddle.html">
     SASRec implementation with Paddle Library
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T701627_SR_SAN_Session_based_Model.html">
     SR-SAN Session-based Recommender
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T975104_SSEPT_ML1M_Tensorflow1x.html">
     SSE-PT Personalized Transformer Recommender on ML-1M in Tensorflow 1.x
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Prototypes
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="T382881_DeepWalk_Karateclub.html">
   DeepWalk from scratch referencing Karateclub library
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T384270_DeepWalk_pure_python.html">
   DeepWalk in pure python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T677598_Jaccard_Cosine_SVD_DeepWalk_ML100K.html">
   Recommender System with DeepWalk Graph Embeddings
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T815556_Node2vec_Karateclub.html">
   Node2vec from scratch referencing Karateclub library
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T894941_Node2vec_MovieLens_Keras.html">
   Graph representation learning with node2vec
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T611050_Node2vec_PyG.html">
   Node2vec from scratch in PyTorch Geometric
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T186367_Node2vec_library.html">
   Node2vec from scratch referencing node2vec library
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T331379_bayesian_personalized_ranking.html">
   BPR from scratch
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T081831_Data_Poisoning_Attacks_on_Factorization_Based_Collaborative_Filtering.html">
   Data Poisoning Attacks on Factorization-Based Collaborative Filtering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T102448_Adversarial_Learning_for_Recommendation.html">
   Adversarial Training (Regularization) on a Recommender System
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T865035_Simulating_Data_Poisoning_Attacks_against_Twitter_Recommender.html">
   Load and process dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T711285_Data_Poisoning_Attack_using_LFM_and_ItemAE_on_Synthetic_Dataset.html">
   Injection attack using LFM and ItemAE model trained on Toy dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T355514_Black_box_Attack_on_Sequential_Recs.html">
   Black-box Attack on Sequential Recs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T873451_Statistics_fundamentals.html">
   Statictics Fundamentals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T890478_Batch_Learning_from_Bandit_Feedback_%28BLBF%29.html">
   Imports
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T257798_Off_Policy_Learning_in_Two_stage_Recommender_Systems.html">
   Off-Policy Learning in Two-stage Recommender Systems
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T471827_Adaptive_Estimator_Selection_for_Off_Policy_Evaluation.html">
   Adaptive Estimator Selection for Off-Policy Evaluation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T902666_Evaluating_the_Robustness_of_Off_Policy_Evaluation.html">
   Evaluating the Robustness of Off-Policy Evaluation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T705904_Evaluation_of_Multiple_Off_Policy_Estimators_on_Synthetic_Dataset.html">
   Evaluation of Multiple Off-Policy Estimators on Synthetic Dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T874693_Evaluating_Standard_Off_Policy_Estimators_with_Small_Sample_Open_Bandit_Dataset.html">
   Evaluating Standard Off-Policy Estimators with Small Sample Open-Bandit Dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T792262_Optimal_Off_Policy_Evaluation_from_Multiple_Logging_Policies.html">
   Optimal Off-Policy Evaluation from Multiple Logging Policies
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T167249_Offline_Policy_Evaluation_with_VW_Command_Line.html">
   Offline Policy Evaluation with VW Command Line
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T966055_OBP_Library_Workshop_Tutorials.html">
   OBP Library Workshop Tutorials
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T632722_PyTorch_Fundamentals_Part_1.html">
   PyTorch Fundamentals Part 1
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T472467_PyTorch_Fundamentals_Part_2.html">
   PyTorch Fundamentals Part 2
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T206654_PyTorch_Fundamentals_Part_3.html">
   PyTorch Fundamentals Part 3
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T536348_Attention_Mechanisms.html">
   Imports
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T500796_Agricultural_Satellite_Image_Segmentation.html">
   Agricultural Satellite Image Segmentation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T611432_Image_Analysis_with_Tensorflow.html">
   Image Analysis with Tensorflow
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T925716_MongoDB_to_CSV_Conversion.html">
   MongoDB to CSV conversion
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T396469_PDF_to_Word_Cloud_via_Email.html">
   PDF to WordCloud via Email
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T030890_Job_Scraping_and_Clustering.html">
   Job scraping and clustering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T897054_Scene_Text_Recognition.html">
   Scene Text Recognition
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T034809_Large_scale_Document_Retrieval_with_Elastic_Search.html">
   Large-scale Document Retrieval with ElasticSearch
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T467251_vowpal_wabbit_contextual_recommender.html">
   Simulating a news personalization scenario using Contextual Bandits
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T686684_similar_product_recommender.html">
   Similar Product Recommender system using Deep Learning for an online e-commerce store
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T132203_Retail_Product_Recommendations_using_Word2vec.html">
   Retail Product Recommendations using word2vec
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T501828_Recommender_Implicit_Negative_Feedback.html">
   Retail Product Recommendation with Negative Implicit Feedback
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T315965_Sequence_Aware_Recommenders_Music.html">
   Sequence Aware Recommender Systems
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T051777_image_similarity_recommendations.html">
   Similar Product Recommendations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990172_recobook_diversity_aware_book_recommender.html">
   Diversity Aware Book Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T488549_Goodreads_Diversity_Aware_Book_Recommender.html">
   Diversity Aware Book Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T023535_Kafka_MongoDB_Real_time_Streaming.html">
   Kafka MongoDB Real-time Streaming
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T622304_Session_based_Recommender_Using_Word2vec.html">
   Session-based recommendation using word2vec
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T416854_bandit_based_recommender_using_thompson_sampling_app.html">
   Bandit-based Online Learning using Thompson Sampling
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T198578_Booking_dot_com_Trip_Recommendation.html">
   Booking.com Trip Recommendation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T519734_Vowpal_Wabbit_Contextual_Bandit.html">
   Vowpal Wabbit Contextual Bandit
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T871537_Recommendation_Systems_using_Olist_Dataset.html">
   Recommendation systems using Olist dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T057885_Offline_Replayer_Evaluation.html">
   Offline Replayer Evaluation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T915054_method_for_effective_online_testing.html">
   Methods for effective online testing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T513987_Recsys_2020_Feature_Engineering_Tutorial.html">
   Recsys’20 Feature Engineering Tutorial
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T227901_amazon_personalize_batch_job.html">
   Amazon Personalize Batch Job
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T022961_Amazon_Personalize_Workshop.html">
   Amazon Personalize Workshop
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T424437_Collaborative_Filtering_on_ML_latest_small.html">
   Collaborative Filtering on ML-latest-small
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T539160_Building_and_Deploying_ASOS_Fashion_Recommender.html">
   Building and deploying ASOS fashion recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T757697_Simple_Similarity_based_Recommender.html">
   Simple Similarity based Recommmendations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T051594_Analytics_Zoo.html">
   Analytics Zoo
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   A/B Testing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T475711_PinSage_Graph_based_Recommender.html">
   PinSage Graph-based Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T516490_Graph_Embeddings.html">
   Learn Embeddings using Graph Networks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T822164_movielens_milvus_redis_efficient_retrieval.html">
   Recommender with Redis and Milvus
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T845186_Anime_Recommender.html">
   RekoNet Anime Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T855843_kafka_spark_streaming_colab.html">
   Kafka and Spark Streaming in Colab
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T460437_Building_Models_From_Scratch.html">
   Building Models from scratch
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T855971_Conet_Model_for_Movie_Recommender.html">
   CoNet model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T996996_content_based_and_collaborative_movielens.html">
   Movie Recommendation with Content-Based and Collaborative Filtering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T239418_Simple_Movie_Recommenders.html">
   Simple Movie Recommenders
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T138337_Simple_Movie_Recommender.html">
   Simple movie recommender in implicit, explicit, and cold-start settings
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T935440_The_importance_of_Rating_Normalization.html">
   The importance of Rating Normalization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T612622_cornac_examples.html">
   Cornac Examples
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T561435_Flower_Classification.html">
   Flower classification
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T680910_Trivago_Session_based_Recommender.html">
   Trivago Session-based Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_ads_selection_using_bandits.html">
   Best Ads detection using bandit methods
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_book_crossing_surprise_svd_nmf.html">
   Book-Crossing Recommendation System
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_book_recommender_kubeflow.html">
   Books recommendations with Kubeflow Pipelines on Scaleway Kapsule
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_build_a_kubeflow_pipeline.html">
   Build a Kubeflow Pipeline
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_causal_inference.html">
   Causal Inference
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_concept_embedding_nlp.html">
   Exploring Word Embeddings
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_concept_neural_net.html">
   Neural Network
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_concept_nlp_basics.html">
   Natural Language Processing 101
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_concept_transformer_lm.html">
   TransformerLM Quick Start and Guide
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_content_based_music_recommender_lyricsfreak.html">
   Content-based method for song recommendation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_evaluation_metrics_basics.html">
   Recommender System Evaluations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_implicit_synthetic.html">
   Comparing Implicit Models on Synthetic Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_movie_recommender_tensorflow.html">
   Recommendation Systems with TensorFlow
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_movie_recommender_tensorflow_sagemaker.html">
   Movie recommender using Tensorflow in Sagemaker
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_movielens_eda_modeling.html">
   Movielens EDA and Modeling
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_read_data_from_cassandra_into_pandas.html">
   Read Cassandra Data Snapshot as DataFrame
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_rl_in_action.html">
   Reinforcement Learning fundamentals in action
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_rnn_cnn_basics.html">
   Processing sequences using RNNs and CNNs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_tf_serving_in_action.html">
   TF Serving in action
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_training_indexing_movie_recommender.html">
   Training and indexing movie recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T207114_EduRec_MOOCCube_Course_Recommender.html">
   EduRec MOOCCube Course Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T273184_Multi_Task_Learning.html">
   Multi-task Learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T661108_Book_Recommender_API.html">
   Book Recommender API
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T912764_Simple_Movie_Recommender_App.html">
   Simple Movie Recommender App
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T964554_Career_Village_Questions_Recommendation.html">
   CareerVillage Questions Recommendation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_amazon_women_apparel_tfidf_word2vec.html">
   Amazon Product Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_anime_recommender_graph_network.html">
   Anime Recommender with Bi-partite Graph Network
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_concept_self_attention.html">
   Self-Attention
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_course_recommender_svd_flask.html">
   Course Recommender with SVD based similarity
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_data_mining_similarity_measures.html">
   Concept - Data Mining Similarity Measures
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_jaccard_recommender.html">
   Jaccard Similarity based Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_live_streamer_recommender.html">
   Live Streamer Recommender with Implicit feedback
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_songs_embedding_skipgram_recommender.html">
   Song Embeddings - Skipgram Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_toy_example_car_recommender_knn.html">
   Toy example - Car Recommender using KNN method
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_wikirecs_recommender.html">
   WikiRecs
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/nbs/T313645_A_B_Testing.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/sparsh-ai/reco-book/main?urlpath=tree/nbs/T313645_A_B_Testing.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-b-test-in-five-simple-steps">
   A/B Test in five simple steps
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#outline-for-a-b-tests">
     Outline for A/B Tests
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#stats">
       Stats
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#plot-utils">
       Plot utils
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#set-up-the-experiment">
     1. Set Up The Experiment
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#baseline-conversion-rate-and-lift">
       Baseline Conversion Rate and Lift
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#control-group-a-and-test-group-b">
       Control Group (A) and Test Group (B)
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#run-the-test">
     2. Run the Test
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#compare-the-two-groups">
     3. Compare the Two Groups
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#binomial-distribution">
       Binomial distribution
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#compare-the-null-hypothesis-vs-the-alternative-hypothesis">
       Compare the Null Hypothesis vs. the Alternative Hypothesis
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#statistical-power-and-significance-level">
     4. Statistical Power and Significance Level
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sample-size">
     5. Sample Size
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ad-conversion-a-b-testing">
   Ad-conversion A-B Testing
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ab-testing-with-python">
   AB Testing With Python
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#udacity-s-a-b-testing-course-a-class-anchor-id-about-a">
     1 Udacity’s A/B Testing Course
     <a class="anchor" id="about">
     </a>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#experiment-overview-a-class-anchor-id-overview-a">
     2 Experiment Overview
     <a class="anchor" id="overview">
     </a>
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#current-conditions-before-change-a-class-anchor-id-current-a">
       2.1 Current Conditions Before Change
       <a class="anchor" id="current">
       </a>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#description-of-experimented-change-a-class-anchor-id-description-a">
       2.2 Description of Experimented Change
       <a class="anchor" id="description">
       </a>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#experiment-hypothesis-a-class-anchor-id-hypothesis-a">
       2.3 Experiment Hypothesis
       <a class="anchor" id="hypothesis">
       </a>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#experiment-details-a-class-anchor-id-details-a">
       2.4 Experiment Details
       <a class="anchor" id="details">
       </a>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#metric-choice-a-class-anchor-id-metric-a">
     3 Metric Choice
     <a class="anchor" id="metric">
     </a>
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#invariate-metrics-sanity-checks-a-class-anchor-id-invariate-a">
       3.1 Invariate Metrics - Sanity Checks
       <a class="anchor" id="invariate">
       </a>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#evaluation-metrics-performance-indicators-a-class-anchor-id-evaluation-a">
       3.2 Evaluation Metrics - Performance Indicators
       <a class="anchor" id="evaluation">
       </a>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#estimating-the-baseline-values-of-metrics-a-class-anchor-id-baseline-a">
     4 Estimating the baseline values of metrics
     <a class="anchor" id="baseline">
     </a>
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#collecting-estimators-data-a-class-anchor-id-collect-a">
       4.1 Collecting estimators data
       <a class="anchor" id="collect">
       </a>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#estimating-standard-deviation-a-class-anchor-id-sd-a">
       4.2 Estimating Standard Deviation
       <a class="anchor" id="sd">
       </a>
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#scaling-collected-data-a-class-anchor-id-scale-a">
         4.2.1 Scaling Collected Data
         <a class="anchor" id="scale">
         </a>
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#estimating-analytically-a-class-anchor-id-estimate-a">
         4.2.2 Estimating Analytically
         <a class="anchor" id="estimate">
         </a>
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#experiment-sizing-a-class-anchor-id-sizing-a">
     5 Experiment Sizing
     <a class="anchor" id="sizing">
     </a>
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#get-z-score-critical-value-and-standard-deviations-a-class-anchor-id-side-methods-a">
       5.1 Get z-score critical value and Standard Deviations
       <a class="anchor" id="side_methods">
       </a>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#calculate-sample-size-per-metric-a-class-anchor-id-calc-a">
       5.2 Calculate Sample Size per Metric
       <a class="anchor" id="calc">
       </a>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#analyzing-collected-data-a-class-anchor-id-analysis-a">
     6 Analyzing Collected Data
     <a class="anchor" id="analysis">
     </a>
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#loading-collected-data-a-class-anchor-id-collect-results-a">
       6.1 Loading collected data
       <a class="anchor" id="collect_results">
       </a>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#sanity-checks-a-class-anchor-id-sanity-a">
       6.2 Sanity Checks
       <a class="anchor" id="sanity">
       </a>
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#sanity-checks-for-differences-between-counts-a-class-anchor-id-check-counts-a">
         6.2.1 Sanity Checks for differences between counts
         <a class="anchor" id="check_counts">
         </a>
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#sanity-checks-for-differences-between-probabilities-a-class-anchor-id-check-prob-a">
         6.2.2 Sanity Checks for differences between probabilities
         <a class="anchor" id="check_prob">
         </a>
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#examining-effect-size-a-class-anchor-id-effect-a">
       6.3 Examining effect size
       <a class="anchor" id="effect">
       </a>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#double-check-with-sign-tests-a-class-anchor-id-sign-tests-a">
     6.4 Double check with Sign Tests
     <a class="anchor" id="sign_tests">
     </a>
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#data-preparation-a-class-anchor-id-prep-a">
       6.4.1 Data Preparation
       <a class="anchor" id="prep">
       </a>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#building-a-sign-test-a-class-anchor-id-sign-a">
       6.4.2 Building a Sign Test
       <a class="anchor" id="sign">
       </a>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#conclusions-recommendations-a-class-anchor-id-conclusions-a">
     7 Conclusions &amp; Recommendations
     <a class="anchor" id="conclusions">
     </a>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-b-testing-step-by-step-guide-in-python">
   A/B testing step-by-step guide in Python
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#designing-our-experiment">
     1. Designing our experiment
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#formulating-a-hypothesis">
       Formulating a hypothesis
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#choosing-the-variables">
       Choosing the variables
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#choosing-a-sample-size">
       Choosing a sample size
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#collecting-and-preparing-the-data">
     2. Collecting and preparing the data
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#sampling">
       Sampling
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#visualising-the-results">
     3. Visualising the results
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#testing-the-hypothesis">
     4. Testing the hypothesis
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#drawing-conclusions">
     5. Drawing conclusions
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="a-b-testing">
<h1>A/B Testing<a class="headerlink" href="#a-b-testing" title="Permalink to this headline">¶</a></h1>
<div class="section" id="a-b-test-in-five-simple-steps">
<h2>A/B Test in five simple steps<a class="headerlink" href="#a-b-test-in-five-simple-steps" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>A/B test and plots with explanations to understand the basics</p>
</div></blockquote>
<div class="section" id="outline-for-a-b-tests">
<h3>Outline for A/B Tests<a class="headerlink" href="#outline-for-a-b-tests" title="Permalink to this headline">¶</a></h3>
<ol class="simple">
<li><p>Set up the experiment.</p></li>
<li><p>Run the test and record the success rate for each group.</p></li>
<li><p>Plot the distribution of the difference between the two samples.</p></li>
<li><p>Calculate the statistical power.</p></li>
<li><p>Evaluate how sample size affects A/B tests.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">scs</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;ggplot&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="stats">
<h4>Stats<a class="headerlink" href="#stats" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">pooled_prob</span><span class="p">(</span><span class="n">N_A</span><span class="p">,</span> <span class="n">N_B</span><span class="p">,</span> <span class="n">X_A</span><span class="p">,</span> <span class="n">X_B</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns pooled probability for two samples&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">X_A</span> <span class="o">+</span> <span class="n">X_B</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">N_A</span> <span class="o">+</span> <span class="n">N_B</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">pooled_SE</span><span class="p">(</span><span class="n">N_A</span><span class="p">,</span> <span class="n">N_B</span><span class="p">,</span> <span class="n">X_A</span><span class="p">,</span> <span class="n">X_B</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the pooled standard error for two samples&quot;&quot;&quot;</span>
    <span class="n">p_hat</span> <span class="o">=</span> <span class="n">pooled_prob</span><span class="p">(</span><span class="n">N_A</span><span class="p">,</span> <span class="n">N_B</span><span class="p">,</span> <span class="n">X_A</span><span class="p">,</span> <span class="n">X_B</span><span class="p">)</span>
    <span class="n">SE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">p_hat</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p_hat</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">N_A</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">N_B</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">SE</span>


<span class="k">def</span> <span class="nf">confidence_interval</span><span class="p">(</span><span class="n">sample_mean</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sample_std</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sample_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">sig_level</span><span class="o">=</span><span class="mf">0.05</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the confidence interval as a tuple&quot;&quot;&quot;</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">z_val</span><span class="p">(</span><span class="n">sig_level</span><span class="p">)</span>

    <span class="n">left</span> <span class="o">=</span> <span class="n">sample_mean</span> <span class="o">-</span> <span class="n">z</span> <span class="o">*</span> <span class="n">sample_std</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sample_size</span><span class="p">)</span>
    <span class="n">right</span> <span class="o">=</span> <span class="n">sample_mean</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="n">sample_std</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sample_size</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">z_val</span><span class="p">(</span><span class="n">sig_level</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">two_tailed</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the z value for a given significance level&quot;&quot;&quot;</span>
    <span class="n">z_dist</span> <span class="o">=</span> <span class="n">scs</span><span class="o">.</span><span class="n">norm</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">two_tailed</span><span class="p">:</span>
        <span class="n">sig_level</span> <span class="o">=</span> <span class="n">sig_level</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">area</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">sig_level</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">area</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">sig_level</span>

    <span class="n">z</span> <span class="o">=</span> <span class="n">z_dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">area</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">z</span>


<span class="k">def</span> <span class="nf">ab_dist</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="n">d_hat</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">group_type</span><span class="o">=</span><span class="s1">&#39;control&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns a distribution object depending on group type</span>
<span class="sd">    Examples:</span>
<span class="sd">    Parameters:</span>
<span class="sd">        stderr (float): pooled standard error of two independent samples</span>
<span class="sd">        d_hat (float): the mean difference between two independent samples</span>
<span class="sd">        group_type (string): &#39;control&#39; and &#39;test&#39; are supported</span>
<span class="sd">    Returns:</span>
<span class="sd">        dist (scipy.stats distribution object)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">group_type</span> <span class="o">==</span> <span class="s1">&#39;control&#39;</span><span class="p">:</span>
        <span class="n">sample_mean</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">elif</span> <span class="n">group_type</span> <span class="o">==</span> <span class="s1">&#39;test&#39;</span><span class="p">:</span>
        <span class="n">sample_mean</span> <span class="o">=</span> <span class="n">d_hat</span>

    <span class="c1"># create a normal distribution which is dependent on mean and std dev</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="n">scs</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">sample_mean</span><span class="p">,</span> <span class="n">stderr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dist</span>


<span class="k">def</span> <span class="nf">min_sample_size</span><span class="p">(</span><span class="n">bcr</span><span class="p">,</span> <span class="n">mde</span><span class="p">,</span> <span class="n">power</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">sig_level</span><span class="o">=</span><span class="mf">0.05</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the minimum sample size to set up a split test</span>
<span class="sd">    Arguments:</span>
<span class="sd">        bcr (float): probability of success for control, sometimes</span>
<span class="sd">        referred to as baseline conversion rate</span>
<span class="sd">        mde (float): minimum change in measurement between control</span>
<span class="sd">        group and test group if alternative hypothesis is true, sometimes</span>
<span class="sd">        referred to as minimum detectable effect</span>
<span class="sd">        power (float): probability of rejecting the null hypothesis when the</span>
<span class="sd">        null hypothesis is false, typically 0.8</span>
<span class="sd">        sig_level (float): significance level often denoted as alpha,</span>
<span class="sd">        typically 0.05</span>
<span class="sd">    Returns:</span>
<span class="sd">        min_N: minimum sample size (float)</span>
<span class="sd">    References:</span>
<span class="sd">        Stanford lecture on sample sizes</span>
<span class="sd">        http://statweb.stanford.edu/~susan/courses/s141/hopower.pdf</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># standard normal distribution to determine z-values</span>
    <span class="n">standard_norm</span> <span class="o">=</span> <span class="n">scs</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># find Z_beta from desired power</span>
    <span class="n">Z_beta</span> <span class="o">=</span> <span class="n">standard_norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">power</span><span class="p">)</span>

    <span class="c1"># find Z_alpha</span>
    <span class="n">Z_alpha</span> <span class="o">=</span> <span class="n">standard_norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">sig_level</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># average of probabilities from both groups</span>
    <span class="n">pooled_prob</span> <span class="o">=</span> <span class="p">(</span><span class="n">bcr</span> <span class="o">+</span> <span class="n">bcr</span><span class="o">+</span><span class="n">mde</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="n">min_N</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">pooled_prob</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">pooled_prob</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">Z_beta</span> <span class="o">+</span> <span class="n">Z_alpha</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
             <span class="o">/</span> <span class="n">mde</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">min_N</span>


<span class="k">def</span> <span class="nf">p_val</span><span class="p">(</span><span class="n">N_A</span><span class="p">,</span> <span class="n">N_B</span><span class="p">,</span> <span class="n">p_A</span><span class="p">,</span> <span class="n">p_B</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the p-value for an A/B test&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">scs</span><span class="o">.</span><span class="n">binom</span><span class="p">(</span><span class="n">N_A</span><span class="p">,</span> <span class="n">p_A</span><span class="p">)</span><span class="o">.</span><span class="n">pmf</span><span class="p">(</span><span class="n">p_B</span> <span class="o">*</span> <span class="n">N_B</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="plot-utils">
<h4>Plot utils<a class="headerlink" href="#plot-utils" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_norm_dist</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">std</span><span class="p">,</span> <span class="n">with_CI</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sig_level</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Adds a normal distribution to the axes provided</span>
<span class="sd">    Example:</span>
<span class="sd">        plot_norm_dist(ax, 0, 1)  # plots a standard normal distribution</span>
<span class="sd">    Parameters:</span>
<span class="sd">        ax (matplotlib axes)</span>
<span class="sd">        mu (float): mean of the normal distribution</span>
<span class="sd">        std (float): standard deviation of the normal distribution</span>
<span class="sd">    Returns:</span>
<span class="sd">        None: the function adds a plot to the axes object provided</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">mu</span> <span class="o">-</span> <span class="mi">12</span> <span class="o">*</span> <span class="n">std</span><span class="p">,</span> <span class="n">mu</span> <span class="o">+</span> <span class="mi">12</span> <span class="o">*</span> <span class="n">std</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">scs</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">std</span><span class="p">)</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">with_CI</span><span class="p">:</span>
        <span class="n">plot_CI</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">std</span><span class="p">,</span> <span class="n">sig_level</span><span class="o">=</span><span class="n">sig_level</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_binom_dist</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Adds a binomial distribution to the axes provided</span>
<span class="sd">    Example:</span>
<span class="sd">        plot_binom_dist(ax, 0, 1)  # plots a standard normal distribution</span>
<span class="sd">    Parameters:</span>
<span class="sd">        ax (matplotlib axes)</span>
<span class="sd">        mu (float): mean of the normal distribution</span>
<span class="sd">        sig (float): standard deviation of the normal distribution</span>
<span class="sd">    Returns:</span>
<span class="sd">        None: the function adds a plot to the axes object provided</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">scs</span><span class="o">.</span><span class="n">binom</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">pmf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_CI</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">sig_level</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Calculates the two-tailed confidence interval and adds the plot to</span>
<span class="sd">    an axes object.</span>
<span class="sd">    Example:</span>
<span class="sd">        plot_CI(ax, mu=0, s=stderr, sig_level=0.05)</span>
<span class="sd">    Parameters:</span>
<span class="sd">        ax (matplotlib axes)</span>
<span class="sd">        mu (float): mean</span>
<span class="sd">        s (float): standard deviation</span>
<span class="sd">    Returns:</span>
<span class="sd">        None: the function adds a plot to the axes object provided</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">confidence_interval</span><span class="p">(</span><span class="n">sample_mean</span><span class="o">=</span><span class="n">mu</span><span class="p">,</span> <span class="n">sample_std</span><span class="o">=</span><span class="n">s</span><span class="p">,</span>
                                      <span class="n">sig_level</span><span class="o">=</span><span class="n">sig_level</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">right</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_null</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">stderr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plots the null hypothesis distribution where if there is no real change,</span>
<span class="sd">    the distribution of the differences between the test and the control groups</span>
<span class="sd">    will be normally distributed.</span>
<span class="sd">    The confidence band is also plotted.</span>
<span class="sd">    Example:</span>
<span class="sd">        plot_null(ax, stderr)</span>
<span class="sd">    Parameters:</span>
<span class="sd">        ax (matplotlib axes)</span>
<span class="sd">        stderr (float): the pooled standard error of the control and test group</span>
<span class="sd">    Returns:</span>
<span class="sd">        None: the function adds a plot to the axes object provided</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">plot_norm_dist</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">stderr</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Null&quot;</span><span class="p">)</span>
    <span class="n">plot_CI</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">stderr</span><span class="p">,</span> <span class="n">sig_level</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_alt</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">stderr</span><span class="p">,</span> <span class="n">d_hat</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plots the alternative hypothesis distribution where if there is a real</span>
<span class="sd">    change, the distribution of the differences between the test and the</span>
<span class="sd">    control groups will be normally distributed and centered around d_hat</span>
<span class="sd">    The confidence band is also plotted.</span>
<span class="sd">    Example:</span>
<span class="sd">        plot_alt(ax, stderr, d_hat=0.025)</span>
<span class="sd">    Parameters:</span>
<span class="sd">        ax (matplotlib axes)</span>
<span class="sd">        stderr (float): the pooled standard error of the control and test group</span>
<span class="sd">    Returns:</span>
<span class="sd">        None: the function adds a plot to the axes object provided</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">plot_norm_dist</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">d_hat</span><span class="p">,</span> <span class="n">stderr</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Alternative&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">abplot</span><span class="p">(</span><span class="n">N_A</span><span class="p">,</span> <span class="n">N_B</span><span class="p">,</span> <span class="n">bcr</span><span class="p">,</span> <span class="n">d_hat</span><span class="p">,</span> <span class="n">sig_level</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">show_power</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
           <span class="n">show_alpha</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_beta</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_p_value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
           <span class="n">show_legend</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Example plot of AB test</span>
<span class="sd">    Example:</span>
<span class="sd">        abplot(n=4000, bcr=0.11, d_hat=0.03)</span>
<span class="sd">    Parameters:</span>
<span class="sd">        n (int): total sample size for both control and test groups (N_A + N_B)</span>
<span class="sd">        bcr (float): base conversion rate; conversion rate of control</span>
<span class="sd">        d_hat: difference in conversion rate between the control and test</span>
<span class="sd">            groups, sometimes referred to as **minimal detectable effect** when</span>
<span class="sd">            calculating minimum sample size or **lift** when discussing</span>
<span class="sd">            positive improvement desired from launching a change.</span>
<span class="sd">    Returns:</span>
<span class="sd">        None: the function plots an AB test as two distributions for</span>
<span class="sd">        visualization purposes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># create a plot object</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

    <span class="c1"># define parameters to find pooled standard error</span>
    <span class="n">X_A</span> <span class="o">=</span> <span class="n">bcr</span> <span class="o">*</span> <span class="n">N_A</span>
    <span class="n">X_B</span> <span class="o">=</span> <span class="p">(</span><span class="n">bcr</span> <span class="o">+</span> <span class="n">d_hat</span><span class="p">)</span> <span class="o">*</span> <span class="n">N_B</span>
    <span class="n">stderr</span> <span class="o">=</span> <span class="n">pooled_SE</span><span class="p">(</span><span class="n">N_A</span><span class="p">,</span> <span class="n">N_B</span><span class="p">,</span> <span class="n">X_A</span><span class="p">,</span> <span class="n">X_B</span><span class="p">)</span>

    <span class="c1"># plot the distribution of the null and alternative hypothesis</span>
    <span class="n">plot_null</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">stderr</span><span class="p">)</span>
    <span class="n">plot_alt</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">stderr</span><span class="p">,</span> <span class="n">d_hat</span><span class="p">)</span>

    <span class="c1"># set extent of plot area</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">8</span> <span class="o">*</span> <span class="n">stderr</span><span class="p">,</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">stderr</span><span class="p">)</span>

    <span class="c1"># shade areas according to user input</span>
    <span class="k">if</span> <span class="n">show_power</span><span class="p">:</span>
        <span class="n">show_area</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">d_hat</span><span class="p">,</span> <span class="n">stderr</span><span class="p">,</span> <span class="n">sig_level</span><span class="p">,</span> <span class="n">area_type</span><span class="o">=</span><span class="s1">&#39;power&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">show_alpha</span><span class="p">:</span>
        <span class="n">show_area</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">d_hat</span><span class="p">,</span> <span class="n">stderr</span><span class="p">,</span> <span class="n">sig_level</span><span class="p">,</span> <span class="n">area_type</span><span class="o">=</span><span class="s1">&#39;alpha&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">show_beta</span><span class="p">:</span>
        <span class="n">show_area</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">d_hat</span><span class="p">,</span> <span class="n">stderr</span><span class="p">,</span> <span class="n">sig_level</span><span class="p">,</span> <span class="n">area_type</span><span class="o">=</span><span class="s1">&#39;beta&#39;</span><span class="p">)</span>

    <span class="c1"># show p_value based on the binomial distributions for the two groups</span>
    <span class="k">if</span> <span class="n">show_p_value</span><span class="p">:</span>
        <span class="n">null</span> <span class="o">=</span> <span class="n">ab_dist</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s1">&#39;control&#39;</span><span class="p">)</span>
        <span class="n">p_value</span> <span class="o">=</span> <span class="n">p_val</span><span class="p">(</span><span class="n">N_A</span><span class="p">,</span> <span class="n">N_B</span><span class="p">,</span> <span class="n">bcr</span><span class="p">,</span> <span class="n">bcr</span><span class="o">+</span><span class="n">d_hat</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">stderr</span><span class="p">,</span> <span class="n">null</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
                <span class="s1">&#39;p-value = </span><span class="si">{0:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p_value</span><span class="p">),</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>

    <span class="c1"># option to show legend</span>
    <span class="k">if</span> <span class="n">show_legend</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;PDF&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">show_area</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">d_hat</span><span class="p">,</span> <span class="n">stderr</span><span class="p">,</span> <span class="n">sig_level</span><span class="p">,</span> <span class="n">area_type</span><span class="o">=</span><span class="s1">&#39;power&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Fill between upper significance boundary and distribution for</span>
<span class="sd">    alternative hypothesis</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">confidence_interval</span><span class="p">(</span><span class="n">sample_mean</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sample_std</span><span class="o">=</span><span class="n">stderr</span><span class="p">,</span>
                                      <span class="n">sig_level</span><span class="o">=</span><span class="n">sig_level</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">12</span> <span class="o">*</span> <span class="n">stderr</span><span class="p">,</span> <span class="mi">12</span> <span class="o">*</span> <span class="n">stderr</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="n">null</span> <span class="o">=</span> <span class="n">ab_dist</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="s1">&#39;control&#39;</span><span class="p">)</span>
    <span class="n">alternative</span> <span class="o">=</span> <span class="n">ab_dist</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="n">d_hat</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">)</span>

    <span class="c1"># if area_type is power</span>
    <span class="c1"># Fill between upper significance boundary and distribution for alternative</span>
    <span class="c1"># hypothesis</span>
    <span class="k">if</span> <span class="n">area_type</span> <span class="o">==</span> <span class="s1">&#39;power&#39;</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">alternative</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
                        <span class="n">where</span><span class="o">=</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">right</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span> <span class="o">*</span> <span class="n">stderr</span><span class="p">,</span> <span class="n">null</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
                <span class="s1">&#39;power = </span><span class="si">{0:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alternative</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">right</span><span class="p">)),</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

    <span class="c1"># if area_type is alpha</span>
    <span class="c1"># Fill between upper significance boundary and distribution for null</span>
    <span class="c1"># hypothesis</span>
    <span class="k">if</span> <span class="n">area_type</span> <span class="o">==</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">null</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
                        <span class="n">where</span><span class="o">=</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">right</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span> <span class="o">*</span> <span class="n">stderr</span><span class="p">,</span> <span class="n">null</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
                <span class="s1">&#39;alpha = </span><span class="si">{0:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">null</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">right</span><span class="p">)),</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

    <span class="c1"># if area_type is beta</span>
    <span class="c1"># Fill between distribution for alternative hypothesis and upper</span>
    <span class="c1"># significance boundary</span>
    <span class="k">if</span> <span class="n">area_type</span> <span class="o">==</span> <span class="s1">&#39;beta&#39;</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">alternative</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
                        <span class="n">where</span><span class="o">=</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">right</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span> <span class="o">*</span> <span class="n">stderr</span><span class="p">,</span> <span class="n">null</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
                <span class="s1">&#39;beta = </span><span class="si">{0:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">alternative</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">right</span><span class="p">)),</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">zplot</span><span class="p">(</span><span class="n">area</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">two_tailed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">align_right</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plots a z distribution with common annotations</span>
<span class="sd">    Example:</span>
<span class="sd">        zplot(area=0.95)</span>
<span class="sd">        zplot(area=0.80, two_tailed=False, align_right=True)</span>
<span class="sd">    Parameters:</span>
<span class="sd">        area (float): The area under the standard normal distribution curve.</span>
<span class="sd">        align (str): The area under the curve can be aligned to the center</span>
<span class="sd">            (default) or to the left.</span>
<span class="sd">    Returns:</span>
<span class="sd">        None: A plot of the normal distribution with annotations showing the</span>
<span class="sd">        area under the curve and the boundaries of the area.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># create plot object</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="c1"># create normal distribution</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="n">scs</span><span class="o">.</span><span class="n">norm</span><span class="p">()</span>
    <span class="c1"># create data points to plot</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="c1"># code to fill areas</span>
    <span class="c1"># for two-tailed tests</span>
    <span class="k">if</span> <span class="n">two_tailed</span><span class="p">:</span>
        <span class="n">left</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">-</span> <span class="n">area</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">right</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">+</span> <span class="n">area</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">right</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">right</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">left</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
                        <span class="n">where</span><span class="o">=</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">left</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">right</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;PDF&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">left</span><span class="p">),</span> <span class="s2">&quot;z = </span><span class="si">{0:.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">left</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                 <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">right</span><span class="p">,</span> <span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">right</span><span class="p">),</span> <span class="s2">&quot;z = </span><span class="si">{0:.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">right</span><span class="p">),</span>
                 <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
    <span class="c1"># for one-tailed tests</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># align the area to the right</span>
        <span class="k">if</span> <span class="n">align_right</span><span class="p">:</span>
            <span class="n">left</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">area</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">left</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
                            <span class="n">where</span><span class="o">=</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">left</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">left</span><span class="p">),</span> <span class="s2">&quot;z = </span><span class="si">{0:.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">left</span><span class="p">),</span>
                     <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>
        <span class="c1"># align the area to the left</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">right</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">area</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">right</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">right</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
                            <span class="n">where</span><span class="o">=</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">right</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">right</span><span class="p">,</span> <span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">right</span><span class="p">),</span> <span class="s2">&quot;z = </span><span class="si">{0:.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">right</span><span class="p">),</span>
                     <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>

    <span class="c1"># annotate the shaded area</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s2">&quot;shaded area = </span><span class="si">{0:.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">area</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
             <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
    <span class="c1"># axis labels</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;PDF&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">abplot_CI_bars</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">sig_level</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">dmin</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns a confidence interval bar plot for multivariate tests</span>
<span class="sd">    Parameters:</span>
<span class="sd">        N (list or tuple): sample size for all groups</span>
<span class="sd">        X (list or tuple): number of conversions for each variant</span>
<span class="sd">        sig_level (float): significance level</span>
<span class="sd">        dmin (float): minimum desired lift; a red and green dashed lines are</span>
<span class="sd">            shown on the plot if dmin is provided.</span>
<span class="sd">    Returns:</span>
<span class="sd">        None: A plot of the confidence interval bars is returned inline.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># initiate plot object</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

    <span class="c1"># get control group values</span>
    <span class="n">N_A</span> <span class="o">=</span> <span class="n">N</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">X_A</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># initiate containers for standard error and differences</span>
    <span class="n">SE</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># iterate through X and N and calculate d and SE</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">N</span><span class="p">)):</span>
        <span class="n">X_B</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">N_B</span> <span class="o">=</span> <span class="n">N</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">X_B</span> <span class="o">/</span> <span class="n">N_B</span> <span class="o">-</span> <span class="n">X_A</span> <span class="o">/</span> <span class="n">N_A</span><span class="p">)</span>
        <span class="n">SE</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pooled_SE</span><span class="p">(</span><span class="n">N_A</span><span class="p">,</span> <span class="n">N_B</span><span class="p">,</span> <span class="n">X_A</span><span class="p">,</span> <span class="n">X_B</span><span class="p">))</span>

    <span class="c1"># convert to numpy arrays</span>
    <span class="n">SE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">SE</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># get z value</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">z_val</span><span class="p">(</span><span class="n">sig_level</span><span class="p">)</span>
    <span class="c1"># confidence interval values</span>
    <span class="n">ci</span> <span class="o">=</span> <span class="n">SE</span> <span class="o">*</span> <span class="n">z</span>

    <span class="c1"># bar to represent the confidence interval</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">d</span><span class="o">-</span><span class="n">ci</span><span class="p">,</span> <span class="n">d</span><span class="o">+</span><span class="n">ci</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.35</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># marker for the mean</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;magenta&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># vertical line to represent 0</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>

    <span class="c1"># plot veritcal dashed lines if dmin is provided</span>
    <span class="k">if</span> <span class="n">dmin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="o">-</span><span class="n">dmin</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">dmin</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>

    <span class="c1"># invert y axis to show variant 1 at the top</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
    <span class="c1"># label variants on y axis</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;variant</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">labels</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">funnel_CI_plot</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">sig_level</span><span class="o">=</span><span class="mf">0.05</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns a confidence interval bar plot for multivariate tests</span>
<span class="sd">    Parameters:</span>
<span class="sd">        A (list of tuples): (sample size, conversions) for control group funnel</span>
<span class="sd">        B (list of tuples): (sample size, conversions) for test group funnel</span>
<span class="sd">        sig_level (float): significance level</span>
<span class="sd">    Returns:</span>
<span class="sd">        None: A plot of the confidence interval bars is returned inline.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># initiate plot object</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

    <span class="c1"># initiate containers for standard error and differences</span>
    <span class="n">SE</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># iterate through X and N and calculate d and SE</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">)):</span>
        <span class="n">X_A</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">N_A</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">X_B</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">N_B</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">X_B</span> <span class="o">/</span> <span class="n">N_B</span> <span class="o">-</span> <span class="n">X_A</span> <span class="o">/</span> <span class="n">N_A</span><span class="p">)</span>
        <span class="n">SE</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pooled_SE</span><span class="p">(</span><span class="n">N_A</span><span class="p">,</span> <span class="n">N_B</span><span class="p">,</span> <span class="n">X_A</span><span class="p">,</span> <span class="n">X_B</span><span class="p">))</span>

    <span class="c1"># convert to numpy arrays</span>
    <span class="n">SE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">SE</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">))</span>

    <span class="c1"># get z value</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">z_val</span><span class="p">(</span><span class="n">sig_level</span><span class="p">)</span>
    <span class="c1"># confidence interval values</span>
    <span class="n">ci</span> <span class="o">=</span> <span class="n">SE</span> <span class="o">*</span> <span class="n">z</span>

    <span class="c1"># bar to represent the confidence interval</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">d</span><span class="o">-</span><span class="n">ci</span><span class="p">,</span> <span class="n">d</span><span class="o">+</span><span class="n">ci</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.35</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># marker for the mean</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;magenta&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># vertical line to represent 0</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>

    <span class="c1"># invert y axis to show variant 1 at the top</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
    <span class="c1"># label variants on y axis</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;metric</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">))]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">)),</span> <span class="n">labels</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="set-up-the-experiment">
<h3>1. Set Up The Experiment<a class="headerlink" href="#set-up-the-experiment" title="Permalink to this headline">¶</a></h3>
<p>We will run an A/B test for a hypothetical company that is trying to increase the amount of users that sign up for a premium account. The goal of running an A/B test is to evaluate if a change in a website will lead to improved performance in a specific metric. You may decide to test very simple alternatives such as changing the look of a single button on a webpage or testing different layouts and headlines. You could also run an A/B test on multi-step processes which may have many differences. Examples of this include the steps required in signing up a new user or processing the sale on an online marketplace. A/B testing is a huge subject and there are many techniques and rules on setting up an experiment.</p>
<div class="section" id="baseline-conversion-rate-and-lift">
<h4>Baseline Conversion Rate and Lift<a class="headerlink" href="#baseline-conversion-rate-and-lift" title="Permalink to this headline">¶</a></h4>
<p>Before running the test, we will know the baseline conversion rate and the desired lift or increase in signups that we would like to test. The baseline conversion rate is the current rate at which we sign up new users under the existing design. For our example, we want to use our test to confirm that the changes we make to our signup process will result in at least a 2% increase in our sign up rate. We currently sign up 10 out of 100 users who are offered a premium account.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># code examples presented in Python</span>
<span class="n">bcr</span> <span class="o">=</span> <span class="mf">0.10</span>  <span class="c1"># baseline conversion rate</span>
<span class="n">d_hat</span> <span class="o">=</span> <span class="mf">0.02</span>  <span class="c1"># difference between the groups</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="control-group-a-and-test-group-b">
<h4>Control Group (A) and Test Group (B)<a class="headerlink" href="#control-group-a-and-test-group-b" title="Permalink to this headline">¶</a></h4>
<p>Typically, the total number of users participating in the A/B test make up a small percentage of the total amount of users. Users are randomly selected and assigned to either a control group or a test group. The sample size that you decide on will determine how long you might have to wait until you have collected enough. For example, websites with large audiences may be able to collect enough data very quickly, while other websites may have to wait a number of weeks. There are some events that happen rarely even for high-traffic websites, so determining the necessary sample size will inform how soon you can assess your experiment and move on to improving other metrics.</p>
<p>Initially, we will collect 1000 users for each group and serve the current signup page to the control group and a new signup page to the test group.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># A is control; B is test</span>
<span class="n">N_A</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">N_B</span> <span class="o">=</span> <span class="mi">1000</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="run-the-test">
<h3>2. Run the Test<a class="headerlink" href="#run-the-test" title="Permalink to this headline">¶</a></h3>
<p>Because this is a hypothetical example, we will need “fake” data to work on. We will use a function that will generate data for our simulation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">generate_data</span><span class="p">(</span><span class="n">N_A</span><span class="p">,</span> <span class="n">N_B</span><span class="p">,</span> <span class="n">p_A</span><span class="p">,</span> <span class="n">p_B</span><span class="p">,</span> <span class="n">days</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">control_label</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span>
                  <span class="n">test_label</span><span class="o">=</span><span class="s1">&#39;B&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns a pandas dataframe with fake CTR data</span>
<span class="sd">    Example:</span>
<span class="sd">    Parameters:</span>
<span class="sd">        N_A (int): sample size for control group</span>
<span class="sd">        N_B (int): sample size for test group</span>
<span class="sd">            Note: final sample size may not match N_A provided because the</span>
<span class="sd">            group at each row is chosen at random (50/50).</span>
<span class="sd">        p_A (float): conversion rate; conversion rate of control group</span>
<span class="sd">        p_B (float): conversion rate; conversion rate of test group</span>
<span class="sd">        days (int): optional; if provided, a column for &#39;ts&#39; will be included</span>
<span class="sd">            to divide the data in chunks of time</span>
<span class="sd">            Note: overflow data will be included in an extra day</span>
<span class="sd">        control_label (str)</span>
<span class="sd">        test_label (str)</span>
<span class="sd">    Returns:</span>
<span class="sd">        df (df)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># initiate empty container</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># total amount of rows in the data</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">N_A</span> <span class="o">+</span> <span class="n">N_B</span>

    <span class="c1"># distribute events based on proportion of group size</span>
    <span class="n">group_bern</span> <span class="o">=</span> <span class="n">scs</span><span class="o">.</span><span class="n">bernoulli</span><span class="p">(</span><span class="n">N_A</span> <span class="o">/</span> <span class="p">(</span><span class="n">N_A</span> <span class="o">+</span> <span class="n">N_B</span><span class="p">))</span>

    <span class="c1"># initiate bernoulli distributions from which to randomly sample</span>
    <span class="n">A_bern</span> <span class="o">=</span> <span class="n">scs</span><span class="o">.</span><span class="n">bernoulli</span><span class="p">(</span><span class="n">p_A</span><span class="p">)</span>
    <span class="n">B_bern</span> <span class="o">=</span> <span class="n">scs</span><span class="o">.</span><span class="n">bernoulli</span><span class="p">(</span><span class="n">p_B</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="c1"># initite empty row</span>
        <span class="n">row</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># for &#39;ts&#39; column</span>
        <span class="k">if</span> <span class="n">days</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">days</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
                <span class="n">row</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">//</span> <span class="p">(</span><span class="n">N</span> <span class="o">//</span> <span class="n">days</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Provide an integer for the days parameter.&quot;</span><span class="p">)</span>
        <span class="c1"># assign group based on 50/50 probability</span>
        <span class="n">row</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">group_bern</span><span class="o">.</span><span class="n">rvs</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># assign conversion based on provided parameters</span>
            <span class="n">row</span><span class="p">[</span><span class="s1">&#39;converted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">A_bern</span><span class="o">.</span><span class="n">rvs</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">row</span><span class="p">[</span><span class="s1">&#39;converted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">B_bern</span><span class="o">.</span><span class="n">rvs</span><span class="p">()</span>
        <span class="c1"># collect row into data container</span>
        <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

    <span class="c1"># convert data into pandas dataframe</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># transform group labels of 0s and 1s to user-defined group labels</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">control_label</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">test_label</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ab_data</span> <span class="o">=</span> <span class="n">generate_data</span><span class="p">(</span><span class="n">N_A</span><span class="p">,</span> <span class="n">N_B</span><span class="p">,</span> <span class="n">bcr</span><span class="p">,</span> <span class="n">bcr</span><span class="o">+</span><span class="n">d_hat</span><span class="p">)</span>
<span class="n">ab_data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>group</th>
      <th>converted</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>B</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>A</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>B</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>A</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>B</td>
      <td>0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>A</td>
      <td>0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>A</td>
      <td>0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>B</td>
      <td>0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>A</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The converted column indicates whether a user signed up for the premium service or not with a 1 or 0, respectively. The A group will be used for our control group and the B group will be our test group.</p>
<p>Let’s look at a summary of the results using the pivot table function in Pandas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ab_summary</span> <span class="o">=</span> <span class="n">ab_data</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="s1">&#39;converted&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">)</span>
<span class="c1"># add additional columns to the pivot table</span>
<span class="n">ab_summary</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ab_data</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="s1">&#39;converted&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="n">ab_summary</span><span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ab_data</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="s1">&#39;converted&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s1">&#39;group&#39;</span><span class="p">)</span>
<span class="n">ab_summary</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>converted</th>
      <th>total</th>
      <th>rate</th>
    </tr>
    <tr>
      <th>group</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>A</th>
      <td>103</td>
      <td>1001</td>
      <td>0.102897</td>
    </tr>
    <tr>
      <th>B</th>
      <td>126</td>
      <td>999</td>
      <td>0.126126</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>It looks like the difference in conversion rates between the two groups is 0.024 which is more than the lift we initially wanted of 0.02. This is a good sign that we should adopt the new design, but this is not enough evidence for us to confidently accept the new design. At this point we have not measured how confident we are in this result. This can be mitigated by looking at the distributions of the two groups.</p>
</div>
<div class="section" id="compare-the-two-groups">
<h3>3. Compare the Two Groups<a class="headerlink" href="#compare-the-two-groups" title="Permalink to this headline">¶</a></h3>
<p>We can compare the two groups by plotting the distribution of the control group and calculating the probability of getting the result from our test group. We can assume that the distribution for our control group is binomial because the data is a series of Bernoulli trials, where each trial only has two possible outcomes (similar to a coin flip).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">A_converted</span> <span class="o">=</span> <span class="n">ab_summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;converted&#39;</span><span class="p">]</span>
<span class="n">A_total</span> <span class="o">=</span> <span class="n">ab_summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;total&#39;</span><span class="p">]</span>
<span class="n">A_cr</span> <span class="o">=</span> <span class="n">ab_summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;rate&#39;</span><span class="p">]</span>

<span class="n">B_converted</span> <span class="o">=</span> <span class="n">ab_summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="s1">&#39;converted&#39;</span><span class="p">]</span>
<span class="n">B_total</span> <span class="o">=</span> <span class="n">ab_summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="s1">&#39;total&#39;</span><span class="p">]</span>
<span class="n">B_cr</span> <span class="o">=</span> <span class="n">ab_summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="s1">&#39;rate&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">A_converted</span><span class="o">-</span><span class="mi">49</span><span class="p">,</span> <span class="n">A_converted</span><span class="o">+</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">scs</span><span class="o">.</span><span class="n">binom</span><span class="p">(</span><span class="n">A_total</span><span class="p">,</span> <span class="n">A_cr</span><span class="p">)</span><span class="o">.</span><span class="n">pmf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">B_cr</span> <span class="o">*</span> <span class="n">A_total</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;converted&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;probability&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;probability&#39;)
</pre></div>
</div>
<img alt="../_images/T313645_A_B_Testing_30_1.png" src="../_images/T313645_A_B_Testing_30_1.png" />
</div>
</div>
<p>The distribution for the control group is shown in red and the result from the test group is indicated by the blue dashed line. We can see that the probability of getting the result from the test group is very high. However, the probability does not convey the confidence level of the results. It does not take the sample size of our test group into consideration. Intuitively, we would feel more confident in our results as our sample sizes grow larger. Let’s continue and plot the test group results as a binomial distribution and compare the distributions against each other.</p>
<div class="section" id="binomial-distribution">
<h4>Binomial distribution<a class="headerlink" href="#binomial-distribution" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">xA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">A_converted</span><span class="o">-</span><span class="mi">49</span><span class="p">,</span> <span class="n">A_converted</span><span class="o">+</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">yA</span> <span class="o">=</span> <span class="n">scs</span><span class="o">.</span><span class="n">binom</span><span class="p">(</span><span class="n">A_total</span><span class="p">,</span> <span class="n">A_cr</span><span class="p">)</span><span class="o">.</span><span class="n">pmf</span><span class="p">(</span><span class="n">xA</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">xA</span><span class="p">,</span> <span class="n">yA</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">xB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">B_converted</span><span class="o">-</span><span class="mi">49</span><span class="p">,</span> <span class="n">B_converted</span><span class="o">+</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">yB</span> <span class="o">=</span> <span class="n">scs</span><span class="o">.</span><span class="n">binom</span><span class="p">(</span><span class="n">B_total</span><span class="p">,</span> <span class="n">B_cr</span><span class="p">)</span><span class="o">.</span><span class="n">pmf</span><span class="p">(</span><span class="n">xB</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">xB</span><span class="p">,</span> <span class="n">yB</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;converted&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;probability&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;probability&#39;)
</pre></div>
</div>
<img alt="../_images/T313645_A_B_Testing_33_1.png" src="../_images/T313645_A_B_Testing_33_1.png" />
</div>
</div>
</div>
<div class="section" id="compare-the-null-hypothesis-vs-the-alternative-hypothesis">
<h4>Compare the Null Hypothesis vs. the Alternative Hypothesis<a class="headerlink" href="#compare-the-null-hypothesis-vs-the-alternative-hypothesis" title="Permalink to this headline">¶</a></h4>
<p>Let’s start off by defining the null hypothesis and the alternative hypothesis.</p>
<ul class="simple">
<li><p>The null hypothesis is the position that the change in the design made for the test group would result in no change in the conversion rate.</p></li>
<li><p>The alternative hypothesis is the opposing position that the change in the design for the test group would result in an improvement (or reduction) in the conversion rate.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># define the parameters for abplot()</span>
<span class="c1"># use the actual values from the experiment for bcr and d_hat</span>
<span class="c1"># p_A is the conversion rate of the control group</span>
<span class="c1"># p_B is the conversion rate of the test group</span>
<span class="n">bcr</span> <span class="o">=</span> <span class="n">A_cr</span>
<span class="n">d_hat</span> <span class="o">=</span> <span class="n">B_cr</span> <span class="o">-</span> <span class="n">A_cr</span>
<span class="n">abplot</span><span class="p">(</span><span class="n">N_A</span><span class="p">,</span> <span class="n">N_B</span><span class="p">,</span> <span class="n">bcr</span><span class="p">,</span> <span class="n">d_hat</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/T313645_A_B_Testing_36_0.png" src="../_images/T313645_A_B_Testing_36_0.png" />
</div>
</div>
<p>Fortunately, both curves are identical in shape, so we can just compare the distance between the means of the two distributions. We can see that the alternative hypothesis curve suggests that the test group has a higher conversion rate than the control group. This plot also can be used to directly determine the statistical power.</p>
</div>
</div>
<div class="section" id="statistical-power-and-significance-level">
<h3>4. Statistical Power and Significance Level<a class="headerlink" href="#statistical-power-and-significance-level" title="Permalink to this headline">¶</a></h3>
<p>I think it is easier to define statistical power and significance level by first showing how they are represented in the plot of the null and alternative hypothesis. We can return a visualization of the statistical power by adding the parameter show_power=True</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">abplot</span><span class="p">(</span><span class="n">N_A</span><span class="p">,</span> <span class="n">N_B</span><span class="p">,</span> <span class="n">bcr</span><span class="p">,</span> <span class="n">d_hat</span><span class="p">,</span> <span class="n">show_power</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/T313645_A_B_Testing_39_0.png" src="../_images/T313645_A_B_Testing_39_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">abplot</span><span class="p">(</span><span class="n">N_A</span><span class="p">,</span> <span class="n">N_B</span><span class="p">,</span> <span class="n">bcr</span><span class="p">,</span> <span class="n">d_hat</span><span class="p">,</span> <span class="n">show_beta</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/T313645_A_B_Testing_40_0.png" src="../_images/T313645_A_B_Testing_40_0.png" />
</div>
</div>
<p>The gray dashed line that divides the area under the alternative curve into two also directly segments the area associated with the significance level, often denoted with the greek letter alpha.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">abplot</span><span class="p">(</span><span class="n">N_A</span><span class="p">,</span> <span class="n">N_B</span><span class="p">,</span> <span class="n">bcr</span><span class="p">,</span> <span class="n">d_hat</span><span class="p">,</span> <span class="n">show_alpha</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/T313645_A_B_Testing_42_0.png" src="../_images/T313645_A_B_Testing_42_0.png" />
</div>
</div>
<p>Experiments are typically set up for a minimum desired power of 80%. If our new design is truly better, we want our experiment to show that there is at least an 80% probability that this is the case. We know that if we increase the sample size for each group, we will decrease the pooled variance for our null and alternative hypothesis. This will make our distributions much narrower and may increase the statistical power. Let’s take a look at how sample size will directly affect our results.</p>
</div>
<div class="section" id="sample-size">
<h3>5. Sample Size<a class="headerlink" href="#sample-size" title="Permalink to this headline">¶</a></h3>
<p>If we run our test again with a sample size of 2000 instead of 1000 for each group, we get the following results.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">abplot</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="n">bcr</span><span class="p">,</span> <span class="n">d_hat</span><span class="p">,</span> <span class="n">show_power</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/T313645_A_B_Testing_45_0.png" src="../_images/T313645_A_B_Testing_45_0.png" />
</div>
</div>
<p>Many people calculate Z from tables such as those shown here and here. However, I am more of a visual learner and I like to refer to the plot of the Z-distribution from which the values are derived.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">zplot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/T313645_A_B_Testing_47_0.png" src="../_images/T313645_A_B_Testing_47_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">zplot</span><span class="p">(</span><span class="mf">0.80</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/T313645_A_B_Testing_48_0.png" src="../_images/T313645_A_B_Testing_48_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">min_sample_size</span><span class="p">(</span><span class="n">bcr</span><span class="o">=</span><span class="mf">0.10</span><span class="p">,</span> <span class="n">mde</span><span class="o">=</span><span class="mf">0.02</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3842.026629963879
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">abplot</span><span class="p">(</span><span class="mi">3843</span><span class="p">,</span> <span class="mi">3843</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="n">show_power</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/T313645_A_B_Testing_50_0.png" src="../_images/T313645_A_B_Testing_50_0.png" />
</div>
</div>
<p>The calculated power for this sample size was approximately 0.80. Therefore, if our design change had an improvement in conversion of about 2 percent, we would need at least 3843 samples in each group for a statistical power of at least 0.80.</p>
<p>That was a very long but basic walkthrough of A/B tests. Once you have developed an understanding and familiarity with the procedure, you will probably be able to run an experiment and go directly to the plots for the null and alternative hypothesis to determine if your results achieved enough power. By calculating the minimum sample size you need prior to the experiment, you can determine how long it will take to get the results back to your team for a final decision.</p>
</div>
</div>
<div class="section" id="ad-conversion-a-b-testing">
<h2>Ad-conversion A-B Testing<a class="headerlink" href="#ad-conversion-a-b-testing" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>Simple T-test to compare 2 samples of ad-conversions</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!wget https://github.com/sparsh-ai/reco-data/raw/master/abtest-sample-dayC1C2.csv
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">ss</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;abtest-sample-dayC1C2.csv&quot;</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Day</th>
      <th>Conversion_A</th>
      <th>Conversion_B</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>0.15</td>
      <td>0.19</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>0.12</td>
      <td>0.20</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>0.18</td>
      <td>0.18</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>0.19</td>
      <td>0.22</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>0.17</td>
      <td>0.19</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6</td>
      <td>0.13</td>
      <td>0.17</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7</td>
      <td>0.14</td>
      <td>0.18</td>
    </tr>
    <tr>
      <th>7</th>
      <td>8</td>
      <td>0.23</td>
      <td>0.20</td>
    </tr>
    <tr>
      <th>8</th>
      <td>9</td>
      <td>0.11</td>
      <td>0.17</td>
    </tr>
    <tr>
      <th>9</th>
      <td>10</td>
      <td>0.15</td>
      <td>0.22</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Let’s plot the distribution of target and control group:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">Conversion_A</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.7/dist-packages/seaborn/distributions.py:2557: FutureWarning: `distplot` is a deprecated function and will be removed in a future version. Please adapt your code to use either `displot` (a figure-level function with similar flexibility) or `histplot` (an axes-level function for histograms).
  warnings.warn(msg, FutureWarning)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f8a7d87c1d0&gt;
</pre></div>
</div>
<img alt="../_images/T313645_A_B_Testing_58_2.png" src="../_images/T313645_A_B_Testing_58_2.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">Conversion_B</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.7/dist-packages/seaborn/distributions.py:2557: FutureWarning: `distplot` is a deprecated function and will be removed in a future version. Please adapt your code to use either `displot` (a figure-level function with similar flexibility) or `histplot` (an axes-level function for histograms).
  warnings.warn(msg, FutureWarning)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f8a7ac61150&gt;
</pre></div>
</div>
<img alt="../_images/T313645_A_B_Testing_59_2.png" src="../_images/T313645_A_B_Testing_59_2.png" />
</div>
</div>
<p>Now, we will perform the t-test:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">t_stat</span><span class="p">,</span> <span class="n">p_val</span><span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">Conversion_B</span><span class="p">,</span><span class="n">data</span><span class="o">.</span><span class="n">Conversion_A</span><span class="p">)</span>
<span class="n">t_stat</span> <span class="p">,</span> <span class="n">p_val</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(3.78736793091929, 0.000363796012828762)
</pre></div>
</div>
</div>
</div>
<p>For our example, the observed value i.e the mean of the test group is 0.19. The hypothesized value (Mean of the control group) is 0.16. On the calculation of the t-score, we get the t-score as .3787. and the p-value is 0.00036.</p>
<p>SO what does all this mean for our A/B Testing?</p>
<p>Here, our p-value is less than the significance level i.e 0.05. Hence, we can reject the null hypothesis. This means that in our A/B testing, newsletter B is performing better than newsletter A. So our recommendation would be to replace our current newsletter with B to bring more traffic on our website.</p>
</div>
<div class="section" id="ab-testing-with-python">
<h2>AB Testing With Python<a class="headerlink" href="#ab-testing-with-python" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>Walkthrough on a Udacity Course on AB testing</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">mt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">norm</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="udacity-s-a-b-testing-course-a-class-anchor-id-about-a">
<h3>1 Udacity’s A/B Testing Course <a class="anchor" id="about"></a><a class="headerlink" href="#udacity-s-a-b-testing-course-a-class-anchor-id-about-a" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://www.udacity.com/">Udacity</a> published a great free course for <a class="reference external" href="https://en.wikipedia.org/wiki/A/B_testing">A/B Testing</a>, also known as split tests, which are online experiments used to test potential improvements to a website or mobile app.
This Python notebook is a walkthrough solution of the final project.</p>
<p>Udacity’s <a class="reference external" href="https://www.udacity.com/course/ab-testing--ud257">AB Testing course</a> is presented by Google and focuses on design and analysis of A/B tests. The course covers how to choose and characterize metrics to evaluate your experiments, how to design an experiment with enough statistical power and how to analyze the results and draw valid conclusions.</p>
</div>
<div class="section" id="experiment-overview-a-class-anchor-id-overview-a">
<h3>2 Experiment Overview <a class="anchor" id="overview"></a><a class="headerlink" href="#experiment-overview-a-class-anchor-id-overview-a" title="Permalink to this headline">¶</a></h3>
<p><strong>Experiment Name:</strong> “Free Trial” Screener. <br>
It is conducted by Udacity, a website dedicated to teaching online - with the overall business goal of maximizing course completion by students.</p>
<div class="section" id="current-conditions-before-change-a-class-anchor-id-current-a">
<h4>2.1 Current Conditions Before Change <a class="anchor" id="current"></a><a class="headerlink" href="#current-conditions-before-change-a-class-anchor-id-current-a" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>At the time of this experiment, Udacity courses currently have two options on the course overview page: “start free trial”, and “access course materials”. <br></p></li>
<li><p>If the student clicks “start free trial”, they will be asked to enter their credit card information, and then they will be enrolled in a free trial for the paid version of the course. After 14 days, they will automatically be charged unless they cancel first.</p></li>
<li><p>If the student clicks “access course materials”, they will be able to view the videos and take the quizzes for free, but they will not receive coaching support or a verified certificate, and they will not submit their final project for feedback.</p></li>
</ul>
</div>
<div class="section" id="description-of-experimented-change-a-class-anchor-id-description-a">
<h4>2.2 Description of Experimented Change <a class="anchor" id="description"></a><a class="headerlink" href="#description-of-experimented-change-a-class-anchor-id-description-a" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>In the experiment, Udacity tested a change where if the student clicked “start free trial”, they were asked how much time they had available to devote to the course.</p></li>
<li><p>If the student indicated 5 or more hours per week, they would be taken through the checkout process as usual. If they indicated fewer than 5 hours per week, a message would appear indicating that Udacity courses usually require a greater time commitment for successful completion, and suggesting that the student might like to access the course materials for free.</p></li>
<li><p>At this point, the student would have the option to continue enrolling in the free trial, or access the course materials for free instead. <a class="reference external" href="https://drive.google.com/file/d/0ByAfiG8HpNUMakVrS0s4cGN2TjQ/view">This screenshot</a> shows what the experiment looks like.</p></li>
</ul>
</div>
<div class="section" id="experiment-hypothesis-a-class-anchor-id-hypothesis-a">
<h4>2.3 Experiment Hypothesis <a class="anchor" id="hypothesis"></a><a class="headerlink" href="#experiment-hypothesis-a-class-anchor-id-hypothesis-a" title="Permalink to this headline">¶</a></h4>
<p>The hypothesis was that this might set clearer expectations for students upfront, thus reducing the number of frustrated students who left the free trial because they didn’t have enough time—without significantly reducing the number of students to continue past the free trial and eventually complete the course. If this hypothesis held true, Udacity could improve the overall student experience and improve coaches’ capacity to support students who are likely to complete the course.</p>
</div>
<div class="section" id="experiment-details-a-class-anchor-id-details-a">
<h4>2.4 Experiment Details <a class="anchor" id="details"></a><a class="headerlink" href="#experiment-details-a-class-anchor-id-details-a" title="Permalink to this headline">¶</a></h4>
<p>The unit of diversion is a cookie, although if the student enrolls in the free trial, they are tracked by user-id from that point forward. The same user-id cannot enroll in the free trial twice. For users that do not enroll, their user-id is not tracked in the experiment, even if they were signed in when they visited the course overview page.</p>
</div>
</div>
<div class="section" id="metric-choice-a-class-anchor-id-metric-a">
<h3>3 Metric Choice <a class="anchor" id="metric"></a><a class="headerlink" href="#metric-choice-a-class-anchor-id-metric-a" title="Permalink to this headline">¶</a></h3>
<p>We need two types of metrics for a successful experiment (or at least, a safe one); Invariate and evaluation metrics.
Invariate metrics are used for “sanity checks”, that is, to make sure our experiment (the way we presented a change to a part of the population, as well as the way we collected the data) is not inherently wrong. Basically, this means we pick metrics which we consider not to change (not to be affected) because of our experiment and later make sure these metrics don’t change drastically between our control and experiment groups.<br>
Evaluation metrics on the other hand, are the metrics in which we expect to see a change, and are relevant to the business goals we aim to achieve. For each metric we state a <span class="math notranslate nohighlight">\(Dmin\)</span> - which marks the minimum change which is practically significant to the business. For instance, stating that any increase in retention that is under 2%, even if statistically significant, is not practical to the business.</p>
<div class="section" id="invariate-metrics-sanity-checks-a-class-anchor-id-invariate-a">
<h4>3.1 Invariate Metrics - Sanity Checks <a class="anchor" id="invariate"></a><a class="headerlink" href="#invariate-metrics-sanity-checks-a-class-anchor-id-invariate-a" title="Permalink to this headline">¶</a></h4>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:center head"><p>Metric Name</p></th>
<th class="text-align:center head"><p>Metric Formula</p></th>
<th class="text-align:center head"><p><span class="math notranslate nohighlight">\(Dmin\)</span></p></th>
<th class="text-align:center head"><p>Notation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:center"><p>Number of Cookies in Course Overview Page</p></td>
<td class="text-align:center"><p># unique daily cookies on page</p></td>
<td class="text-align:center"><p>3000 cookies</p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(C_k\)</span></p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>Number of Clicks on Free Trial Button</p></td>
<td class="text-align:center"><p># unique daily cookies who clicked</p></td>
<td class="text-align:center"><p>240 clicks</p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(C_l\)</span></p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>Free Trial button Click-Through-Probability</p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(\frac{C_l}{C_k}\)</span></p></td>
<td class="text-align:center"><p>0.01</p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(CTP\)</span></p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="evaluation-metrics-performance-indicators-a-class-anchor-id-evaluation-a">
<h4>3.2 Evaluation Metrics - Performance Indicators <a class="anchor" id="evaluation"></a><a class="headerlink" href="#evaluation-metrics-performance-indicators-a-class-anchor-id-evaluation-a" title="Permalink to this headline">¶</a></h4>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:center head"><p>Metric Name</p></th>
<th class="text-align:center head"><p>Metric Formula</p></th>
<th class="text-align:center head"><p><span class="math notranslate nohighlight">\(Dmin\)</span></p></th>
<th class="text-align:center head"><p>Notation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:center"><p>Gross Conversion</p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(\frac{enrolled}{C_l}\)</span></p></td>
<td class="text-align:center"><p>0.01</p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(Conversion_{Gross}\)</span></p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>Retention</p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(\frac{paid}{enrolled}\)</span></p></td>
<td class="text-align:center"><p>0.01</p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(Retention\)</span></p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>Net Conversion</p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(\frac{paid}{C_l}\)</span></p></td>
<td class="text-align:center"><p>0.0075</p></td>
<td class="text-align:center"><p><span class="math notranslate nohighlight">\(Conversion_{Net}\)</span></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="estimating-the-baseline-values-of-metrics-a-class-anchor-id-baseline-a">
<h3>4 Estimating the baseline values of metrics <a class="anchor" id="baseline"></a><a class="headerlink" href="#estimating-the-baseline-values-of-metrics-a-class-anchor-id-baseline-a" title="Permalink to this headline">¶</a></h3>
<p>Before we start our experiment we should know how these metrics behave before the change - that is, what are their baseline values.</p>
<div class="section" id="collecting-estimators-data-a-class-anchor-id-collect-a">
<h4>4.1 Collecting estimators data <a class="anchor" id="collect"></a><a class="headerlink" href="#collecting-estimators-data-a-class-anchor-id-collect-a" title="Permalink to this headline">¶</a></h4>
<p>Udacity gives the following rough estimates for these metrics (presumably collected from aggregates on daily traffic) <br></p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:center head"><p>Item</p></th>
<th class="text-align:center head"><p>Description</p></th>
<th class="text-align:center head"><p>Estimator</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:center"><p>Number of cookies</p></td>
<td class="text-align:center"><p>Daily unique cookies to view course overview page</p></td>
<td class="text-align:center"><p>40,000</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>Number of clicks</p></td>
<td class="text-align:center"><p>Daily unique cookies to click Free Trial button</p></td>
<td class="text-align:center"><p>3,200</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>Number of enrollments</p></td>
<td class="text-align:center"><p>Free Trial enrollments per day</p></td>
<td class="text-align:center"><p>660</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>CTP</p></td>
<td class="text-align:center"><p>CTP on Free Trial button</p></td>
<td class="text-align:center"><p>0.08</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>Gross Conversion</p></td>
<td class="text-align:center"><p>Probability of enrolling, given a click</p></td>
<td class="text-align:center"><p>0.20625</p></td>
</tr>
<tr class="row-odd"><td class="text-align:center"><p>Retention</p></td>
<td class="text-align:center"><p>Probability of payment, given enrollment</p></td>
<td class="text-align:center"><p>0.53</p></td>
</tr>
<tr class="row-even"><td class="text-align:center"><p>Net Conversion</p></td>
<td class="text-align:center"><p>Probability of payment, given click</p></td>
<td class="text-align:center"><p>0.109313</p></td>
</tr>
</tbody>
</table>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#Let&#39;s place this estimators into a dictionary for ease of use later</span>
<span class="n">baseline</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Cookies&quot;</span><span class="p">:</span><span class="mi">40000</span><span class="p">,</span><span class="s2">&quot;Clicks&quot;</span><span class="p">:</span><span class="mi">3200</span><span class="p">,</span><span class="s2">&quot;Enrollments&quot;</span><span class="p">:</span><span class="mi">660</span><span class="p">,</span><span class="s2">&quot;CTP&quot;</span><span class="p">:</span><span class="mf">0.08</span><span class="p">,</span><span class="s2">&quot;GConversion&quot;</span><span class="p">:</span><span class="mf">0.20625</span><span class="p">,</span>
           <span class="s2">&quot;Retention&quot;</span><span class="p">:</span><span class="mf">0.53</span><span class="p">,</span><span class="s2">&quot;NConversion&quot;</span><span class="p">:</span><span class="mf">0.109313</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="estimating-standard-deviation-a-class-anchor-id-sd-a">
<h4>4.2 Estimating Standard Deviation <a class="anchor" id="sd"></a><a class="headerlink" href="#estimating-standard-deviation-a-class-anchor-id-sd-a" title="Permalink to this headline">¶</a></h4>
<p>Once we collected these estimates, we should estimate the standard deviation of a metric, this is computed for sample size calculations and confidence intervals for our results. The more variant a metric is, the harder it is to reach a significant result. Assuming a sample size of 5,000 cookies visiting the course overview page per day (as given in project’s instructions) - we want to estimate a standard deviation, for the evaluation metrics only. The sample size we are considering should be smaller than the “population” we collected and small enough to have two groups with that size.</p>
<div class="section" id="scaling-collected-data-a-class-anchor-id-scale-a">
<h5>4.2.1 Scaling Collected Data <a class="anchor" id="scale"></a><a class="headerlink" href="#scaling-collected-data-a-class-anchor-id-scale-a" title="Permalink to this headline">¶</a></h5>
<p>For all the calculations to follow we need to scale our collected counts estimates of metrics with the sample size we specified for variance estimation. In this case, from 40000 unique cookies to visit the course overview page per day, to 5000.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#Scale The counts estimates</span>
<span class="n">baseline</span><span class="p">[</span><span class="s2">&quot;Cookies&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="n">baseline</span><span class="p">[</span><span class="s2">&quot;Clicks&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">baseline</span><span class="p">[</span><span class="s2">&quot;Clicks&quot;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">5000</span><span class="o">/</span><span class="mi">40000</span><span class="p">)</span>
<span class="n">baseline</span><span class="p">[</span><span class="s2">&quot;Enrollments&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">baseline</span><span class="p">[</span><span class="s2">&quot;Enrollments&quot;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">5000</span><span class="o">/</span><span class="mi">40000</span><span class="p">)</span>
<span class="n">baseline</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;CTP&#39;: 0.08,
 &#39;Clicks&#39;: 400.0,
 &#39;Cookies&#39;: 5000,
 &#39;Enrollments&#39;: 82.5,
 &#39;GConversion&#39;: 0.20625,
 &#39;NConversion&#39;: 0.109313,
 &#39;Retention&#39;: 0.53}
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="estimating-analytically-a-class-anchor-id-estimate-a">
<h5>4.2.2 Estimating Analytically <a class="anchor" id="estimate"></a><a class="headerlink" href="#estimating-analytically-a-class-anchor-id-estimate-a" title="Permalink to this headline">¶</a></h5>
<p>In order to estimate variance analytically, we can assume metrics which are probabilities (<span class="math notranslate nohighlight">\(\hat{p}\)</span>) are binomially distributed, so we can use this formula for the standard deviation: <br></p>
<center><font size="4">$SD=\sqrt{\frac{\hat{p}*(1-\hat{p})}{n}}$</font></center><br>
This assumption is only valid when the **unit of diversion** of the experiment is equal to the **unit of analysis** (the denominator of the metric formula). In the cases when this is not valid, the actual variance might be different and it is recommended to estimate it empirically.
<p>For each metric, we need to plug two variables into the formula: <br>
<span class="math notranslate nohighlight">\(\hat{p}\)</span> - baseline probability of the event to occur <br>
<span class="math notranslate nohighlight">\( n \)</span> - sample size <br></p>
<ul class="simple">
<li><p><strong>Gross Conversion</strong> - The baseline probability for Gross Conversion can be calculated by the number of users to enroll in a free trial divided by the number of cookies clicking the free trial. In other words, the probability of enrollment given a click. In this case, the unit of diversion (Cookies), that is the element by which we differentiate samples and assign them to control and experiment groups, is equall to the unit of analysis (cookies who click), that is the denominator of the formula to calculate Gross Conversion (GC). When this is the case, this analytic estimate of variance is sufficient.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let&#39;s get the p and n we need for Gross Conversion (GC)</span>
<span class="c1"># and compute the Stansard Deviation(sd) rounded to 4 decimal digits.</span>
<span class="n">GC</span><span class="o">=</span><span class="p">{}</span>
<span class="n">GC</span><span class="p">[</span><span class="s2">&quot;d_min&quot;</span><span class="p">]</span><span class="o">=</span><span class="mf">0.01</span>
<span class="n">GC</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">baseline</span><span class="p">[</span><span class="s2">&quot;GConversion&quot;</span><span class="p">]</span>
<span class="c1">#p is given in this case - or we could calculate it from enrollments/clicks</span>
<span class="n">GC</span><span class="p">[</span><span class="s2">&quot;n&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">baseline</span><span class="p">[</span><span class="s2">&quot;Clicks&quot;</span><span class="p">]</span>
<span class="n">GC</span><span class="p">[</span><span class="s2">&quot;sd&quot;</span><span class="p">]</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">mt</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">GC</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">GC</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]))</span><span class="o">/</span><span class="n">GC</span><span class="p">[</span><span class="s2">&quot;n&quot;</span><span class="p">]),</span><span class="mi">4</span><span class="p">)</span>
<span class="n">GC</span><span class="p">[</span><span class="s2">&quot;sd&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0202
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p><strong>Retention</strong> - The baseline probability for retention is the number of paying users (enrolled after 14 free days) divided by the number of total enrolled users. In other words, the probability of payment, given enrollment. The sample size is the number of enrolled users. In this case, unit of diversion is not equal to unit of analysis (users who enrolled) so an analytical estimation is not enough - if we had the data for these estimates, we would want to estimate this variance empirically as well.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let&#39;s get the p and n we need for Retention(R)</span>
<span class="c1"># and compute the Stansard Deviation(sd) rounded to 4 decimal digits.</span>
<span class="n">R</span><span class="o">=</span><span class="p">{}</span>
<span class="n">R</span><span class="p">[</span><span class="s2">&quot;d_min&quot;</span><span class="p">]</span><span class="o">=</span><span class="mf">0.01</span>
<span class="n">R</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">baseline</span><span class="p">[</span><span class="s2">&quot;Retention&quot;</span><span class="p">]</span>
<span class="n">R</span><span class="p">[</span><span class="s2">&quot;n&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">baseline</span><span class="p">[</span><span class="s2">&quot;Enrollments&quot;</span><span class="p">]</span>
<span class="n">R</span><span class="p">[</span><span class="s2">&quot;sd&quot;</span><span class="p">]</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">mt</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">R</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">R</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]))</span><span class="o">/</span><span class="n">R</span><span class="p">[</span><span class="s2">&quot;n&quot;</span><span class="p">]),</span><span class="mi">4</span><span class="p">)</span>
<span class="n">R</span><span class="p">[</span><span class="s2">&quot;sd&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0549
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p><strong>Net Conversion</strong> - The baseline probability for the net conversion is the number of paying users divided by the number of cookies that clicked the free trial button. In other words, the probability of payment, given a click. The sample size is the number of cookies that clicked. In this case, the unit of analysis and diversion are equal so we expect a good enough estimation analytically.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let&#39;s get the p and n we need for Net Conversion (NC)</span>
<span class="c1"># and compute the Standard Deviation (sd) rounded to 4 decimal digits.</span>
<span class="n">NC</span><span class="o">=</span><span class="p">{}</span>
<span class="n">NC</span><span class="p">[</span><span class="s2">&quot;d_min&quot;</span><span class="p">]</span><span class="o">=</span><span class="mf">0.0075</span>
<span class="n">NC</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">baseline</span><span class="p">[</span><span class="s2">&quot;NConversion&quot;</span><span class="p">]</span>
<span class="n">NC</span><span class="p">[</span><span class="s2">&quot;n&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">baseline</span><span class="p">[</span><span class="s2">&quot;Clicks&quot;</span><span class="p">]</span>
<span class="n">NC</span><span class="p">[</span><span class="s2">&quot;sd&quot;</span><span class="p">]</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">mt</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">NC</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">NC</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]))</span><span class="o">/</span><span class="n">NC</span><span class="p">[</span><span class="s2">&quot;n&quot;</span><span class="p">]),</span><span class="mi">4</span><span class="p">)</span>
<span class="n">NC</span><span class="p">[</span><span class="s2">&quot;sd&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0156
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="experiment-sizing-a-class-anchor-id-sizing-a">
<h3>5 Experiment Sizing <a class="anchor" id="sizing"></a><a class="headerlink" href="#experiment-sizing-a-class-anchor-id-sizing-a" title="Permalink to this headline">¶</a></h3>
<p>At this point, once we have estimated our metrics in the baseline (most importantly, their estimated variance) we cancalculate the munumal number of samples we need so that our experiment will have enough statistical power, as well as siginificance.</p>
<p>Given <span class="math notranslate nohighlight">\(\alpha=0.05\)</span> (significance level ) and <span class="math notranslate nohighlight">\(\beta=0.2\)</span> (power), we want to estimate how many total pageviews (cookies who viewed the course overview page) we need in the experiment. This amount will be divided into tthe two groups: control and experiment. This calculation can be done using an <a class="reference external" href="http://www.evanmiller.org/ab-testing/sample-size.html">online calculator</a> or by calculating directly using the required formula.</p>
<p>The minimum sample size for control and experiment groups, which provides probability of Type I Error <span class="math notranslate nohighlight">\(\alpha\)</span>, Power <span class="math notranslate nohighlight">\(1-\beta\)</span>, detectable effect <span class="math notranslate nohighlight">\(d\)</span> and baseline conversion rate <span class="math notranslate nohighlight">\(p\)</span> (simple hypothesis <span class="math notranslate nohighlight">\(H_0 : P_{cont} - P_{exp} = 0\)</span> against simple alternative <span class="math notranslate nohighlight">\(H_A : P_{cont} - P_{exp} = d\)</span>  is:</p>
<center> <font size="5"> $n = \frac{(Z_{1-\frac{\alpha}{2}}sd_1 + Z_{1-\beta}sd_2)^2}{d^2}$</font>, with: <br><br>
$sd_1 = \sqrt{p(1-p)+p(1-p)}$<br><br>
$sd_2 = \sqrt{p(1-p)+(p+d)(1-(1-(p+d))}$ </center><br>
<p>Now, let’s break down what inputs we need and which calculations still need to be made. Regarding inputs, we have all the data we need:
Type 1 error (<span class="math notranslate nohighlight">\(\alpha\)</span>), power (<span class="math notranslate nohighlight">\(1-\beta\)</span>), detectable change (<span class="math notranslate nohighlight">\(d = D_{min}\)</span>) and baseline conversion rate (our <span class="math notranslate nohighlight">\(\hat{p}\)</span> ).
What we need to calculate:</p>
<ul class="simple">
<li><p>Get Z score for <span class="math notranslate nohighlight">\(1-\frac{\alpha}{2}\)</span> and for <span class="math notranslate nohighlight">\(1-\beta\)</span></p></li>
<li><p>Get standard deviations 1 &amp; 2, that is for both the baseline and for expected changed rate
All these components will finally yield the number we need.</p></li>
</ul>
<div class="section" id="get-z-score-critical-value-and-standard-deviations-a-class-anchor-id-side-methods-a">
<h4>5.1 Get z-score critical value and Standard Deviations <a class="anchor" id="side_methods"></a><a class="headerlink" href="#get-z-score-critical-value-and-standard-deviations-a-class-anchor-id-side-methods-a" title="Permalink to this headline">¶</a></h4>
<p>We are used to looking up this value in a table, but gladly we can use python’s <code class="docutils literal notranslate"><span class="pre">scipy.stats.norm</span></code> package to get all the required methods for normal distribution. The <code class="docutils literal notranslate"><span class="pre">ppf</span></code> method gives us access to the <a class="reference external" href="https://en.wikipedia.org/wiki/Quantile_function">Percent Point Function (ppf)</a> or Quantile Function, and besides it being the inverse of the <a class="reference external" href="https://en.wikipedia.org/wiki/Cumulative_distribution_function">Cummulative Distribution Function (cdf)</a>, this is the functions that will give back our required critical z-score.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_sds</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">d</span><span class="p">):</span>
    <span class="n">sd1</span><span class="o">=</span><span class="n">mt</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">p</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p</span><span class="p">))</span>
    <span class="n">sd2</span><span class="o">=</span><span class="n">mt</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">p</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="n">d</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="n">d</span><span class="p">)))</span>
    <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">sd1</span><span class="p">,</span><span class="n">sd2</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">x</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#Inputs: required alpha value (alpha should already fit the required test)</span>
<span class="c1">#Returns: z-score for given alpha</span>
<span class="k">def</span> <span class="nf">get_z_score</span><span class="p">(</span><span class="n">alpha</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>

<span class="c1"># Inputs p-baseline conversion rate which is our estimated p and d-minimum detectable change</span>
<span class="c1"># Returns</span>
<span class="k">def</span> <span class="nf">get_sds</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">d</span><span class="p">):</span>
    <span class="n">sd1</span><span class="o">=</span><span class="n">mt</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">p</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p</span><span class="p">))</span>
    <span class="n">sd2</span><span class="o">=</span><span class="n">mt</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">p</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="n">d</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="n">d</span><span class="p">)))</span>
    <span class="n">sds</span><span class="o">=</span><span class="p">[</span><span class="n">sd1</span><span class="p">,</span><span class="n">sd2</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">sds</span>

<span class="c1"># Inputs:sd1-sd for the baseline,sd2-sd for the expected change,alpha,beta,d-d_min,p-baseline estimate p</span>
<span class="c1"># Returns: the minimum sample size required per group according to metric denominator</span>
<span class="k">def</span> <span class="nf">get_sampSize</span><span class="p">(</span><span class="n">sds</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">d</span><span class="p">):</span>
    <span class="n">n</span><span class="o">=</span><span class="nb">pow</span><span class="p">((</span><span class="n">get_z_score</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">alpha</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">sds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">get_z_score</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">beta</span><span class="p">)</span><span class="o">*</span><span class="n">sds</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="nb">pow</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">n</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="calculate-sample-size-per-metric-a-class-anchor-id-calc-a">
<h4>5.2 Calculate Sample Size per Metric <a class="anchor" id="calc"></a><a class="headerlink" href="#calculate-sample-size-per-metric-a-class-anchor-id-calc-a" title="Permalink to this headline">¶</a></h4>
<p>OK! Looks like we set up all the tools required for this part. We are now going to calculate the number of samples required for the experiment per metric, and we are subected to the fact that the highest sample size will be the effective size. This size should be considered in terms of efficacy of duration and exposure: how long will it take to get this many samples for the experiment.</p>
<p>So, to work more easily, let’s add the d parameter to each of the metrics characteristics of each metric:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">GC</span><span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">]</span><span class="o">=</span><span class="mf">0.01</span>
<span class="n">R</span><span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">]</span><span class="o">=</span><span class="mf">0.01</span>
<span class="n">NC</span><span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">]</span><span class="o">=</span><span class="mf">0.0075</span>
</pre></div>
</div>
</div>
</div>
<p>Now, for the calculations</p>
<ul class="simple">
<li><p><strong>Gross Conversion</strong></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let&#39;s get an integer value for simplicity</span>
<span class="n">GC</span><span class="p">[</span><span class="s2">&quot;SampSize&quot;</span><span class="p">]</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">get_sampSize</span><span class="p">(</span><span class="n">get_sds</span><span class="p">(</span><span class="n">GC</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">],</span><span class="n">GC</span><span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">]),</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="n">GC</span><span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">]))</span>
<span class="n">GC</span><span class="p">[</span><span class="s2">&quot;SampSize&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>25835
</pre></div>
</div>
</div>
</div>
<p>This means we need at least 25,835 cookies who click the Free Trial button - per group! That means that if we got 400 clicks out of 5000 pageviews (<code class="docutils literal notranslate"><span class="pre">400/5000</span> <span class="pre">=</span> <span class="pre">0.08</span></code>) -&gt; So, we are going to need <code class="docutils literal notranslate"><span class="pre">GC[&quot;SampSize&quot;]/0.08</span> <span class="pre">=</span> <span class="pre">322,938</span></code> pageviews, again ; per group! Finally, the total amount of samples per the Gross Conversion metric is:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">GC</span><span class="p">[</span><span class="s2">&quot;SampSize&quot;</span><span class="p">]</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">GC</span><span class="p">[</span><span class="s2">&quot;SampSize&quot;</span><span class="p">]</span><span class="o">/</span><span class="mf">0.08</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
<span class="n">GC</span><span class="p">[</span><span class="s2">&quot;SampSize&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>645875
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Retention</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Getting a nice integer value</span>
<span class="n">R</span><span class="p">[</span><span class="s2">&quot;SampSize&quot;</span><span class="p">]</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">get_sampSize</span><span class="p">(</span><span class="n">get_sds</span><span class="p">(</span><span class="n">R</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">],</span><span class="n">R</span><span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">]),</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="n">R</span><span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">]))</span>
<span class="n">R</span><span class="p">[</span><span class="s2">&quot;SampSize&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>39087
</pre></div>
</div>
</div>
</div>
<p>This means that we need 39,087 users who enrolled per group! We have to first convert this to cookies who clicked, and then to cookies who viewed the page, then finally to multipky by two for both groups.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">R</span><span class="p">[</span><span class="s2">&quot;SampSize&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">R</span><span class="p">[</span><span class="s2">&quot;SampSize&quot;</span><span class="p">]</span><span class="o">/</span><span class="mf">0.08</span><span class="o">/</span><span class="mf">0.20625</span><span class="o">*</span><span class="mi">2</span>
<span class="n">R</span><span class="p">[</span><span class="s2">&quot;SampSize&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4737818.181818182
</pre></div>
</div>
</div>
</div>
<p>This takes us as high as over 4 million page views total, this is practically impossible because we know we get about 40,000 a day, this would take well over 100 days. This means we have to drop this metric and not continue to work with it because results from our experiment (which is much smaller) will be biased.</p>
<ul class="simple">
<li><p><strong>Net Conversion</strong></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Getting a nice integer value</span>
<span class="n">NC</span><span class="p">[</span><span class="s2">&quot;SampSize&quot;</span><span class="p">]</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">get_sampSize</span><span class="p">(</span><span class="n">get_sds</span><span class="p">(</span><span class="n">NC</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">],</span><span class="n">NC</span><span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">]),</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="n">NC</span><span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">]))</span>
<span class="n">NC</span><span class="p">[</span><span class="s2">&quot;SampSize&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>27413
</pre></div>
</div>
</div>
</div>
<p>So, needing 27,413 cookies who click per group takes us all the way up to:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NC</span><span class="p">[</span><span class="s2">&quot;SampSize&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">NC</span><span class="p">[</span><span class="s2">&quot;SampSize&quot;</span><span class="p">]</span><span class="o">/</span><span class="mf">0.08</span><span class="o">*</span><span class="mi">2</span>
<span class="n">NC</span><span class="p">[</span><span class="s2">&quot;SampSize&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>685325.0
</pre></div>
</div>
</div>
</div>
<p>We are all the way up to 685,325 cookies who view the page. This is more than what was needed for Gross Conversion, so this will be our number. Assuming we take 80% of each days pageviews, the data collection period for this experiment (the period in which the experiment is revealed) will be about 3 weeks.</p>
</div>
</div>
<div class="section" id="analyzing-collected-data-a-class-anchor-id-analysis-a">
<h3>6 Analyzing Collected Data <a class="anchor" id="analysis"></a><a class="headerlink" href="#analyzing-collected-data-a-class-anchor-id-analysis-a" title="Permalink to this headline">¶</a></h3>
<p>Finally, the moment we’ve all been waiting for, after so much preparation we finally get to see what this experiment will prove!
The data is presented as two spreadsheets. I will load each spreadshot into a pandas dataframe.</p>
<div class="section" id="loading-collected-data-a-class-anchor-id-collect-results-a">
<h4>6.1 Loading collected data <a class="anchor" id="collect_results"></a><a class="headerlink" href="#loading-collected-data-a-class-anchor-id-collect-results-a" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># we use pandas to load datasets</span>
<span class="n">control</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://github.com/baumanab/udacity_ABTesting/raw/master/data/Final%20Project%20Results%20-%20Control.csv&quot;</span><span class="p">)</span>
<span class="n">experiment</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://github.com/baumanab/udacity_ABTesting/raw/master/data/Final%20Project%20Results%20-</span><span class="si">%20E</span><span class="s2">xperiment.csv&quot;</span><span class="p">)</span>
<span class="n">control</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>Pageviews</th>
      <th>Clicks</th>
      <th>Enrollments</th>
      <th>Payments</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Sat, Oct 11</td>
      <td>7723</td>
      <td>687</td>
      <td>134.0</td>
      <td>70.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Sun, Oct 12</td>
      <td>9102</td>
      <td>779</td>
      <td>147.0</td>
      <td>70.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Mon, Oct 13</td>
      <td>10511</td>
      <td>909</td>
      <td>167.0</td>
      <td>95.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Tue, Oct 14</td>
      <td>9871</td>
      <td>836</td>
      <td>156.0</td>
      <td>105.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Wed, Oct 15</td>
      <td>10014</td>
      <td>837</td>
      <td>163.0</td>
      <td>64.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="sanity-checks-a-class-anchor-id-sanity-a">
<h4>6.2 Sanity Checks <a class="anchor" id="sanity"></a><a class="headerlink" href="#sanity-checks-a-class-anchor-id-sanity-a" title="Permalink to this headline">¶</a></h4>
<p>First thing we have to do before even beginning to analyze this experiment’s results is sanity checks. These checks help verify that the experiment was conducted as expected and that other factors did not influence the data which we collected. This also makes sure that data collection was correct.</p>
<p>We have 3 Invariant metrics::</p>
<ul class="simple">
<li><p>Number of Cookies in Course Overview Page</p></li>
<li><p>Number of Clicks on Free Trial Button</p></li>
<li><p>Free Trial button Click-Through-Probability</p></li>
</ul>
<p>Two of these metrics are simple counts like number of cookies or number of clicks and the third is a probability (CTP). We will use two different ways of checking whether these obsereved values are like we expect (if in fact the experiment was not damaged.</p>
<div class="section" id="sanity-checks-for-differences-between-counts-a-class-anchor-id-check-counts-a">
<h5>6.2.1 Sanity Checks for differences between counts <a class="anchor" id="check_counts"></a><a class="headerlink" href="#sanity-checks-for-differences-between-counts-a-class-anchor-id-check-counts-a" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p><strong>Number of cookies who viewed the course overview page</strong> - Starting from this simpel invariant metric, we want to count the total amount of cookie pageviews we diverted to each group and see if there is a significant difference int he amount of cookies. A significant difference will imply a biased experiment that we should not rely on it’s results.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pageviews_cont</span><span class="o">=</span><span class="n">control</span><span class="p">[</span><span class="s1">&#39;Pageviews&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">pageviews_exp</span><span class="o">=</span><span class="n">experiment</span><span class="p">[</span><span class="s1">&#39;Pageviews&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">pageviews_total</span><span class="o">=</span><span class="n">pageviews_cont</span><span class="o">+</span><span class="n">pageviews_exp</span>
<span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;number of pageviews in control:&quot;</span><span class="p">,</span> <span class="n">pageviews_cont</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;number of Pageviewsin experiment:&quot;</span> <span class="p">,</span><span class="n">pageviews_exp</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>number of pageviews in control: 345543
number of Pageviewsin experiment: 344660
</pre></div>
</div>
</div>
</div>
<p>Ok so these look like pretty close numbers. Now, let’s make sure this difference in amounts is not significant and is random and even like we expected. We can model this diversion in the following way: <br>
We expect the amount of pageviews in the control group to be about a half (50%) of the total pageviews in both groups, so we can define a random variable with an easy to use distribution. <br>
A binomial random variable will be the number of successes we can expect to get out of N experiments, given the probability of a single success. So, if we consider being assigned to a group (control, for example) a success with probability 0.5 (random!), the number of samples which get assigned to the group is the value of our random binomial variable! <br></p>
<p>This get’s easier thanks to the central limit theorem which let’s us approximate the binomial distribution to a normal distribution (when n is large enough) with a mean of <span class="math notranslate nohighlight">\(p\)</span> and a standard deviation <span class="math notranslate nohighlight">\(\sqrt{\frac{p(1-p)}{N}}\)</span></p>
<center> <font size="4"> $ X$~$N( p,\sqrt{\frac{p(1-p)}{N}})$ </font></center>
What we want to test is whether our observed $\hat{p}$ (number of samples in control divided by total number of damples in both groups) is not significantly different than $p=0.5$. In order to do that we can calculate the margin of error acceptable at a 95% confidence level:
<center> <font size="4"> $ ME=Z_{1-\frac{\alpha}{2}}SD$ </font></center>
Finally, a [confidence interval](https://en.wikipedia.org/wiki/Confidence_interval) can be derived to tell us in which range an observed $p$ can exist and be acceptable as "the same" as the expected value.
<center> <font size="4"> $ CI=[\hat{p}-ME,\hat{p}+ME]$ </font></center>
When our obsereved $\hat{p}$ is within this range, all is well and the test was passed.<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">p</span><span class="o">=</span><span class="mf">0.5</span>
<span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span>
<span class="n">p_hat</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">pageviews_cont</span><span class="o">/</span><span class="p">(</span><span class="n">pageviews_total</span><span class="p">),</span><span class="mi">4</span><span class="p">)</span>
<span class="n">sd</span><span class="o">=</span><span class="n">mt</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">p</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">pageviews_total</span><span class="p">))</span>
<span class="n">ME</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">get_z_score</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="n">alpha</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="n">sd</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;The confidence interval is between&quot;</span><span class="p">,</span><span class="n">p</span><span class="o">-</span><span class="n">ME</span><span class="p">,</span><span class="s2">&quot;and&quot;</span><span class="p">,</span><span class="n">p</span><span class="o">+</span><span class="n">ME</span><span class="p">,</span><span class="s2">&quot;; Is&quot;</span><span class="p">,</span><span class="n">p_hat</span><span class="p">,</span><span class="s2">&quot;inside this range?&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The confidence interval is between 0.4988 and 0.5012 ; Is 0.5006 inside this range?
</pre></div>
</div>
</div>
</div>
<p>Our observed <span class="math notranslate nohighlight">\(\hat{p}\)</span> is inside this range which means the difference in number of samples between groups is expected. So far so good, since this invariant metric sanity test passes!</p>
<ul class="simple">
<li><p><strong>Number of cookies who clicked the Free Trial Button</strong>
We are going to address this count with the same strategy as before.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">clicks_cont</span><span class="o">=</span><span class="n">control</span><span class="p">[</span><span class="s1">&#39;Clicks&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">clicks_exp</span><span class="o">=</span><span class="n">experiment</span><span class="p">[</span><span class="s1">&#39;Clicks&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">clicks_total</span><span class="o">=</span><span class="n">clicks_cont</span><span class="o">+</span><span class="n">clicks_exp</span>

<span class="n">p_hat</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">clicks_cont</span><span class="o">/</span><span class="n">clicks_total</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">sd</span><span class="o">=</span><span class="n">mt</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">p</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p</span><span class="p">)</span><span class="o">/</span><span class="n">clicks_total</span><span class="p">)</span>
<span class="n">ME</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">get_z_score</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="n">alpha</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="n">sd</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;The confidence interval is between&quot;</span><span class="p">,</span><span class="n">p</span><span class="o">-</span><span class="n">ME</span><span class="p">,</span><span class="s2">&quot;and&quot;</span><span class="p">,</span><span class="n">p</span><span class="o">+</span><span class="n">ME</span><span class="p">,</span><span class="s2">&quot;; Is&quot;</span><span class="p">,</span><span class="n">p_hat</span><span class="p">,</span><span class="s2">&quot;inside this range?&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The confidence interval is between 0.4959 and 0.5041 ; Is 0.5005 inside this range?
</pre></div>
</div>
</div>
</div>
<p>We have another pass! Great, so far it still seems all is well with our experiment results. Now, for the final metric which is a probability.</p>
</div>
<div class="section" id="sanity-checks-for-differences-between-probabilities-a-class-anchor-id-check-prob-a">
<h5>6.2.2 Sanity Checks for differences between probabilities <a class="anchor" id="check_prob"></a><a class="headerlink" href="#sanity-checks-for-differences-between-probabilities-a-class-anchor-id-check-prob-a" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><p>** Click-through-probability of the Free Trial Button**
In this case, we want to make sure the proportion of clicks given a pageview (our observed CTP) is about the same in both groups (since this was not expected to change due to the experiment). In order to check this out we will calculate the CTP in each group and calculate a confidence interval for the expected difference between them.</p></li>
</ul>
<p>In other words, we expect to see no difference (<span class="math notranslate nohighlight">\(CTP_{exp}-CTP_{cont}=0\)</span>), with an acceptable margin of error, dictated by our calculated confidence interval. The changes we should notice are for the calculation of the standard error - which in this case is a pooled standard error.</p>
<center><font size="4">$SD_{pool}=\sqrt{\hat{p_{pool}}(1-\hat{p_{pool}}(\frac{1}{N_{cont}}+\frac{1}{N_{exp}})}$</font></center>
with <br> <center><font size="5"> $\hat{p_{pool}}=\frac{x_{cont}+x_{exp}}{N_{cont}+N_{exp}}$ </font></center>
We should understand that CTP is a proportion in a population (amount of events x in a population n) like the amount of clicks out of the amount of pageviews..<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ctp_cont</span><span class="o">=</span><span class="n">clicks_cont</span><span class="o">/</span><span class="n">pageviews_cont</span>
<span class="n">ctp_exp</span><span class="o">=</span><span class="n">clicks_exp</span><span class="o">/</span><span class="n">pageviews_exp</span>
<span class="n">d_hat</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">ctp_exp</span><span class="o">-</span><span class="n">ctp_cont</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">p_pooled</span><span class="o">=</span><span class="n">clicks_total</span><span class="o">/</span><span class="n">pageviews_total</span>
<span class="n">sd_pooled</span><span class="o">=</span><span class="n">mt</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">p_pooled</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p_pooled</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">pageviews_cont</span><span class="o">+</span><span class="mi">1</span><span class="o">/</span><span class="n">pageviews_exp</span><span class="p">))</span>
<span class="n">ME</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">get_z_score</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="n">alpha</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="n">sd_pooled</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;The confidence interval is between&quot;</span><span class="p">,</span><span class="mi">0</span><span class="o">-</span><span class="n">ME</span><span class="p">,</span><span class="s2">&quot;and&quot;</span><span class="p">,</span><span class="mi">0</span><span class="o">+</span><span class="n">ME</span><span class="p">,</span><span class="s2">&quot;; Is&quot;</span><span class="p">,</span><span class="n">d_hat</span><span class="p">,</span><span class="s2">&quot;within this range?&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The confidence interval is between -0.0013 and 0.0013 ; Is 0.0001 within this range?
</pre></div>
</div>
</div>
</div>
<p>Wonderful. It seems this test has passed with flying colors as well.</p>
</div>
</div>
<div class="section" id="examining-effect-size-a-class-anchor-id-effect-a">
<h4>6.3 Examining effect size <a class="anchor" id="effect"></a><a class="headerlink" href="#examining-effect-size-a-class-anchor-id-effect-a" title="Permalink to this headline">¶</a></h4>
<p>The next step is looking at the changes between the control and experiment groups with regard to our evaluation metrics to make sure the difference is there, that it is statistically significant and most importantly practically significant (the difference is “big” enough to make the experimented change beneficial to the company).</p>
<p>Now, all that is left is to measure for each evaluation metric, the difference between the values from both groups. Then, we compute the confidence interval for that difference and test whether or not this confidence interval is both statistically and practically significant.</p>
<ul class="simple">
<li><p><strong>Gross Conversion</strong>
A metric is statistically significant if the confidence interval does not include 0 (that is, you can be confident there was a change), and it is practically significant if the confidence interval does not include the practical significance boundary (that is, you can be confident there is a change that matters to the business.)</p></li>
</ul>
<blockquote>
<div><p><strong>Important:</strong> The given spreadsheet lists pageviews and clicks for 39 days, while it only lists enrollments and payments for 23 days. So, when working with enrollments and payments we should notice using only the corresponding pageviews and clicks, and not all of them.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Count the total clicks from complete records only</span>
<span class="n">clicks_cont</span><span class="o">=</span><span class="n">control</span><span class="p">[</span><span class="s2">&quot;Clicks&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">control</span><span class="p">[</span><span class="s2">&quot;Enrollments&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">clicks_exp</span><span class="o">=</span><span class="n">experiment</span><span class="p">[</span><span class="s2">&quot;Clicks&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">experiment</span><span class="p">[</span><span class="s2">&quot;Enrollments&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#Gross Conversion - number of enrollments divided by number of clicks</span>
<span class="n">enrollments_cont</span><span class="o">=</span><span class="n">control</span><span class="p">[</span><span class="s2">&quot;Enrollments&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">enrollments_exp</span><span class="o">=</span><span class="n">experiment</span><span class="p">[</span><span class="s2">&quot;Enrollments&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="n">GC_cont</span><span class="o">=</span><span class="n">enrollments_cont</span><span class="o">/</span><span class="n">clicks_cont</span>
<span class="n">GC_exp</span><span class="o">=</span><span class="n">enrollments_exp</span><span class="o">/</span><span class="n">clicks_exp</span>
<span class="n">GC_pooled</span><span class="o">=</span><span class="p">(</span><span class="n">enrollments_cont</span><span class="o">+</span><span class="n">enrollments_exp</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">clicks_cont</span><span class="o">+</span><span class="n">clicks_exp</span><span class="p">)</span>
<span class="n">GC_sd_pooled</span><span class="o">=</span><span class="n">mt</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">GC_pooled</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">GC_pooled</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">clicks_cont</span><span class="o">+</span><span class="mi">1</span><span class="o">/</span><span class="n">clicks_exp</span><span class="p">))</span>
<span class="n">GC_ME</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">get_z_score</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">alpha</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">GC_sd_pooled</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">GC_diff</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">GC_exp</span><span class="o">-</span><span class="n">GC_cont</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The change due to the experiment is&quot;</span><span class="p">,</span><span class="n">GC_diff</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="s2">&quot;%&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Confidence Interval: [&quot;</span><span class="p">,</span><span class="n">GC_diff</span><span class="o">-</span><span class="n">GC_ME</span><span class="p">,</span><span class="s2">&quot;,&quot;</span><span class="p">,</span><span class="n">GC_diff</span><span class="o">+</span><span class="n">GC_ME</span><span class="p">,</span><span class="s2">&quot;]&quot;</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;The change is statistically significant if the CI doesn&#39;t include 0. In that case, it is practically significant if&quot;</span><span class="p">,</span><span class="o">-</span><span class="n">GC</span><span class="p">[</span><span class="s2">&quot;d_min&quot;</span><span class="p">],</span><span class="s2">&quot;is not in the CI as well.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The change due to the experiment is -2.06 %
Confidence Interval: [ -0.0292 , -0.012 ]
The change is statistically significant if the CI doesn&#39;t include 0. In that case, it is practically significant if -0.01 is not in the CI as well.
</pre></div>
</div>
</div>
</div>
<p>According to this result there was a change due to the experiment, that change was both statistically and practically significant.
We have a negative change of 2.06%, when we were willing to accept any change greater than 1%. This means the Gross Conversion rate of the experiment group (the one exposed to the change, i.e. asked how many hours they can devote to studying) has decreased as expected by 2% and this change was significant. This means  less people enrolled in the Free Trial after due to the pop-up.</p>
<ul class="simple">
<li><p><strong>Net Conversion</strong>
The hypothesis is the same as before just with net conversion instead of gross. At this point we expect the fraction of payers (out of the clicks) to decrease as well.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#Net Conversion - number of payments divided by number of clicks</span>
<span class="n">payments_cont</span><span class="o">=</span><span class="n">control</span><span class="p">[</span><span class="s2">&quot;Payments&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">payments_exp</span><span class="o">=</span><span class="n">experiment</span><span class="p">[</span><span class="s2">&quot;Payments&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="n">NC_cont</span><span class="o">=</span><span class="n">payments_cont</span><span class="o">/</span><span class="n">clicks_cont</span>
<span class="n">NC_exp</span><span class="o">=</span><span class="n">payments_exp</span><span class="o">/</span><span class="n">clicks_exp</span>
<span class="n">NC_pooled</span><span class="o">=</span><span class="p">(</span><span class="n">payments_cont</span><span class="o">+</span><span class="n">payments_exp</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">clicks_cont</span><span class="o">+</span><span class="n">clicks_exp</span><span class="p">)</span>
<span class="n">NC_sd_pooled</span><span class="o">=</span><span class="n">mt</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">NC_pooled</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">NC_pooled</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">clicks_cont</span><span class="o">+</span><span class="mi">1</span><span class="o">/</span><span class="n">clicks_exp</span><span class="p">))</span>
<span class="n">NC_ME</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">get_z_score</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">alpha</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">NC_sd_pooled</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="n">NC_diff</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">NC_exp</span><span class="o">-</span><span class="n">NC_cont</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The change due to the experiment is&quot;</span><span class="p">,</span><span class="n">NC_diff</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="s2">&quot;%&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Confidence Interval: [&quot;</span><span class="p">,</span><span class="n">NC_diff</span><span class="o">-</span><span class="n">NC_ME</span><span class="p">,</span><span class="s2">&quot;,&quot;</span><span class="p">,</span><span class="n">NC_diff</span><span class="o">+</span><span class="n">NC_ME</span><span class="p">,</span><span class="s2">&quot;]&quot;</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;The change is statistically significant if the CI doesn&#39;t include 0. In that case, it is practically significant if&quot;</span><span class="p">,</span><span class="n">NC</span><span class="p">[</span><span class="s2">&quot;d_min&quot;</span><span class="p">],</span><span class="s2">&quot;is not in the CI as well.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The change due to the experiment is -0.49 %
Confidence Interval: [ -0.0116 , 0.0018000000000000004 ]
The change is statistically significant if the CI doesn&#39;t include 0. In that case, it is practically significant if 0.0075 is not in the CI as well.
</pre></div>
</div>
</div>
</div>
<p>In this case we got a change size of less than a 0.5%, a very small decrease which is not statistically significant, and as such not practically significant.</p>
</div>
</div>
<div class="section" id="double-check-with-sign-tests-a-class-anchor-id-sign-tests-a">
<h3>6.4 Double check with Sign Tests <a class="anchor" id="sign_tests"></a><a class="headerlink" href="#double-check-with-sign-tests-a-class-anchor-id-sign-tests-a" title="Permalink to this headline">¶</a></h3>
<p>In a sign test we get another angle at analyzing the results we got - we check if the trend of change we observed (increase or decrease) was evident in the daily data. We are goint to compute the metric’s value per day and then count on how many days the metric was lower in the experiment group and this will be the number of succssesses for our binomial variable. Once this is defined we can look at the proportion of days of success out of all the available days.</p>
<div class="section" id="data-preparation-a-class-anchor-id-prep-a">
<h4>6.4.1 Data Preparation <a class="anchor" id="prep"></a><a class="headerlink" href="#data-preparation-a-class-anchor-id-prep-a" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#let&#39;s first create the dataset we need for this:</span>
<span class="c1"># start by merging the two datasets</span>
<span class="n">full</span><span class="o">=</span><span class="n">control</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">other</span><span class="o">=</span><span class="n">experiment</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span><span class="n">lsuffix</span><span class="o">=</span><span class="s2">&quot;_cont&quot;</span><span class="p">,</span><span class="n">rsuffix</span><span class="o">=</span><span class="s2">&quot;_exp&quot;</span><span class="p">)</span>
<span class="c1">#Let&#39;s look at what we got</span>
<span class="n">full</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Date_cont           37
Pageviews_cont      37
Clicks_cont         37
Enrollments_cont    23
Payments_cont       23
Date_exp            37
Pageviews_exp       37
Clicks_exp          37
Enrollments_exp     23
Payments_exp        23
dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#now we only need the complete data records</span>
<span class="n">full</span><span class="o">=</span><span class="n">full</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">full</span><span class="p">[</span><span class="s2">&quot;Enrollments_cont&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span>
<span class="n">full</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Date_cont           23
Pageviews_cont      23
Clicks_cont         23
Enrollments_cont    23
Payments_cont       23
Date_exp            23
Pageviews_exp       23
Clicks_exp          23
Enrollments_exp     23
Payments_exp        23
dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Perfect! Now, derive a new column for each metric, so we have it&#39;s daily values</span>
<span class="c1"># We need a 1 if the experiment value is greater than the control value=</span>
<span class="n">x</span><span class="o">=</span><span class="n">full</span><span class="p">[</span><span class="s1">&#39;Enrollments_cont&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">full</span><span class="p">[</span><span class="s1">&#39;Clicks_cont&#39;</span><span class="p">]</span>
<span class="n">y</span><span class="o">=</span><span class="n">full</span><span class="p">[</span><span class="s1">&#39;Enrollments_exp&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">full</span><span class="p">[</span><span class="s1">&#39;Clicks_exp&#39;</span><span class="p">]</span>
<span class="n">full</span><span class="p">[</span><span class="s1">&#39;GC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;</span><span class="n">y</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># The same now for net conversion</span>
<span class="n">z</span><span class="o">=</span><span class="n">full</span><span class="p">[</span><span class="s1">&#39;Payments_cont&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">full</span><span class="p">[</span><span class="s1">&#39;Clicks_cont&#39;</span><span class="p">]</span>
<span class="n">w</span><span class="o">=</span><span class="n">full</span><span class="p">[</span><span class="s1">&#39;Payments_exp&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">full</span><span class="p">[</span><span class="s1">&#39;Clicks_exp&#39;</span><span class="p">]</span>
<span class="n">full</span><span class="p">[</span><span class="s1">&#39;NC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">z</span><span class="o">&lt;</span><span class="n">w</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">full</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date_cont</th>
      <th>Pageviews_cont</th>
      <th>Clicks_cont</th>
      <th>Enrollments_cont</th>
      <th>Payments_cont</th>
      <th>Date_exp</th>
      <th>Pageviews_exp</th>
      <th>Clicks_exp</th>
      <th>Enrollments_exp</th>
      <th>Payments_exp</th>
      <th>GC</th>
      <th>NC</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Sat, Oct 11</td>
      <td>7723</td>
      <td>687</td>
      <td>134.0</td>
      <td>70.0</td>
      <td>Sat, Oct 11</td>
      <td>7716</td>
      <td>686</td>
      <td>105.0</td>
      <td>34.0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Sun, Oct 12</td>
      <td>9102</td>
      <td>779</td>
      <td>147.0</td>
      <td>70.0</td>
      <td>Sun, Oct 12</td>
      <td>9288</td>
      <td>785</td>
      <td>116.0</td>
      <td>91.0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Mon, Oct 13</td>
      <td>10511</td>
      <td>909</td>
      <td>167.0</td>
      <td>95.0</td>
      <td>Mon, Oct 13</td>
      <td>10480</td>
      <td>884</td>
      <td>145.0</td>
      <td>79.0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Tue, Oct 14</td>
      <td>9871</td>
      <td>836</td>
      <td>156.0</td>
      <td>105.0</td>
      <td>Tue, Oct 14</td>
      <td>9867</td>
      <td>827</td>
      <td>138.0</td>
      <td>92.0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Wed, Oct 15</td>
      <td>10014</td>
      <td>837</td>
      <td>163.0</td>
      <td>64.0</td>
      <td>Wed, Oct 15</td>
      <td>9793</td>
      <td>832</td>
      <td>140.0</td>
      <td>94.0</td>
      <td>0</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">GC_x</span><span class="o">=</span><span class="n">full</span><span class="o">.</span><span class="n">GC</span><span class="p">[</span><span class="n">full</span><span class="p">[</span><span class="s2">&quot;GC&quot;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">NC_x</span><span class="o">=</span><span class="n">full</span><span class="o">.</span><span class="n">NC</span><span class="p">[</span><span class="n">full</span><span class="p">[</span><span class="s2">&quot;NC&quot;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">n</span><span class="o">=</span><span class="n">full</span><span class="o">.</span><span class="n">NC</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No. of cases for GC:&quot;</span><span class="p">,</span><span class="n">GC_x</span><span class="p">,</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
      <span class="s2">&quot;No. of cases for NC:&quot;</span><span class="p">,</span><span class="n">NC_x</span><span class="p">,</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
      <span class="s2">&quot;No. of total cases&quot;</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>No. of cases for GC: 4 
 No. of cases for NC: 10 
 No. of total cases 23
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="building-a-sign-test-a-class-anchor-id-sign-a">
<h4>6.4.2 Building a Sign Test <a class="anchor" id="sign"></a><a class="headerlink" href="#building-a-sign-test-a-class-anchor-id-sign-a" title="Permalink to this headline">¶</a></h4>
<p>We can forget all about this part and just use an <a class="reference external" href="https://www.graphpad.com/quickcalcs/binomial2/">online sign test calculator</a>, but for me that is just no fun - so I will implement the calculations behind it. <br>
What we want to do after we count the amount of days in which the experiment group had a higher metric value than that of the control group, is to see if that number is likely to be seen again in a new experiment (significance). We assume the chance of a day like this is random (50% chance to happen) and then use the binomial distribution with <span class="math notranslate nohighlight">\(p=0.5\)</span> and the number of experiments (days) to tell us the probability of this happening according to a random chance.<br>
So, according to the binomial distribution with <span class="math notranslate nohighlight">\(p=0.5\)</span> and <span class="math notranslate nohighlight">\(n=\)</span>total number of days; we want to now the probability of <span class="math notranslate nohighlight">\(x\)</span> days being a success (higher metric value in experiment). Because we are doing a two-tailed test we want to double this probability and once we have we can call it the <span class="math notranslate nohighlight">\(p-value\)</span> and compare it to our <span class="math notranslate nohighlight">\(\alpha\)</span>. If the <span class="math notranslate nohighlight">\(p-value\)</span> is greater than the <span class="math notranslate nohighlight">\(\alpha\)</span> the result is not significant and vice-versa.<br></p>
<center><font size="4"> $p(successes )=\frac{n!}{x!(n-x)!}p^x(1-p)^{n-x}$ </font></center>
Recall that a $p-value$ is the probability of observing a test statistic as or more extreme than that observed. If we observed 2 days like that, the $p-value$ for the test is: $p-value = P(x <= 2)$. We only need to remember the following:<br>
<center>$P(x<=2)=P(0)+P(1)+P(2)$.</center><br>For more detailed information, visit [this excellent page](http://sphweb.bumc.bu.edu/otlt/mph-modules/bs/bs704_nonparametric/BS704_Nonparametric5.html).
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#first a function for calculating probability of x=number of successes</span>
<span class="k">def</span> <span class="nf">get_prob</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
    <span class="n">p</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">mt</span><span class="o">.</span><span class="n">factorial</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">mt</span><span class="o">.</span><span class="n">factorial</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">mt</span><span class="o">.</span><span class="n">factorial</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="n">x</span><span class="p">))</span><span class="o">*</span><span class="mf">0.5</span><span class="o">**</span><span class="n">x</span><span class="o">*</span><span class="mf">0.5</span><span class="o">**</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="n">x</span><span class="p">),</span><span class="mi">4</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">p</span>
<span class="c1">#next a function to compute the pvalue from probabilities of maximum x</span>
<span class="k">def</span> <span class="nf">get_2side_pvalue</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
    <span class="n">p</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="o">+</span><span class="n">get_prob</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">p</span>
</pre></div>
</div>
</div>
</div>
<p>Finally, to conduct the sign test itself: we will calculate the p-value for each metric, using the counts <code class="docutils literal notranslate"><span class="pre">GC_x</span></code>,<code class="docutils literal notranslate"><span class="pre">NC_x</span></code> and <code class="docutils literal notranslate"><span class="pre">n</span></code> and the function <code class="docutils literal notranslate"><span class="pre">get_2side_pvalue</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;GC Change is significant if&quot;</span><span class="p">,</span><span class="n">get_2side_pvalue</span><span class="p">(</span><span class="n">GC_x</span><span class="p">,</span><span class="n">n</span><span class="p">),</span><span class="s2">&quot;is smaller than 0.05&quot;</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;NC Change is significant if&quot;</span><span class="p">,</span><span class="n">get_2side_pvalue</span><span class="p">(</span><span class="n">NC_x</span><span class="p">,</span><span class="n">n</span><span class="p">),</span><span class="s2">&quot;is smaller than 0.05&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GC Change is significant if 0.0026000000000000003 is smaller than 0.05
NC Change is significant if 0.6774 is smaller than 0.05
</pre></div>
</div>
</div>
</div>
<p>We get the same conclusions as we got from our effect size calculation: the change in Gross conversion was indeed significant, while the change in Net conversion was not.</p>
</div>
</div>
<div class="section" id="conclusions-recommendations-a-class-anchor-id-conclusions-a">
<h3>7 Conclusions &amp; Recommendations <a class="anchor" id="conclusions"></a><a class="headerlink" href="#conclusions-recommendations-a-class-anchor-id-conclusions-a" title="Permalink to this headline">¶</a></h3>
<p>At this point, once we have seen that the actual underlying goal we had was not reached (increase fraction of paying users by asking them in advance if they have the time to invest in the course), we can only recommend to not continue with change. It may have caused a change in Gross conversion, but it didn’t for net conversion.</p>
<p>A wonderful summary of this experiment, analysis and results, by the amazing Andrew Bauman, can be found <a class="reference external" href="https://github.com/baumanab/udacity_ABTesting#summary">here</a>.</p>
</div>
</div>
<div class="section" id="a-b-testing-step-by-step-guide-in-python">
<h2>A/B testing step-by-step guide in Python<a class="headerlink" href="#a-b-testing-step-by-step-guide-in-python" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>In this notebook we’ll go over the process of analysing an A/B test, from formulating a hypothesis, testing it, and finally interpreting results.</p>
</div></blockquote>
<p>In this notebook we’ll go over the process of analysing an A/B test, from formulating a hypothesis, testing it, and finally interpreting results. For our data, we’ll use a <a href='https://www.kaggle.com/zhangluyuan/ab-testing?select=ab_data.csv'>dataset from Kaggle</a> which contains the results of an A/B test on what seems to be 2 different designs of a website page (old_page vs. new_page). Here’s what we’ll do:</p>
<ol class="simple">
<li><p>Designing our experiment</p></li>
<li><p>Collecting and preparing the data</p></li>
<li><p>Visualising the results</p></li>
<li><p>Testing the hypothesis</p></li>
<li><p>Drawing conclusions</p></li>
</ol>
<p>To make it a bit more realistic, here’s a potential <strong>scenario</strong> for our study:</p>
<blockquote>
<div><p>Let’s imagine you work on the product team at a medium-sized <strong>online e-commerce business</strong>. The UX designer worked really hard on a new version of the product page, with the hope that it will lead to a higher conversion rate. The product manager (PM) told you that the <strong>current conversion rate</strong> is about <strong>13%</strong> on average throughout the year, and that the team would be happy with an <strong>increase of 2%</strong>, meaning that the new design will be considered a success if it raises the conversion rate to 15%.</p>
</div></blockquote>
<p>Before rolling out the change, the team would be more comfortable testing it on a small number of users to see how it performs, so you suggest running an <strong>A/B test</strong> on a subset of your user base users.</p>
<hr class="docutils" />
<div class="section" id="designing-our-experiment">
<h3>1. Designing our experiment<a class="headerlink" href="#designing-our-experiment" title="Permalink to this headline">¶</a></h3>
<div class="section" id="formulating-a-hypothesis">
<h4>Formulating a hypothesis<a class="headerlink" href="#formulating-a-hypothesis" title="Permalink to this headline">¶</a></h4>
<p>First things first, we want to make sure we formulate a hypothesis at the start of our project. This will make sure our interpretation of the results is correct as well as rigorous.</p>
<p>Given we don’t know if the new design will perform better or worse (or the same?) as our current design, we’ll choose a <a href="https://en.wikipedia.org/wiki/One-_and_two-tailed_tests"><strong>two-tailed test</strong></a>:</p>
<div class="math notranslate nohighlight">
\[H_0: p = p_0\]</div>
<div class="math notranslate nohighlight">
\[H_a: p \ne p_0\]</div>
<p>where <span class="math notranslate nohighlight">\(p\)</span> and <span class="math notranslate nohighlight">\(p_0\)</span> stand for the conversion rate of the new and old design, respectively. We’ll also set a <strong>confidence level of 95%</strong>:</p>
<div class="math notranslate nohighlight">
\[\alpha = 0.05\]</div>
<p>The <span class="math notranslate nohighlight">\(\alpha\)</span> value is a threshold we set, by which we say “if the probability of observing a result as extreme or more (<span class="math notranslate nohighlight">\(p\)</span>-value) is lower than <span class="math notranslate nohighlight">\(\alpha\)</span>, then we reject the null hypothesis”. Since our <span class="math notranslate nohighlight">\(\alpha=0.05\)</span> (indicating 5% probability), our confidence (1 - <span class="math notranslate nohighlight">\(\alpha\)</span>) is 95%.</p>
<p>Don’t worry if you are not familiar with the above, all this really means is that whatever conversion rate we observe for our new design in our test, we want to be 95% confident it is statistically different from the conversion rate of our old design, before we decide to reject the Null hypothesis <span class="math notranslate nohighlight">\(H_0\)</span>.</p>
</div>
<div class="section" id="choosing-the-variables">
<h4>Choosing the variables<a class="headerlink" href="#choosing-the-variables" title="Permalink to this headline">¶</a></h4>
<p>For our test we’ll need <strong>two groups</strong>:</p>
<ul class="simple">
<li><p>A <code class="docutils literal notranslate"><span class="pre">control</span></code> group - They’ll be shown the old design</p></li>
<li><p>A <code class="docutils literal notranslate"><span class="pre">treatment</span></code> (or experimental) group - They’ll be shown the new design</p></li>
</ul>
<p>This will be our <em>Independent Variable</em>. The reason we have two groups even though we know the baseline conversion rate is that we want to control for other variables that could have an effect on our results, such as seasonality: by having a <code class="docutils literal notranslate"><span class="pre">control</span></code> group we can directly compare their results to the <code class="docutils literal notranslate"><span class="pre">treatment</span></code> group, because the only systematic difference between the groups is the design of the product page, and we can therefore attribute any differences in results to the designs.</p>
<p>For our <em>Dependent Variable</em> (i.e. what we are trying to measure), we are interested in capturing the <code class="docutils literal notranslate"><span class="pre">conversion</span> <span class="pre">rate</span></code>. A way we can code this is by  each user session with a binary variable:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">0</span></code> - The user did not buy the product during this user session</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code> - The user bought the product during this user session</p></li>
</ul>
<p>This way, we can easily calculate the mean for each group to get the conversion rate of each design.</p>
</div>
<div class="section" id="choosing-a-sample-size">
<h4>Choosing a sample size<a class="headerlink" href="#choosing-a-sample-size" title="Permalink to this headline">¶</a></h4>
<p>It is important to note that since we won’t test the whole user base (our <a href="https://www.bmj.com/about-bmj/resources-readers/publications/statistics-square-one/3-populations-and-samples">population</a>), the conversion rates that we’ll get will inevitably be only <em>estimates</em> of the true rates.</p>
<p>The number of people (or user sessions) we decide to capture in each group will have an effect on the precision of our estimated conversion rates: <strong>the larger the sample size</strong>, the more precise our estimates (i.e. the smaller our confidence intervals), <strong>the higher the chance to detect a difference</strong> in the two groups, if present.</p>
<p>On the other hand, the larger our sample gets, the more expensive (and impractical) our study becomes.</p>
<p><em>So how many people should we have in each group?</em></p>
<p>The sample size we need is estimated through something called <a href="https://research.usu.edu//irb/wp-content/uploads/sites/12/2015/08/A_Researchers_Guide_to_Power_Analysis_USU.pdf"><em>Power analysis</em></a>, and it depends on a few factors:</p>
<ul class="simple">
<li><p><strong>Power of the test</strong> (<span class="math notranslate nohighlight">\(1 - \beta\)</span>) - This represents the probability of finding a statistical difference between the groups in our test when a difference is actually present. This is usually set at 0.8 as a convention (here’s more info on <a href="https://en.wikipedia.org/wiki/Power_of_a_test">statistical power</a>, if you are curious)</p></li>
<li><p><strong>Alpha value</strong> (<span class="math notranslate nohighlight">\(\alpha\)</span>) - The critical value we set earlier to 0.05</p></li>
<li><p><strong>Effect size</strong> - How big of a difference we expect there to be between the conversion rates</p></li>
</ul>
<p>Since our team would be happy with a difference of 2%, we can use 13% and 15% to calculate the effect size we expect.</p>
<p>Luckily, <strong>Python takes care of all these calculations for us</strong>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Packages imports</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>
<span class="kn">import</span> <span class="nn">statsmodels.stats.api</span> <span class="k">as</span> <span class="nn">sms</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">ceil</span>

<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

<span class="c1"># Some plot styling preferences</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;seaborn-whitegrid&#39;</span><span class="p">)</span>
<span class="n">font</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;family&#39;</span> <span class="p">:</span> <span class="s1">&#39;Helvetica&#39;</span><span class="p">,</span>
        <span class="s1">&#39;weight&#39;</span> <span class="p">:</span> <span class="s1">&#39;bold&#39;</span><span class="p">,</span>
        <span class="s1">&#39;size&#39;</span>   <span class="p">:</span> <span class="mi">14</span><span class="p">}</span>

<span class="n">mpl</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">font</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">effect_size</span> <span class="o">=</span> <span class="n">sms</span><span class="o">.</span><span class="n">proportion_effectsize</span><span class="p">(</span><span class="mf">0.13</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">)</span>    <span class="c1"># Calculating effect size based on our expected rates</span>

<span class="n">required_n</span> <span class="o">=</span> <span class="n">sms</span><span class="o">.</span><span class="n">NormalIndPower</span><span class="p">()</span><span class="o">.</span><span class="n">solve_power</span><span class="p">(</span>
    <span class="n">effect_size</span><span class="p">,</span> 
    <span class="n">power</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> 
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> 
    <span class="n">ratio</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>                                                  <span class="c1"># Calculating sample size needed</span>

<span class="n">required_n</span> <span class="o">=</span> <span class="n">ceil</span><span class="p">(</span><span class="n">required_n</span><span class="p">)</span>                          <span class="c1"># Rounding up to next whole number                          </span>

<span class="nb">print</span><span class="p">(</span><span class="n">required_n</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4720
</pre></div>
</div>
</div>
</div>
<p>We’d need <strong>at least 4720 observations for each group</strong>.</p>
<p>Having set the <code class="docutils literal notranslate"><span class="pre">power</span></code> parameter to 0.8 in practice means that if there exists an actual difference in conversion rate between our designs, assuming the difference is the one we estimated (13% vs. 15%), we have about 80% chance to detect it as statistically significant in our test with the sample size we calculated.</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="collecting-and-preparing-the-data">
<h3>2. Collecting and preparing the data<a class="headerlink" href="#collecting-and-preparing-the-data" title="Permalink to this headline">¶</a></h3>
<p>Great stuff! So now that we have our required sample size, we need to collect the data. Usually at this point you would work with your team to set up the experiment, likely with the help of the Engineering team, and make sure that you collect enough data based on the sample size needed.</p>
<p>However, since we’ll use a dataset that we found online, in order to simulate this situation we’ll:</p>
<ol class="simple">
<li><p>Download the <a href='https://www.kaggle.com/zhangluyuan/ab-testing?select=ab_data.csv'>dataset from Kaggle</a></p></li>
<li><p>Read the data into a pandas DataFrame</p></li>
<li><p>Check and clean the data as needed</p></li>
<li><p>Randomly sample <code class="docutils literal notranslate"><span class="pre">n=4720</span></code> rows from the DataFrame for each group *****</p></li>
</ol>
<p>*<strong>Note</strong>: Normally, we would not need to perform step 4, this is just for the sake of the exercise</p>
<p>Since I already downloaded the dataset, I’ll go straight to number 2.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://github.com/sparsh-ai/reco-data/raw/master/ab-testing.zip&#39;</span><span class="p">)</span>

<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>user_id</th>
      <th>timestamp</th>
      <th>group</th>
      <th>landing_page</th>
      <th>converted</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>851104</td>
      <td>2017-01-21 22:11:48.556739</td>
      <td>control</td>
      <td>old_page</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>804228</td>
      <td>2017-01-12 08:01:45.159739</td>
      <td>control</td>
      <td>old_page</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>661590</td>
      <td>2017-01-11 16:55:06.154213</td>
      <td>treatment</td>
      <td>new_page</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>853541</td>
      <td>2017-01-08 18:28:03.143765</td>
      <td>treatment</td>
      <td>new_page</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>864975</td>
      <td>2017-01-21 01:52:26.210827</td>
      <td>control</td>
      <td>old_page</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 294478 entries, 0 to 294477
Data columns (total 5 columns):
 #   Column        Non-Null Count   Dtype 
---  ------        --------------   ----- 
 0   user_id       294478 non-null  int64 
 1   timestamp     294478 non-null  object
 2   group         294478 non-null  object
 3   landing_page  294478 non-null  object
 4   converted     294478 non-null  int64 
dtypes: int64(2), object(3)
memory usage: 11.2+ MB
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># To make sure all the control group are seeing the old page and viceversa</span>

<span class="n">pd</span><span class="o">.</span><span class="n">crosstab</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;landing_page&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>landing_page</th>
      <th>new_page</th>
      <th>old_page</th>
    </tr>
    <tr>
      <th>group</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>control</th>
      <td>1928</td>
      <td>145274</td>
    </tr>
    <tr>
      <th>treatment</th>
      <td>145311</td>
      <td>1965</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>There are <strong>294478 rows</strong> in the DataFrame, each representing a user session, as well as <strong>5 columns</strong> :</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">user_id</span></code> - The user ID of each session</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">timestamp</span></code> - Timestamp for the session</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">group</span></code> - Which group the user was assigned to for that session {<code class="docutils literal notranslate"><span class="pre">control</span></code>, <code class="docutils literal notranslate"><span class="pre">treatment</span></code>}</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">landing_page</span></code> - Which design each user saw on that session {<code class="docutils literal notranslate"><span class="pre">old_page</span></code>, <code class="docutils literal notranslate"><span class="pre">new_page</span></code>}</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">converted</span></code> - Whether the session ended in a conversion or not (binary, <code class="docutils literal notranslate"><span class="pre">0</span></code>=not converted, <code class="docutils literal notranslate"><span class="pre">1</span></code>=converted)</p></li>
</ul>
<p>We’ll actually only use the <code class="docutils literal notranslate"><span class="pre">group</span></code> and <code class="docutils literal notranslate"><span class="pre">converted</span></code> columns for the analysis.</p>
<p>Before we go ahead and sample the data to get our subset, let’s make sure there are no users that have been sampled multiple times.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">session_counts</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">multi_users</span> <span class="o">=</span> <span class="n">session_counts</span><span class="p">[</span><span class="n">session_counts</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;There are </span><span class="si">{</span><span class="n">multi_users</span><span class="si">}</span><span class="s1"> users that appear multiple times in the dataset&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>There are 3894 users that appear multiple times in the dataset
</pre></div>
</div>
</div>
</div>
<p>There are, in fact, users that appear more than once. Since the number is pretty low, we’ll go ahead and remove them from the DataFrame to avoid sampling the same users twice.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">users_to_drop</span> <span class="o">=</span> <span class="n">session_counts</span><span class="p">[</span><span class="n">session_counts</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">users_to_drop</span><span class="p">)]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The updated dataset now has </span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> entries&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The updated dataset now has 286690 entries
</pre></div>
</div>
</div>
</div>
<div class="section" id="sampling">
<h4>Sampling<a class="headerlink" href="#sampling" title="Permalink to this headline">¶</a></h4>
<p>Now that our DataFrame is nice and clean, we can proceed and sample <code class="docutils literal notranslate"><span class="pre">n=4720</span></code> entries for each of the groups. We can use pandas’ <code class="docutils literal notranslate"><span class="pre">DataFrame.sample()</span></code> method to do this, which will perform Simple Random Sampling for us.</p>
<p><strong>Note</strong>: I’ve set <code class="docutils literal notranslate"><span class="pre">random_state=22</span></code> so that the results are reproducible if you feel like following on your own Notebook: just use <code class="docutils literal notranslate"><span class="pre">random_state=22</span></code> in your function and you should get the same sample as I did.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">control_sample</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;control&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">required_n</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">22</span><span class="p">)</span>
<span class="n">treatment_sample</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;treatment&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">required_n</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">22</span><span class="p">)</span>

<span class="n">ab_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">control_sample</span><span class="p">,</span> <span class="n">treatment_sample</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ab_test</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ab_test</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>user_id</th>
      <th>timestamp</th>
      <th>group</th>
      <th>landing_page</th>
      <th>converted</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>763854</td>
      <td>2017-01-21 03:43:17.188315</td>
      <td>control</td>
      <td>old_page</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>690555</td>
      <td>2017-01-18 06:38:13.079449</td>
      <td>control</td>
      <td>old_page</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>861520</td>
      <td>2017-01-06 21:13:40.044766</td>
      <td>control</td>
      <td>old_page</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>630778</td>
      <td>2017-01-05 16:42:36.995204</td>
      <td>control</td>
      <td>old_page</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>656634</td>
      <td>2017-01-04 15:31:21.676130</td>
      <td>control</td>
      <td>old_page</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>9435</th>
      <td>908512</td>
      <td>2017-01-14 22:02:29.922674</td>
      <td>treatment</td>
      <td>new_page</td>
      <td>0</td>
    </tr>
    <tr>
      <th>9436</th>
      <td>873211</td>
      <td>2017-01-05 00:57:16.167151</td>
      <td>treatment</td>
      <td>new_page</td>
      <td>0</td>
    </tr>
    <tr>
      <th>9437</th>
      <td>631276</td>
      <td>2017-01-20 18:56:58.167809</td>
      <td>treatment</td>
      <td>new_page</td>
      <td>0</td>
    </tr>
    <tr>
      <th>9438</th>
      <td>662301</td>
      <td>2017-01-03 08:10:57.768806</td>
      <td>treatment</td>
      <td>new_page</td>
      <td>0</td>
    </tr>
    <tr>
      <th>9439</th>
      <td>944623</td>
      <td>2017-01-19 10:56:01.648653</td>
      <td>treatment</td>
      <td>new_page</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
<p>9440 rows × 5 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ab_test</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 9440 entries, 0 to 9439
Data columns (total 5 columns):
 #   Column        Non-Null Count  Dtype 
---  ------        --------------  ----- 
 0   user_id       9440 non-null   int64 
 1   timestamp     9440 non-null   object
 2   group         9440 non-null   object
 3   landing_page  9440 non-null   object
 4   converted     9440 non-null   int64 
dtypes: int64(2), object(3)
memory usage: 368.9+ KB
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ab_test</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>control      4720
treatment    4720
Name: group, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>Great, looks like everything went as planned, and we are now ready to analyse our results.</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="visualising-the-results">
<h3>3. Visualising the results<a class="headerlink" href="#visualising-the-results" title="Permalink to this headline">¶</a></h3>
<p>The first thing we can do is to calculate some <strong>basic statistics</strong> to get an idea of what our samples look like.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conversion_rates</span> <span class="o">=</span> <span class="n">ab_test</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;group&#39;</span><span class="p">)[</span><span class="s1">&#39;converted&#39;</span><span class="p">]</span>

<span class="n">std_p</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>              <span class="c1"># Std. deviation of the proportion</span>
<span class="n">se_p</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">stats</span><span class="o">.</span><span class="n">sem</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>            <span class="c1"># Std. error of the proportion (std / sqrt(n))</span>

<span class="n">conversion_rates</span> <span class="o">=</span> <span class="n">conversion_rates</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">std_p</span><span class="p">,</span> <span class="n">se_p</span><span class="p">])</span>
<span class="n">conversion_rates</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;conversion_rate&#39;</span><span class="p">,</span> <span class="s1">&#39;std_deviation&#39;</span><span class="p">,</span> <span class="s1">&#39;std_error&#39;</span><span class="p">]</span>


<span class="n">conversion_rates</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:.3f}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style  type="text/css" >
</style><table id="T_669d6f68_d778_11eb_88e9_0242ac1c0002" ><thead>    <tr>        <th class="blank level0" ></th>        <th class="col_heading level0 col0" >conversion_rate</th>        <th class="col_heading level0 col1" >std_deviation</th>        <th class="col_heading level0 col2" >std_error</th>    </tr>    <tr>        <th class="index_name level0" >group</th>        <th class="blank" ></th>        <th class="blank" ></th>        <th class="blank" ></th>    </tr></thead><tbody>
                <tr>
                        <th id="T_669d6f68_d778_11eb_88e9_0242ac1c0002level0_row0" class="row_heading level0 row0" >control</th>
                        <td id="T_669d6f68_d778_11eb_88e9_0242ac1c0002row0_col0" class="data row0 col0" >0.123</td>
                        <td id="T_669d6f68_d778_11eb_88e9_0242ac1c0002row0_col1" class="data row0 col1" >0.329</td>
                        <td id="T_669d6f68_d778_11eb_88e9_0242ac1c0002row0_col2" class="data row0 col2" >0.005</td>
            </tr>
            <tr>
                        <th id="T_669d6f68_d778_11eb_88e9_0242ac1c0002level0_row1" class="row_heading level0 row1" >treatment</th>
                        <td id="T_669d6f68_d778_11eb_88e9_0242ac1c0002row1_col0" class="data row1 col0" >0.126</td>
                        <td id="T_669d6f68_d778_11eb_88e9_0242ac1c0002row1_col1" class="data row1 col1" >0.331</td>
                        <td id="T_669d6f68_d778_11eb_88e9_0242ac1c0002row1_col2" class="data row1 col2" >0.005</td>
            </tr>
    </tbody></table></div></div>
</div>
<p>Judging by the stats above, it does look like <strong>our two designs performed very similarly</strong>, with our new design performing slightly better, approx. <strong>12.3% vs. 12.6% conversion rate</strong>.</p>
<p>Plotting the data will make these results easier to grasp:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>

<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">ab_test</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">ab_test</span><span class="p">[</span><span class="s1">&#39;converted&#39;</span><span class="p">],</span> <span class="n">ci</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Conversion rate by group&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Group&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Converted (proportion)&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">15</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family [&#39;Helvetica&#39;] not found. Falling back to DejaVu Sans.
findfont: Font family [&#39;Helvetica&#39;] not found. Falling back to DejaVu Sans.
findfont: Font family [&#39;Helvetica&#39;] not found. Falling back to DejaVu Sans.
</pre></div>
</div>
<img alt="../_images/T313645_A_B_Testing_149_1.png" src="../_images/T313645_A_B_Testing_149_1.png" />
</div>
</div>
<p>The conversion rates for our groups are indeed very close. Also note that the conversion rate of the <code class="docutils literal notranslate"><span class="pre">control</span></code> group is lower than what we would have expected given what we knew about our avg. conversion rate (12.3% vs. 13%). This goes to show that there is some variation in results when sampling from a population.</p>
<p>So… the <code class="docutils literal notranslate"><span class="pre">treatment</span></code> group’s value is higher. <strong>Is this difference <em>statistically significant</em></strong>?</p>
</div>
<hr class="docutils" />
<div class="section" id="testing-the-hypothesis">
<h3>4. Testing the hypothesis<a class="headerlink" href="#testing-the-hypothesis" title="Permalink to this headline">¶</a></h3>
<p>The last step of our analysis is testing our hypothesis. Since we have a very large sample, we can use the <a href="https://en.wikipedia.org/wiki/Binomial_proportion_confidence_interval#Normal_approximation_interval">normal approximation</a> for calculating our <span class="math notranslate nohighlight">\(p\)</span>-value (i.e. z-test).</p>
<p>Again, Python makes all the calculations very easy. We can use the <code class="docutils literal notranslate"><span class="pre">statsmodels.stats.proportion</span></code> module to get the <span class="math notranslate nohighlight">\(p\)</span>-value and confidence intervals:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">statsmodels.stats.proportion</span> <span class="kn">import</span> <span class="n">proportions_ztest</span><span class="p">,</span> <span class="n">proportion_confint</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">control_results</span> <span class="o">=</span> <span class="n">ab_test</span><span class="p">[</span><span class="n">ab_test</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;control&#39;</span><span class="p">][</span><span class="s1">&#39;converted&#39;</span><span class="p">]</span>
<span class="n">treatment_results</span> <span class="o">=</span> <span class="n">ab_test</span><span class="p">[</span><span class="n">ab_test</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;treatment&#39;</span><span class="p">][</span><span class="s1">&#39;converted&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">n_con</span> <span class="o">=</span> <span class="n">control_results</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">n_treat</span> <span class="o">=</span> <span class="n">treatment_results</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">successes</span> <span class="o">=</span> <span class="p">[</span><span class="n">control_results</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">treatment_results</span><span class="o">.</span><span class="n">sum</span><span class="p">()]</span>
<span class="n">nobs</span> <span class="o">=</span> <span class="p">[</span><span class="n">n_con</span><span class="p">,</span> <span class="n">n_treat</span><span class="p">]</span>

<span class="n">z_stat</span><span class="p">,</span> <span class="n">pval</span> <span class="o">=</span> <span class="n">proportions_ztest</span><span class="p">(</span><span class="n">successes</span><span class="p">,</span> <span class="n">nobs</span><span class="o">=</span><span class="n">nobs</span><span class="p">)</span>
<span class="p">(</span><span class="n">lower_con</span><span class="p">,</span> <span class="n">lower_treat</span><span class="p">),</span> <span class="p">(</span><span class="n">upper_con</span><span class="p">,</span> <span class="n">upper_treat</span><span class="p">)</span> <span class="o">=</span> <span class="n">proportion_confint</span><span class="p">(</span><span class="n">successes</span><span class="p">,</span> <span class="n">nobs</span><span class="o">=</span><span class="n">nobs</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;z statistic: </span><span class="si">{</span><span class="n">z_stat</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;p-value: </span><span class="si">{</span><span class="n">pval</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ci 95% for control group: [</span><span class="si">{</span><span class="n">lower_con</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">upper_con</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ci 95% for treatment group: [</span><span class="si">{</span><span class="n">lower_treat</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">upper_treat</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>z statistic: -0.34
p-value: 0.732
ci 95% for control group: [0.114, 0.133]
ci 95% for treatment group: [0.116, 0.135]
</pre></div>
</div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="drawing-conclusions">
<h3>5. Drawing conclusions<a class="headerlink" href="#drawing-conclusions" title="Permalink to this headline">¶</a></h3>
<p>Since our <span class="math notranslate nohighlight">\(p\)</span>-value=0.732 is way above our <span class="math notranslate nohighlight">\(\alpha\)</span>=0.05, we cannot reject the null hypothesis <span class="math notranslate nohighlight">\(H_0\)</span>, which means that our new design did not perform significantly different (let alone better) than our old one :(</p>
<p>Additionally, if we look at the confidence interval for the <code class="docutils literal notranslate"><span class="pre">treatment</span></code> group ([0.116, 0.135], i.e. 11.6-13.5%) we notice that:</p>
<ol class="simple">
<li><p>It includes our baseline value of 13% conversion rate</p></li>
<li><p>It does not include our target value of 15% (the 2% uplift we were aiming for)</p></li>
</ol>
<p>What this means is that it is more likely that the true conversion rate of the new design is similar to our baseline, rather than the 15% target we had hoped for. This is further proof that our new design is not likely to be an improvement on our old design, and that unfortunately we are back to the drawing board!</p>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./nbs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="T051594_Analytics_Zoo.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">Analytics Zoo</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="T475711_PinSage_Graph_based_Recommender.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">PinSage Graph-based Recommender</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Sparsh A.<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>