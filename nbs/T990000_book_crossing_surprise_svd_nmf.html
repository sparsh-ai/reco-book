
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Book-Crossing Recommendation System &#8212; Reco Book</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Books recommendations with Kubeflow Pipelines on Scaleway Kapsule" href="T990000_book_recommender_kubeflow.html" />
    <link rel="prev" title="Best Ads detection using bandit methods" href="T990000_ads_selection_using_bandits.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Reco Book</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../index.html">
   Tutorials in Jupyter notebook format
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  User Stories
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="US780867_Transformer_based_Recommenders.html">
   Transformer-based Recommenders
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="T034923_BERT4Rec_on_ML1M_in_PyTorch.html">
     BERT4Rec on ML-1M in PyTorch
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T595874_BERT4Rec_on_ML25M_in_PyTorch_Lightning.html">
     BERT4Rec on ML-25M
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T088416_BST_Implementation_in_MXNet.html">
     BST Implementation in MXNet
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T602245_BST_implementation_in_PyTorch.html">
     BST implementation in PyTorch
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T007665_BST_on_ML1M_in_Keras.html">
     A Transformer-based recommendation system
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T881207_BST_PTLightning_ML1M.html">
     Rating prediction using the Behavior Sequence Transformer (BST) model on ML-1M dataset in PyTorch Lightning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T757997_SASRec_PyTorch.html">
     SASRec implementation with PyTorch Library
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T225287_SASRec_PaddlePaddle.html">
     SASRec implementation with Paddle Library
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T701627_SR_SAN_Session_based_Model.html">
     SR-SAN Session-based Recommender
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T975104_SSEPT_ML1M_Tensorflow1x.html">
     SSE-PT Personalized Transformer Recommender on ML-1M in Tensorflow 1.x
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Prototypes
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="T382881_DeepWalk_Karateclub.html">
   DeepWalk from scratch referencing Karateclub library
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T384270_DeepWalk_pure_python.html">
   DeepWalk in pure python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T677598_Jaccard_Cosine_SVD_DeepWalk_ML100K.html">
   Recommender System with DeepWalk Graph Embeddings
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T815556_Node2vec_Karateclub.html">
   Node2vec from scratch referencing Karateclub library
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T894941_Node2vec_MovieLens_Keras.html">
   Graph representation learning with node2vec
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T611050_Node2vec_PyG.html">
   Node2vec from scratch in PyTorch Geometric
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T186367_Node2vec_library.html">
   Node2vec from scratch referencing node2vec library
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T331379_bayesian_personalized_ranking.html">
   BPR from scratch
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T081831_Data_Poisoning_Attacks_on_Factorization_Based_Collaborative_Filtering.html">
   Data Poisoning Attacks on Factorization-Based Collaborative Filtering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T102448_Adversarial_Learning_for_Recommendation.html">
   Adversarial Training (Regularization) on a Recommender System
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T865035_Simulating_Data_Poisoning_Attacks_against_Twitter_Recommender.html">
   Load and process dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T711285_Data_Poisoning_Attack_using_LFM_and_ItemAE_on_Synthetic_Dataset.html">
   Injection attack using LFM and ItemAE model trained on Toy dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T355514_Black_box_Attack_on_Sequential_Recs.html">
   Black-box Attack on Sequential Recs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T873451_Statistics_fundamentals.html">
   Statictics Fundamentals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T890478_Batch_Learning_from_Bandit_Feedback_%28BLBF%29.html">
   Imports
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T257798_Off_Policy_Learning_in_Two_stage_Recommender_Systems.html">
   Off-Policy Learning in Two-stage Recommender Systems
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T471827_Adaptive_Estimator_Selection_for_Off_Policy_Evaluation.html">
   Adaptive Estimator Selection for Off-Policy Evaluation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T902666_Evaluating_the_Robustness_of_Off_Policy_Evaluation.html">
   Evaluating the Robustness of Off-Policy Evaluation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T705904_Evaluation_of_Multiple_Off_Policy_Estimators_on_Synthetic_Dataset.html">
   Evaluation of Multiple Off-Policy Estimators on Synthetic Dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T874693_Evaluating_Standard_Off_Policy_Estimators_with_Small_Sample_Open_Bandit_Dataset.html">
   Evaluating Standard Off-Policy Estimators with Small Sample Open-Bandit Dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T792262_Optimal_Off_Policy_Evaluation_from_Multiple_Logging_Policies.html">
   Optimal Off-Policy Evaluation from Multiple Logging Policies
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T167249_Offline_Policy_Evaluation_with_VW_Command_Line.html">
   Offline Policy Evaluation with VW Command Line
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T966055_OBP_Library_Workshop_Tutorials.html">
   OBP Library Workshop Tutorials
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T632722_PyTorch_Fundamentals_Part_1.html">
   PyTorch Fundamentals Part 1
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T472467_PyTorch_Fundamentals_Part_2.html">
   PyTorch Fundamentals Part 2
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T206654_PyTorch_Fundamentals_Part_3.html">
   PyTorch Fundamentals Part 3
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T536348_Attention_Mechanisms.html">
   Imports
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T500796_Agricultural_Satellite_Image_Segmentation.html">
   Agricultural Satellite Image Segmentation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T611432_Image_Analysis_with_Tensorflow.html">
   Image Analysis with Tensorflow
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T925716_MongoDB_to_CSV_Conversion.html">
   MongoDB to CSV conversion
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T396469_PDF_to_Word_Cloud_via_Email.html">
   PDF to WordCloud via Email
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T030890_Job_Scraping_and_Clustering.html">
   Job scraping and clustering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T897054_Scene_Text_Recognition.html">
   Scene Text Recognition
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T034809_Large_scale_Document_Retrieval_with_Elastic_Search.html">
   Large-scale Document Retrieval with ElasticSearch
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T467251_vowpal_wabbit_contextual_recommender.html">
   Simulating a news personalization scenario using Contextual Bandits
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T686684_similar_product_recommender.html">
   Similar Product Recommender system using Deep Learning for an online e-commerce store
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T132203_Retail_Product_Recommendations_using_Word2vec.html">
   Retail Product Recommendations using word2vec
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T501828_Recommender_Implicit_Negative_Feedback.html">
   Retail Product Recommendation with Negative Implicit Feedback
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T315965_Sequence_Aware_Recommenders_Music.html">
   Sequence Aware Recommender Systems
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T051777_image_similarity_recommendations.html">
   Similar Product Recommendations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990172_recobook_diversity_aware_book_recommender.html">
   Diversity Aware Book Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T488549_Goodreads_Diversity_Aware_Book_Recommender.html">
   Diversity Aware Book Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T023535_Kafka_MongoDB_Real_time_Streaming.html">
   Kafka MongoDB Real-time Streaming
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T622304_Session_based_Recommender_Using_Word2vec.html">
   Session-based recommendation using word2vec
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T416854_bandit_based_recommender_using_thompson_sampling_app.html">
   Bandit-based Online Learning using Thompson Sampling
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T198578_Booking_dot_com_Trip_Recommendation.html">
   Booking.com Trip Recommendation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T519734_Vowpal_Wabbit_Contextual_Bandit.html">
   Vowpal Wabbit Contextual Bandit
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T871537_Recommendation_Systems_using_Olist_Dataset.html">
   Recommendation systems using Olist dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T057885_Offline_Replayer_Evaluation.html">
   Offline Replayer Evaluation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T915054_method_for_effective_online_testing.html">
   Methods for effective online testing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T513987_Recsys_2020_Feature_Engineering_Tutorial.html">
   Recsys’20 Feature Engineering Tutorial
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T227901_amazon_personalize_batch_job.html">
   Amazon Personalize Batch Job
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T022961_Amazon_Personalize_Workshop.html">
   Amazon Personalize Workshop
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T424437_Collaborative_Filtering_on_ML_latest_small.html">
   Collaborative Filtering on ML-latest-small
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T539160_Building_and_Deploying_ASOS_Fashion_Recommender.html">
   Building and deploying ASOS fashion recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T757697_Simple_Similarity_based_Recommender.html">
   Simple Similarity based Recommmendations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T051594_Analytics_Zoo.html">
   Analytics Zoo
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T313645_A_B_Testing.html">
   A/B Testing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T475711_PinSage_Graph_based_Recommender.html">
   PinSage Graph-based Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T516490_Graph_Embeddings.html">
   Learn Embeddings using Graph Networks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T822164_movielens_milvus_redis_efficient_retrieval.html">
   Recommender with Redis and Milvus
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T845186_Anime_Recommender.html">
   RekoNet Anime Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T855843_kafka_spark_streaming_colab.html">
   Kafka and Spark Streaming in Colab
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T460437_Building_Models_From_Scratch.html">
   Building Models from scratch
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T855971_Conet_Model_for_Movie_Recommender.html">
   CoNet model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T996996_content_based_and_collaborative_movielens.html">
   Movie Recommendation with Content-Based and Collaborative Filtering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T239418_Simple_Movie_Recommenders.html">
   Simple Movie Recommenders
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T138337_Simple_Movie_Recommender.html">
   Simple movie recommender in implicit, explicit, and cold-start settings
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T935440_The_importance_of_Rating_Normalization.html">
   The importance of Rating Normalization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T612622_cornac_examples.html">
   Cornac Examples
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T561435_Flower_Classification.html">
   Flower classification
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T680910_Trivago_Session_based_Recommender.html">
   Trivago Session-based Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_ads_selection_using_bandits.html">
   Best Ads detection using bandit methods
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Book-Crossing Recommendation System
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_book_recommender_kubeflow.html">
   Books recommendations with Kubeflow Pipelines on Scaleway Kapsule
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_build_a_kubeflow_pipeline.html">
   Build a Kubeflow Pipeline
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_causal_inference.html">
   Causal Inference
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_concept_embedding_nlp.html">
   Exploring Word Embeddings
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_concept_neural_net.html">
   Neural Network
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_concept_nlp_basics.html">
   Natural Language Processing 101
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_concept_transformer_lm.html">
   TransformerLM Quick Start and Guide
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_content_based_music_recommender_lyricsfreak.html">
   Content-based method for song recommendation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_evaluation_metrics_basics.html">
   Recommender System Evaluations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_implicit_synthetic.html">
   Comparing Implicit Models on Synthetic Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_movie_recommender_tensorflow.html">
   Recommendation Systems with TensorFlow
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_movie_recommender_tensorflow_sagemaker.html">
   Movie recommender using Tensorflow in Sagemaker
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_movielens_eda_modeling.html">
   Movielens EDA and Modeling
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_read_data_from_cassandra_into_pandas.html">
   Read Cassandra Data Snapshot as DataFrame
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_rl_in_action.html">
   Reinforcement Learning fundamentals in action
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_rnn_cnn_basics.html">
   Processing sequences using RNNs and CNNs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_tf_serving_in_action.html">
   TF Serving in action
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_training_indexing_movie_recommender.html">
   Training and indexing movie recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T207114_EduRec_MOOCCube_Course_Recommender.html">
   EduRec MOOCCube Course Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T273184_Multi_Task_Learning.html">
   Multi-task Learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T661108_Book_Recommender_API.html">
   Book Recommender API
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T912764_Simple_Movie_Recommender_App.html">
   Simple Movie Recommender App
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T964554_Career_Village_Questions_Recommendation.html">
   CareerVillage Questions Recommendation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_amazon_women_apparel_tfidf_word2vec.html">
   Amazon Product Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_anime_recommender_graph_network.html">
   Anime Recommender with Bi-partite Graph Network
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_concept_self_attention.html">
   Self-Attention
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_course_recommender_svd_flask.html">
   Course Recommender with SVD based similarity
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_data_mining_similarity_measures.html">
   Concept - Data Mining Similarity Measures
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_jaccard_recommender.html">
   Jaccard Similarity based Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_live_streamer_recommender.html">
   Live Streamer Recommender with Implicit feedback
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_songs_embedding_skipgram_recommender.html">
   Song Embeddings - Skipgram Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_toy_example_car_recommender_knn.html">
   Toy example - Car Recommender using KNN method
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_wikirecs_recommender.html">
   WikiRecs
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/nbs/T990000_book_crossing_surprise_svd_nmf.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/sparsh-ai/reco-book/main?urlpath=tree/nbs/T990000_book_crossing_surprise_svd_nmf.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setup">
   Setup
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#load-the-dataset">
   Load the dataset
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#eda-and-data-cleaning">
   EDA and Data cleaning
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#users">
     Users
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#books">
     Books
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#interactions">
     Interactions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#merge">
     Merge
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#single-isbn-per-book">
     Single ISBN per book
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#remove-small-and-large-book-cover-url-columns">
     Remove Small and Large book-cover URL columns
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#join-the-users-table-on-the-userid-field">
   Join the ‘users’ table on the ‘USERID’ field
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#recommender-model">
   Recommender model
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-sklearn-to-generate-training-and-testing-subsets">
     Using
     <code class="docutils literal notranslate">
      <span class="pre">
       sklearn
      </span>
     </code>
     to generate training and testing subsets
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#map-the-userid-and-unique-itemids-fields-to-sequential-integers-for-matrix-processing">
     Map the
     <code class="docutils literal notranslate">
      <span class="pre">
       USERID
      </span>
     </code>
     and
     <code class="docutils literal notranslate">
      <span class="pre">
       UNIQUE_ITEMIDS
      </span>
     </code>
     fields to sequential integers for matrix processing
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#calculating-cosine-similarity-with-the-pairwise-distances-function">
     Calculating cosine similarity with the ‘pairwise distances’ function
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#evaluation">
     Evaluation
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#using-the-surprise-library-for-building-a-recommender-system">
   Using the
   <code class="docutils literal notranslate">
    <span class="pre">
     surprise
    </span>
   </code>
   library for building a recommender system
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#svd-model">
     SVD model
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#nmf-model">
     NMF model
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#optimizing-the-svd-algorithm-with-parameter-tuning">
   Optimizing the SVD algorithm with parameter tuning
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#testing-some-of-the-outputs-ratings-and-recommendations">
   Testing some of the outputs (ratings and recommendations)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#summary">
   Summary
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   References
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="book-crossing-recommendation-system">
<h1>Book-Crossing Recommendation System<a class="headerlink" href="#book-crossing-recommendation-system" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div><p>Book recommender system on book crossing dataset using surprise SVD and NMF models.</p>
</div></blockquote>
<div class="section" id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!pip install -q git+https://github.com/sparsh-ai/recochef.git
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pickle</span>

<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">model_selection</span>

<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;seaborn-white&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">15</span><span class="p">})</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">recochef.datasets.bookcrossing</span> <span class="kn">import</span> <span class="n">BookCrossing</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="load-the-dataset">
<h2>Load the dataset<a class="headerlink" href="#load-the-dataset" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bookcrossing</span> <span class="o">=</span> <span class="n">BookCrossing</span><span class="p">()</span>
<span class="n">users</span> <span class="o">=</span> <span class="n">bookcrossing</span><span class="o">.</span><span class="n">load_users</span><span class="p">()</span>
<span class="n">books</span> <span class="o">=</span> <span class="n">bookcrossing</span><span class="o">.</span><span class="n">load_items</span><span class="p">()</span>
<span class="n">book_ratings</span> <span class="o">=</span> <span class="n">bookcrossing</span><span class="o">.</span><span class="n">load_interactions</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">users</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>USERID</th>
      <th>LOCATION</th>
      <th>AGE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>nyc, new york, usa</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>stockton, california, usa</td>
      <td>18.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>moscow, yukon territory, russia</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>porto, v.n.gaia, portugal</td>
      <td>17.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>farnborough, hants, united kingdom</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">books</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ITEMID</th>
      <th>TITLE</th>
      <th>AUTHOR</th>
      <th>YEAR</th>
      <th>PUBLISHER</th>
      <th>URLSMALL</th>
      <th>URLMEDIUM</th>
      <th>URLLARGE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0195153448</td>
      <td>Classical Mythology</td>
      <td>Mark P. O. Morford</td>
      <td>2002</td>
      <td>Oxford University Press</td>
      <td>http://images.amazon.com/images/P/0195153448.0...</td>
      <td>http://images.amazon.com/images/P/0195153448.0...</td>
      <td>http://images.amazon.com/images/P/0195153448.0...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0002005018</td>
      <td>Clara Callan</td>
      <td>Richard Bruce Wright</td>
      <td>2001</td>
      <td>HarperFlamingo Canada</td>
      <td>http://images.amazon.com/images/P/0002005018.0...</td>
      <td>http://images.amazon.com/images/P/0002005018.0...</td>
      <td>http://images.amazon.com/images/P/0002005018.0...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0060973129</td>
      <td>Decision in Normandy</td>
      <td>Carlo D'Este</td>
      <td>1991</td>
      <td>HarperPerennial</td>
      <td>http://images.amazon.com/images/P/0060973129.0...</td>
      <td>http://images.amazon.com/images/P/0060973129.0...</td>
      <td>http://images.amazon.com/images/P/0060973129.0...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0374157065</td>
      <td>Flu: The Story of the Great Influenza Pandemic...</td>
      <td>Gina Bari Kolata</td>
      <td>1999</td>
      <td>Farrar Straus Giroux</td>
      <td>http://images.amazon.com/images/P/0374157065.0...</td>
      <td>http://images.amazon.com/images/P/0374157065.0...</td>
      <td>http://images.amazon.com/images/P/0374157065.0...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0393045218</td>
      <td>The Mummies of Urumchi</td>
      <td>E. J. W. Barber</td>
      <td>1999</td>
      <td>W. W. Norton &amp;amp; Company</td>
      <td>http://images.amazon.com/images/P/0393045218.0...</td>
      <td>http://images.amazon.com/images/P/0393045218.0...</td>
      <td>http://images.amazon.com/images/P/0393045218.0...</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">book_ratings</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>USERID</th>
      <th>ITEMID</th>
      <th>RATING</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>276725</td>
      <td>034545104X</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>276726</td>
      <td>0155061224</td>
      <td>5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>276727</td>
      <td>0446520802</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>276729</td>
      <td>052165615X</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>276729</td>
      <td>0521795028</td>
      <td>6</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Users: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">users</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">Books: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">books</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">Ratings: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">book_ratings</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Users: 278858
Books: 271360
Ratings: 1149780
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="eda-and-data-cleaning">
<h2>EDA and Data cleaning<a class="headerlink" href="#eda-and-data-cleaning" title="Permalink to this headline">¶</a></h2>
<div class="section" id="users">
<h3>Users<a class="headerlink" href="#users" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">users</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>unique</th>
      <th>top</th>
      <th>freq</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>USERID</th>
      <td>278858</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>139430</td>
      <td>80499.5</td>
      <td>1</td>
      <td>69715.2</td>
      <td>139430</td>
      <td>209144</td>
      <td>278858</td>
    </tr>
    <tr>
      <th>LOCATION</th>
      <td>278858</td>
      <td>57339</td>
      <td>london, england, united kingdom</td>
      <td>2506</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>AGE</th>
      <td>168096</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>34.7514</td>
      <td>14.4281</td>
      <td>0</td>
      <td>24</td>
      <td>32</td>
      <td>44</td>
      <td>244</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The age range goes from 0 to 244 years old! Obviously this cannot be correct; I’ll set all ages less than 5 and older than 100 to NaN to try keep them realistic.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">users</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">users</span><span class="o">.</span><span class="n">AGE</span><span class="o">&lt;</span><span class="mi">5</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">users</span><span class="o">.</span><span class="n">AGE</span><span class="o">&gt;</span><span class="mi">100</span><span class="p">),</span> <span class="s1">&#39;AGE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">u</span> <span class="o">=</span> <span class="n">users</span><span class="o">.</span><span class="n">AGE</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Age&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;counts&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/T990000_book_crossing_surprise_svd_nmf_16_0.png" src="../_images/T990000_book_crossing_surprise_svd_nmf_16_0.png" />
</div>
</div>
<p>Next, can we expand the ‘Location’ field to break it up into ‘City’, ‘State’, and ‘Country’.</p>
<blockquote>
<div><p>Note: Used Pandas Series.str.split method as it has an ‘expand’ parameter which can handle None cases</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">user_location_expanded</span> <span class="o">=</span> <span class="n">users</span><span class="o">.</span><span class="n">LOCATION</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">user_location_expanded</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CITY&#39;</span><span class="p">,</span> <span class="s1">&#39;STATE&#39;</span><span class="p">,</span> <span class="s1">&#39;COUNTRY&#39;</span><span class="p">]</span>
<span class="n">users</span> <span class="o">=</span> <span class="n">users</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">user_location_expanded</span><span class="p">)</span>
<span class="n">users</span><span class="o">.</span><span class="n">COUNTRY</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">users</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;LOCATION&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">users</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>USERID</th>
      <th>AGE</th>
      <th>CITY</th>
      <th>STATE</th>
      <th>COUNTRY</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>NaN</td>
      <td>nyc</td>
      <td>new york</td>
      <td>usa</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>18.0</td>
      <td>stockton</td>
      <td>california</td>
      <td>usa</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>NaN</td>
      <td>moscow</td>
      <td>yukon territory</td>
      <td>russia</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>17.0</td>
      <td>porto</td>
      <td>v.n.gaia</td>
      <td>portugal</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>NaN</td>
      <td>farnborough</td>
      <td>hants</td>
      <td>united kingdom</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="books">
<h3>Books<a class="headerlink" href="#books" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">books</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ITEMID</th>
      <th>TITLE</th>
      <th>AUTHOR</th>
      <th>YEAR</th>
      <th>PUBLISHER</th>
      <th>URLSMALL</th>
      <th>URLMEDIUM</th>
      <th>URLLARGE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0195153448</td>
      <td>Classical Mythology</td>
      <td>Mark P. O. Morford</td>
      <td>2002</td>
      <td>Oxford University Press</td>
      <td>http://images.amazon.com/images/P/0195153448.0...</td>
      <td>http://images.amazon.com/images/P/0195153448.0...</td>
      <td>http://images.amazon.com/images/P/0195153448.0...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0002005018</td>
      <td>Clara Callan</td>
      <td>Richard Bruce Wright</td>
      <td>2001</td>
      <td>HarperFlamingo Canada</td>
      <td>http://images.amazon.com/images/P/0002005018.0...</td>
      <td>http://images.amazon.com/images/P/0002005018.0...</td>
      <td>http://images.amazon.com/images/P/0002005018.0...</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">books</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>unique</th>
      <th>top</th>
      <th>freq</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>ITEMID</th>
      <td>271360</td>
      <td>271360</td>
      <td>0553141279</td>
      <td>1</td>
    </tr>
    <tr>
      <th>TITLE</th>
      <td>271360</td>
      <td>242135</td>
      <td>Selected Poems</td>
      <td>27</td>
    </tr>
    <tr>
      <th>AUTHOR</th>
      <td>271359</td>
      <td>102023</td>
      <td>Agatha Christie</td>
      <td>632</td>
    </tr>
    <tr>
      <th>YEAR</th>
      <td>271360</td>
      <td>118</td>
      <td>2002</td>
      <td>17627</td>
    </tr>
    <tr>
      <th>PUBLISHER</th>
      <td>271358</td>
      <td>16807</td>
      <td>Harlequin</td>
      <td>7535</td>
    </tr>
    <tr>
      <th>URLSMALL</th>
      <td>271360</td>
      <td>271044</td>
      <td>http://images.amazon.com/images/P/051511264X.0...</td>
      <td>2</td>
    </tr>
    <tr>
      <th>URLMEDIUM</th>
      <td>271360</td>
      <td>271044</td>
      <td>http://images.amazon.com/images/P/038079439X.0...</td>
      <td>2</td>
    </tr>
    <tr>
      <th>URLLARGE</th>
      <td>271357</td>
      <td>271041</td>
      <td>http://images.amazon.com/images/P/044022859X.0...</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convert years to float</span>
<span class="n">books</span><span class="o">.</span><span class="n">YEAR</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">books</span><span class="o">.</span><span class="n">YEAR</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Replace all years of zero with NaN</span>
<span class="n">books</span><span class="o">.</span><span class="n">YEAR</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">yr</span> <span class="o">=</span> <span class="n">books</span><span class="o">.</span><span class="n">YEAR</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
<span class="n">yr</span> <span class="o">=</span> <span class="n">yr</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">yr</span><span class="o">&gt;</span><span class="mi">5</span><span class="p">)</span> <span class="c1"># filter out counts less than 5</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">yr</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">yr</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Year of Publication&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;counts&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/T990000_book_crossing_surprise_svd_nmf_25_0.png" src="../_images/T990000_book_crossing_surprise_svd_nmf_25_0.png" />
</div>
</div>
<p>Note that in the plot above we filtered out counts less than 5, as there are a few books in the dataset with publication years in the 1300s, and a few in the future (?!). The plot above show the general trend that more recent books are much more frequent.</p>
<p>Let’s take a look at some of those ‘outlier’ books. Maybe we’ll even keep them as a separate dataset so we can filter them out if we need to later in the analysis. We’ll leave them in for now, and then figure out how to handle them once we have more info later on.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">historical_books</span> <span class="o">=</span> <span class="n">books</span><span class="p">[</span><span class="n">books</span><span class="o">.</span><span class="n">YEAR</span><span class="o">&lt;</span><span class="mi">1900</span><span class="p">]</span> <span class="c1"># create df of old books</span>
<span class="n">books_from_the_future</span> <span class="o">=</span> <span class="n">books</span><span class="p">[</span><span class="n">books</span><span class="o">.</span><span class="n">YEAR</span><span class="o">&gt;</span><span class="mi">2018</span><span class="p">]</span> <span class="c1"># create df of books with publication yrs in the future!</span>

<span class="n">hist_books_mini</span> <span class="o">=</span> <span class="n">historical_books</span><span class="p">[[</span><span class="s1">&#39;TITLE&#39;</span><span class="p">,</span> <span class="s1">&#39;YEAR&#39;</span><span class="p">]]</span>
<span class="n">future_books_mini</span> <span class="o">=</span> <span class="n">books_from_the_future</span><span class="p">[[</span><span class="s1">&#39;TITLE&#39;</span><span class="p">,</span> <span class="s1">&#39;YEAR&#39;</span><span class="p">]]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Historical books:</span><span class="se">\n</span><span class="si">{</span><span class="n">hist_books_mini</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Future books:</span><span class="se">\n</span><span class="si">{</span><span class="n">future_books_mini</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Historical books:
                                                    TITLE    YEAR
171817  Complete Works 10 Volumes [2,6,7,8,9] (Notable...  1806.0
227531                   Dalan-i bihisht (Dastan-i Irani)  1378.0
245607  Hugh Wynne, Free Quaker (2 Volumes (BCL1-PS Am...  1897.0
253750                                       Tasht-i khun  1376.0


Future books:
                                                    TITLE    YEAR
30010                                          The Royals  2020.0
37487   MY TEACHER FRIED MY BRAINS (RACK SIZE) (MY TEA...  2030.0
55676   MY TEACHER FLUNKED THE PLANET (RACK SIZE) (MY ...  2030.0
78168                                    Crossing America  2030.0
80264   Alice&#39;s Adventures in Wonderland and Through t...  2050.0
92156                     Edgar Allen Poe Collected Poems  2020.0
97826       Outline of European Architecture (Pelican S.)  2050.0
116053                       Three Plays of Eugene Oneill  2038.0
118294        Das groÃ?Â?e BÃ?Â¶se- MÃ?Â¤dchen- Lesebuch.  2026.0
183769                                              Heidi  2021.0
192993  Field Guide to the Birds of North America, 3rd...  2030.0
228173       FOREST PEOPLE (Touchstone Books (Hardcover))  2030.0
238817                                LOOK HOMEWARD ANGEL  2020.0
240169            In Our Time: Stories (Scribner Classic)  2030.0
246842                                              CLOUT  2024.0
255409                               To Have and Have Not  2037.0
260974        FOOTBALL SUPER TEAMS : FOOTBALL SUPER TEAMS  2030.0
</pre></div>
</div>
</div>
</div>
<p>I think we can probably omit the ‘historical_books’ as they may potentially skew the model and do not seem to have much relevance to the wider userbase.</p>
<p>Some of the ‘future’ books actually appear to be errors (e.g. Alice in Wonderland, Edgar Allen Poe, etc.)… Perhaps they were supposed to be e.g. 1950 instead of 2050? However, instead of investigating this further, since there are &lt;20 books here I will simply remove them from the ‘books’ table.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Length of books dataset before removal: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">books</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">books</span> <span class="o">=</span> <span class="n">books</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="p">(</span><span class="n">books</span><span class="o">.</span><span class="n">ITEMID</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">historical_books</span><span class="o">.</span><span class="n">ITEMID</span><span class="p">))]</span> <span class="c1"># remove historical books</span>
<span class="n">books</span> <span class="o">=</span> <span class="n">books</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="p">(</span><span class="n">books</span><span class="o">.</span><span class="n">ITEMID</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">books_from_the_future</span><span class="o">.</span><span class="n">ITEMID</span><span class="p">))]</span> <span class="c1"># remove historical books</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Length of books dataset after removal: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">books</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Length of books dataset before removal: 271360
Length of books dataset after removal: 271339
</pre></div>
</div>
</div>
</div>
<p>We clean up the ampersand formatting in the Publisher field.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">books</span><span class="o">.</span><span class="n">PUBLISHER</span> <span class="o">=</span> <span class="n">books</span><span class="o">.</span><span class="n">PUBLISHER</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&amp;amp&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">books</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ITEMID</th>
      <th>TITLE</th>
      <th>AUTHOR</th>
      <th>YEAR</th>
      <th>PUBLISHER</th>
      <th>URLSMALL</th>
      <th>URLMEDIUM</th>
      <th>URLLARGE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0195153448</td>
      <td>Classical Mythology</td>
      <td>Mark P. O. Morford</td>
      <td>2002.0</td>
      <td>Oxford University Press</td>
      <td>http://images.amazon.com/images/P/0195153448.0...</td>
      <td>http://images.amazon.com/images/P/0195153448.0...</td>
      <td>http://images.amazon.com/images/P/0195153448.0...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0002005018</td>
      <td>Clara Callan</td>
      <td>Richard Bruce Wright</td>
      <td>2001.0</td>
      <td>HarperFlamingo Canada</td>
      <td>http://images.amazon.com/images/P/0002005018.0...</td>
      <td>http://images.amazon.com/images/P/0002005018.0...</td>
      <td>http://images.amazon.com/images/P/0002005018.0...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0060973129</td>
      <td>Decision in Normandy</td>
      <td>Carlo D'Este</td>
      <td>1991.0</td>
      <td>HarperPerennial</td>
      <td>http://images.amazon.com/images/P/0060973129.0...</td>
      <td>http://images.amazon.com/images/P/0060973129.0...</td>
      <td>http://images.amazon.com/images/P/0060973129.0...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0374157065</td>
      <td>Flu: The Story of the Great Influenza Pandemic...</td>
      <td>Gina Bari Kolata</td>
      <td>1999.0</td>
      <td>Farrar Straus Giroux</td>
      <td>http://images.amazon.com/images/P/0374157065.0...</td>
      <td>http://images.amazon.com/images/P/0374157065.0...</td>
      <td>http://images.amazon.com/images/P/0374157065.0...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0393045218</td>
      <td>The Mummies of Urumchi</td>
      <td>E. J. W. Barber</td>
      <td>1999.0</td>
      <td>W. W. Norton &amp;; Company</td>
      <td>http://images.amazon.com/images/P/0393045218.0...</td>
      <td>http://images.amazon.com/images/P/0393045218.0...</td>
      <td>http://images.amazon.com/images/P/0393045218.0...</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Check that there are no duplicated book entries.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">uniq_books</span> <span class="o">=</span> <span class="n">books</span><span class="o">.</span><span class="n">ITEMID</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
<span class="n">all_books</span> <span class="o">=</span> <span class="n">books</span><span class="o">.</span><span class="n">ITEMID</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;No. of unique books: </span><span class="si">{</span><span class="n">uniq_books</span><span class="si">}</span><span class="s1"> | All book entries: </span><span class="si">{</span><span class="n">all_books</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>No. of unique books: 271339 | All book entries: 271339
</pre></div>
</div>
</div>
</div>
<p>Let’s look at the most frequent Publishing houses in the dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">top_publishers</span> <span class="o">=</span> <span class="n">books</span><span class="o">.</span><span class="n">PUBLISHER</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()[:</span><span class="mi">10</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The 10 publishers with the most entries in the books table are:</span><span class="se">\n</span><span class="si">{</span><span class="n">top_publishers</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The 10 publishers with the most entries in the books table are:
Harlequin                   7535
Silhouette                  4220
Pocket                      3905
Ballantine Books            3783
Bantam Books                3646
Scholastic                  3159
Simon &amp;; Schuster           2969
Penguin Books               2844
Berkley Publishing Group    2771
Warner Books                2727
Name: PUBLISHER, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>What about authors with the most entries?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">top_authors</span> <span class="o">=</span> <span class="n">books</span><span class="o">.</span><span class="n">AUTHOR</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()[:</span><span class="mi">10</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The 10 authors with the most entries in the books table are:</span><span class="se">\n</span><span class="si">{</span><span class="n">top_authors</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The 10 authors with the most entries in the books table are:
Agatha Christie        632
William Shakespeare    567
Stephen King           524
Ann M. Martin          423
Carolyn Keene          373
Francine Pascal        372
Isaac Asimov           330
Nora Roberts           315
Barbara Cartland       307
Charles Dickens        302
Name: AUTHOR, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>We should search for empty or NaN values in these fields too.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">empty_string_publisher</span> <span class="o">=</span> <span class="n">books</span><span class="p">[</span><span class="n">books</span><span class="o">.</span><span class="n">PUBLISHER</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">PUBLISHER</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">nan_publisher</span> <span class="o">=</span> <span class="n">books</span><span class="o">.</span><span class="n">PUBLISHER</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;There are </span><span class="si">{</span><span class="n">empty_string_publisher</span><span class="si">}</span><span class="s1"> entries with empty strings, and </span><span class="si">{</span><span class="n">nan_publisher</span><span class="si">}</span><span class="s1"> NaN entries in the Publisher field&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>There are 0 entries with empty strings, and 2 NaN entries in the Publisher field
</pre></div>
</div>
</div>
</div>
<p>Great - no empty strings in the Publisher field, and only 2 NaNs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">empty_string_author</span> <span class="o">=</span> <span class="n">books</span><span class="p">[</span><span class="n">books</span><span class="o">.</span><span class="n">AUTHOR</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">AUTHOR</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">nan_author</span> <span class="o">=</span> <span class="n">books</span><span class="o">.</span><span class="n">AUTHOR</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;There are </span><span class="si">{</span><span class="n">empty_string_author</span><span class="si">}</span><span class="s1"> entries with empty strings, and </span><span class="si">{</span><span class="n">nan_author</span><span class="si">}</span><span class="s1"> NaN entries in the Author field&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>There are 0 entries with empty strings, and 1 NaN entries in the Author field
</pre></div>
</div>
</div>
</div>
<p>Cool, only 1 NaN in the Author field.</p>
<p>Let’s look at the titles.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">top_titles</span> <span class="o">=</span> <span class="n">books</span><span class="o">.</span><span class="n">TITLE</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()[:</span><span class="mi">10</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The 10 book titles with the most entries in the books table are:</span><span class="se">\n</span><span class="si">{</span><span class="n">top_titles</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The 10 book titles with the most entries in the books table are:
Selected Poems                    27
Little Women                      24
Wuthering Heights                 21
The Secret Garden                 20
Adventures of Huckleberry Finn    20
Dracula                           20
Jane Eyre                         19
The Night Before Christmas        18
Pride and Prejudice               18
Great Expectations                17
Name: TITLE, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>This is actually quite an important observation. Although all of the ISBN entries are <em>unique</em> in the ‘books’ dataframe, different <em>forms</em> of the <strong>same</strong> book will have different ISBNs - i.e. paperback, e-book, etc. Therefore, we can see that some books have multiple ISBN entries (e.g. Jane Eyre has 19 different ISBNs, each corresponding to a different version of the book).</p>
<p>Let’s take a look at, for example, the entries for ‘Jane Eyre’.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">books</span><span class="p">[</span><span class="n">books</span><span class="o">.</span><span class="n">TITLE</span><span class="o">==</span><span class="s1">&#39;Jane Eyre&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ITEMID</th>
      <th>TITLE</th>
      <th>AUTHOR</th>
      <th>YEAR</th>
      <th>PUBLISHER</th>
      <th>URLSMALL</th>
      <th>URLMEDIUM</th>
      <th>URLLARGE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3323</th>
      <td>0451518845</td>
      <td>Jane Eyre</td>
      <td>Charlotte Bronte</td>
      <td>1999.0</td>
      <td>New Amer Library Classics</td>
      <td>http://images.amazon.com/images/P/0451518845.0...</td>
      <td>http://images.amazon.com/images/P/0451518845.0...</td>
      <td>http://images.amazon.com/images/P/0451518845.0...</td>
    </tr>
    <tr>
      <th>9545</th>
      <td>0451523326</td>
      <td>Jane Eyre</td>
      <td>Charlotte Bronte</td>
      <td>1988.0</td>
      <td>Signet Classics</td>
      <td>http://images.amazon.com/images/P/0451523326.0...</td>
      <td>http://images.amazon.com/images/P/0451523326.0...</td>
      <td>http://images.amazon.com/images/P/0451523326.0...</td>
    </tr>
    <tr>
      <th>27657</th>
      <td>1566193028</td>
      <td>Jane Eyre</td>
      <td>Charlotte Bronte</td>
      <td>1994.0</td>
      <td>Dorset Press</td>
      <td>http://images.amazon.com/images/P/1566193028.0...</td>
      <td>http://images.amazon.com/images/P/1566193028.0...</td>
      <td>http://images.amazon.com/images/P/1566193028.0...</td>
    </tr>
    <tr>
      <th>28501</th>
      <td>156619024X</td>
      <td>Jane Eyre</td>
      <td>Charlotte Bronte</td>
      <td>NaN</td>
      <td>Barnes Noble Classics</td>
      <td>http://images.amazon.com/images/P/156619024X.0...</td>
      <td>http://images.amazon.com/images/P/156619024X.0...</td>
      <td>http://images.amazon.com/images/P/156619024X.0...</td>
    </tr>
    <tr>
      <th>40050</th>
      <td>8426102069</td>
      <td>Jane Eyre</td>
      <td>Charlotte Bronte</td>
      <td>1997.0</td>
      <td>Juventud</td>
      <td>http://images.amazon.com/images/P/8426102069.0...</td>
      <td>http://images.amazon.com/images/P/8426102069.0...</td>
      <td>http://images.amazon.com/images/P/8426102069.0...</td>
    </tr>
    <tr>
      <th>41265</th>
      <td>0553210203</td>
      <td>Jane Eyre</td>
      <td>Charlotte Bronte</td>
      <td>1981.0</td>
      <td>Bantam Books</td>
      <td>http://images.amazon.com/images/P/0553210203.0...</td>
      <td>http://images.amazon.com/images/P/0553210203.0...</td>
      <td>http://images.amazon.com/images/P/0553210203.0...</td>
    </tr>
    <tr>
      <th>58243</th>
      <td>0460012878</td>
      <td>Jane Eyre</td>
      <td>Charlotte Bronte</td>
      <td>1976.0</td>
      <td>J m Dent &amp;; Sons Ltd</td>
      <td>http://images.amazon.com/images/P/0460012878.0...</td>
      <td>http://images.amazon.com/images/P/0460012878.0...</td>
      <td>http://images.amazon.com/images/P/0460012878.0...</td>
    </tr>
    <tr>
      <th>69689</th>
      <td>0141305371</td>
      <td>Jane Eyre</td>
      <td>Charlotte Bronte</td>
      <td>1999.0</td>
      <td>Puffin Books</td>
      <td>http://images.amazon.com/images/P/0141305371.0...</td>
      <td>http://images.amazon.com/images/P/0141305371.0...</td>
      <td>http://images.amazon.com/images/P/0141305371.0...</td>
    </tr>
    <tr>
      <th>72306</th>
      <td>2253004359</td>
      <td>Jane Eyre</td>
      <td>Charlotte BrontÃ?Â«</td>
      <td>1991.0</td>
      <td>LGF</td>
      <td>http://images.amazon.com/images/P/2253004359.0...</td>
      <td>http://images.amazon.com/images/P/2253004359.0...</td>
      <td>http://images.amazon.com/images/P/2253004359.0...</td>
    </tr>
    <tr>
      <th>84642</th>
      <td>0812523377</td>
      <td>Jane Eyre</td>
      <td>Charlotte Bronte</td>
      <td>1994.0</td>
      <td>Tor Books</td>
      <td>http://images.amazon.com/images/P/0812523377.0...</td>
      <td>http://images.amazon.com/images/P/0812523377.0...</td>
      <td>http://images.amazon.com/images/P/0812523377.0...</td>
    </tr>
    <tr>
      <th>84848</th>
      <td>0809598949</td>
      <td>Jane Eyre</td>
      <td>Charlotte Bronte</td>
      <td>2004.0</td>
      <td>Wildside Press</td>
      <td>http://images.amazon.com/images/P/0809598949.0...</td>
      <td>http://images.amazon.com/images/P/0809598949.0...</td>
      <td>http://images.amazon.com/images/P/0809598949.0...</td>
    </tr>
    <tr>
      <th>87375</th>
      <td>3548301231</td>
      <td>Jane Eyre</td>
      <td>C Bronte</td>
      <td>NaN</td>
      <td>Ullstein-Taschenbuch-Verlag, Zweigniederlassun...</td>
      <td>http://images.amazon.com/images/P/3548301231.0...</td>
      <td>http://images.amazon.com/images/P/3548301231.0...</td>
      <td>http://images.amazon.com/images/P/3548301231.0...</td>
    </tr>
    <tr>
      <th>144292</th>
      <td>0517668432</td>
      <td>Jane Eyre</td>
      <td>Charlotte Bronte</td>
      <td>1988.0</td>
      <td>Random House Value Publishing</td>
      <td>http://images.amazon.com/images/P/0517668432.0...</td>
      <td>http://images.amazon.com/images/P/0517668432.0...</td>
      <td>http://images.amazon.com/images/P/0517668432.0...</td>
    </tr>
    <tr>
      <th>158858</th>
      <td>1853268348</td>
      <td>Jane Eyre</td>
      <td>Charlotte Bronte</td>
      <td>NaN</td>
      <td>Universal Sales Marketing</td>
      <td>http://images.amazon.com/images/P/1853268348.0...</td>
      <td>http://images.amazon.com/images/P/1853268348.0...</td>
      <td>http://images.amazon.com/images/P/1853268348.0...</td>
    </tr>
    <tr>
      <th>166665</th>
      <td>2266083252</td>
      <td>Jane Eyre</td>
      <td>Charlotte BrontÃ?Â«</td>
      <td>1999.0</td>
      <td>Pocket</td>
      <td>http://images.amazon.com/images/P/2266083252.0...</td>
      <td>http://images.amazon.com/images/P/2266083252.0...</td>
      <td>http://images.amazon.com/images/P/2266083252.0...</td>
    </tr>
    <tr>
      <th>204658</th>
      <td>0451515560</td>
      <td>Jane Eyre</td>
      <td>Charlotte Bronte</td>
      <td>1981.0</td>
      <td>Signet Book</td>
      <td>http://images.amazon.com/images/P/0451515560.0...</td>
      <td>http://images.amazon.com/images/P/0451515560.0...</td>
      <td>http://images.amazon.com/images/P/0451515560.0...</td>
    </tr>
    <tr>
      <th>226926</th>
      <td>0582528259</td>
      <td>Jane Eyre</td>
      <td>Charlotte Bronte</td>
      <td>1978.0</td>
      <td>Addison-Wesley Pub Co</td>
      <td>http://images.amazon.com/images/P/0582528259.0...</td>
      <td>http://images.amazon.com/images/P/0582528259.0...</td>
      <td>http://images.amazon.com/images/P/0582528259.0...</td>
    </tr>
    <tr>
      <th>242914</th>
      <td>1590071212</td>
      <td>Jane Eyre</td>
      <td>Charlotte Bronte</td>
      <td>2002.0</td>
      <td>New Millenium Audio</td>
      <td>http://images.amazon.com/images/P/1590071212.0...</td>
      <td>http://images.amazon.com/images/P/1590071212.0...</td>
      <td>http://images.amazon.com/images/P/1590071212.0...</td>
    </tr>
    <tr>
      <th>248967</th>
      <td>843761449X</td>
      <td>Jane Eyre</td>
      <td>Charlotte Bronte</td>
      <td>1998.0</td>
      <td>Ediciones Catedra S.A.</td>
      <td>http://images.amazon.com/images/P/843761449X.0...</td>
      <td>http://images.amazon.com/images/P/843761449X.0...</td>
      <td>http://images.amazon.com/images/P/843761449X.0...</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>It looks like each ISBN assigned to the book ‘Jane Eyre’ has different Publisher and Year of Publication values also.</p>
<p>It might be more useful for our model if we simplified this to give each book a <em>unique</em> identifier, independent of the book format, as our recommendations will be for a book, not a specific version of a book. Therefore, all values in the Jane Eyre example above would stay the same, except all of the Jane Eyre entries would additionally be assigned a <em>unique ISBN</em> code as a new field.</p>
<p><strong>Will create this more unique identifier under the field name ‘UNIQUE_ITEMIDS’. Note that entries with only a single ISBN number will be left the same. However, will need to do this after joining to the other tables in the dataset, as some ISBNs in the ‘book-rating’ table may be removed if done prior.</strong></p>
</div>
<div class="section" id="interactions">
<h3>Interactions<a class="headerlink" href="#interactions" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">book_ratings</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>USERID</th>
      <th>ITEMID</th>
      <th>RATING</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>276725</td>
      <td>034545104X</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>276726</td>
      <td>0155061224</td>
      <td>5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>276727</td>
      <td>0446520802</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>276729</td>
      <td>052165615X</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>276729</td>
      <td>0521795028</td>
      <td>6</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">book_ratings</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>unique</th>
      <th>top</th>
      <th>freq</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>USERID</th>
      <td>1.14978e+06</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>140386</td>
      <td>80562.3</td>
      <td>2</td>
      <td>70345</td>
      <td>141010</td>
      <td>211028</td>
      <td>278854</td>
    </tr>
    <tr>
      <th>ITEMID</th>
      <td>1149780</td>
      <td>340556</td>
      <td>0971880107</td>
      <td>2502</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>RATING</th>
      <td>1.14978e+06</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2.86695</td>
      <td>3.85418</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>7</td>
      <td>10</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">book_ratings</span><span class="o">.</span><span class="n">dtypes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>USERID     int64
ITEMID    object
RATING     int64
dtype: object
</pre></div>
</div>
</div>
</div>
<p>The data types already look good. Remember that the ISBN numbers may contain letters, and so should be left as strings.</p>
<p>Which users contribute the most ratings?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">super_users</span> <span class="o">=</span> <span class="n">book_ratings</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;USERID&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">ITEMID</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The 20 users with the most ratings:</span><span class="se">\n</span><span class="si">{</span><span class="n">super_users</span><span class="p">[:</span><span class="mi">20</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The 20 users with the most ratings:
USERID
11676     13602
198711     7550
153662     6109
98391      5891
35859      5850
212898     4785
278418     4533
76352      3367
110973     3100
235105     3067
230522     2991
16795      2948
234623     2674
36836      2529
52584      2512
245963     2507
204864     2504
55492      2459
185233     2448
171118     2421
Name: ITEMID, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>Wow! User #11676 has almost twice as many ratings as the next highest user! All of the top 20 users have thousands of ratings, which seems like a lot, although maybe I’m just a slow reader…</p>
<p>Let’s see how they are distributed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># user distribution - users with more than 50 ratings removed</span>
<span class="n">user_hist</span> <span class="o">=</span> <span class="n">super_users</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">super_users</span><span class="o">&lt;</span><span class="mi">50</span><span class="p">)</span>
<span class="n">user_hist</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;No. of ratings&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/T990000_book_crossing_surprise_svd_nmf_54_0.png" src="../_images/T990000_book_crossing_surprise_svd_nmf_54_0.png" />
</div>
</div>
<p>It looks like <strong><em>by far</em></strong> the most frequent events are users with only 1 or 2 rating entries. We can see that the ‘super users’ with thousands of ratings are significant outliers.</p>
<p>This becomes clear if we make the same histogram with a cutoff for users with a minimum of 1000 ratings.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># only users with more than 1000 ratings</span>
<span class="n">super_user_hist</span> <span class="o">=</span> <span class="n">super_users</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">super_users</span><span class="o">&gt;</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">super_user_hist</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;No. of ratings (min. 1000)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/T990000_book_crossing_surprise_svd_nmf_56_0.png" src="../_images/T990000_book_crossing_surprise_svd_nmf_56_0.png" />
</div>
</div>
<p>Let’s see what the distribution of <strong>ratings</strong> looks like.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rtg</span> <span class="o">=</span> <span class="n">book_ratings</span><span class="o">.</span><span class="n">RATING</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">rtg</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">rtg</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Rating&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;counts&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/T990000_book_crossing_surprise_svd_nmf_58_0.png" src="../_images/T990000_book_crossing_surprise_svd_nmf_58_0.png" />
</div>
</div>
<p>Seems like most of the entries have a rating of zero!</p>
<p>After doing some research on the internet regarding this (and similar) datasets, it appears that the rating scale is actually from 1 to 10, and a 0 indicates an ‘implicit’ rather than an ‘explicit’ rating. An implicit rating represents an interaction (may be positive or negative) between the user and the item. Implicit interactions usually need to be handled differently from explicit ones.</p>
<p>For the modeling step we’ll only be looking at <em>explicit</em> ratings, and so the 0 rating entry rows will be removed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Size of book_ratings before removing zero ratings: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">book_ratings</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">book_ratings</span> <span class="o">=</span> <span class="n">book_ratings</span><span class="p">[</span><span class="n">book_ratings</span><span class="o">.</span><span class="n">RATING</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Size of book_ratings after removing zero ratings: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">book_ratings</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Size of book_ratings before removing zero ratings: 1149780
Size of book_ratings after removing zero ratings: 433671
</pre></div>
</div>
</div>
</div>
<p>By removing the implicit ratings we have reduced our sample size by more than half.</p>
<p>Let’s look at how the ratings are distributed again.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rtg</span> <span class="o">=</span> <span class="n">book_ratings</span><span class="o">.</span><span class="n">RATING</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">rtg</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">rtg</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Rating&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;counts&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/T990000_book_crossing_surprise_svd_nmf_62_0.png" src="../_images/T990000_book_crossing_surprise_svd_nmf_62_0.png" />
</div>
</div>
<p>This is much more clear! Now we can see that 8 is the most frequent rating, while users tend to give ratings &gt; 5, with very few low ratings given.</p>
</div>
<div class="section" id="merge">
<h3>Merge<a class="headerlink" href="#merge" title="Permalink to this headline">¶</a></h3>
<p>First, we’ll join the ‘books’ table to the ‘book_ratings’ table on the ISBN field.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Books table size: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">books</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Ratings table size: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">book_ratings</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">books_with_ratings</span> <span class="o">=</span> <span class="n">book_ratings</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">books</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;ITEMID&#39;</span><span class="p">),</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;ITEMID&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;New table size: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">books_with_ratings</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Books table size: 271339
Ratings table size: 433671
New table size: 433671
</pre></div>
</div>
</div>
</div>
<p>Let’s take a look at the new table.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">books_with_ratings</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>USERID</th>
      <th>ITEMID</th>
      <th>RATING</th>
      <th>TITLE</th>
      <th>AUTHOR</th>
      <th>YEAR</th>
      <th>PUBLISHER</th>
      <th>URLSMALL</th>
      <th>URLMEDIUM</th>
      <th>URLLARGE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>276726</td>
      <td>0155061224</td>
      <td>5</td>
      <td>Rites of Passage</td>
      <td>Judith Rae</td>
      <td>2001.0</td>
      <td>Heinle</td>
      <td>http://images.amazon.com/images/P/0155061224.0...</td>
      <td>http://images.amazon.com/images/P/0155061224.0...</td>
      <td>http://images.amazon.com/images/P/0155061224.0...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>276729</td>
      <td>052165615X</td>
      <td>3</td>
      <td>Help!: Level 1</td>
      <td>Philip Prowse</td>
      <td>1999.0</td>
      <td>Cambridge University Press</td>
      <td>http://images.amazon.com/images/P/052165615X.0...</td>
      <td>http://images.amazon.com/images/P/052165615X.0...</td>
      <td>http://images.amazon.com/images/P/052165615X.0...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>276729</td>
      <td>0521795028</td>
      <td>6</td>
      <td>The Amsterdam Connection : Level 4 (Cambridge ...</td>
      <td>Sue Leather</td>
      <td>2001.0</td>
      <td>Cambridge University Press</td>
      <td>http://images.amazon.com/images/P/0521795028.0...</td>
      <td>http://images.amazon.com/images/P/0521795028.0...</td>
      <td>http://images.amazon.com/images/P/0521795028.0...</td>
    </tr>
    <tr>
      <th>6</th>
      <td>276736</td>
      <td>3257224281</td>
      <td>8</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>7</th>
      <td>276737</td>
      <td>0600570967</td>
      <td>6</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;There are </span><span class="si">{</span><span class="n">books_with_ratings</span><span class="o">.</span><span class="n">TITLE</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s1"> books with no title/author information.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;This represents </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">books_with_ratings</span><span class="p">)</span><span class="o">/</span><span class="n">books_with_ratings</span><span class="o">.</span><span class="n">TITLE</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">% of the ratings dataset.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>There are 49861 books with no title/author information.
This represents 8.70% of the ratings dataset.
</pre></div>
</div>
</div>
</div>
<p>There seems to be quite a few ISBNs in the ratings table that did not match an ISBN in the books table, almost 9% of all entries!</p>
<p>There isn’t really anything we can do about that, but we should really remove them from the dataset as we won’t be able to access the title of the book to make a recommendation even if the model can use them.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">books_with_ratings</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 433671 entries, 1 to 1149779
Data columns (total 10 columns):
 #   Column     Non-Null Count   Dtype  
---  ------     --------------   -----  
 0   USERID     433671 non-null  int64  
 1   ITEMID     433671 non-null  object 
 2   RATING     433671 non-null  int64  
 3   TITLE      383810 non-null  object 
 4   AUTHOR     383809 non-null  object 
 5   YEAR       378026 non-null  float64
 6   PUBLISHER  383808 non-null  object 
 7   URLSMALL   383810 non-null  object 
 8   URLMEDIUM  383810 non-null  object 
 9   URLLARGE   383809 non-null  object 
dtypes: float64(1), int64(2), object(7)
memory usage: 36.4+ MB
</pre></div>
</div>
</div>
</div>
<p>It looks like the <code class="docutils literal notranslate"><span class="pre">year_of_publication</span></code> field contains the most NaN entries, while <code class="docutils literal notranslate"><span class="pre">USERID</span></code>, <code class="docutils literal notranslate"><span class="pre">isbn</span></code>, and <code class="docutils literal notranslate"><span class="pre">book_rating</span></code> are full. The <code class="docutils literal notranslate"><span class="pre">book_title</span></code>, <code class="docutils literal notranslate"><span class="pre">book_author</span></code>, and <code class="docutils literal notranslate"><span class="pre">publisher</span></code> fields contain approximately the same number of missing entries.</p>
<p>We’ll choose to remove rows for which the <code class="docutils literal notranslate"><span class="pre">book_title</span></code> is empty, as this is the most crucial piece of data needed to identify the book.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">books_with_ratings</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;TITLE&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># remove rows with missing title/author data</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s see which books have the highest <strong>cumulative</strong> book rating values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cm_rtg</span> <span class="o">=</span> <span class="n">books_with_ratings</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;TITLE&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">RATING</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">cm_rtg</span> <span class="o">=</span> <span class="n">cm_rtg</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span>
<span class="n">idx</span> <span class="o">=</span> <span class="n">cm_rtg</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="c1"># Get sorted book titles</span>
<span class="n">vals</span> <span class="o">=</span> <span class="n">cm_rtg</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="c1"># Get corresponding cm_rtg values</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)),</span> <span class="n">vals</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)),</span> <span class="n">idx</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;cumulative rating score&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/T990000_book_crossing_surprise_svd_nmf_75_0.png" src="../_images/T990000_book_crossing_surprise_svd_nmf_75_0.png" />
</div>
</div>
<p>This seems about right as it combines the total number of ratings with the score given, so these are all really popular book titles.</p>
<p>What about the highest <strong>average ratings</strong> (with a minimum of at least 50 ratings recieved)?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cutoff</span> <span class="o">=</span> <span class="n">books_with_ratings</span><span class="o">.</span><span class="n">TITLE</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="n">mean_rtg</span> <span class="o">=</span> <span class="n">books_with_ratings</span><span class="p">[</span><span class="n">books_with_ratings</span><span class="o">.</span><span class="n">TITLE</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">cutoff</span><span class="p">[</span><span class="n">cutoff</span><span class="o">&gt;</span><span class="mi">50</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;TITLE&#39;</span><span class="p">)[</span><span class="s1">&#39;RATING&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">mean_rtg</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span> <span class="c1"># show only top 10</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>TITLE
The Two Towers (The Lord of the Rings, Part 2)            9.330882
The Return of the King (The Lord of the Rings, Part 3)    9.213592
Harry Potter and the Goblet of Fire (Book 4)              9.125506
The Little Prince                                         9.111111
Charlotte&#39;s Web (Trophy Newbery)                          9.073529
Harry Potter and the Sorcerer&#39;s Stone (Book 1)            9.062500
84 Charing Cross Road                                     9.049180
Harry Potter and the Order of the Phoenix (Book 5)        9.047393
Harry Potter and the Prisoner of Azkaban (Book 3)         9.043321
To Kill a Mockingbird                                     8.977528
Name: RATING, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>This looks perfectly reasonable. The Harry Potter and Lord of the Rings books rate extremely highly, as expected.</p>
<p>How about the <strong>lowest-rated</strong> books?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mean_rtg</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="o">-</span><span class="mi">10</span><span class="p">:]</span> <span class="c1"># bottom 10 only</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>TITLE
Slow Waltz in Cedar Bend                                  6.619718
My Gal Sunday                                             6.607843
Hornet&#39;s Nest                                             6.591398
Bleachers                                                 6.583333
Full Tilt (Janet Evanovich&#39;s Full Series)                 6.568627
Songs in Ordinary Time (Oprah&#39;s Book Club (Paperback))    6.530303
4 Blondes                                                 5.653846
Isle of Dogs                                              5.433962
Four Blondes                                              5.393939
Wild Animus                                               4.390706
Name: RATING, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>Seems like the <em>lowest average</em> rating in the dataset is only a 4.39 - and all the rest of the books have average ratings higher than 5.</p>
<p>I haven’t heard of any of these books, so I can’t really comment on if they seem correct here.</p>
<p><strong>Now I’d like to tackle the challenge of the same book potentially having multiple ISBN numbers (for the different formats it is available in). We should clean that up here before we add the ‘user’ table.</strong></p>
</div>
<div class="section" id="single-isbn-per-book">
<h3>Single ISBN per book<a class="headerlink" href="#single-isbn-per-book" title="Permalink to this headline">¶</a></h3>
<p>Restrict books to a “single ISBN per book” (regardless of format)</p>
<p>Let’s look again at the book titles which have the most associated ISBN numbers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">books_with_ratings</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;TITLE&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">ITEMID</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>TITLE
The Secret Garden                 18
Selected Poems                    16
Adventures of Huckleberry Finn    15
Dracula                           15
Beloved                           14
Wuthering Heights                 14
Jane Eyre                         14
Pride and Prejudice               14
Little Women                      14
The Hobbit                        12
Name: ITEMID, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">multiple_isbns</span> <span class="o">=</span> <span class="n">books_with_ratings</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;TITLE&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">ITEMID</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
<span class="n">multiple_isbns</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1     125322
2       7872
3       1497
4        493
5        181
6         86
7         44
8         27
9         11
10         8
14         5
15         2
11         2
18         1
16         1
12         1
Name: ITEMID, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>We can see that the vast majority of books have less only 1 associated ISBN number, however quite a few multiple ISBNs. We want to create a <code class="docutils literal notranslate"><span class="pre">UNIQUE_ITEMIDS</span></code> such that a single book will only have 1 identifier when fed to the recommendation model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">has_mult_isbns</span> <span class="o">=</span> <span class="n">multiple_isbns</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">multiple_isbns</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span>
<span class="n">has_mult_isbns</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># remove NaNs, which in this case is books with a single ISBN number</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;There are </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">has_mult_isbns</span><span class="p">)</span><span class="si">}</span><span class="s1"> book titles with multiple ISBN numbers which we will try to re-assign to a unique identifier&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>There are 10231 book titles with multiple ISBN numbers which we will try to re-assign to a unique identifier
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check to see that our friend Jane Eyre still has multiple ISBN values</span>
<span class="n">has_mult_isbns</span><span class="p">[</span><span class="s1">&#39;Jane Eyre&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>14.0
</pre></div>
</div>
</div>
</div>
<p><strong>Note:</strong> Created the dictionary below and pickled it, just need to load it again (or run it if the first time on a new system).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create dictionary for books with multiple isbns</span>
<span class="k">def</span> <span class="nf">make_isbn_dict</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">title_isbn_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">title</span> <span class="ow">in</span> <span class="n">has_mult_isbns</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
        <span class="n">isbn_series</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">TITLE</span><span class="o">==</span><span class="n">title</span><span class="p">]</span><span class="o">.</span><span class="n">ITEMID</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span> <span class="c1"># returns only the unique ISBNs</span>
        <span class="n">title_isbn_dict</span><span class="p">[</span><span class="n">title</span><span class="p">]</span> <span class="o">=</span> <span class="n">isbn_series</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">title_isbn_dict</span>

<span class="o">%</span><span class="n">time</span> <span class="n">dict_UNIQUE_ITEMIDS</span> <span class="o">=</span> <span class="n">make_isbn_dict</span><span class="p">(</span><span class="n">books_with_ratings</span><span class="p">)</span>

<span class="c1"># As the loop takes a while to run (8 min on the full dataset), pickle this dict for future use</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;multiple_isbn_dict.pickle&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">dict_UNIQUE_ITEMIDS</span><span class="p">,</span> <span class="n">handle</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="n">pickle</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span><span class="p">)</span>

<span class="c1"># LOAD isbn_dict back into namespace</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;multiple_isbn_dict.pickle&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
    <span class="n">multiple_isbn_dict</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 8min 32s, sys: 1.61 s, total: 8min 34s
Wall time: 8min 33s
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;There are now </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">multiple_isbn_dict</span><span class="p">)</span><span class="si">}</span><span class="s1"> books in the ISBN dictionary that have multiple ISBN numbers&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>There are now 10231 books in the ISBN dictionary that have multiple ISBN numbers
</pre></div>
</div>
</div>
</div>
<p>Let’s take a quick look in the dict we just created for the ‘Jane Eyre’ entry - it should contain a list of 14 ISBN numbers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Length of Jane Eyre dict entry: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">multiple_isbn_dict</span><span class="p">[</span><span class="s2">&quot;Jane Eyre&quot;</span><span class="p">])</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">multiple_isbn_dict</span><span class="p">[</span><span class="s1">&#39;Jane Eyre&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Length of Jane Eyre dict entry: 14
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;1590071212&#39;,
 &#39;0451518845&#39;,
 &#39;0451523326&#39;,
 &#39;843761449X&#39;,
 &#39;156619024X&#39;,
 &#39;8426102069&#39;,
 &#39;1566193028&#39;,
 &#39;0141305371&#39;,
 &#39;3548301231&#39;,
 &#39;0812523377&#39;,
 &#39;0517668432&#39;,
 &#39;2253004359&#39;,
 &#39;0553210203&#39;,
 &#39;0451515560&#39;]
</pre></div>
</div>
</div>
</div>
<p>Looking good!</p>
<p>As I don’t really know what each of the different ISBN numbers refers to (from what I understand the code actually signifies various things including publisher, year, type of print, etc, but decoding this is outside the scope of this analysis), I’ll just select the <strong>first</strong> ISBN number that appears in the list of values to set as our <code class="docutils literal notranslate"><span class="pre">UNIQUE_ITEMIDS</span></code> for that particular book.</p>
<p><em><strong>Note</strong></em>: ISBN numbers are currently 13 digits long, but used to be 10. Any ISBN that isn’t 10 or 13 digits long is probably an error that should be handled somehow. Any that are 9 digits long might actually be SBN numbers (pre-1970), and can be converted into ISBN’s by just pre-fixing with a zero.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add &#39;UNIQUE_ITEMIDS&#39; column to &#39;books_with_ratings&#39; dataframe that includes the first ISBN if multiple ISBNS,</span>
<span class="c1"># or just the ISBN if only 1 ISBN present anyway.</span>
<span class="k">def</span> <span class="nf">add_UNIQUE_ITEMIDS_col</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;UNIQUE_ITEMIDS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">multiple_isbn_dict</span><span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">TITLE</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">TITLE</span> <span class="ow">in</span> <span class="n">multiple_isbn_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">else</span> <span class="n">row</span><span class="o">.</span><span class="n">ITEMID</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>

<span class="o">%</span><span class="n">time</span> <span class="n">books_with_ratings</span> <span class="o">=</span> <span class="n">add_UNIQUE_ITEMIDS_col</span><span class="p">(</span><span class="n">books_with_ratings</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 7.77 s, sys: 53.9 ms, total: 7.82 s
Wall time: 7.82 s
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">books_with_ratings</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>USERID</th>
      <th>ITEMID</th>
      <th>RATING</th>
      <th>TITLE</th>
      <th>AUTHOR</th>
      <th>YEAR</th>
      <th>PUBLISHER</th>
      <th>URLSMALL</th>
      <th>URLMEDIUM</th>
      <th>URLLARGE</th>
      <th>UNIQUE_ITEMIDS</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>276726</td>
      <td>0155061224</td>
      <td>5</td>
      <td>Rites of Passage</td>
      <td>Judith Rae</td>
      <td>2001.0</td>
      <td>Heinle</td>
      <td>http://images.amazon.com/images/P/0155061224.0...</td>
      <td>http://images.amazon.com/images/P/0155061224.0...</td>
      <td>http://images.amazon.com/images/P/0155061224.0...</td>
      <td>0155061224</td>
    </tr>
    <tr>
      <th>3</th>
      <td>276729</td>
      <td>052165615X</td>
      <td>3</td>
      <td>Help!: Level 1</td>
      <td>Philip Prowse</td>
      <td>1999.0</td>
      <td>Cambridge University Press</td>
      <td>http://images.amazon.com/images/P/052165615X.0...</td>
      <td>http://images.amazon.com/images/P/052165615X.0...</td>
      <td>http://images.amazon.com/images/P/052165615X.0...</td>
      <td>052165615X</td>
    </tr>
    <tr>
      <th>4</th>
      <td>276729</td>
      <td>0521795028</td>
      <td>6</td>
      <td>The Amsterdam Connection : Level 4 (Cambridge ...</td>
      <td>Sue Leather</td>
      <td>2001.0</td>
      <td>Cambridge University Press</td>
      <td>http://images.amazon.com/images/P/0521795028.0...</td>
      <td>http://images.amazon.com/images/P/0521795028.0...</td>
      <td>http://images.amazon.com/images/P/0521795028.0...</td>
      <td>0521795028</td>
    </tr>
    <tr>
      <th>8</th>
      <td>276744</td>
      <td>038550120X</td>
      <td>7</td>
      <td>A Painted House</td>
      <td>JOHN GRISHAM</td>
      <td>2001.0</td>
      <td>Doubleday</td>
      <td>http://images.amazon.com/images/P/038550120X.0...</td>
      <td>http://images.amazon.com/images/P/038550120X.0...</td>
      <td>http://images.amazon.com/images/P/038550120X.0...</td>
      <td>038550120X</td>
    </tr>
    <tr>
      <th>16</th>
      <td>276747</td>
      <td>0060517794</td>
      <td>9</td>
      <td>Little Altars Everywhere</td>
      <td>Rebecca Wells</td>
      <td>2003.0</td>
      <td>HarperTorch</td>
      <td>http://images.amazon.com/images/P/0060517794.0...</td>
      <td>http://images.amazon.com/images/P/0060517794.0...</td>
      <td>http://images.amazon.com/images/P/0060517794.0...</td>
      <td>0060517794</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The table now includes our <code class="docutils literal notranslate"><span class="pre">UNIQUE_ITEMIDS</span></code> field.</p>
<p>Let’s check to see if the ‘Jane Eyre’ entries have been assigned the ISBN ‘1590071212’, which was the first val in the dictionary for this title.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">books_with_ratings</span><span class="p">[</span><span class="n">books_with_ratings</span><span class="o">.</span><span class="n">TITLE</span><span class="o">==</span><span class="s1">&#39;Jane Eyre&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>USERID</th>
      <th>ITEMID</th>
      <th>RATING</th>
      <th>TITLE</th>
      <th>AUTHOR</th>
      <th>YEAR</th>
      <th>PUBLISHER</th>
      <th>URLSMALL</th>
      <th>URLMEDIUM</th>
      <th>URLLARGE</th>
      <th>UNIQUE_ITEMIDS</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>10481</th>
      <td>387</td>
      <td>1590071212</td>
      <td>9</td>
      <td>Jane Eyre</td>
      <td>Charlotte Bronte</td>
      <td>2002.0</td>
      <td>New Millenium Audio</td>
      <td>http://images.amazon.com/images/P/1590071212.0...</td>
      <td>http://images.amazon.com/images/P/1590071212.0...</td>
      <td>http://images.amazon.com/images/P/1590071212.0...</td>
      <td>1590071212</td>
    </tr>
    <tr>
      <th>16178</th>
      <td>2718</td>
      <td>0451518845</td>
      <td>10</td>
      <td>Jane Eyre</td>
      <td>Charlotte Bronte</td>
      <td>1999.0</td>
      <td>New Amer Library Classics</td>
      <td>http://images.amazon.com/images/P/0451518845.0...</td>
      <td>http://images.amazon.com/images/P/0451518845.0...</td>
      <td>http://images.amazon.com/images/P/0451518845.0...</td>
      <td>1590071212</td>
    </tr>
    <tr>
      <th>35499</th>
      <td>8370</td>
      <td>0451523326</td>
      <td>8</td>
      <td>Jane Eyre</td>
      <td>Charlotte Bronte</td>
      <td>1988.0</td>
      <td>Signet Classics</td>
      <td>http://images.amazon.com/images/P/0451523326.0...</td>
      <td>http://images.amazon.com/images/P/0451523326.0...</td>
      <td>http://images.amazon.com/images/P/0451523326.0...</td>
      <td>1590071212</td>
    </tr>
    <tr>
      <th>50842</th>
      <td>11676</td>
      <td>0451523326</td>
      <td>9</td>
      <td>Jane Eyre</td>
      <td>Charlotte Bronte</td>
      <td>1988.0</td>
      <td>Signet Classics</td>
      <td>http://images.amazon.com/images/P/0451523326.0...</td>
      <td>http://images.amazon.com/images/P/0451523326.0...</td>
      <td>http://images.amazon.com/images/P/0451523326.0...</td>
      <td>1590071212</td>
    </tr>
    <tr>
      <th>58066</th>
      <td>11676</td>
      <td>843761449X</td>
      <td>8</td>
      <td>Jane Eyre</td>
      <td>Charlotte Bronte</td>
      <td>1998.0</td>
      <td>Ediciones Catedra S.A.</td>
      <td>http://images.amazon.com/images/P/843761449X.0...</td>
      <td>http://images.amazon.com/images/P/843761449X.0...</td>
      <td>http://images.amazon.com/images/P/843761449X.0...</td>
      <td>1590071212</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Great! Seems to have worked well.</p>
<p>We won’t replace the original ISBN column with the ‘UNIQUE_ITEMIDS’ column, but just note that the recommendation model should be based on the ‘UNIQUE_ITEMIDS’ field.</p>
</div>
<div class="section" id="remove-small-and-large-book-cover-url-columns">
<h3>Remove Small and Large book-cover URL columns<a class="headerlink" href="#remove-small-and-large-book-cover-url-columns" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">books_users_ratings</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;URLSMALL&#39;</span><span class="p">,</span> <span class="s1">&#39;URLLARGE&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="join-the-users-table-on-the-userid-field">
<h2>Join the ‘users’ table on the ‘USERID’ field<a class="headerlink" href="#join-the-users-table-on-the-userid-field" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Books+Ratings table size: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">books_with_ratings</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Users table size: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">users</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">books_users_ratings</span> <span class="o">=</span> <span class="n">books_with_ratings</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">users</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;USERID&#39;</span><span class="p">),</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;USERID&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;New &quot;books_users_ratings&quot; table size: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">books_users_ratings</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Books+Ratings table size: 383810
Users table size: 278858
New &quot;books_users_ratings&quot; table size: 383810
</pre></div>
</div>
</div>
</div>
<p>Inspect the new table.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">books_users_ratings</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>USERID</th>
      <th>ITEMID</th>
      <th>RATING</th>
      <th>TITLE</th>
      <th>AUTHOR</th>
      <th>YEAR</th>
      <th>PUBLISHER</th>
      <th>URLMEDIUM</th>
      <th>UNIQUE_ITEMIDS</th>
      <th>AGE</th>
      <th>CITY</th>
      <th>STATE</th>
      <th>COUNTRY</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>276726</td>
      <td>0155061224</td>
      <td>5</td>
      <td>Rites of Passage</td>
      <td>Judith Rae</td>
      <td>2001.0</td>
      <td>Heinle</td>
      <td>http://images.amazon.com/images/P/0155061224.0...</td>
      <td>0155061224</td>
      <td>NaN</td>
      <td>seattle</td>
      <td>washington</td>
      <td>usa</td>
    </tr>
    <tr>
      <th>3</th>
      <td>276729</td>
      <td>052165615X</td>
      <td>3</td>
      <td>Help!: Level 1</td>
      <td>Philip Prowse</td>
      <td>1999.0</td>
      <td>Cambridge University Press</td>
      <td>http://images.amazon.com/images/P/052165615X.0...</td>
      <td>052165615X</td>
      <td>16.0</td>
      <td>rijeka</td>
      <td>n/a</td>
      <td>croatia</td>
    </tr>
    <tr>
      <th>4</th>
      <td>276729</td>
      <td>0521795028</td>
      <td>6</td>
      <td>The Amsterdam Connection : Level 4 (Cambridge ...</td>
      <td>Sue Leather</td>
      <td>2001.0</td>
      <td>Cambridge University Press</td>
      <td>http://images.amazon.com/images/P/0521795028.0...</td>
      <td>0521795028</td>
      <td>16.0</td>
      <td>rijeka</td>
      <td>n/a</td>
      <td>croatia</td>
    </tr>
    <tr>
      <th>8</th>
      <td>276744</td>
      <td>038550120X</td>
      <td>7</td>
      <td>A Painted House</td>
      <td>JOHN GRISHAM</td>
      <td>2001.0</td>
      <td>Doubleday</td>
      <td>http://images.amazon.com/images/P/038550120X.0...</td>
      <td>038550120X</td>
      <td>NaN</td>
      <td>torrance</td>
      <td>california</td>
      <td>usa</td>
    </tr>
    <tr>
      <th>16</th>
      <td>276747</td>
      <td>0060517794</td>
      <td>9</td>
      <td>Little Altars Everywhere</td>
      <td>Rebecca Wells</td>
      <td>2003.0</td>
      <td>HarperTorch</td>
      <td>http://images.amazon.com/images/P/0060517794.0...</td>
      <td>0060517794</td>
      <td>25.0</td>
      <td>iowa city</td>
      <td>iowa</td>
      <td>usa</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">books_users_ratings</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 383810 entries, 1 to 1149778
Data columns (total 13 columns):
 #   Column          Non-Null Count   Dtype  
---  ------          --------------   -----  
 0   USERID          383810 non-null  int64  
 1   ITEMID          383810 non-null  object 
 2   RATING          383810 non-null  int64  
 3   TITLE           383810 non-null  object 
 4   AUTHOR          383809 non-null  object 
 5   YEAR            378026 non-null  float64
 6   PUBLISHER       383808 non-null  object 
 7   URLMEDIUM       383810 non-null  object 
 8   UNIQUE_ITEMIDS  383810 non-null  object 
 9   AGE             267996 non-null  float64
 10  CITY            383810 non-null  object 
 11  STATE           383810 non-null  object 
 12  COUNTRY         373330 non-null  object 
dtypes: float64(2), int64(2), object(9)
memory usage: 41.0+ MB
</pre></div>
</div>
</div>
</div>
<p>There are a few missing <code class="docutils literal notranslate"><span class="pre">age</span></code>, <code class="docutils literal notranslate"><span class="pre">year_of_publication</span></code>, <code class="docutils literal notranslate"><span class="pre">publisher</span></code>, and <code class="docutils literal notranslate"><span class="pre">country</span></code> entries, but the primary fields of <code class="docutils literal notranslate"><span class="pre">USERID</span></code>, <code class="docutils literal notranslate"><span class="pre">UNIQUE_ITEMIDS</span></code>, and <code class="docutils literal notranslate"><span class="pre">book_rating</span></code> are all full, which is good.</p>
<p>In terms of the data types, <code class="docutils literal notranslate"><span class="pre">USERID</span></code> and <code class="docutils literal notranslate"><span class="pre">book_rating</span></code> are integers, while the <code class="docutils literal notranslate"><span class="pre">UNIQUE_ITEMIDS</span></code> are strings (which is expected as the ISBN numbers may also contain letters).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">books_users_ratings</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(383810, 13)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="recommender-model">
<h2>Recommender model<a class="headerlink" href="#recommender-model" title="Permalink to this headline">¶</a></h2>
<p>Collaborative filtering use similarities of the ‘user’ and ‘item’ fields, with values of ‘rating’ predicted based on either user-item, or item-item similarity:</p>
<ul class="simple">
<li><p>Item-Item CF: “Users who liked this item also liked…”</p></li>
<li><p>User-Item CF: “Users who are similar to you also liked…”</p></li>
</ul>
<p>In both cases, we need to create a user-item matrix built from the entire dataset. We’ll create a matrix for each of the training and testing sets, with the users as the rows, the books as the columns, and the rating as the matrix value. Note that this will be a very sparse matrix, as not every user will have watched every movie etc.</p>
<p>We’ll first create a new dataframe that contains only the relevant columns (<code class="docutils literal notranslate"><span class="pre">USERID</span></code>, <code class="docutils literal notranslate"><span class="pre">UNIQUE_ITEMIDS</span></code>, and <code class="docutils literal notranslate"><span class="pre">book_rating</span></code>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">user_item_rating</span> <span class="o">=</span> <span class="n">books_users_ratings</span><span class="p">[[</span><span class="s1">&#39;USERID&#39;</span><span class="p">,</span> <span class="s1">&#39;UNIQUE_ITEMIDS&#39;</span><span class="p">,</span> <span class="s1">&#39;RATING&#39;</span><span class="p">]]</span>
<span class="n">user_item_rating</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>USERID</th>
      <th>UNIQUE_ITEMIDS</th>
      <th>RATING</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>276726</td>
      <td>0155061224</td>
      <td>5</td>
    </tr>
    <tr>
      <th>3</th>
      <td>276729</td>
      <td>052165615X</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>276729</td>
      <td>0521795028</td>
      <td>6</td>
    </tr>
    <tr>
      <th>8</th>
      <td>276744</td>
      <td>038550120X</td>
      <td>7</td>
    </tr>
    <tr>
      <th>16</th>
      <td>276747</td>
      <td>0060517794</td>
      <td>9</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We know what the distribution of ratings should look like (as we plotted it earlier) - let’s plot it again on this new dataframe to just quickly check that it looks right.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rtg</span> <span class="o">=</span> <span class="n">user_item_rating</span><span class="o">.</span><span class="n">RATING</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">rtg</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">rtg</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Rating&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;counts&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/T990000_book_crossing_surprise_svd_nmf_112_0.png" src="../_images/T990000_book_crossing_surprise_svd_nmf_112_0.png" />
</div>
</div>
<p>Looks perfect! Continue.</p>
<div class="section" id="using-sklearn-to-generate-training-and-testing-subsets">
<h3>Using <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> to generate training and testing subsets<a class="headerlink" href="#using-sklearn-to-generate-training-and-testing-subsets" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">train_data</span><span class="p">,</span> <span class="n">test_data</span> <span class="o">=</span> <span class="n">model_selection</span><span class="o">.</span><span class="n">train_test_split</span><span class="p">(</span><span class="n">user_item_rating</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.20</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Training set size: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">train_data</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Testing set size: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">test_data</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Test set is </span><span class="si">{</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_data</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">train_data</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">test_data</span><span class="p">))</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span><span class="si">:</span><span class="s1">.0f</span><span class="si">}</span><span class="s1">% of the full dataset.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Training set size: 307048
Testing set size: 76762
Test set is 20% of the full dataset.
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="map-the-userid-and-unique-itemids-fields-to-sequential-integers-for-matrix-processing">
<h3>Map the <code class="docutils literal notranslate"><span class="pre">USERID</span></code> and <code class="docutils literal notranslate"><span class="pre">UNIQUE_ITEMIDS</span></code> fields to sequential integers for matrix processing<a class="headerlink" href="#map-the-userid-and-unique-itemids-fields-to-sequential-integers-for-matrix-processing" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">### TRAINING SET</span>
<span class="c1"># Get int mapping for USERID</span>
<span class="n">u_unique_train</span> <span class="o">=</span> <span class="n">train_data</span><span class="o">.</span><span class="n">USERID</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>  <span class="c1"># create a &#39;set&#39; (i.e. all unique) list of vals</span>
<span class="n">train_data_user2idx</span> <span class="o">=</span> <span class="p">{</span><span class="n">o</span><span class="p">:</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">u_unique_train</span><span class="p">)}</span>
<span class="c1"># Get int mapping for UNIQUE_ITEMIDS</span>
<span class="n">b_unique_train</span> <span class="o">=</span> <span class="n">train_data</span><span class="o">.</span><span class="n">UNIQUE_ITEMIDS</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>  <span class="c1"># create a &#39;set&#39; (i.e. all unique) list of vals</span>
<span class="n">train_data_book2idx</span> <span class="o">=</span> <span class="p">{</span><span class="n">o</span><span class="p">:</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">b_unique_train</span><span class="p">)}</span>

<span class="c1">### TESTING SET</span>
<span class="c1"># Get int mapping for USERID</span>
<span class="n">u_unique_test</span> <span class="o">=</span> <span class="n">test_data</span><span class="o">.</span><span class="n">USERID</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>  <span class="c1"># create a &#39;set&#39; (i.e. all unique) list of vals</span>
<span class="n">test_data_user2idx</span> <span class="o">=</span> <span class="p">{</span><span class="n">o</span><span class="p">:</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">u_unique_test</span><span class="p">)}</span>
<span class="c1"># Get int mapping for UNIQUE_ITEMIDS</span>
<span class="n">b_unique_test</span> <span class="o">=</span> <span class="n">test_data</span><span class="o">.</span><span class="n">UNIQUE_ITEMIDS</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>  <span class="c1"># create a &#39;set&#39; (i.e. all unique) list of vals</span>
<span class="n">test_data_book2idx</span> <span class="o">=</span> <span class="p">{</span><span class="n">o</span><span class="p">:</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">b_unique_test</span><span class="p">)}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">### TRAINING SET</span>
<span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;USER_UNIQUE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;USERID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">train_data_user2idx</span><span class="p">)</span>
<span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;ITEM_UNIQUE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;UNIQUE_ITEMIDS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">train_data_book2idx</span><span class="p">)</span>

<span class="c1">### TESTING SET</span>
<span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;USER_UNIQUE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;USERID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">test_data_user2idx</span><span class="p">)</span>
<span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;ITEM_UNIQUE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;UNIQUE_ITEMIDS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">test_data_book2idx</span><span class="p">)</span>

<span class="c1">### Convert back to 3-column df</span>
<span class="n">train_data</span> <span class="o">=</span> <span class="n">train_data</span><span class="p">[[</span><span class="s1">&#39;USER_UNIQUE&#39;</span><span class="p">,</span> <span class="s1">&#39;ITEM_UNIQUE&#39;</span><span class="p">,</span> <span class="s1">&#39;RATING&#39;</span><span class="p">]]</span>
<span class="n">test_data</span> <span class="o">=</span> <span class="n">test_data</span><span class="p">[[</span><span class="s1">&#39;USER_UNIQUE&#39;</span><span class="p">,</span> <span class="s1">&#39;ITEM_UNIQUE&#39;</span><span class="p">,</span> <span class="s1">&#39;RATING&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">train_data</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>USER_UNIQUE</th>
      <th>ITEM_UNIQUE</th>
      <th>RATING</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>436369</th>
      <td>3013</td>
      <td>41654</td>
      <td>10</td>
    </tr>
    <tr>
      <th>1022064</th>
      <td>59278</td>
      <td>116980</td>
      <td>8</td>
    </tr>
    <tr>
      <th>524738</th>
      <td>6887</td>
      <td>21241</td>
      <td>5</td>
    </tr>
    <tr>
      <th>340428</th>
      <td>2495</td>
      <td>15166</td>
      <td>8</td>
    </tr>
    <tr>
      <th>443166</th>
      <td>11135</td>
      <td>10688</td>
      <td>10</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">train_data</span><span class="o">.</span><span class="n">dtypes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>USER_UNIQUE    int64
ITEM_UNIQUE    int64
RATING         int64
dtype: object
</pre></div>
</div>
</div>
</div>
<p>This dataset is now ready to be processed via a collaborative filtering approach!</p>
<p><strong>Note:</strong> When we need to identify the user or book from the model we’ll need to refer back to the <code class="docutils literal notranslate"><span class="pre">train_data_user2idx</span></code> and <code class="docutils literal notranslate"><span class="pre">train_data_book2idx</span></code> dictionaries to locate the <code class="docutils literal notranslate"><span class="pre">USERID</span></code> and <code class="docutils literal notranslate"><span class="pre">UNIQUE_ITEMIDS</span></code>, respectively.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">### TRAINING SET</span>
<span class="c1"># Create user-item matrices</span>
<span class="n">n_users</span> <span class="o">=</span> <span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;USER_UNIQUE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
<span class="n">n_books</span> <span class="o">=</span> <span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;ITEM_UNIQUE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>

<span class="c1"># First, create an empty matrix of size USERS x BOOKS (this speeds up the later steps)</span>
<span class="n">train_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_users</span><span class="p">,</span> <span class="n">n_books</span><span class="p">))</span>

<span class="c1"># Then, add the appropriate vals to the matrix by extracting them from the df with itertuples</span>
<span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">train_data</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span> <span class="c1"># entry[1] is the user-id, entry[2] is the book-isbn</span>
    <span class="n">train_matrix</span><span class="p">[</span><span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">entry</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="c1"># -1 is to counter 0-based indexing</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">train_matrix</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(59851, 117107)
</pre></div>
</div>
</div>
</div>
<p>Now do the same for the test set.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">### TESTING SET</span>
<span class="c1"># Create user-item matrices</span>
<span class="n">n_users</span> <span class="o">=</span> <span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;u_unique&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
<span class="n">n_books</span> <span class="o">=</span> <span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;b_unique&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>

<span class="c1"># First, create an empty matrix of size USERS x BOOKS (this speeds up the later steps)</span>
<span class="n">test_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_users</span><span class="p">,</span> <span class="n">n_books</span><span class="p">))</span>

<span class="c1"># Then, add the appropriate vals to the matrix by extracting them from the df with itertuples</span>
<span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">test_data</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span> <span class="c1"># entry[1] is the user-id, entry[2] is the book-isbn</span>
    <span class="n">test_matrix</span><span class="p">[</span><span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">entry</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="c1"># -1 is to counter 0-based indexing</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_matrix</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(26007, 43403)
</pre></div>
</div>
</div>
</div>
<p>Now the matrix is in the correct format, with the user and book entries encoded from the mapping dict created above!</p>
</div>
<div class="section" id="calculating-cosine-similarity-with-the-pairwise-distances-function">
<h3>Calculating cosine similarity with the ‘pairwise distances’ function<a class="headerlink" href="#calculating-cosine-similarity-with-the-pairwise-distances-function" title="Permalink to this headline">¶</a></h3>
<p>To determine the similarity between users/items we’ll use the ‘cosine similarity’ which is a common n-dimensional distance metric.</p>
<p><strong>Note:</strong> since all of the rating values are positive (1-10 scale), the cosine distances will all fall between 0 and 1.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># It may take a while to calculate, so I&#39;ll perform on a subset initially</span>
<span class="n">train_matrix_small</span> <span class="o">=</span> <span class="n">train_matrix</span><span class="p">[:</span><span class="mi">10000</span><span class="p">,</span> <span class="p">:</span><span class="mi">10000</span><span class="p">]</span>
<span class="n">test_matrix_small</span> <span class="o">=</span> <span class="n">test_matrix</span><span class="p">[:</span><span class="mi">10000</span><span class="p">,</span> <span class="p">:</span><span class="mi">10000</span><span class="p">]</span>

<span class="kn">from</span> <span class="nn">sklearn.metrics.pairwise</span> <span class="kn">import</span> <span class="n">pairwise_distances</span>
<span class="n">user_similarity</span> <span class="o">=</span> <span class="n">pairwise_distances</span><span class="p">(</span><span class="n">train_matrix_small</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;cosine&#39;</span><span class="p">)</span>
<span class="n">item_similarity</span> <span class="o">=</span> <span class="n">pairwise_distances</span><span class="p">(</span><span class="n">train_matrix_small</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;cosine&#39;</span><span class="p">)</span> <span class="c1"># .T transposes the matrix (NumPy)</span>
</pre></div>
</div>
</div>
</div>
<p>If we are looking at similarity between users we need to account for the average behaviour of that individual user. For example, one user may give all movies quite high ratings, whereas one might give all ratings between 3 and 7. These users might otherwise have quite similar preferences.</p>
<p>To do this, we use the users average rating as a ‘weighting’ factor.</p>
<p>If we are looking at item-based similarity we don’t need to add this weighting factor.</p>
<p>We can incorporate this into a <code class="docutils literal notranslate"><span class="pre">predict()</span></code> function, like so:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="n">ratings</span><span class="p">,</span> <span class="n">similarity</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;user&#39;</span><span class="p">):</span> <span class="c1"># default type is &#39;user&#39;</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;user&#39;</span><span class="p">:</span>
        <span class="n">mean_user_rating</span> <span class="o">=</span> <span class="n">ratings</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># Use np.newaxis so that mean_user_rating has the same format as ratings</span>
        <span class="n">ratings_diff</span> <span class="o">=</span> <span class="p">(</span><span class="n">ratings</span> <span class="o">-</span> <span class="n">mean_user_rating</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">])</span>
        <span class="n">pred</span> <span class="o">=</span> <span class="n">mean_user_rating</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">+</span> <span class="n">similarity</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">ratings_diff</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">similarity</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)])</span><span class="o">.</span><span class="n">T</span>
    <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;item&#39;</span><span class="p">:</span>
        <span class="n">pred</span> <span class="o">=</span> <span class="n">ratings</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">similarity</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">similarity</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)])</span>
    <span class="k">return</span> <span class="n">pred</span>
</pre></div>
</div>
</div>
</div>
<p>Then can make our predictions!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">item_prediction</span> <span class="o">=</span> <span class="n">predict</span><span class="p">(</span><span class="n">train_matrix_small</span><span class="p">,</span> <span class="n">item_similarity</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;item&#39;</span><span class="p">)</span>
<span class="n">user_prediction</span> <span class="o">=</span> <span class="n">predict</span><span class="p">(</span><span class="n">train_matrix_small</span><span class="p">,</span> <span class="n">user_similarity</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;user&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="evaluation">
<h3>Evaluation<a class="headerlink" href="#evaluation" title="Permalink to this headline">¶</a></h3>
<p>How do we know if this is making good <code class="docutils literal notranslate"><span class="pre">rating</span></code> predictions?</p>
<p>We’ll start by just taking the root mean squared error (RMSE) (from <code class="docutils literal notranslate"><span class="pre">sklearn</span></code>) of predicted values in the <code class="docutils literal notranslate"><span class="pre">test_set</span></code> (i.e. where we know what the answer should be).</p>
<p>Since we want to compare only predicted ratings that are in the test set, we can filter out all other predictions that aren’t in the test matrix.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sqrt</span>

<span class="k">def</span> <span class="nf">rmse</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">test_matrix</span><span class="p">):</span>
    <span class="n">prediction</span> <span class="o">=</span> <span class="n">prediction</span><span class="p">[</span><span class="n">test_matrix</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">test_matrix</span> <span class="o">=</span> <span class="n">test_matrix</span><span class="p">[</span><span class="n">test_matrix</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">test_matrix</span><span class="p">))</span>

<span class="c1"># Call on test set to get error from each approach (&#39;user&#39; or &#39;item&#39;)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;User-based CF RMSE: </span><span class="si">{</span><span class="n">rmse</span><span class="p">(</span><span class="n">user_prediction</span><span class="p">,</span> <span class="n">test_matrix_small</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Item-based CF RMSE: </span><span class="si">{</span><span class="n">rmse</span><span class="p">(</span><span class="n">item_prediction</span><span class="p">,</span> <span class="n">test_matrix_small</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>User-based CF RMSE: 7.929926397008533
Item-based CF RMSE: 7.930326958653732
</pre></div>
</div>
</div>
</div>
<p>For the user-item and the item-item recommendations we get RMSE = 7.85 (MSE &gt; 60) for both. This is pretty bad, but we only trained over a small subset of the data.</p>
<p>Although this collaborative filtering setup is relatively simple to write, it doesn’t scale very well at all, as it is all stored in memory! (Hence why we only used a subset of the training/testing data).</p>
<hr class="docutils" />
<p>Instead, we should really use a model-based (based on matrix factorization) recommendation algorithm. These are inherently more scalable and can deal with higher sparsity level than memory-based models, and are considered more powerful due to their ability to pick up on “latent factors” in the relationships between what sets of items users like. However, they still suffer from the “cold start” problem (where a new user has no history).</p>
<p>Fortunately, there is a Python library called <code class="docutils literal notranslate"><span class="pre">surprise</span></code> that was built specifically for the implementation of model-based recommendation systems! This library comes with many of the leading algorithms in this space already built-in. Let’s try use it for our book recommender system.</p>
</div>
</div>
<div class="section" id="using-the-surprise-library-for-building-a-recommender-system">
<h2>Using the <code class="docutils literal notranslate"><span class="pre">surprise</span></code> library for building a recommender system<a class="headerlink" href="#using-the-surprise-library-for-building-a-recommender-system" title="Permalink to this headline">¶</a></h2>
<p>Several common model-based algorithms including SVD, KNN, and non-negative matrix factorization are built-in!<br />
See <a class="reference external" href="http://surprise.readthedocs.io/en/stable/getting_started.html#basic-usage">here</a> for the docs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">surprise</span> <span class="kn">import</span> <span class="n">Reader</span><span class="p">,</span> <span class="n">Dataset</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">user_item_rating</span><span class="o">.</span><span class="n">head</span><span class="p">()</span> <span class="c1"># take a look at our data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>user_id</th>
      <th>unique_isbn</th>
      <th>book_rating</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>276726</td>
      <td>0155061224</td>
      <td>5</td>
    </tr>
    <tr>
      <th>3</th>
      <td>276729</td>
      <td>052165615X</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>276729</td>
      <td>0521795028</td>
      <td>6</td>
    </tr>
    <tr>
      <th>8</th>
      <td>276744</td>
      <td>038550120X</td>
      <td>7</td>
    </tr>
    <tr>
      <th>16</th>
      <td>276747</td>
      <td>0060517794</td>
      <td>9</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># First need to create a &#39;Reader&#39; object to set the scale/limit of the ratings field</span>
<span class="n">reader</span> <span class="o">=</span> <span class="n">Reader</span><span class="p">(</span><span class="n">rating_scale</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="c1"># Load the data into a &#39;Dataset&#39; object directly from the pandas df.</span>
<span class="c1"># Note: The fields must be in the order: user, item, rating</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">load_from_df</span><span class="p">(</span><span class="n">user_item_rating</span><span class="p">,</span> <span class="n">reader</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load the models and &#39;evaluation&#39; method</span>
<span class="kn">from</span> <span class="nn">surprise</span> <span class="kn">import</span> <span class="n">SVD</span><span class="p">,</span> <span class="n">NMF</span><span class="p">,</span> <span class="n">model_selection</span><span class="p">,</span> <span class="n">accuracy</span>
</pre></div>
</div>
</div>
</div>
<p>Where: SVD = Singular Value Decomposition (orthogonal factorization), NMF = Non-negative Matrix Factorization.</p>
<p><strong>Note</strong> that when using the <code class="docutils literal notranslate"><span class="pre">surprise</span></code> library we don’t need to manually create the mapping of USERID and UNIQUE_ITEMIDS to integers in a custom dict. See <a class="reference external" href="http://surprise.readthedocs.io/en/stable/FAQ.html#raw-inner-note">here</a> for details.</p>
<div class="section" id="svd-model">
<h3>SVD model<a class="headerlink" href="#svd-model" title="Permalink to this headline">¶</a></h3>
<p><strong><em>Using cross-validation (5 folds)</em></strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load SVD algorithm</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">SVD</span><span class="p">()</span>

<span class="c1"># Train on books dataset</span>
<span class="o">%</span><span class="n">time</span> <span class="n">model_selection</span><span class="o">.</span><span class="n">cross_validate</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">measures</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;RMSE&#39;</span><span class="p">],</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating RMSE of algorithm SVD on 5 split(s).

                  Fold 1  Fold 2  Fold 3  Fold 4  Fold 5  Mean    Std     
RMSE (testset)    1.6379  1.6342  1.6399  1.6333  1.6383  1.6367  0.0025  
Fit time          27.50   29.12   28.19   28.50   27.17   28.09   0.70    
Test time         1.26    1.28    1.25    1.07    1.22    1.22    0.07    
CPU times: user 2min 32s, sys: 1.44 s, total: 2min 33s
Wall time: 2min 34s
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;fit_time&#39;: (27.502967834472656,
  29.117522954940796,
  28.18734574317932,
  28.497459888458252,
  27.168857097625732),
 &#39;test_rmse&#39;: array([1.63792973, 1.63415582, 1.63987213, 1.63326894, 1.63828638]),
 &#39;test_time&#39;: (1.2554690837860107,
  1.2811057567596436,
  1.2533769607543945,
  1.0734889507293701,
  1.2155327796936035)}
</pre></div>
</div>
</div>
</div>
<p>The SVD model gives an average RMSE of ca. 1.64 after 5-folds, with a fit time of ca. 28 s for each fold.</p>
<p><strong><em>Using test-train split</em></strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># set test set to 20%.</span>
<span class="n">trainset</span><span class="p">,</span> <span class="n">testset</span> <span class="o">=</span> <span class="n">model_selection</span><span class="o">.</span><span class="n">train_test_split</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

<span class="c1"># Instantiate the SVD model.</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">SVD</span><span class="p">()</span>

<span class="c1"># Train the algorithm on the training set, and predict ratings for the test set</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">trainset</span><span class="p">)</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">testset</span><span class="p">)</span>

<span class="c1"># Then compute RMSE</span>
<span class="n">accuracy</span><span class="o">.</span><span class="n">rmse</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: 1.6355
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.635463484151215
</pre></div>
</div>
</div>
</div>
<p>Using a 80% train-test split, the SVD model gave a RMSE of 1.6426.</p>
<hr class="docutils" />
<p>We can see that using the SVD algorithm has already far out-performed the memory-based collaborative filtering approach (RMSE of 1.64 vs 7.92)!</p>
</div>
<div class="section" id="nmf-model">
<h3>NMF model<a class="headerlink" href="#nmf-model" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load NMF algorithm</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">NMF</span><span class="p">()</span>
<span class="c1"># Train on books dataset</span>
<span class="o">%</span><span class="n">time</span> <span class="n">model_selection</span><span class="o">.</span><span class="n">cross_validate</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">measures</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;RMSE&#39;</span><span class="p">],</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating RMSE of algorithm NMF on 5 split(s).

                  Fold 1  Fold 2  Fold 3  Fold 4  Fold 5  Mean    Std     
RMSE (testset)    2.4719  2.4753  2.4991  2.4583  2.4690  2.4747  0.0134  
Fit time          48.55   48.36   48.67   48.21   49.12   48.58   0.31    
Test time         1.00    1.22    1.24    0.89    1.27    1.12    0.15    
CPU times: user 4min 12s, sys: 2.77 s, total: 4min 15s
Wall time: 4min 15s
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;fit_time&#39;: (48.549073934555054,
  48.363773822784424,
  48.67202186584473,
  48.2091269493103,
  49.12370300292969),
 &#39;test_rmse&#39;: array([2.47190526, 2.47525086, 2.49908596, 2.45830639, 2.46903139]),
 &#39;test_time&#39;: (0.9956762790679932,
  1.2233927249908447,
  1.2397921085357666,
  0.8911020755767822,
  1.2676730155944824)}
</pre></div>
</div>
</div>
</div>
<p>The NMF model gave a mean RMSE of ca. 2.47, with a fit time of ca. 48 s.</p>
<p>It seems like the SVD algorithm is the best choice for this dataset.</p>
</div>
</div>
<div class="section" id="optimizing-the-svd-algorithm-with-parameter-tuning">
<h2>Optimizing the SVD algorithm with parameter tuning<a class="headerlink" href="#optimizing-the-svd-algorithm-with-parameter-tuning" title="Permalink to this headline">¶</a></h2>
<p>Since it seems like the SVD algorithm is our best choice, let’s see if we can improve the predictions even further by optimizing some of the algorithm hyperparameters.</p>
<p>One way of doing this is to use the handy <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code> method from the <code class="docutils literal notranslate"><span class="pre">surprise</span></code> library. When passed a range of hyperparameter values, <code class="docutils literal notranslate"><span class="pre">GridSearchCV</span></code> will automatically search through the parameter-space to find the best-performing set of hyperparameters.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># We&#39;ll remake the training set, keeping 20% for testing</span>
<span class="n">trainset</span><span class="p">,</span> <span class="n">testset</span> <span class="o">=</span> <span class="n">model_selection</span><span class="o">.</span><span class="n">train_test_split</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">### Fine-tune Surprise SVD model useing GridSearchCV</span>
<span class="kn">from</span> <span class="nn">surprise.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>

<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;n_factors&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">80</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">120</span><span class="p">],</span> <span class="s1">&#39;lr_all&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">],</span> <span class="s1">&#39;reg_all&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">]}</span>

<span class="c1"># Optimize SVD algorithm for both root mean squared error (&#39;rmse&#39;) and mean average error (&#39;mae&#39;)</span>
<span class="n">gs</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">SVD</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">measures</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;rmse&#39;</span><span class="p">,</span> <span class="s1">&#39;mae&#39;</span><span class="p">],</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fit the gridsearch result on the entire dataset</span>
<span class="o">%</span><span class="n">time</span> <span class="n">gs</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 34min 9s, sys: 10.8 s, total: 34min 20s
Wall time: 34min 29s
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Return the best version of the SVD algorithm</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">best_estimator</span><span class="p">[</span><span class="s1">&#39;rmse&#39;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">best_score</span><span class="p">[</span><span class="s1">&#39;rmse&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">best_params</span><span class="p">[</span><span class="s1">&#39;rmse&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.6376613092691847
{&#39;n_factors&#39;: 80, &#39;lr_all&#39;: 0.005, &#39;reg_all&#39;: 0.04}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">model_selection</span><span class="o">.</span><span class="n">cross_validate</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">measures</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;rmse&#39;</span><span class="p">,</span> <span class="s1">&#39;mae&#39;</span><span class="p">],</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating RMSE, MAE of algorithm SVD on 5 split(s).

                  Fold 1  Fold 2  Fold 3  Fold 4  Fold 5  Mean    Std     
RMSE (testset)    1.6326  1.6292  1.6314  1.6323  1.6296  1.6310  0.0014  
MAE (testset)     1.2594  1.2612  1.2611  1.2587  1.2563  1.2593  0.0018  
Fit time          25.22   24.25   24.24   24.00   24.18   24.38   0.43    
Test time         1.08    1.46    1.46    1.05    1.04    1.22    0.20    
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;fit_time&#39;: (25.217539072036743,
  24.249317169189453,
  24.235455989837646,
  24.002593994140625,
  24.184158086776733),
 &#39;test_mae&#39;: array([1.25944594, 1.26118138, 1.2610566 , 1.25867174, 1.25627505]),
 &#39;test_rmse&#39;: array([1.63260117, 1.6291625 , 1.63136824, 1.63232568, 1.62957994]),
 &#39;test_time&#39;: (1.0834269523620605,
  1.4560067653656006,
  1.464034080505371,
  1.0514049530029297,
  1.0434091091156006)}
</pre></div>
</div>
</div>
</div>
<p>The mean RSME using the optimized parameters was 1.6351 over 5 folds, with an average fit time of ca. 24s.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">### Use the new parameters with the training set</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">SVD</span><span class="p">(</span><span class="n">n_factors</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">lr_all</span><span class="o">=</span><span class="mf">0.005</span><span class="p">,</span> <span class="n">reg_all</span><span class="o">=</span><span class="mf">0.04</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">trainset</span><span class="p">)</span> <span class="c1"># re-fit on only the training data using the best hyperparameters</span>
<span class="n">test_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">testset</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SVD : Test Set&quot;</span><span class="p">)</span>
<span class="n">accuracy</span><span class="o">.</span><span class="n">rmse</span><span class="p">(</span><span class="n">test_pred</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SVD : Test Set
RMSE: 1.6287
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.6287348933888393
</pre></div>
</div>
</div>
</div>
<p>Using the optimized hyperparameters we see a slight improvement in the resulting RMSE (1.629) compared with the unoptimized SVD algorithm (1.635)1</p>
</div>
<div class="section" id="testing-some-of-the-outputs-ratings-and-recommendations">
<h2>Testing some of the outputs (ratings and recommendations)<a class="headerlink" href="#testing-some-of-the-outputs-ratings-and-recommendations" title="Permalink to this headline">¶</a></h2>
<p>Would like to do an intuitive check of some of the recommendations being made.</p>
<p>Let’s just choose a random user/book pair (represented in the <code class="docutils literal notranslate"><span class="pre">suprise</span></code> library as <code class="docutils literal notranslate"><span class="pre">uid</span></code> and <code class="docutils literal notranslate"><span class="pre">iid</span></code>, respectively).</p>
<p><strong>Note:</strong> The <code class="docutils literal notranslate"><span class="pre">model</span></code> being used here is the optimized SVD algorithm that has been fit on the training set.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># get a prediction for specific users and items.</span>
<span class="n">uid</span> <span class="o">=</span> <span class="mi">276744</span>  <span class="c1"># the USERID int</span>
<span class="n">iid</span> <span class="o">=</span> <span class="s1">&#39;038550120X&#39;</span> <span class="c1"># the UNIQUE_ITEMIDS string</span>
<span class="c1"># This pair has an actual rating of 7!</span>

<span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">iid</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user: 276744     item: 038550120X r_ui = None   est = 7.18   {&#39;was_impossible&#39;: False}
</pre></div>
</div>
</div>
</div>
<p>Can access the attributes of the <code class="docutils literal notranslate"><span class="pre">predict</span></code> method to get a nicer output.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The estimated rating for the book with the &quot;UNIQUE_ITEMIDS&quot; code </span><span class="si">{</span><span class="n">pred</span><span class="o">.</span><span class="n">iid</span><span class="si">}</span><span class="s1"> from user #</span><span class="si">{</span><span class="n">pred</span><span class="o">.</span><span class="n">uid</span><span class="si">}</span><span class="s1"> is </span><span class="si">{</span><span class="n">pred</span><span class="o">.</span><span class="n">est</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">actual_rtg</span> <span class="o">=</span> <span class="n">user_item_rating</span><span class="p">[(</span><span class="n">user_item_rating</span><span class="o">.</span><span class="n">USERID</span><span class="o">==</span><span class="n">pred</span><span class="o">.</span><span class="n">uid</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">user_item_rating</span><span class="o">.</span><span class="n">UNIQUE_ITEMIDS</span><span class="o">==</span><span class="n">pred</span><span class="o">.</span><span class="n">iid</span><span class="p">)]</span><span class="o">.</span><span class="n">RATING</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The real rating given for this was </span><span class="si">{</span><span class="n">actual_rtg</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The estimated rating for the book with the &quot;unique_isbn&quot; code 038550120X from user #276744 is 7.18.

The real rating given for this was 7.00.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># get a prediction for specific users and items.</span>
<span class="n">uid</span> <span class="o">=</span> <span class="mi">95095</span>  <span class="c1"># the USERID int</span>
<span class="n">iid</span> <span class="o">=</span> <span class="s1">&#39;0140079963&#39;</span> <span class="c1"># the UNIQUE_ITEMIDS string</span>
<span class="c1"># This pair has an actual rating of 6.0!</span>

<span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">iid</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user: 95095      item: 0140079963 r_ui = None   est = 6.87   {&#39;was_impossible&#39;: False}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The estimated rating for the book with the &quot;UNIQUE_ITEMIDS&quot; code </span><span class="si">{</span><span class="n">pred</span><span class="o">.</span><span class="n">iid</span><span class="si">}</span><span class="s1"> from user #</span><span class="si">{</span><span class="n">pred</span><span class="o">.</span><span class="n">uid</span><span class="si">}</span><span class="s1"> is </span><span class="si">{</span><span class="n">pred</span><span class="o">.</span><span class="n">est</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">actual_rtg</span> <span class="o">=</span> <span class="n">user_item_rating</span><span class="p">[(</span><span class="n">user_item_rating</span><span class="o">.</span><span class="n">USERID</span><span class="o">==</span><span class="n">pred</span><span class="o">.</span><span class="n">uid</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">user_item_rating</span><span class="o">.</span><span class="n">UNIQUE_ITEMIDS</span><span class="o">==</span><span class="n">pred</span><span class="o">.</span><span class="n">iid</span><span class="p">)]</span><span class="o">.</span><span class="n">RATING</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The real rating given for this was </span><span class="si">{</span><span class="n">actual_rtg</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The estimated rating for the book with the &quot;unique_isbn&quot; code 0140079963 from user #95095 is 6.87.

The real rating given for this was 6.00.
</pre></div>
</div>
</div>
</div>
<p>The following function was adapted from the <code class="docutils literal notranslate"><span class="pre">surprise</span></code> docs, and can be used to get the top book recommendations for each user.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>

<span class="k">def</span> <span class="nf">get_top_n</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return the top-N recommendation for each user from a set of predictions.</span>

<span class="sd">    Args:</span>
<span class="sd">        predictions(list of Prediction objects): The list of predictions, as</span>
<span class="sd">            returned by the test method of an algorithm.</span>
<span class="sd">        n(int): The number of recommendation to output for each user. Default</span>
<span class="sd">            is 10.</span>

<span class="sd">    Returns:</span>
<span class="sd">    A dict where keys are user (raw) ids and values are lists of tuples:</span>
<span class="sd">        [(raw item id, rating estimation), ...] of size n.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># First map the predictions to each user.</span>
    <span class="n">top_n</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">uid</span><span class="p">,</span> <span class="n">iid</span><span class="p">,</span> <span class="n">true_r</span><span class="p">,</span> <span class="n">est</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">predictions</span><span class="p">:</span>
        <span class="n">top_n</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">iid</span><span class="p">,</span> <span class="n">est</span><span class="p">))</span>

    <span class="c1"># Then sort the predictions for each user and retrieve the k highest ones.</span>
    <span class="k">for</span> <span class="n">uid</span><span class="p">,</span> <span class="n">user_ratings</span> <span class="ow">in</span> <span class="n">top_n</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">user_ratings</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">top_n</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_ratings</span><span class="p">[:</span><span class="n">n</span><span class="p">]</span>
        
    <span class="k">return</span> <span class="n">top_n</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s get the Top 10 recommended books for each USERID in the test set.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">testset</span><span class="p">)</span>
<span class="n">top_n</span> <span class="o">=</span> <span class="n">get_top_n</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_reading_list</span><span class="p">(</span><span class="n">userid</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve full book titles from full &#39;books_users_ratings&#39; dataframe</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reading_list</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">top_n</span> <span class="o">=</span> <span class="n">get_top_n</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">top_n</span><span class="p">[</span><span class="n">userid</span><span class="p">]:</span>
        <span class="n">book</span><span class="p">,</span> <span class="n">rating</span> <span class="o">=</span> <span class="n">n</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">books_users_ratings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">books_users_ratings</span><span class="o">.</span><span class="n">UNIQUE_ITEMIDS</span><span class="o">==</span><span class="n">book</span><span class="p">]</span><span class="o">.</span><span class="n">TITLE</span><span class="o">.</span><span class="n">unique</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">reading_list</span><span class="p">[</span><span class="n">title</span><span class="p">]</span> <span class="o">=</span> <span class="n">rating</span>
    <span class="k">return</span> <span class="n">reading_list</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Just take a random look at USERID=60337</span>
<span class="n">example_reading_list</span> <span class="o">=</span> <span class="n">get_reading_list</span><span class="p">(</span><span class="n">userid</span><span class="o">=</span><span class="mi">60337</span><span class="p">)</span>
<span class="k">for</span> <span class="n">book</span><span class="p">,</span> <span class="n">rating</span> <span class="ow">in</span> <span class="n">example_reading_list</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">book</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">rating</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>A Natural History of the Senses: 9.124985146110324
Grace For The Moment: 9.004232452533614
Eva Luna: 8.957717816714606
A Slender Thread : Rediscovering Hope at the Heart of Crisis: 8.81756023683983
Tell Me the Truth About Love: Ten Poems: 8.729204207356146
Papa, My Father: A Celebration of Dads: 8.708985984501158
Let the Dead Bury Their Dead (Harvest American Writing Series): 8.646273705729296
The Doctor&#39;s Book of Home Remedies : Thousands of Tips and Techniques Anyone Can Use to Heal Everyday Health Problems: 8.635645117795315
Why We Cant Wait: 8.535174763005822
Lump It or Leave It: 8.535174763005822
</pre></div>
</div>
</div>
</div>
<p>Have tried out a few different <code class="docutils literal notranslate"><span class="pre">userid</span></code> entries (from the <code class="docutils literal notranslate"><span class="pre">testset</span></code>) to see what the top 10 books that user would like are and they seem pretty well related, indicating that the recommendation engine is performing reasonably well!</p>
</div>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>In this notebook a dataset from the ‘Book-Crossing’ website was used to create a recommendation system. A few different approaches were investigated, including memory-based correlations, and model-based matrix factorization algorithms[2]. Of these, the latter - and particularly the Singular Value Decomposition (SVD) algorithm - gave the best performance as assessed by comparing the predicted book ratings for a given user with the actual rating in a test set that the model was not trained on.</p>
<p>The only fields that were used for the model were the “user ID”, “book ID”, and “rating”. There were others available in the dataset, such as “age”, “location”, “publisher”, “year published”, etc, however for these types of recommendation systems it has often been found that additional data fields do not increase the accuracy of the models significantly[1]. A “Grid Search Cross Validation” method was used to optimize some of the hyperparameters for the model, resulting in a slight improvement in model performance from the default values.</p>
<p>Finally, we were able to build a recommender that could predict the 10 most likely book titles to be rated highly by a given user.</p>
<p>It should be noted that this approach still suffers from the “cold start problem”[3] - that is, for users with no ratings or history the model will not make accurate predictions. One way we could tackle this problem may be to initially start with popularity-based recommendations, before building up enough user history to implement the model. Another piece of data that was not utilised in the current investigation was the “implicit” ratings - denoted as those with a rating of “0” in the dataset. Although more information about these implicit ratings (for example, does it represent a positive or negative interaction), these might be useful for supplementing the “explicit” ratings recommender.</p>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p><a class="reference external" href="http://blog.ethanrosenthal.com/2015/11/02/intro-to-collaborative-filtering/">http://blog.ethanrosenthal.com/2015/11/02/intro-to-collaborative-filtering/</a></p></li>
<li><p><a class="reference external" href="https://cambridgespark.com/content/tutorials/implementing-your-own-recommender-systems-in-Python/index.html">https://cambridgespark.com/content/tutorials/implementing-your-own-recommender-systems-in-Python/index.html</a></p></li>
<li><p><a class="reference external" href="https://towardsdatascience.com/building-a-recommendation-system-for-fragrance-5b00de3829da">https://towardsdatascience.com/building-a-recommendation-system-for-fragrance-5b00de3829da</a></p></li>
</ol>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./nbs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="T990000_ads_selection_using_bandits.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">Best Ads detection using bandit methods</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="T990000_book_recommender_kubeflow.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">Books recommendations with Kubeflow Pipelines on Scaleway Kapsule</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Sparsh A.<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>