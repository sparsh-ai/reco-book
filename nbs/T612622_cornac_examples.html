
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cornac Examples &#8212; Reco Book</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Flower classification" href="T561435_Flower_Classification.html" />
    <link rel="prev" title="The importance of Rating Normalization" href="T935440_The_importance_of_Rating_Normalization.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Reco Book</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../index.html">
   Tutorials in Jupyter notebook format
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  User Stories
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="US780867_Transformer_based_Recommenders.html">
   Transformer-based Recommenders
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="T034923_BERT4Rec_on_ML1M_in_PyTorch.html">
     BERT4Rec on ML-1M in PyTorch
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T595874_BERT4Rec_on_ML25M_in_PyTorch_Lightning.html">
     BERT4Rec on ML-25M
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T088416_BST_Implementation_in_MXNet.html">
     BST Implementation in MXNet
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T602245_BST_implementation_in_PyTorch.html">
     BST implementation in PyTorch
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T007665_BST_on_ML1M_in_Keras.html">
     A Transformer-based recommendation system
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T881207_BST_PTLightning_ML1M.html">
     Rating prediction using the Behavior Sequence Transformer (BST) model on ML-1M dataset in PyTorch Lightning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T757997_SASRec_PyTorch.html">
     SASRec implementation with PyTorch Library
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T225287_SASRec_PaddlePaddle.html">
     SASRec implementation with Paddle Library
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T701627_SR_SAN_Session_based_Model.html">
     SR-SAN Session-based Recommender
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T975104_SSEPT_ML1M_Tensorflow1x.html">
     SSE-PT Personalized Transformer Recommender on ML-1M in Tensorflow 1.x
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Prototypes
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="T382881_DeepWalk_Karateclub.html">
   DeepWalk from scratch referencing Karateclub library
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T384270_DeepWalk_pure_python.html">
   DeepWalk in pure python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T677598_Jaccard_Cosine_SVD_DeepWalk_ML100K.html">
   Recommender System with DeepWalk Graph Embeddings
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T815556_Node2vec_Karateclub.html">
   Node2vec from scratch referencing Karateclub library
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T894941_Node2vec_MovieLens_Keras.html">
   Graph representation learning with node2vec
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T611050_Node2vec_PyG.html">
   Node2vec from scratch in PyTorch Geometric
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T186367_Node2vec_library.html">
   Node2vec from scratch referencing node2vec library
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T331379_bayesian_personalized_ranking.html">
   BPR from scratch
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T081831_Data_Poisoning_Attacks_on_Factorization_Based_Collaborative_Filtering.html">
   Data Poisoning Attacks on Factorization-Based Collaborative Filtering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T102448_Adversarial_Learning_for_Recommendation.html">
   Adversarial Training (Regularization) on a Recommender System
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T865035_Simulating_Data_Poisoning_Attacks_against_Twitter_Recommender.html">
   Load and process dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T711285_Data_Poisoning_Attack_using_LFM_and_ItemAE_on_Synthetic_Dataset.html">
   Injection attack using LFM and ItemAE model trained on Toy dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T355514_Black_box_Attack_on_Sequential_Recs.html">
   Black-box Attack on Sequential Recs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T873451_Statistics_fundamentals.html">
   Statictics Fundamentals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T890478_Batch_Learning_from_Bandit_Feedback_%28BLBF%29.html">
   Imports
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T257798_Off_Policy_Learning_in_Two_stage_Recommender_Systems.html">
   Off-Policy Learning in Two-stage Recommender Systems
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T471827_Adaptive_Estimator_Selection_for_Off_Policy_Evaluation.html">
   Adaptive Estimator Selection for Off-Policy Evaluation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T902666_Evaluating_the_Robustness_of_Off_Policy_Evaluation.html">
   Evaluating the Robustness of Off-Policy Evaluation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T705904_Evaluation_of_Multiple_Off_Policy_Estimators_on_Synthetic_Dataset.html">
   Evaluation of Multiple Off-Policy Estimators on Synthetic Dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T874693_Evaluating_Standard_Off_Policy_Estimators_with_Small_Sample_Open_Bandit_Dataset.html">
   Evaluating Standard Off-Policy Estimators with Small Sample Open-Bandit Dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T792262_Optimal_Off_Policy_Evaluation_from_Multiple_Logging_Policies.html">
   Optimal Off-Policy Evaluation from Multiple Logging Policies
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T167249_Offline_Policy_Evaluation_with_VW_Command_Line.html">
   Offline Policy Evaluation with VW Command Line
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T966055_OBP_Library_Workshop_Tutorials.html">
   OBP Library Workshop Tutorials
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T632722_PyTorch_Fundamentals_Part_1.html">
   PyTorch Fundamentals Part 1
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T472467_PyTorch_Fundamentals_Part_2.html">
   PyTorch Fundamentals Part 2
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T206654_PyTorch_Fundamentals_Part_3.html">
   PyTorch Fundamentals Part 3
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T536348_Attention_Mechanisms.html">
   Imports
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T500796_Agricultural_Satellite_Image_Segmentation.html">
   Agricultural Satellite Image Segmentation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T611432_Image_Analysis_with_Tensorflow.html">
   Image Analysis with Tensorflow
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T925716_MongoDB_to_CSV_Conversion.html">
   MongoDB to CSV conversion
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T396469_PDF_to_Word_Cloud_via_Email.html">
   PDF to WordCloud via Email
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T030890_Job_Scraping_and_Clustering.html">
   Job scraping and clustering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T897054_Scene_Text_Recognition.html">
   Scene Text Recognition
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T034809_Large_scale_Document_Retrieval_with_Elastic_Search.html">
   Large-scale Document Retrieval with ElasticSearch
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T467251_vowpal_wabbit_contextual_recommender.html">
   Simulating a news personalization scenario using Contextual Bandits
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T686684_similar_product_recommender.html">
   Similar Product Recommender system using Deep Learning for an online e-commerce store
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T132203_Retail_Product_Recommendations_using_Word2vec.html">
   Retail Product Recommendations using word2vec
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T501828_Recommender_Implicit_Negative_Feedback.html">
   Retail Product Recommendation with Negative Implicit Feedback
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T315965_Sequence_Aware_Recommenders_Music.html">
   Sequence Aware Recommender Systems
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T051777_image_similarity_recommendations.html">
   Similar Product Recommendations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990172_recobook_diversity_aware_book_recommender.html">
   Diversity Aware Book Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T488549_Goodreads_Diversity_Aware_Book_Recommender.html">
   Diversity Aware Book Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T023535_Kafka_MongoDB_Real_time_Streaming.html">
   Kafka MongoDB Real-time Streaming
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T622304_Session_based_Recommender_Using_Word2vec.html">
   Session-based recommendation using word2vec
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T416854_bandit_based_recommender_using_thompson_sampling_app.html">
   Bandit-based Online Learning using Thompson Sampling
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T198578_Booking_dot_com_Trip_Recommendation.html">
   Booking.com Trip Recommendation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T519734_Vowpal_Wabbit_Contextual_Bandit.html">
   Vowpal Wabbit Contextual Bandit
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T871537_Recommendation_Systems_using_Olist_Dataset.html">
   Recommendation systems using Olist dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T057885_Offline_Replayer_Evaluation.html">
   Offline Replayer Evaluation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T915054_method_for_effective_online_testing.html">
   Methods for effective online testing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T513987_Recsys_2020_Feature_Engineering_Tutorial.html">
   Recsys’20 Feature Engineering Tutorial
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T227901_amazon_personalize_batch_job.html">
   Amazon Personalize Batch Job
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T022961_Amazon_Personalize_Workshop.html">
   Amazon Personalize Workshop
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T424437_Collaborative_Filtering_on_ML_latest_small.html">
   Collaborative Filtering on ML-latest-small
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T539160_Building_and_Deploying_ASOS_Fashion_Recommender.html">
   Building and deploying ASOS fashion recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T757697_Simple_Similarity_based_Recommender.html">
   Simple Similarity based Recommmendations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T051594_Analytics_Zoo.html">
   Analytics Zoo
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T313645_A_B_Testing.html">
   A/B Testing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T475711_PinSage_Graph_based_Recommender.html">
   PinSage Graph-based Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T516490_Graph_Embeddings.html">
   Learn Embeddings using Graph Networks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T822164_movielens_milvus_redis_efficient_retrieval.html">
   Recommender with Redis and Milvus
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T845186_Anime_Recommender.html">
   RekoNet Anime Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T855843_kafka_spark_streaming_colab.html">
   Kafka and Spark Streaming in Colab
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T460437_Building_Models_From_Scratch.html">
   Building Models from scratch
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T855971_Conet_Model_for_Movie_Recommender.html">
   CoNet model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T996996_content_based_and_collaborative_movielens.html">
   Movie Recommendation with Content-Based and Collaborative Filtering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T239418_Simple_Movie_Recommenders.html">
   Simple Movie Recommenders
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T138337_Simple_Movie_Recommender.html">
   Simple movie recommender in implicit, explicit, and cold-start settings
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T935440_The_importance_of_Rating_Normalization.html">
   The importance of Rating Normalization
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Cornac Examples
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T561435_Flower_Classification.html">
   Flower classification
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T680910_Trivago_Session_based_Recommender.html">
   Trivago Session-based Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_ads_selection_using_bandits.html">
   Best Ads detection using bandit methods
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_book_crossing_surprise_svd_nmf.html">
   Book-Crossing Recommendation System
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_book_recommender_kubeflow.html">
   Books recommendations with Kubeflow Pipelines on Scaleway Kapsule
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_build_a_kubeflow_pipeline.html">
   Build a Kubeflow Pipeline
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_causal_inference.html">
   Causal Inference
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_concept_embedding_nlp.html">
   Exploring Word Embeddings
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_concept_neural_net.html">
   Neural Network
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_concept_nlp_basics.html">
   Natural Language Processing 101
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_concept_transformer_lm.html">
   TransformerLM Quick Start and Guide
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_content_based_music_recommender_lyricsfreak.html">
   Content-based method for song recommendation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_evaluation_metrics_basics.html">
   Recommender System Evaluations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_implicit_synthetic.html">
   Comparing Implicit Models on Synthetic Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_movie_recommender_tensorflow.html">
   Recommendation Systems with TensorFlow
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_movie_recommender_tensorflow_sagemaker.html">
   Movie recommender using Tensorflow in Sagemaker
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_movielens_eda_modeling.html">
   Movielens EDA and Modeling
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_read_data_from_cassandra_into_pandas.html">
   Read Cassandra Data Snapshot as DataFrame
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_rl_in_action.html">
   Reinforcement Learning fundamentals in action
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_rnn_cnn_basics.html">
   Processing sequences using RNNs and CNNs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_tf_serving_in_action.html">
   TF Serving in action
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_training_indexing_movie_recommender.html">
   Training and indexing movie recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T207114_EduRec_MOOCCube_Course_Recommender.html">
   EduRec MOOCCube Course Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T273184_Multi_Task_Learning.html">
   Multi-task Learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T661108_Book_Recommender_API.html">
   Book Recommender API
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T912764_Simple_Movie_Recommender_App.html">
   Simple Movie Recommender App
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T964554_Career_Village_Questions_Recommendation.html">
   CareerVillage Questions Recommendation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_amazon_women_apparel_tfidf_word2vec.html">
   Amazon Product Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_anime_recommender_graph_network.html">
   Anime Recommender with Bi-partite Graph Network
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_concept_self_attention.html">
   Self-Attention
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_course_recommender_svd_flask.html">
   Course Recommender with SVD based similarity
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_data_mining_similarity_measures.html">
   Concept - Data Mining Similarity Measures
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_jaccard_recommender.html">
   Jaccard Similarity based Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_live_streamer_recommender.html">
   Live Streamer Recommender with Implicit feedback
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_songs_embedding_skipgram_recommender.html">
   Song Embeddings - Skipgram Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_toy_example_car_recommender_knn.html">
   Toy example - Car Recommender using KNN method
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_wikirecs_recommender.html">
   WikiRecs
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/nbs/T612622_cornac_examples.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/sparsh-ai/reco-book/main?urlpath=tree/nbs/T612622_cornac_examples.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#eda">
   EDA
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#recomendations-based-on-item-popularity">
   Recomendations based on item popularity
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#user-based-collaborative-filtering">
   User-based collaborative filtering
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#item-based-collaborative-filtering">
   Item-based collaborative filtering
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#matrix-factorization">
   Matrix factorization
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#implicit-matrix-factorization">
   Implicit matrix factorization
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#neural-collaborative-filtering">
   Neural Collaborative Filtering
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#variational-autoencoder-for-collaborative-filtering-vaecf">
   Variational Autoencoder for Collaborative Filtering (VAECF)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#running-experiment">
   Running Experiment
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pmf-ratio">
   PMF ratio
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#given-data">
   Given data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#c2pf">
   C2PF
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#hyperparameters">
   Hyperparameters
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#social-bpr">
   Social BPR
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="cornac-examples">
<h1>Cornac Examples<a class="headerlink" href="#cornac-examples" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div><p>Multiple examples showcasing the features of cornac library and recommender concepts</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!pip install -q -U cornac
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cornac</span>
<span class="n">cornac</span><span class="o">.</span><span class="n">__version__</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;1.4.1&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span><span class="p">,</span> <span class="n">sparse</span>

<span class="kn">from</span> <span class="nn">cornac.data</span> <span class="kn">import</span> <span class="n">Reader</span>
<span class="kn">from</span> <span class="nn">cornac.datasets</span> <span class="kn">import</span> <span class="n">movielens</span>
<span class="kn">from</span> <span class="nn">cornac.eval_methods</span> <span class="kn">import</span> <span class="n">RatioSplit</span>
<span class="kn">from</span> <span class="nn">cornac.models</span> <span class="kn">import</span> <span class="n">UserKNN</span><span class="p">,</span> <span class="n">ItemKNN</span>
<span class="kn">from</span> <span class="nn">cornac.models</span> <span class="kn">import</span> <span class="n">MF</span><span class="p">,</span> <span class="n">NMF</span><span class="p">,</span> <span class="n">BaselineOnly</span>
<span class="kn">from</span> <span class="nn">cornac.models</span> <span class="kn">import</span> <span class="n">BPR</span><span class="p">,</span> <span class="n">WMF</span>
<span class="kn">from</span> <span class="nn">cornac.models</span> <span class="kn">import</span> <span class="n">GMF</span><span class="p">,</span> <span class="n">MLP</span><span class="p">,</span> <span class="n">NeuMF</span><span class="p">,</span> <span class="n">VAECF</span><span class="p">,</span> <span class="n">WMF</span>

<span class="o">%</span><span class="n">tensorflow_version</span> <span class="mf">1.</span><span class="n">x</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="eda">
<h2>EDA<a class="headerlink" href="#eda" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_100k3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./data/ml-100k/ratings.csv&#39;</span><span class="p">,</span>
                 <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;UserId&quot;</span><span class="p">,</span><span class="s2">&quot;MovieId&quot;</span><span class="p">,</span><span class="s2">&quot;Rating&quot;</span><span class="p">])</span>
<span class="n">df_100k3</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">,</span> <span class="s2">&quot;item_id&quot;</span><span class="p">,</span> <span class="s2">&quot;rating&quot;</span><span class="p">]</span>
<span class="n">df_100k3</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>user_id</th>
      <th>item_id</th>
      <th>rating</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>196</td>
      <td>242</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>186</td>
      <td>302</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>22</td>
      <td>377</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>244</td>
      <td>51</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>166</td>
      <td>346</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_user_100k</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./data/ml-100k/users.csv&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;UserID&quot;</span><span class="p">)</span>
<span class="n">df_user_100k</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Age</th>
      <th>Gender</th>
      <th>Occupation</th>
      <th>Zip Code</th>
    </tr>
    <tr>
      <th>UserID</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>24</td>
      <td>M</td>
      <td>technician</td>
      <td>85711</td>
    </tr>
    <tr>
      <th>2</th>
      <td>53</td>
      <td>F</td>
      <td>other</td>
      <td>94043</td>
    </tr>
    <tr>
      <th>3</th>
      <td>23</td>
      <td>M</td>
      <td>writer</td>
      <td>32067</td>
    </tr>
    <tr>
      <th>4</th>
      <td>24</td>
      <td>M</td>
      <td>technician</td>
      <td>43537</td>
    </tr>
    <tr>
      <th>5</th>
      <td>33</td>
      <td>F</td>
      <td>other</td>
      <td>15213</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df_item_100k</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./data/ml-100k/items.csv&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;ItemID&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Video Release Date&quot;</span><span class="p">,</span> <span class="s2">&quot;IMDb URL&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">])</span>
<span class="n">df_item_100k</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Title</th>
      <th>Release Date</th>
      <th>Action</th>
      <th>Adventure</th>
      <th>Animation</th>
      <th>Children's</th>
      <th>Comedy</th>
      <th>Crime</th>
      <th>Documentary</th>
      <th>Drama</th>
      <th>Fantasy</th>
      <th>Film-Noir</th>
      <th>Horror</th>
      <th>Musical</th>
      <th>Mystery</th>
      <th>Romance</th>
      <th>Sci-Fi</th>
      <th>Thriller</th>
      <th>War</th>
      <th>Western</th>
    </tr>
    <tr>
      <th>ItemID</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>Toy Story (1995)</td>
      <td>01-Jan-1995</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>GoldenEye (1995)</td>
      <td>01-Jan-1995</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Four Rooms (1995)</td>
      <td>01-Jan-1995</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Get Shorty (1995)</td>
      <td>01-Jan-1995</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Copycat (1995)</td>
      <td>01-Jan-1995</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Rating distribution</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;rating&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;ch:.25&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;rating&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;ch:.25&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7fe392c6e8d0&gt;
</pre></div>
</div>
<img alt="../_images/T612622_cornac_examples_9_1.png" src="../_images/T612622_cornac_examples_9_1.png" />
</div>
</div>
<p>Sparsity</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">print_sparsity</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
  <span class="n">n_users</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">user_id</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
  <span class="n">n_items</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">item_id</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
  <span class="n">n_ratings</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
  <span class="n">rating_matrix_size</span> <span class="o">=</span> <span class="n">n_users</span> <span class="o">*</span> <span class="n">n_items</span>
  <span class="n">sparsity</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">n_ratings</span> <span class="o">/</span> <span class="n">rating_matrix_size</span>

  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of users: </span><span class="si">{</span><span class="n">n_users</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of items: </span><span class="si">{</span><span class="n">n_items</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of available ratings: </span><span class="si">{</span><span class="n">n_ratings</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of all possible ratings: </span><span class="si">{</span><span class="n">rating_matrix_size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">40</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SPARSITY: </span><span class="si">{</span><span class="n">sparsity</span> <span class="o">*</span> <span class="mf">100.0</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

<span class="n">print_sparsity</span><span class="p">(</span><span class="n">df_100k3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of users: 943
Number of items: 1682
Number of available ratings: 100000
Number of all possible ratings: 1586126
----------------------------------------
SPARSITY: 93.70%
</pre></div>
</div>
</div>
</div>
<p>For this MovieLens dataset, the data has been prepared in such a way that each user has at least 20 ratings. As a result, it’s relatively dense as compared to many other recommendation datasets that are usually much sparser (often 99% or more).</p>
<p>Power Law Distribution</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">item_rate_count</span> <span class="o">=</span> <span class="n">df_100k3</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;item_id&quot;</span><span class="p">)[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">item_rate_count</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">item_rate_count</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s2">&quot;edge&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;long tail of rating frequency&quot;</span><span class="p">,</span> 
            <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;item ordered by decreasing frequency&quot;</span><span class="p">,</span> 
            <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;#ratings&quot;</span><span class="p">)</span>

<span class="n">count</span> <span class="o">=</span> <span class="n">item_rate_count</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">count</span><span class="o">.</span><span class="n">index</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">count</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;log-log plot&quot;</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;#ratings (log scale)&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;#items (log scale)&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/T612622_cornac_examples_15_0.png" src="../_images/T612622_cornac_examples_15_0.png" />
</div>
</div>
<p>User profiling</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span> <span class="o">=</span> <span class="n">cornac</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_uir</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">itertuples</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
<span class="n">uknn_pearson</span> <span class="o">=</span> <span class="n">UserKNN</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">similarity</span><span class="o">=</span><span class="s2">&quot;pearson&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;UserKNN-Pearson&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>

<span class="n">uknn_pearson</span><span class="o">.</span><span class="n">train_set</span><span class="o">.</span><span class="n">uid_map</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>118
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">user_profiling</span><span class="p">(</span><span class="n">UID</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">user_df</span><span class="p">,</span> <span class="n">item_df</span><span class="p">,</span> <span class="n">TOPK</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
  <span class="n">dataset</span> <span class="o">=</span> <span class="n">cornac</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_uir</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">itertuples</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
  <span class="n">uknn_pearson</span> <span class="o">=</span> <span class="n">UserKNN</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">similarity</span><span class="o">=</span><span class="s2">&quot;pearson&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;UserKNN-Pearson&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>

  <span class="n">rating_mat</span> <span class="o">=</span> <span class="n">uknn_pearson</span><span class="o">.</span><span class="n">train_set</span><span class="o">.</span><span class="n">matrix</span>
  <span class="n">user_id2idx</span> <span class="o">=</span> <span class="n">uknn_pearson</span><span class="o">.</span><span class="n">train_set</span><span class="o">.</span><span class="n">uid_map</span>
  <span class="n">user_idx2id</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">uknn_pearson</span><span class="o">.</span><span class="n">train_set</span><span class="o">.</span><span class="n">user_ids</span><span class="p">)</span>
  <span class="n">item_id2idx</span> <span class="o">=</span> <span class="n">uknn_pearson</span><span class="o">.</span><span class="n">train_set</span><span class="o">.</span><span class="n">iid_map</span>
  <span class="n">item_idx2id</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">uknn_pearson</span><span class="o">.</span><span class="n">train_set</span><span class="o">.</span><span class="n">item_ids</span><span class="p">)</span>

  <span class="n">UIDX</span> <span class="o">=</span> <span class="n">uknn_pearson</span><span class="o">.</span><span class="n">train_set</span><span class="o">.</span><span class="n">uid_map</span><span class="p">[</span><span class="n">UID</span><span class="p">]</span>

  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;UserID = </span><span class="si">{</span><span class="n">UID</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">25</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">user_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">UID</span><span class="p">])</span>

  <span class="n">rating_arr</span> <span class="o">=</span> <span class="n">rating_mat</span><span class="p">[</span><span class="n">UIDX</span><span class="p">]</span><span class="o">.</span><span class="n">A</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
  <span class="n">top_rated_items</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">rating_arr</span><span class="p">)[</span><span class="o">-</span><span class="n">TOPK</span><span class="p">:]</span>
  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">TOP </span><span class="si">{</span><span class="n">TOPK</span><span class="si">}</span><span class="s2"> RATED ITEMS BY USER </span><span class="si">{</span><span class="n">UID</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">item_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="nb">int</span><span class="p">(</span><span class="n">item_idx2id</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">top_rated_items</span><span class="p">]])</span>

<span class="n">user_profiling</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">df_100k3</span><span class="p">,</span> <span class="n">df_user_100k</span><span class="p">,</span> <span class="n">df_item_100k</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>UserID = 2
-------------------------
Age              53
Gender            F
Occupation    other
Zip Code      94043
Name: 2, dtype: object

TOP 5 RATED ITEMS BY USER 2:
                                Title Release Date  ...  War  Western
ItemID                                              ...              
50                   Star Wars (1977)  01-Jan-1977  ...    1        0
251            Shall We Dance? (1996)  11-Jul-1997  ...    0        0
272          Good Will Hunting (1997)  01-Jan-1997  ...    0        0
311     Wings of the Dove, The (1997)  01-Jan-1997  ...    0        0
242                      Kolya (1996)  24-Jan-1997  ...    0        0

[5 rows x 20 columns]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="recomendations-based-on-item-popularity">
<h2>Recomendations based on item popularity<a class="headerlink" href="#recomendations-based-on-item-popularity" title="Permalink to this headline">¶</a></h2>
<p>Since some items are much more popular than the rest, intuitively many users may prefer these popular items. From that observation, it inspires a simple approach for providing recommendations based on popularity (i.e., number of ratings) of the items.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;Let&#39;s do a simple experiment with the popularity approach. In this </span>
<span class="sd">experiment, we will split the rating data into 5 folds for cross-validation. </span>
<span class="sd">For each run, 4 folds will be used for training and the remaining fold will </span>
<span class="sd">be used for evaluation. We measure the recommendation performance using </span>
<span class="sd">Recall@20 metric.&#39;&#39;&#39;</span>

<span class="k">def</span> <span class="nf">itempop_cornac</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
  <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">astype</span><span class="p">({</span><span class="s1">&#39;user_id&#39;</span><span class="p">:</span><span class="nb">object</span><span class="p">,</span> <span class="s1">&#39;item_id&#39;</span><span class="p">:</span><span class="nb">object</span><span class="p">})</span>
  <span class="n">records</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_records</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
  <span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">records</span><span class="p">)</span>
  <span class="n">eval_method</span> <span class="o">=</span> <span class="n">cornac</span><span class="o">.</span><span class="n">eval_methods</span><span class="o">.</span><span class="n">CrossValidation</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">n_folds</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span> <span class="c1"># 5-fold cross validation</span>
  <span class="n">most_pop</span> <span class="o">=</span> <span class="n">cornac</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">MostPop</span><span class="p">()</span> <span class="c1"># recommender system based on item popularity</span>
  <span class="n">rec_20</span> <span class="o">=</span> <span class="n">cornac</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">Recall</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span> <span class="c1"># recall@20 metric</span>
  <span class="n">cornac</span><span class="o">.</span><span class="n">Experiment</span><span class="p">(</span><span class="n">eval_method</span><span class="o">=</span><span class="n">eval_method</span><span class="p">,</span> <span class="n">models</span><span class="o">=</span><span class="p">[</span><span class="n">most_pop</span><span class="p">],</span> <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="n">rec_20</span><span class="p">])</span><span class="o">.</span><span class="n">run</span><span class="p">()</span> <span class="c1"># put everything together into an experiment</span>

<span class="n">itempop_cornac</span><span class="p">(</span><span class="n">df_100k3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>TEST:
...
[MostPop]
       | Recall@20 | Train (s) | Test (s)
------ + --------- + --------- + --------
Fold 0 |    0.1263 |    0.0054 |   0.4017
Fold 1 |    0.1304 |    0.0053 |   0.3883
Fold 2 |    0.1337 |    0.0055 |   0.4014
Fold 3 |    0.1252 |    0.0058 |   0.4019
Fold 4 |    0.1187 |    0.0054 |   0.4046
------ + --------- + --------- + --------
Mean   |    0.1269 |    0.0055 |   0.3996
Std    |    0.0051 |    0.0002 |   0.0058
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="user-based-collaborative-filtering">
<h2>User-based collaborative filtering<a class="headerlink" href="#user-based-collaborative-filtering" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">userknn_cornac</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
  <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">astype</span><span class="p">({</span><span class="s1">&#39;user_id&#39;</span><span class="p">:</span><span class="nb">object</span><span class="p">,</span> <span class="s1">&#39;item_id&#39;</span><span class="p">:</span><span class="nb">object</span><span class="p">})</span>
  <span class="n">records</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_records</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
  <span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">records</span><span class="p">)</span>
  <span class="n">K</span> <span class="o">=</span> <span class="mi">50</span>  <span class="c1"># number of nearest neighbors</span>
  <span class="n">VERBOSE</span> <span class="o">=</span> <span class="kc">False</span>
  <span class="n">SEED</span> <span class="o">=</span> <span class="mi">42</span>
  <span class="n">uknn_cosine</span> <span class="o">=</span> <span class="n">UserKNN</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">similarity</span><span class="o">=</span><span class="s2">&quot;cosine&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;UserKNN-Cosine&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">)</span>
  <span class="n">uknn_cosine_mc</span> <span class="o">=</span> <span class="n">UserKNN</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">similarity</span><span class="o">=</span><span class="s2">&quot;cosine&quot;</span><span class="p">,</span> <span class="n">mean_centered</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;UserKNN-Cosine-MC&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">)</span>
  <span class="n">uknn_pearson</span> <span class="o">=</span> <span class="n">UserKNN</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">similarity</span><span class="o">=</span><span class="s2">&quot;pearson&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;UserKNN-Pearson&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">)</span>
  <span class="n">uknn_pearson_mc</span> <span class="o">=</span> <span class="n">UserKNN</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">similarity</span><span class="o">=</span><span class="s2">&quot;pearson&quot;</span><span class="p">,</span> <span class="n">mean_centered</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;UserKNN-Pearson-MC&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">)</span>
  <span class="n">ratio_split</span> <span class="o">=</span> <span class="n">RatioSplit</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">SEED</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">)</span>
  <span class="n">cornac</span><span class="o">.</span><span class="n">Experiment</span><span class="p">(</span><span class="n">eval_method</span><span class="o">=</span><span class="n">ratio_split</span><span class="p">,</span>
                    <span class="n">models</span><span class="o">=</span><span class="p">[</span><span class="n">uknn_cosine</span><span class="p">,</span> <span class="n">uknn_cosine_mc</span><span class="p">,</span> <span class="n">uknn_pearson</span><span class="p">,</span> <span class="n">uknn_pearson_mc</span><span class="p">],</span>
                    <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="n">cornac</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">RMSE</span><span class="p">()],</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

<span class="n">userknn_cornac</span><span class="p">(</span><span class="n">df_100k3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>TEST:
...
                   |   RMSE | Train (s) | Test (s)
------------------ + ------ + --------- + --------
UserKNN-Cosine     | 0.9102 |    0.1444 |   1.3036
UserKNN-Cosine-MC  | 0.8947 |    0.1369 |   1.2839
UserKNN-Pearson    | 0.8947 |    0.1458 |   1.2950
UserKNN-Pearson-MC | 0.8947 |    0.1360 |   1.2894
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="item-based-collaborative-filtering">
<h2>Item-based collaborative filtering<a class="headerlink" href="#item-based-collaborative-filtering" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">itemknn_cornac</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
  <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">astype</span><span class="p">({</span><span class="s1">&#39;user_id&#39;</span><span class="p">:</span><span class="nb">object</span><span class="p">,</span> <span class="s1">&#39;item_id&#39;</span><span class="p">:</span><span class="nb">object</span><span class="p">})</span>
  <span class="n">records</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_records</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
  <span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">records</span><span class="p">)</span>
  <span class="n">K</span> <span class="o">=</span> <span class="mi">50</span>  <span class="c1"># number of nearest neighbors</span>
  <span class="n">VERBOSE</span> <span class="o">=</span> <span class="kc">False</span>
  <span class="n">SEED</span> <span class="o">=</span> <span class="mi">42</span>
  <span class="n">iknn_cosine</span> <span class="o">=</span> <span class="n">ItemKNN</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">similarity</span><span class="o">=</span><span class="s2">&quot;cosine&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;ItemKNN-Cosine&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">)</span>
  <span class="n">iknn_cosine_mc</span> <span class="o">=</span> <span class="n">ItemKNN</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">similarity</span><span class="o">=</span><span class="s2">&quot;cosine&quot;</span><span class="p">,</span> <span class="n">mean_centered</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;ItemKNN-AdjustedCosine&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">)</span>
  <span class="n">iknn_pearson</span> <span class="o">=</span> <span class="n">ItemKNN</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">similarity</span><span class="o">=</span><span class="s2">&quot;pearson&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;ItemKNN-Pearson&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">)</span>
  <span class="n">iknn_pearson_mc</span> <span class="o">=</span> <span class="n">ItemKNN</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">similarity</span><span class="o">=</span><span class="s2">&quot;pearson&quot;</span><span class="p">,</span> <span class="n">mean_centered</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;ItemKNN-Pearson-MC&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">)</span>
  <span class="n">ratio_split</span> <span class="o">=</span> <span class="n">RatioSplit</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">SEED</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">)</span>
  <span class="n">cornac</span><span class="o">.</span><span class="n">Experiment</span><span class="p">(</span><span class="n">eval_method</span><span class="o">=</span><span class="n">ratio_split</span><span class="p">,</span>
                    <span class="n">models</span><span class="o">=</span><span class="p">[</span><span class="n">iknn_cosine</span><span class="p">,</span> <span class="n">iknn_cosine_mc</span><span class="p">,</span> <span class="n">iknn_pearson</span><span class="p">,</span> <span class="n">iknn_pearson_mc</span><span class="p">],</span>
                    <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="n">cornac</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">RMSE</span><span class="p">()],</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

<span class="n">itemknn_cornac</span><span class="p">(</span><span class="n">df_100k3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>TEST:
...
                       |   RMSE | Train (s) | Test (s)
---------------------- + ------ + --------- + --------
ItemKNN-Cosine         | 0.9687 |    0.2175 |   1.3857
ItemKNN-AdjustedCosine | 0.9099 |    0.2107 |   1.4040
ItemKNN-Pearson        | 0.9624 |    0.2462 |   1.3763
ItemKNN-Pearson-MC     | 0.9573 |    0.2374 |   1.3883
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="matrix-factorization">
<h2>Matrix factorization<a class="headerlink" href="#matrix-factorization" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">mf_cornac</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
  <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">astype</span><span class="p">({</span><span class="s1">&#39;user_id&#39;</span><span class="p">:</span><span class="nb">object</span><span class="p">,</span> <span class="s1">&#39;item_id&#39;</span><span class="p">:</span><span class="nb">object</span><span class="p">})</span>
  <span class="n">records</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_records</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
  <span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">records</span><span class="p">)</span>
  <span class="n">K</span> <span class="o">=</span> <span class="mi">100</span>
  <span class="n">VERBOSE</span> <span class="o">=</span> <span class="kc">False</span>
  <span class="n">SEED</span> <span class="o">=</span> <span class="mi">42</span>
  <span class="n">lbd</span> <span class="o">=</span> <span class="mf">0.01</span>
  <span class="n">baseline</span> <span class="o">=</span> <span class="n">BaselineOnly</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">lambda_reg</span><span class="o">=</span><span class="n">lbd</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">)</span>
  <span class="n">mf1</span> <span class="o">=</span> <span class="n">MF</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">lambda_reg</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">use_bias</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">SEED</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;MF(K=</span><span class="si">{</span><span class="n">K</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
  <span class="n">mf2</span> <span class="o">=</span> <span class="n">MF</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">lambda_reg</span><span class="o">=</span><span class="n">lbd</span><span class="p">,</span> <span class="n">use_bias</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">SEED</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;MF(K=</span><span class="si">{</span><span class="n">K</span><span class="si">}</span><span class="s2">,lambda=</span><span class="si">{</span><span class="n">lbd</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
  <span class="n">mf3</span> <span class="o">=</span> <span class="n">MF</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">lambda_reg</span><span class="o">=</span><span class="n">lbd</span><span class="p">,</span> <span class="n">use_bias</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">SEED</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;MF(K=</span><span class="si">{</span><span class="n">K</span><span class="si">}</span><span class="s2">,bias)&quot;</span><span class="p">)</span>
  <span class="n">nmf</span> <span class="o">=</span> <span class="n">NMF</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">use_bias</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">SEED</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;NMF(K=</span><span class="si">{</span><span class="n">K</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
  <span class="n">ratio_split</span> <span class="o">=</span> <span class="n">RatioSplit</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">SEED</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">)</span>
  <span class="n">cornac</span><span class="o">.</span><span class="n">Experiment</span><span class="p">(</span><span class="n">eval_method</span><span class="o">=</span><span class="n">ratio_split</span><span class="p">,</span>
                    <span class="n">models</span><span class="o">=</span><span class="p">[</span><span class="n">baseline</span><span class="p">,</span> <span class="n">mf1</span><span class="p">,</span> <span class="n">mf2</span><span class="p">,</span> <span class="n">mf3</span><span class="p">,</span> <span class="n">nmf</span><span class="p">],</span>
                    <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="n">cornac</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">RMSE</span><span class="p">()],</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

<span class="n">mf_cornac</span><span class="p">(</span><span class="n">df_100k3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>TEST:
...
                        |   RMSE | Train (s) | Test (s)
----------------------- + ------ + --------- + --------
BaselineOnly            | 0.8892 |    0.0113 |   0.2159
MF(K=100)               | 0.8665 |    0.5043 |   0.2463
MF(K=100,lambda=0.0100) | 0.8647 |    0.5154 |   0.2466
MF(K=100,bias)          | 0.8614 |    0.5224 |   0.2324
NMF(K=100)              | 0.8807 |    8.7957 |   0.2519
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="implicit-matrix-factorization">
<h2>Implicit matrix factorization<a class="headerlink" href="#implicit-matrix-factorization" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">implicitmf_cornac</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
  <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">astype</span><span class="p">({</span><span class="s1">&#39;user_id&#39;</span><span class="p">:</span><span class="nb">object</span><span class="p">,</span> <span class="s1">&#39;item_id&#39;</span><span class="p">:</span><span class="nb">object</span><span class="p">})</span>
  <span class="n">records</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_records</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
  <span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">records</span><span class="p">)</span>

  <span class="n">K</span> <span class="o">=</span> <span class="mi">50</span>
  <span class="n">VERBOSE</span> <span class="o">=</span> <span class="kc">False</span>
  <span class="n">SEED</span> <span class="o">=</span> <span class="mi">42</span>
  <span class="n">mf</span> <span class="o">=</span> <span class="n">MF</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">lambda_reg</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">SEED</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;MF(K=</span><span class="si">{</span><span class="n">K</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
  <span class="n">wmf</span> <span class="o">=</span> <span class="n">WMF</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">lambda_u</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">lambda_v</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">SEED</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;WMF(K=</span><span class="si">{</span><span class="n">K</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
  <span class="n">bpr</span> <span class="o">=</span> <span class="n">BPR</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">lambda_reg</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">SEED</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;BPR(K=</span><span class="si">{</span><span class="n">K</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

  <span class="n">eval_metrics</span> <span class="o">=</span> <span class="p">[</span>
  <span class="n">cornac</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">RMSE</span><span class="p">(),</span> 
  <span class="n">cornac</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">AUC</span><span class="p">(),</span>
  <span class="n">cornac</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">Precision</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
  <span class="n">cornac</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">Recall</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
  <span class="n">cornac</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">FMeasure</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
  <span class="n">cornac</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">NDCG</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">]),</span>
  <span class="n">cornac</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">MRR</span><span class="p">(),</span>
  <span class="n">cornac</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">MAP</span><span class="p">()</span>
  <span class="p">]</span>

  <span class="n">rs</span> <span class="o">=</span> <span class="n">RatioSplit</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">SEED</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">)</span>

  <span class="n">cornac</span><span class="o">.</span><span class="n">Experiment</span><span class="p">(</span><span class="n">eval_method</span><span class="o">=</span><span class="n">rs</span><span class="p">,</span>
                    <span class="n">models</span><span class="o">=</span><span class="p">[</span><span class="n">mf</span><span class="p">,</span> <span class="n">wmf</span><span class="p">,</span> <span class="n">bpr</span><span class="p">],</span>
                    <span class="n">metrics</span><span class="o">=</span><span class="n">eval_metrics</span><span class="p">,</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

<span class="n">implicitmf_cornac</span><span class="p">(</span><span class="n">df_100k3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>TEST:
...
          |   RMSE |    AUC |  F1@10 |    MAP |    MRR | NDCG@10 | NDCG@20 | NDCG@30 | Precision@10 | Recall@10 | Train (s) | Test (s)
--------- + ------ + ------ + ------ + ------ + ------ + ------- + ------- + ------- + ------------ + --------- + --------- + --------
MF(K=50)  | 0.8909 | 0.6573 | 0.0290 | 0.0402 | 0.1453 |  0.0539 |  0.0565 |  0.0626 |       0.0524 |    0.0241 |    0.2498 |   2.0077
WMF(K=50) | 1.1012 | 0.8980 | 0.0734 | 0.0956 | 0.2387 |  0.1068 |  0.1292 |  0.1506 |       0.0968 |    0.0800 |    6.4536 |   2.1959
BPR(K=50) | 1.5631 | 0.9356 | 0.0859 | 0.1146 | 0.2337 |  0.1096 |  0.1393 |  0.1662 |       0.0938 |    0.1000 |    6.5871 |   1.9878
</pre></div>
</div>
</div>
</div>
<p>As we can observe, the strength of the MF model is the ability to predict ratings well (lower RMSE). However, WMF model is designed to rank items, by fitting binary adoptions, thus it outperforms MF across all the listed ranking metrics.</p>
<p>BPR only tries to preserve the ordinal constraints without learning to predict the rating values. Thus, RMSE is not the right metric to evaluate BPR model. Minimizing the loss function of BPR is analogous to maximizing AUC, therefore, we expect BPR to do well on that metric.</p>
<p>Both BPR and WMF models are designed to obtain good performances in terms of ranking metrics. With reasonable efforts for hyper-parameter tuning, we should see comparable performance between the two models.</p>
</div>
<div class="section" id="neural-collaborative-filtering">
<h2>Neural Collaborative Filtering<a class="headerlink" href="#neural-collaborative-filtering" title="Permalink to this headline">¶</a></h2>
<p>Neural collaborative filtering consists of a family of models developed based on neural networks to tackle the problem of collaborative filtering based on implicit feedback. The final model NeuMF is a combination of two components, namely Generalized Matrix Factorization (GMF) and Multi-Layer Perceptrons (MLP), which are also independent models respectively.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">GMF_FACTORS</span> <span class="o">=</span> <span class="mi">8</span>  <span class="c1"># @param</span>
<span class="n">MLP_LAYERS</span> <span class="o">=</span> <span class="p">[</span><span class="mi">32</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>  <span class="c1"># @param</span>
<span class="n">ACTIVATION</span> <span class="o">=</span> <span class="s2">&quot;tanh&quot;</span>  <span class="c1"># @param [&quot;tanh&quot;, &quot;sigmoid&quot;, &quot;relu&quot;, &quot;leaky_relu&quot;]</span>
<span class="n">NEG_SAMPLES</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># @param</span>
<span class="n">NUM_EPOCHS</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># @param </span>
<span class="n">BATCH_SIZE</span> <span class="o">=</span> <span class="mi">256</span>  <span class="c1"># @param</span>
<span class="n">LEARNING_RATE</span> <span class="o">=</span> <span class="mf">0.001</span>  <span class="c1"># @param</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gmf</span> <span class="o">=</span> <span class="n">GMF</span><span class="p">(</span><span class="n">num_factors</span><span class="o">=</span><span class="n">GMF_FACTORS</span><span class="p">,</span> <span class="n">num_epochs</span><span class="o">=</span><span class="n">NUM_EPOCHS</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">BATCH_SIZE</span><span class="p">,</span> 
          <span class="n">num_neg</span><span class="o">=</span><span class="n">NEG_SAMPLES</span><span class="p">,</span> <span class="n">lr</span><span class="o">=</span><span class="n">LEARNING_RATE</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">SEED</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">)</span>
<span class="n">mlp</span> <span class="o">=</span> <span class="n">MLP</span><span class="p">(</span><span class="n">layers</span><span class="o">=</span><span class="n">MLP_LAYERS</span><span class="p">,</span> <span class="n">act_fn</span><span class="o">=</span><span class="n">ACTIVATION</span><span class="p">,</span> <span class="n">num_epochs</span><span class="o">=</span><span class="n">NUM_EPOCHS</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">BATCH_SIZE</span><span class="p">,</span> 
          <span class="n">num_neg</span><span class="o">=</span><span class="n">NEG_SAMPLES</span><span class="p">,</span> <span class="n">lr</span><span class="o">=</span><span class="n">LEARNING_RATE</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">SEED</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">)</span>
<span class="n">neumf</span> <span class="o">=</span> <span class="n">NeuMF</span><span class="p">(</span><span class="n">num_factors</span><span class="o">=</span><span class="n">GMF_FACTORS</span><span class="p">,</span> <span class="n">layers</span><span class="o">=</span><span class="n">MLP_LAYERS</span><span class="p">,</span> <span class="n">act_fn</span><span class="o">=</span><span class="n">ACTIVATION</span><span class="p">,</span> <span class="n">num_epochs</span><span class="o">=</span><span class="n">NUM_EPOCHS</span><span class="p">,</span>
              <span class="n">num_neg</span><span class="o">=</span><span class="n">NEG_SAMPLES</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">BATCH_SIZE</span><span class="p">,</span> <span class="n">lr</span><span class="o">=</span><span class="n">LEARNING_RATE</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">SEED</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">)</span>

<span class="n">wmf</span> <span class="o">=</span> <span class="n">WMF</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="n">GMF_FACTORS</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">SEED</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">)</span>

<span class="n">ml_100k</span> <span class="o">=</span> <span class="n">movielens</span><span class="o">.</span><span class="n">load_feedback</span><span class="p">(</span><span class="n">variant</span><span class="o">=</span><span class="s2">&quot;100K&quot;</span><span class="p">,</span> <span class="n">reader</span><span class="o">=</span><span class="n">Reader</span><span class="p">(</span><span class="n">bin_threshold</span><span class="o">=</span><span class="mf">4.0</span><span class="p">))</span>
<span class="n">ratio_split</span> <span class="o">=</span> <span class="n">RatioSplit</span><span class="p">(</span>
  <span class="n">data</span><span class="o">=</span><span class="n">ml_100k</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">exclude_unknowns</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">SEED</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span>
<span class="p">)</span>
<span class="n">ndcg_50</span> <span class="o">=</span> <span class="n">cornac</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">NDCG</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">rec_50</span> <span class="o">=</span> <span class="n">cornac</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">Recall</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

<span class="n">cornac</span><span class="o">.</span><span class="n">Experiment</span><span class="p">(</span>
  <span class="n">eval_method</span><span class="o">=</span><span class="n">ratio_split</span><span class="p">,</span>
  <span class="n">models</span><span class="o">=</span><span class="p">[</span><span class="n">gmf</span><span class="p">,</span> <span class="n">mlp</span><span class="p">,</span> <span class="n">neumf</span><span class="p">,</span> <span class="n">wmf</span><span class="p">],</span>
  <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="n">ndcg_50</span><span class="p">,</span> <span class="n">rec_50</span><span class="p">],</span>
<span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Data from http://files.grouplens.org/datasets/movielens/ml-100k/u.data
will be cached into /root/.cornac/ml-100k/u.data
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "1ceb3d202e4b47e7ba222da7a0bf9299", "version_major": 2, "version_minor": 0}
</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>File cached!

TEST:
...
      | NDCG@50 | Recall@50 | Train (s) | Test (s)
----- + ------- + --------- + --------- + --------
GMF   |  0.1609 |    0.2778 |   28.6248 |   1.0193
MLP   |  0.1630 |    0.2807 |   29.0589 |   1.1897
NeuMF |  0.2412 |    0.4268 |   29.9544 |   1.2884
WMF   |  0.1976 |    0.3753 |    9.2373 |   0.5958
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="variational-autoencoder-for-collaborative-filtering-vaecf">
<h2>Variational Autoencoder for Collaborative Filtering (VAECF)<a class="headerlink" href="#variational-autoencoder-for-collaborative-filtering-vaecf" title="Permalink to this headline">¶</a></h2>
<p>Variational Autoencoders (VAE) is a type of autoencoders which is a neural network with auto-associative mapping of inputs. Normal autoencoders learns a determinisic latent representation of an input, while VAE learns a distribution of that representation. VAECF model extends VAE for the collaborative filtering problem with implicit feedback data.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">NUM_FACTORS</span> <span class="o">=</span> <span class="mi">25</span>  <span class="c1"># @param</span>
<span class="n">AE_LAYERS</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">50</span><span class="p">]</span>  <span class="c1"># @param</span>
<span class="n">ACTIVATION</span> <span class="o">=</span> <span class="s2">&quot;tanh&quot;</span>  <span class="c1"># @param [&quot;tanh&quot;, &quot;sigmoid&quot;, &quot;relu&quot;, &quot;leaky_relu&quot;]</span>
<span class="n">LIKELIHOOD</span> <span class="o">=</span> <span class="s2">&quot;bern&quot;</span>  <span class="c1"># @param [&quot;bern&quot;, &quot;mult&quot;, &quot;gaus&quot;, &quot;pois&quot;]</span>
<span class="n">NUM_EPOCHS</span> <span class="o">=</span> <span class="mi">600</span>  <span class="c1"># @param </span>
<span class="n">BATCH_SIZE</span> <span class="o">=</span> <span class="mi">256</span>  <span class="c1"># @param</span>
<span class="n">LEARNING_RATE</span> <span class="o">=</span> <span class="mf">0.001</span>  <span class="c1"># @param</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vaecf</span> <span class="o">=</span> <span class="n">VAECF</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="n">NUM_FACTORS</span><span class="p">,</span> <span class="n">autoencoder_structure</span><span class="o">=</span><span class="n">AE_LAYERS</span><span class="p">,</span> <span class="n">act_fn</span><span class="o">=</span><span class="n">ACTIVATION</span><span class="p">,</span>
              <span class="n">likelihood</span><span class="o">=</span><span class="n">LIKELIHOOD</span><span class="p">,</span> <span class="n">n_epochs</span><span class="o">=</span><span class="n">NUM_EPOCHS</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">BATCH_SIZE</span><span class="p">,</span>
              <span class="n">learning_rate</span><span class="o">=</span><span class="n">LEARNING_RATE</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">SEED</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">,</span> <span class="n">use_gpu</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">wmf</span> <span class="o">=</span> <span class="n">WMF</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="n">NUM_FACTORS</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">SEED</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span><span class="p">)</span>

<span class="n">ml_100k</span> <span class="o">=</span> <span class="n">movielens</span><span class="o">.</span><span class="n">load_feedback</span><span class="p">(</span><span class="n">variant</span><span class="o">=</span><span class="s2">&quot;100K&quot;</span><span class="p">,</span> <span class="n">reader</span><span class="o">=</span><span class="n">Reader</span><span class="p">(</span><span class="n">bin_threshold</span><span class="o">=</span><span class="mf">4.0</span><span class="p">))</span>
<span class="n">ratio_split</span> <span class="o">=</span> <span class="n">RatioSplit</span><span class="p">(</span>
  <span class="n">data</span><span class="o">=</span><span class="n">ml_100k</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">exclude_unknowns</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">SEED</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">VERBOSE</span>
<span class="p">)</span>

<span class="n">cornac</span><span class="o">.</span><span class="n">Experiment</span><span class="p">(</span>
  <span class="n">eval_method</span><span class="o">=</span><span class="n">ratio_split</span><span class="p">,</span> <span class="n">models</span><span class="o">=</span><span class="p">[</span><span class="n">vaecf</span><span class="p">,</span> <span class="n">wmf</span><span class="p">],</span> <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="n">rec_50</span><span class="p">,</span> <span class="n">ndcg_50</span><span class="p">],</span>
<span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>TEST:
...
      | NDCG@50 | Recall@50 | Train (s) | Test (s)
----- + ------- + --------- + --------- + --------
VAECF |  0.2418 |    0.4268 |   56.6568 |   1.0349
WMF   |  0.2045 |    0.3958 |   10.5690 |   0.6070
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="running-experiment">
<h2>Running Experiment<a class="headerlink" href="#running-experiment" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cornac</span>
<span class="kn">from</span> <span class="nn">cornac.eval_methods</span> <span class="kn">import</span> <span class="n">RatioSplit</span>
<span class="kn">from</span> <span class="nn">cornac.models</span> <span class="kn">import</span> <span class="n">MF</span><span class="p">,</span> <span class="n">PMF</span><span class="p">,</span> <span class="n">BPR</span>
<span class="kn">from</span> <span class="nn">cornac.metrics</span> <span class="kn">import</span> <span class="n">MAE</span><span class="p">,</span> <span class="n">RMSE</span><span class="p">,</span> <span class="n">Precision</span><span class="p">,</span> <span class="n">Recall</span><span class="p">,</span> <span class="n">NDCG</span><span class="p">,</span> <span class="n">AUC</span>

<span class="c1"># load the built-in MovieLens 100K and split the data based on ratio</span>
<span class="n">ml_100k</span> <span class="o">=</span> <span class="n">cornac</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">movielens</span><span class="o">.</span><span class="n">load_feedback</span><span class="p">()</span>
<span class="n">rs</span> <span class="o">=</span> <span class="n">RatioSplit</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">ml_100k</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">rating_threshold</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">123</span><span class="p">)</span>

<span class="c1"># initialize models, here we are comparing: Biased MF, PMF, and BPR</span>
<span class="n">models</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">MF</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">lambda_reg</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">use_bias</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">123</span><span class="p">),</span>
    <span class="n">PMF</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">lambda_reg</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">123</span><span class="p">),</span>
    <span class="n">BPR</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">lambda_reg</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">123</span><span class="p">),</span>
<span class="p">]</span>

<span class="c1"># define metrics to evaluate the models</span>
<span class="n">metrics</span> <span class="o">=</span> <span class="p">[</span><span class="n">MAE</span><span class="p">(),</span> <span class="n">RMSE</span><span class="p">(),</span> <span class="n">Precision</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span> <span class="n">Recall</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span> <span class="n">NDCG</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span> <span class="n">AUC</span><span class="p">()]</span>

<span class="c1"># put it together in an experiment, voilà!</span>
<span class="n">cornac</span><span class="o">.</span><span class="n">Experiment</span><span class="p">(</span><span class="n">eval_method</span><span class="o">=</span><span class="n">rs</span><span class="p">,</span> <span class="n">models</span><span class="o">=</span><span class="n">models</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="n">metrics</span><span class="p">,</span> <span class="n">user_based</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>TEST:
...
    |    MAE |   RMSE |    AUC | NDCG@10 | Precision@10 | Recall@10 | Train (s) | Test (s)
--- + ------ + ------ + ------ + ------- + ------------ + --------- + --------- + --------
MF  | 0.7430 | 0.8998 | 0.7445 |  0.0479 |       0.0437 |    0.0352 |    0.1202 |   1.4422
PMF | 0.7534 | 0.9138 | 0.7744 |  0.0617 |       0.0533 |    0.0479 |    2.2300 |   1.7559
BPR | 2.0143 | 2.2267 | 0.8695 |  0.0975 |       0.0727 |    0.0891 |    3.8556 |   1.4108
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="pmf-ratio">
<h2>PMF ratio<a class="headerlink" href="#pmf-ratio" title="Permalink to this headline">¶</a></h2>
<p>Example to run Probabilistic Matrix Factorization (PMF) model with Ratio Split evaluation strategy</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cornac</span>
<span class="kn">from</span> <span class="nn">cornac.datasets</span> <span class="kn">import</span> <span class="n">movielens</span>
<span class="kn">from</span> <span class="nn">cornac.eval_methods</span> <span class="kn">import</span> <span class="n">RatioSplit</span>
<span class="kn">from</span> <span class="nn">cornac.models</span> <span class="kn">import</span> <span class="n">PMF</span>


<span class="c1"># Load the MovieLens 100K dataset</span>
<span class="n">ml_100k</span> <span class="o">=</span> <span class="n">movielens</span><span class="o">.</span><span class="n">load_feedback</span><span class="p">()</span>

<span class="c1"># Instantiate an evaluation method.</span>
<span class="n">ratio_split</span> <span class="o">=</span> <span class="n">RatioSplit</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">ml_100k</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">rating_threshold</span><span class="o">=</span><span class="mf">4.0</span><span class="p">,</span> <span class="n">exclude_unknowns</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="c1"># Instantiate a PMF recommender model.</span>
<span class="n">pmf</span> <span class="o">=</span> <span class="n">PMF</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">lambda_reg</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>

<span class="c1"># Instantiate evaluation metrics.</span>
<span class="n">mae</span> <span class="o">=</span> <span class="n">cornac</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">MAE</span><span class="p">()</span>
<span class="n">rmse</span> <span class="o">=</span> <span class="n">cornac</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">RMSE</span><span class="p">()</span>
<span class="n">rec_20</span> <span class="o">=</span> <span class="n">cornac</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">Recall</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">pre_20</span> <span class="o">=</span> <span class="n">cornac</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">Precision</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="c1"># Instantiate and then run an experiment.</span>
<span class="n">cornac</span><span class="o">.</span><span class="n">Experiment</span><span class="p">(</span>
    <span class="n">eval_method</span><span class="o">=</span><span class="n">ratio_split</span><span class="p">,</span>
    <span class="n">models</span><span class="o">=</span><span class="p">[</span><span class="n">pmf</span><span class="p">],</span>
    <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="n">mae</span><span class="p">,</span> <span class="n">rmse</span><span class="p">,</span> <span class="n">rec_20</span><span class="p">,</span> <span class="n">pre_20</span><span class="p">],</span>
    <span class="n">user_based</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>TEST:
...
    |    MAE |   RMSE | Precision@20 | Recall@20 | Train (s) | Test (s)
--- + ------ + ------ + ------------ + --------- + --------- + --------
PMF | 0.7408 | 0.8992 |       0.0502 |    0.0903 |    2.2457 |   1.2484
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="given-data">
<h2>Given data<a class="headerlink" href="#given-data" title="Permalink to this headline">¶</a></h2>
<p>Example on how to train and evaluate a model with provided train and test sets</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cornac.data</span> <span class="kn">import</span> <span class="n">Reader</span>
<span class="kn">from</span> <span class="nn">cornac.eval_methods</span> <span class="kn">import</span> <span class="n">BaseMethod</span>
<span class="kn">from</span> <span class="nn">cornac.models</span> <span class="kn">import</span> <span class="n">MF</span>
<span class="kn">from</span> <span class="nn">cornac.metrics</span> <span class="kn">import</span> <span class="n">MAE</span><span class="p">,</span> <span class="n">RMSE</span>
<span class="kn">from</span> <span class="nn">cornac.utils</span> <span class="kn">import</span> <span class="n">cache</span>


<span class="c1"># Download MovieLens 100K provided train and test sets</span>
<span class="n">reader</span> <span class="o">=</span> <span class="n">Reader</span><span class="p">()</span>
<span class="n">train_data</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>
    <span class="n">cache</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://files.grouplens.org/datasets/movielens/ml-100k/u1.base&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">test_data</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>
    <span class="n">cache</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://files.grouplens.org/datasets/movielens/ml-100k/u1.test&quot;</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># Instantiate a Base evaluation method using the provided train and test sets</span>
<span class="n">eval_method</span> <span class="o">=</span> <span class="n">BaseMethod</span><span class="o">.</span><span class="n">from_splits</span><span class="p">(</span>
    <span class="n">train_data</span><span class="o">=</span><span class="n">train_data</span><span class="p">,</span> <span class="n">test_data</span><span class="o">=</span><span class="n">test_data</span><span class="p">,</span> <span class="n">exclude_unknowns</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="c1"># Instantiate the MF model</span>
<span class="n">mf</span> <span class="o">=</span> <span class="n">MF</span><span class="p">(</span>
    <span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">max_iter</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span>
    <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="n">lambda_reg</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span>
    <span class="n">use_bias</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">early_stop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Evaluation</span>
<span class="n">test_result</span><span class="p">,</span> <span class="n">val_result</span> <span class="o">=</span> <span class="n">eval_method</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">mf</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="n">MAE</span><span class="p">(),</span> <span class="n">RMSE</span><span class="p">()],</span> <span class="n">user_based</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">test_result</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.00B [00:00, ?B/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Data from http://files.grouplens.org/datasets/movielens/ml-100k/u1.base
will be cached into /root/.cornac/u1.base
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.60MB [00:00, 2.19MB/s]                           
0.00B [00:00, ?B/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>File cached!
Data from http://files.grouplens.org/datasets/movielens/ml-100k/u1.test
will be cached into /root/.cornac/u1.test
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>401kB [00:00, 852kB/s]                            
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>File cached!
rating_threshold = 1.0
exclude_unknowns = False
---
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 72%|███████▏  | 18/25 [00:00&lt;00:00, 140.99it/s, loss=32731.62]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Training data:
Number of users = 943
Number of items = 1650
Number of ratings = 80000
Max rating = 5.0
Min rating = 1.0
Global mean = 3.5
---
Test data:
Number of users = 459
Number of items = 1410
Number of ratings = 20000
Number of unknown users = 0
Number of unknown items = 32
---
Total users = 943
Total items = 1682

[MF] Training started!
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 25/25 [00:00&lt;00:00, 129.03it/s, loss=28517.47]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization finished!

[MF] Evaluation started!
   |    MAE |   RMSE | Train (s) | Test (s)
-- + ------ + ------ + --------- + --------
MF | 0.7447 | 0.9166 |    0.1995 |   0.6030
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="c2pf">
<h2>C2PF<a class="headerlink" href="#c2pf" title="Permalink to this headline">¶</a></h2>
<p>Collaborative Context Poisson Factorization (C2PF) with Amazon Office dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Fit to and evaluate C2PF [1] on the Office Amazon dataset.</span>
<span class="sd">[1] Salah, Aghiles, and Hady W. Lauw. A Bayesian Latent Variable Model of User Preferences with Item Context. \</span>
<span class="sd">    In IJCAI, pp. 2667-2674. 2018.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">cornac.data</span> <span class="kn">import</span> <span class="n">GraphModality</span>
<span class="kn">from</span> <span class="nn">cornac.eval_methods</span> <span class="kn">import</span> <span class="n">RatioSplit</span>
<span class="kn">from</span> <span class="nn">cornac.experiment</span> <span class="kn">import</span> <span class="n">Experiment</span>
<span class="kn">from</span> <span class="nn">cornac</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="kn">from</span> <span class="nn">cornac.models</span> <span class="kn">import</span> <span class="n">C2PF</span>
<span class="kn">from</span> <span class="nn">cornac.datasets</span> <span class="kn">import</span> <span class="n">amazon_office</span> <span class="k">as</span> <span class="n">office</span>


<span class="c1"># In addition to user-item feedback, C2PF integrates item-to-item contextual relationships</span>
<span class="c1"># The necessary data can be loaded as follows</span>
<span class="n">ratings</span> <span class="o">=</span> <span class="n">office</span><span class="o">.</span><span class="n">load_feedback</span><span class="p">()</span>
<span class="n">contexts</span> <span class="o">=</span> <span class="n">office</span><span class="o">.</span><span class="n">load_graph</span><span class="p">()</span>

<span class="c1"># Instantiate a GraphModality, it makes it convenient to work with graph (network) auxiliary information</span>
<span class="c1"># For more details, please refer to the tutorial on how to work with auxiliary data</span>
<span class="n">item_graph_modality</span> <span class="o">=</span> <span class="n">GraphModality</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">contexts</span><span class="p">)</span>

<span class="c1"># Define an evaluation method to split feedback into train and test sets</span>
<span class="n">ratio_split</span> <span class="o">=</span> <span class="n">RatioSplit</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">ratings</span><span class="p">,</span>
    <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="n">rating_threshold</span><span class="o">=</span><span class="mf">3.5</span><span class="p">,</span>
    <span class="n">exclude_unknowns</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">item_graph</span><span class="o">=</span><span class="n">item_graph_modality</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Instantiate C2PF</span>
<span class="n">c2pf</span> <span class="o">=</span> <span class="n">C2PF</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">variant</span><span class="o">=</span><span class="s2">&quot;c2pf&quot;</span><span class="p">)</span>

<span class="c1"># Evaluation metrics</span>
<span class="n">ndcg</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">NDCG</span><span class="p">(</span><span class="n">k</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">mrr</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">MRR</span><span class="p">()</span>
<span class="n">rec</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">Recall</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">pre</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">Precision</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="c1"># Put everything together into an experiment and run it</span>
<span class="n">Experiment</span><span class="p">(</span><span class="n">eval_method</span><span class="o">=</span><span class="n">ratio_split</span><span class="p">,</span> <span class="n">models</span><span class="o">=</span><span class="p">[</span><span class="n">c2pf</span><span class="p">],</span> <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="n">ndcg</span><span class="p">,</span> <span class="n">mrr</span><span class="p">,</span> <span class="n">rec</span><span class="p">,</span> <span class="n">pre</span><span class="p">])</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.00B [00:00, ?B/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Data from https://static.preferred.ai/cornac/datasets/amazon_office/rating.zip
will be cached into /root/.cornac/amazon_office/rating.txt
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>213kB [00:01, 171kB/s]                            
0.00B [00:00, ?B/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Unzipping ...
File cached!
Data from https://static.preferred.ai/cornac/datasets/amazon_office/context.zip
will be cached into /root/.cornac/amazon_office/context.txt
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>344kB [00:01, 271kB/s]                            
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Unzipping ...
File cached!
rating_threshold = 3.5
exclude_unknowns = True
---
Training data:
Number of users = 3698
Number of items = 6405
Number of ratings = 42625
Max rating = 5.0
Min rating = 1.0
Global mean = 4.4
---
Test data:
Number of users = 3269
Number of items = 3549
Number of ratings = 10404
Number of unknown users = 0
Number of unknown items = 0
---
Total users = 3698
Total items = 6405

[C2PF] Training started!
Learning...
Learning completed!
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0%|          | 0/3269 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[C2PF] Evaluation started!
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 3269/3269 [00:09&lt;00:00, 350.86it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>TEST:
...
     |    MRR | NDCG@-1 | Precision@20 | Recall@20 | Train (s) | Test (s)
---- + ------ + ------- + ------------ + --------- + --------- + --------
C2PF | 0.0611 |  0.1913 |       0.0136 |    0.0868 | 1314.9453 |   9.3316
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="hyperparameters">
<h2>Hyperparameters<a class="headerlink" href="#hyperparameters" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Example for hyper-parameter searching with Matrix Factorization&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">cornac</span>
<span class="kn">from</span> <span class="nn">cornac.datasets</span> <span class="kn">import</span> <span class="n">movielens</span>
<span class="kn">from</span> <span class="nn">cornac.eval_methods</span> <span class="kn">import</span> <span class="n">RatioSplit</span>
<span class="kn">from</span> <span class="nn">cornac.hyperopt</span> <span class="kn">import</span> <span class="n">Discrete</span><span class="p">,</span> <span class="n">Continuous</span>
<span class="kn">from</span> <span class="nn">cornac.hyperopt</span> <span class="kn">import</span> <span class="n">GridSearch</span><span class="p">,</span> <span class="n">RandomSearch</span>


<span class="c1"># Load MovieLens 100K ratings</span>
<span class="n">ml_100k</span> <span class="o">=</span> <span class="n">movielens</span><span class="o">.</span><span class="n">load_feedback</span><span class="p">(</span><span class="n">variant</span><span class="o">=</span><span class="s2">&quot;100K&quot;</span><span class="p">)</span>

<span class="c1"># Define an evaluation method to split feedback into train, validation and test sets</span>
<span class="n">ratio_split</span> <span class="o">=</span> <span class="n">RatioSplit</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">ml_100k</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">val_size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Instantiate MAE and RMSE for evaluation</span>
<span class="n">mae</span> <span class="o">=</span> <span class="n">cornac</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">MAE</span><span class="p">()</span>
<span class="n">rmse</span> <span class="o">=</span> <span class="n">cornac</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">RMSE</span><span class="p">()</span>

<span class="c1"># Define a base MF model with fixed hyper-parameters</span>
<span class="n">mf</span> <span class="o">=</span> <span class="n">cornac</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">MF</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">early_stop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Wrap MF model inside GridSearch along with the searching space</span>
<span class="n">gs_mf</span> <span class="o">=</span> <span class="n">GridSearch</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">mf</span><span class="p">,</span>
    <span class="n">space</span><span class="o">=</span><span class="p">[</span>
        <span class="n">Discrete</span><span class="p">(</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">50</span><span class="p">]),</span>
        <span class="n">Discrete</span><span class="p">(</span><span class="s2">&quot;use_bias&quot;</span><span class="p">,</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]),</span>
        <span class="n">Discrete</span><span class="p">(</span><span class="s2">&quot;lambda_reg&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mf">1e-1</span><span class="p">,</span> <span class="mf">1e-2</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="mf">1e-4</span><span class="p">]),</span>
    <span class="p">],</span>
    <span class="n">metric</span><span class="o">=</span><span class="n">rmse</span><span class="p">,</span>
    <span class="n">eval_method</span><span class="o">=</span><span class="n">ratio_split</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Wrap MF model inside RandomSearch along with the searching space, try 30 times</span>
<span class="n">rs_mf</span> <span class="o">=</span> <span class="n">RandomSearch</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">mf</span><span class="p">,</span>
    <span class="n">space</span><span class="o">=</span><span class="p">[</span>
        <span class="n">Discrete</span><span class="p">(</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">50</span><span class="p">]),</span>
        <span class="n">Discrete</span><span class="p">(</span><span class="s2">&quot;use_bias&quot;</span><span class="p">,</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]),</span>
        <span class="n">Continuous</span><span class="p">(</span><span class="s2">&quot;lambda_reg&quot;</span><span class="p">,</span> <span class="n">low</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">1e-1</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="n">metric</span><span class="o">=</span><span class="n">rmse</span><span class="p">,</span>
    <span class="n">eval_method</span><span class="o">=</span><span class="n">ratio_split</span><span class="p">,</span>
    <span class="n">n_trails</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Put everything together into an experiment and run it</span>
<span class="n">cornac</span><span class="o">.</span><span class="n">Experiment</span><span class="p">(</span>
    <span class="n">eval_method</span><span class="o">=</span><span class="n">ratio_split</span><span class="p">,</span>
    <span class="n">models</span><span class="o">=</span><span class="p">[</span><span class="n">gs_mf</span><span class="p">,</span> <span class="n">rs_mf</span><span class="p">],</span>
    <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="n">mae</span><span class="p">,</span> <span class="n">rmse</span><span class="p">],</span>
    <span class="n">user_based</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rating_threshold = 1.0
exclude_unknowns = True
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 75%|███████▌  | 15/20 [00:00&lt;00:00, 113.22it/s, loss=31685.08]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>---
Training data:
Number of users = 943
Number of items = 1656
Number of ratings = 80000
Max rating = 5.0
Min rating = 1.0
Global mean = 3.5
---
Test data:
Number of users = 925
Number of items = 1254
Number of ratings = 9984
Number of unknown users = 0
Number of unknown items = 0
---
Validation data:
Number of users = 922
Number of items = 1235
Number of ratings = 9988
---
Total users = 943
Total items = 1656

[GridSearch_MF] Training started!
Evaluating: {&#39;k&#39;: 10, &#39;lambda_reg&#39;: 0.0001, &#39;use_bias&#39;: False}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 117.48it/s, loss=28069.14]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization finished!
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 135.92it/s, loss=29540.58]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating: {&#39;k&#39;: 10, &#39;lambda_reg&#39;: 0.0001, &#39;use_bias&#39;: True}
Optimization finished!
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 138.72it/s, loss=28466.41]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating: {&#39;k&#39;: 10, &#39;lambda_reg&#39;: 0.001, &#39;use_bias&#39;: False}
Optimization finished!
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 122.73it/s, loss=29679.09]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating: {&#39;k&#39;: 10, &#39;lambda_reg&#39;: 0.001, &#39;use_bias&#39;: True}
Optimization finished!
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 134.49it/s, loss=29168.98]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating: {&#39;k&#39;: 10, &#39;lambda_reg&#39;: 0.01, &#39;use_bias&#39;: False}
Optimization finished!
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 122.54it/s, loss=30386.51]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating: {&#39;k&#39;: 10, &#39;lambda_reg&#39;: 0.01, &#39;use_bias&#39;: True}
Optimization finished!
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 138.90it/s, loss=33891.18]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating: {&#39;k&#39;: 10, &#39;lambda_reg&#39;: 0.1, &#39;use_bias&#39;: False}
Optimization finished!
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 129.45it/s, loss=33907.84]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating: {&#39;k&#39;: 10, &#39;lambda_reg&#39;: 0.1, &#39;use_bias&#39;: True}
Optimization finished!
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 75%|███████▌  | 15/20 [00:00&lt;00:00, 80.51it/s, loss=30235.88]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating: {&#39;k&#39;: 30, &#39;lambda_reg&#39;: 0.0001, &#39;use_bias&#39;: False}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 79.79it/s, loss=24809.18]
 15%|█▌        | 3/20 [00:00&lt;00:00, 82.12it/s, loss=35532.26]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization finished!
Evaluating: {&#39;k&#39;: 30, &#39;lambda_reg&#39;: 0.0001, &#39;use_bias&#39;: True}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 78.13it/s, loss=26479.67]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization finished!
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 80%|████████  | 16/20 [00:00&lt;00:00, 84.55it/s, loss=29081.02]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating: {&#39;k&#39;: 30, &#39;lambda_reg&#39;: 0.001, &#39;use_bias&#39;: False}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 80.98it/s, loss=24763.03]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization finished!
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 80%|████████  | 16/20 [00:00&lt;00:00, 80.95it/s, loss=30655.64]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating: {&#39;k&#39;: 30, &#39;lambda_reg&#39;: 0.001, &#39;use_bias&#39;: True}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 79.88it/s, loss=26515.29]
 10%|█         | 2/20 [00:00&lt;00:00, 90.06it/s, loss=252966.80]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization finished!
Evaluating: {&#39;k&#39;: 30, &#39;lambda_reg&#39;: 0.01, &#39;use_bias&#39;: False}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 74.03it/s, loss=26736.58]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization finished!
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 80%|████████  | 16/20 [00:00&lt;00:00, 83.59it/s, loss=31441.78]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating: {&#39;k&#39;: 30, &#39;lambda_reg&#39;: 0.01, &#39;use_bias&#39;: True}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 81.56it/s, loss=28064.21]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization finished!
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 85%|████████▌ | 17/20 [00:00&lt;00:00, 90.88it/s, loss=34440.27]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating: {&#39;k&#39;: 30, &#39;lambda_reg&#39;: 0.1, &#39;use_bias&#39;: False}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 86.20it/s, loss=33572.37]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization finished!
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 80%|████████  | 16/20 [00:00&lt;00:00, 85.06it/s, loss=33991.67]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating: {&#39;k&#39;: 30, &#39;lambda_reg&#39;: 0.1, &#39;use_bias&#39;: True}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 80.74it/s, loss=33831.92]
  5%|▌         | 1/20 [00:00&lt;00:00, 68.43it/s, loss=546675.25]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization finished!
Evaluating: {&#39;k&#39;: 50, &#39;lambda_reg&#39;: 0.0001, &#39;use_bias&#39;: False}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 57.63it/s, loss=22798.65]
  5%|▌         | 1/20 [00:00&lt;00:00, 68.89it/s, loss=41469.27]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization finished!
Evaluating: {&#39;k&#39;: 50, &#39;lambda_reg&#39;: 0.0001, &#39;use_bias&#39;: True}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 60.71it/s, loss=24302.16]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization finished!
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 55%|█████▌    | 11/20 [00:00&lt;00:00, 63.89it/s, loss=33206.38]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating: {&#39;k&#39;: 50, &#39;lambda_reg&#39;: 0.001, &#39;use_bias&#39;: False}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 54.75it/s, loss=23045.52]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization finished!
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 60%|██████    | 12/20 [00:00&lt;00:00, 66.91it/s, loss=33009.37]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating: {&#39;k&#39;: 50, &#39;lambda_reg&#39;: 0.001, &#39;use_bias&#39;: True}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 63.26it/s, loss=24565.52]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization finished!
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 50%|█████     | 10/20 [00:00&lt;00:00, 53.04it/s, loss=34417.25]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating: {&#39;k&#39;: 50, &#39;lambda_reg&#39;: 0.01, &#39;use_bias&#39;: False}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 55.37it/s, loss=24783.99]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization finished!
Evaluating: {&#39;k&#39;: 50, &#39;lambda_reg&#39;: 0.01, &#39;use_bias&#39;: True}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 55.83it/s, loss=26360.77]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization finished!
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 60%|██████    | 12/20 [00:00&lt;00:00, 59.66it/s, loss=35750.37]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating: {&#39;k&#39;: 50, &#39;lambda_reg&#39;: 0.1, &#39;use_bias&#39;: False}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 58.32it/s, loss=33372.11]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization finished!
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 55%|█████▌    | 11/20 [00:00&lt;00:00, 61.39it/s, loss=34167.66]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating: {&#39;k&#39;: 50, &#39;lambda_reg&#39;: 0.1, &#39;use_bias&#39;: True}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 58.49it/s, loss=33779.37]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization finished!
Best parameter settings: {&#39;k&#39;: 50, &#39;lambda_reg&#39;: 0.01, &#39;use_bias&#39;: False}
RMSE = 0.9220

[GridSearch_MF] Evaluation started!
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 75%|███████▌  | 15/20 [00:00&lt;00:00, 79.16it/s, loss=33960.62]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[RandomSearch_MF] Training started!
Evaluating: {&#39;k&#39;: 30, &#39;lambda_reg&#39;: 0.08612193189485716, &#39;use_bias&#39;: True}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 77.07it/s, loss=33654.50]
 30%|███       | 6/20 [00:00&lt;00:00, 141.43it/s, loss=38583.63]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization finished!
Evaluating: {&#39;k&#39;: 10, &#39;lambda_reg&#39;: 0.06501679843184538, &#39;use_bias&#39;: False}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 100.55it/s, loss=33031.33]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization finished!
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 75%|███████▌  | 15/20 [00:00&lt;00:00, 83.19it/s, loss=33864.39]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating: {&#39;k&#39;: 30, &#39;lambda_reg&#39;: 0.0694755346230901, &#39;use_bias&#39;: True}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 72.34it/s, loss=33263.62]
 15%|█▌        | 3/20 [00:00&lt;00:00, 72.29it/s, loss=62142.05] 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization finished!
Evaluating: {&#39;k&#39;: 50, &#39;lambda_reg&#39;: 0.08344455898777325, &#39;use_bias&#39;: False}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 57.71it/s, loss=32557.79]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization finished!
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 113.03it/s, loss=32853.84]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating: {&#39;k&#39;: 10, &#39;lambda_reg&#39;: 0.06841850071431532, &#39;use_bias&#39;: False}
Optimization finished!
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 124.30it/s, loss=33150.24]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating: {&#39;k&#39;: 10, &#39;lambda_reg&#39;: 0.05636623382282792, &#39;use_bias&#39;: True}
Optimization finished!
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 70%|███████   | 14/20 [00:00&lt;00:00, 76.65it/s, loss=35203.05]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating: {&#39;k&#39;: 30, &#39;lambda_reg&#39;: 0.09375336481584197, &#39;use_bias&#39;: False}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 73.56it/s, loss=33380.41]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization finished!
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 50%|█████     | 10/20 [00:00&lt;00:00, 53.25it/s, loss=33705.49]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating: {&#39;k&#39;: 50, &#39;lambda_reg&#39;: 0.003348765700165698, &#39;use_bias&#39;: True}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 48.41it/s, loss=25168.01]
 10%|█         | 2/20 [00:00&lt;00:00, 119.17it/s, loss=322194.56]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization finished!
Evaluating: {&#39;k&#39;: 10, &#39;lambda_reg&#39;: 0.04834871514338827, &#39;use_bias&#39;: False}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 100.29it/s, loss=32004.79]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization finished!
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 50%|█████     | 10/20 [00:00&lt;00:00, 54.17it/s, loss=34853.15]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating: {&#39;k&#39;: 50, &#39;lambda_reg&#39;: 0.0293367690175802, &#39;use_bias&#39;: False}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 50.23it/s, loss=27899.66]
 10%|█         | 2/20 [00:00&lt;00:00, 114.57it/s, loss=36735.89]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization finished!
Evaluating: {&#39;k&#39;: 10, &#39;lambda_reg&#39;: 0.008332232500049594, &#39;use_bias&#39;: True}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 103.31it/s, loss=30316.82]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization finished!
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 55%|█████▌    | 11/20 [00:00&lt;00:00, 61.34it/s, loss=33973.71]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating: {&#39;k&#39;: 50, &#39;lambda_reg&#39;: 0.05440617877888826, &#39;use_bias&#39;: True}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 55.02it/s, loss=32135.47]
  0%|          | 0/20 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization finished!
Evaluating: {&#39;k&#39;: 30, &#39;lambda_reg&#39;: 0.05911135478061436, &#39;use_bias&#39;: True}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 69.46it/s, loss=32609.57]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization finished!
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 60%|██████    | 12/20 [00:00&lt;00:00, 76.24it/s, loss=33982.51]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating: {&#39;k&#39;: 30, &#39;lambda_reg&#39;: 0.06601038205965916, &#39;use_bias&#39;: True}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 66.61it/s, loss=32986.09]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization finished!
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 101.00it/s, loss=33249.00]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating: {&#39;k&#39;: 10, &#39;lambda_reg&#39;: 0.08521209412017094, &#39;use_bias&#39;: False}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 100.27it/s, loss=33249.00]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization finished!
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 95%|█████████▌| 19/20 [00:00&lt;00:00, 107.30it/s, loss=29760.30]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating: {&#39;k&#39;: 10, &#39;lambda_reg&#39;: 0.00035195130988261385, &#39;use_bias&#39;: False}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 98.99it/s, loss=29069.75] 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization finished!
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 106.21it/s, loss=30486.16]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating: {&#39;k&#39;: 10, &#39;lambda_reg&#39;: 0.020650725560393792, &#39;use_bias&#39;: False}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 55%|█████▌    | 11/20 [00:00&lt;00:00, 57.71it/s, loss=33524.53]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization finished!
Evaluating: {&#39;k&#39;: 50, &#39;lambda_reg&#39;: 0.009120595685760981, &#39;use_bias&#39;: False}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 52.97it/s, loss=24341.06]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization finished!
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 70%|███████   | 14/20 [00:00&lt;00:00, 74.48it/s, loss=33847.32]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating: {&#39;k&#39;: 30, &#39;lambda_reg&#39;: 0.05819710438128485, &#39;use_bias&#39;: True}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 74.83it/s, loss=32835.14]
 10%|█         | 2/20 [00:00&lt;00:00, 87.17it/s, loss=251168.25] 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization finished!
Evaluating: {&#39;k&#39;: 30, &#39;lambda_reg&#39;: 0.003045882175220655, &#39;use_bias&#39;: False}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 71.26it/s, loss=25421.24]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization finished!
Evaluating: {&#39;k&#39;: 50, &#39;lambda_reg&#39;: 0.021020313541605162, &#39;use_bias&#39;: True}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 52.99it/s, loss=28414.02]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization finished!
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 50%|█████     | 10/20 [00:00&lt;00:00, 51.96it/s, loss=36176.66]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating: {&#39;k&#39;: 50, &#39;lambda_reg&#39;: 0.0931018404851425, &#39;use_bias&#39;: False}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 50.41it/s, loss=32988.32]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization finished!
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 108.93it/s, loss=28873.34]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating: {&#39;k&#39;: 10, &#39;lambda_reg&#39;: 0.004135755775979635, &#39;use_bias&#39;: False}
Optimization finished!
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 60%|██████    | 12/20 [00:00&lt;00:00, 69.02it/s, loss=33869.27]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating: {&#39;k&#39;: 30, &#39;lambda_reg&#39;: 0.040445801068814305, &#39;use_bias&#39;: True}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 63.04it/s, loss=31712.69]
  5%|▌         | 1/20 [00:00&lt;00:00, 132.08it/s, loss=41573.63]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization finished!
Evaluating: {&#39;k&#39;: 10, &#39;lambda_reg&#39;: 0.07677103563371872, &#39;use_bias&#39;: True}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 110.49it/s, loss=33682.86]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization finished!
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 50%|█████     | 10/20 [00:00&lt;00:00, 54.03it/s, loss=35032.48]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating: {&#39;k&#39;: 50, &#39;lambda_reg&#39;: 0.03065512171145367, &#39;use_bias&#39;: False}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 51.99it/s, loss=28106.60]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization finished!
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 75%|███████▌  | 15/20 [00:00&lt;00:00, 77.31it/s, loss=31036.10]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating: {&#39;k&#39;: 30, &#39;lambda_reg&#39;: 0.007274328332829502, &#39;use_bias&#39;: False}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 74.36it/s, loss=26083.12]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization finished!
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 90%|█████████ | 18/20 [00:00&lt;00:00, 95.74it/s, loss=32830.86]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating: {&#39;k&#39;: 10, &#39;lambda_reg&#39;: 0.05198029254841431, &#39;use_bias&#39;: False}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 87.32it/s, loss=32142.98]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization finished!
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 55%|█████▌    | 11/20 [00:00&lt;00:00, 62.66it/s, loss=35979.21]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating: {&#39;k&#39;: 50, &#39;lambda_reg&#39;: 0.09457717620040243, &#39;use_bias&#39;: False}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 54.57it/s, loss=33207.05]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization finished!
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 65%|██████▌   | 13/20 [00:00&lt;00:00, 72.72it/s, loss=33535.01]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating: {&#39;k&#39;: 30, &#39;lambda_reg&#39;: 0.022599564709232942, &#39;use_bias&#39;: True}
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 20/20 [00:00&lt;00:00, 68.46it/s, loss=29700.91]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization finished!
Best parameter settings: {&#39;k&#39;: 50, &#39;lambda_reg&#39;: 0.009120595685760981, &#39;use_bias&#39;: False}
RMSE = 0.9211

[RandomSearch_MF] Evaluation started!

VALIDATION:
...
                |    MAE |   RMSE | Time (s)
--------------- + ------ + ------ + --------
GridSearch_MF   | 0.7229 | 0.9220 |   0.1563
RandomSearch_MF | 0.7212 | 0.9211 |   0.1615

TEST:
...
                |    MAE |   RMSE | Train (s) | Test (s)
--------------- + ------ + ------ + --------- + --------
GridSearch_MF   | 0.7210 | 0.9217 |   11.4011 |   0.1963
RandomSearch_MF | 0.7227 | 0.9245 |   15.3778 |   0.2546
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="social-bpr">
<h2>Social BPR<a class="headerlink" href="#social-bpr" title="Permalink to this headline">¶</a></h2>
<p>Example for Social Bayesian Personalized Ranking (SBPR) with Epinions dataset</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cornac</span>
<span class="kn">from</span> <span class="nn">cornac.data</span> <span class="kn">import</span> <span class="n">Reader</span><span class="p">,</span> <span class="n">GraphModality</span>
<span class="kn">from</span> <span class="nn">cornac.datasets</span> <span class="kn">import</span> <span class="n">epinions</span>
<span class="kn">from</span> <span class="nn">cornac.eval_methods</span> <span class="kn">import</span> <span class="n">RatioSplit</span>


<span class="c1"># SBPR integrates user social network into Bayesian Personalized Ranking.</span>
<span class="c1"># The necessary data can be loaded as follows</span>
<span class="n">feedback</span> <span class="o">=</span> <span class="n">epinions</span><span class="o">.</span><span class="n">load_feedback</span><span class="p">(</span>
    <span class="n">Reader</span><span class="p">(</span><span class="n">bin_threshold</span><span class="o">=</span><span class="mf">4.0</span><span class="p">)</span>
<span class="p">)</span>  <span class="c1"># feedback is binarised (turned into implicit) using Reader.</span>
<span class="n">trust</span> <span class="o">=</span> <span class="n">epinions</span><span class="o">.</span><span class="n">load_trust</span><span class="p">()</span>

<span class="c1"># Instantiate a GraphModality, it makes it convenient to work with graph (network) auxiliary information</span>
<span class="c1"># For more details, please refer to the tutorial on how to work with auxiliary data</span>
<span class="n">user_graph_modality</span> <span class="o">=</span> <span class="n">GraphModality</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">trust</span><span class="p">)</span>

<span class="c1"># Define an evaluation method to split feedback into train and test sets</span>
<span class="n">ratio_split</span> <span class="o">=</span> <span class="n">RatioSplit</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">feedback</span><span class="p">,</span>
    <span class="n">test_size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="n">rating_threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">exclude_unknowns</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">user_graph</span><span class="o">=</span><span class="n">user_graph_modality</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Instantiate SBPR model</span>
<span class="n">sbpr</span> <span class="o">=</span> <span class="n">cornac</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">SBPR</span><span class="p">(</span>
    <span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">max_iter</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
    <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span>
    <span class="n">lambda_u</span><span class="o">=</span><span class="mf">0.015</span><span class="p">,</span>
    <span class="n">lambda_v</span><span class="o">=</span><span class="mf">0.025</span><span class="p">,</span>
    <span class="n">lambda_b</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Use Recall@10 for evaluation</span>
<span class="n">rec_10</span> <span class="o">=</span> <span class="n">cornac</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">Recall</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># Put everything together into an experiment and run it</span>
<span class="n">cornac</span><span class="o">.</span><span class="n">Experiment</span><span class="p">(</span><span class="n">eval_method</span><span class="o">=</span><span class="n">ratio_split</span><span class="p">,</span> <span class="n">models</span><span class="o">=</span><span class="p">[</span><span class="n">sbpr</span><span class="p">],</span> <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="n">rec_10</span><span class="p">])</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.00B [00:00, ?B/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Data from http://www.trustlet.org/datasets/downloaded_epinions/ratings_data.txt.bz2
will be cached into /root/.cornac/epinions/ratings_data.txt
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.62MB [00:01, 1.99MB/s]                            
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Unzipping ...
File cached!
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.00B [00:00, ?B/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Data from http://www.trustlet.org/datasets/downloaded_epinions/trust_data.txt.bz2
will be cached into /root/.cornac/epinions/trust_data.txt
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.70MB [00:00, 2.19MB/s]                           
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Unzipping ...
File cached!
rating_threshold = 0.5
exclude_unknowns = True
---
Training data:
Number of users = 37153
Number of items = 111967
Number of ratings = 445853
Max rating = 1.0
Min rating = 1.0
Global mean = 1.0
---
Test data:
Number of users = 16312
Number of items = 19302
Number of ratings = 41537
Number of unknown users = 0
Number of unknown items = 0
---
Total users = 37153
Total items = 111967

[SBPR] Training started!
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Building social data: 100%|██████████| 37153/37153 [00:21&lt;00:00, 1738.91it/s]
100%|██████████| 50/50 [00:10&lt;00:00,  4.77it/s, skipped=0.06%]
  0%|          | 0/16312 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization finished!

[SBPR] Evaluation started!
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 16312/16312 [05:16&lt;00:00, 51.56it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>TEST:
...
     | Recall@10 | Train (s) | Test (s)
---- + --------- + --------- + --------
SBPR |    0.0183 |   40.7528 | 316.3553
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./nbs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="T935440_The_importance_of_Rating_Normalization.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">The importance of Rating Normalization</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="T561435_Flower_Classification.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">Flower classification</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Sparsh A.<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>