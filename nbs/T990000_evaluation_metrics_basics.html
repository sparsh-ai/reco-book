
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Recommender System Evaluations &#8212; Reco Book</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Comparing Implicit Models on Synthetic Data" href="T990000_implicit_synthetic.html" />
    <link rel="prev" title="Content-based method for song recommendation" href="T990000_content_based_music_recommender_lyricsfreak.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Reco Book</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../index.html">
   Tutorials in Jupyter notebook format
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  User Stories
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="US780867_Transformer_based_Recommenders.html">
   Transformer-based Recommenders
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="T034923_BERT4Rec_on_ML1M_in_PyTorch.html">
     BERT4Rec on ML-1M in PyTorch
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T595874_BERT4Rec_on_ML25M_in_PyTorch_Lightning.html">
     BERT4Rec on ML-25M
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T088416_BST_Implementation_in_MXNet.html">
     BST Implementation in MXNet
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T602245_BST_implementation_in_PyTorch.html">
     BST implementation in PyTorch
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T007665_BST_on_ML1M_in_Keras.html">
     A Transformer-based recommendation system
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T881207_BST_PTLightning_ML1M.html">
     Rating prediction using the Behavior Sequence Transformer (BST) model on ML-1M dataset in PyTorch Lightning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T757997_SASRec_PyTorch.html">
     SASRec implementation with PyTorch Library
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T225287_SASRec_PaddlePaddle.html">
     SASRec implementation with Paddle Library
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T701627_SR_SAN_Session_based_Model.html">
     SR-SAN Session-based Recommender
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T975104_SSEPT_ML1M_Tensorflow1x.html">
     SSE-PT Personalized Transformer Recommender on ML-1M in Tensorflow 1.x
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Prototypes
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="T382881_DeepWalk_Karateclub.html">
   DeepWalk from scratch referencing Karateclub library
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T384270_DeepWalk_pure_python.html">
   DeepWalk in pure python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T677598_Jaccard_Cosine_SVD_DeepWalk_ML100K.html">
   Recommender System with DeepWalk Graph Embeddings
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T815556_Node2vec_Karateclub.html">
   Node2vec from scratch referencing Karateclub library
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T894941_Node2vec_MovieLens_Keras.html">
   Graph representation learning with node2vec
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T611050_Node2vec_PyG.html">
   Node2vec from scratch in PyTorch Geometric
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T186367_Node2vec_library.html">
   Node2vec from scratch referencing node2vec library
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T331379_bayesian_personalized_ranking.html">
   BPR from scratch
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T081831_Data_Poisoning_Attacks_on_Factorization_Based_Collaborative_Filtering.html">
   Data Poisoning Attacks on Factorization-Based Collaborative Filtering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T102448_Adversarial_Learning_for_Recommendation.html">
   Adversarial Training (Regularization) on a Recommender System
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T865035_Simulating_Data_Poisoning_Attacks_against_Twitter_Recommender.html">
   Load and process dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T711285_Data_Poisoning_Attack_using_LFM_and_ItemAE_on_Synthetic_Dataset.html">
   Injection attack using LFM and ItemAE model trained on Toy dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T355514_Black_box_Attack_on_Sequential_Recs.html">
   Black-box Attack on Sequential Recs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T873451_Statistics_fundamentals.html">
   Statictics Fundamentals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T890478_Batch_Learning_from_Bandit_Feedback_%28BLBF%29.html">
   Imports
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T257798_Off_Policy_Learning_in_Two_stage_Recommender_Systems.html">
   Off-Policy Learning in Two-stage Recommender Systems
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T471827_Adaptive_Estimator_Selection_for_Off_Policy_Evaluation.html">
   Adaptive Estimator Selection for Off-Policy Evaluation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T902666_Evaluating_the_Robustness_of_Off_Policy_Evaluation.html">
   Evaluating the Robustness of Off-Policy Evaluation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T705904_Evaluation_of_Multiple_Off_Policy_Estimators_on_Synthetic_Dataset.html">
   Evaluation of Multiple Off-Policy Estimators on Synthetic Dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T874693_Evaluating_Standard_Off_Policy_Estimators_with_Small_Sample_Open_Bandit_Dataset.html">
   Evaluating Standard Off-Policy Estimators with Small Sample Open-Bandit Dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T792262_Optimal_Off_Policy_Evaluation_from_Multiple_Logging_Policies.html">
   Optimal Off-Policy Evaluation from Multiple Logging Policies
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T167249_Offline_Policy_Evaluation_with_VW_Command_Line.html">
   Offline Policy Evaluation with VW Command Line
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T966055_OBP_Library_Workshop_Tutorials.html">
   OBP Library Workshop Tutorials
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T632722_PyTorch_Fundamentals_Part_1.html">
   PyTorch Fundamentals Part 1
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T472467_PyTorch_Fundamentals_Part_2.html">
   PyTorch Fundamentals Part 2
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T206654_PyTorch_Fundamentals_Part_3.html">
   PyTorch Fundamentals Part 3
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T536348_Attention_Mechanisms.html">
   Imports
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T500796_Agricultural_Satellite_Image_Segmentation.html">
   Agricultural Satellite Image Segmentation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T611432_Image_Analysis_with_Tensorflow.html">
   Image Analysis with Tensorflow
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T925716_MongoDB_to_CSV_Conversion.html">
   MongoDB to CSV conversion
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T396469_PDF_to_Word_Cloud_via_Email.html">
   PDF to WordCloud via Email
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T030890_Job_Scraping_and_Clustering.html">
   Job scraping and clustering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T897054_Scene_Text_Recognition.html">
   Scene Text Recognition
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T034809_Large_scale_Document_Retrieval_with_Elastic_Search.html">
   Large-scale Document Retrieval with ElasticSearch
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T467251_vowpal_wabbit_contextual_recommender.html">
   Simulating a news personalization scenario using Contextual Bandits
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T686684_similar_product_recommender.html">
   Similar Product Recommender system using Deep Learning for an online e-commerce store
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T132203_Retail_Product_Recommendations_using_Word2vec.html">
   Retail Product Recommendations using word2vec
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T501828_Recommender_Implicit_Negative_Feedback.html">
   Retail Product Recommendation with Negative Implicit Feedback
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T315965_Sequence_Aware_Recommenders_Music.html">
   Sequence Aware Recommender Systems
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T051777_image_similarity_recommendations.html">
   Similar Product Recommendations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990172_recobook_diversity_aware_book_recommender.html">
   Diversity Aware Book Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T488549_Goodreads_Diversity_Aware_Book_Recommender.html">
   Diversity Aware Book Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T023535_Kafka_MongoDB_Real_time_Streaming.html">
   Kafka MongoDB Real-time Streaming
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T622304_Session_based_Recommender_Using_Word2vec.html">
   Session-based recommendation using word2vec
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T416854_bandit_based_recommender_using_thompson_sampling_app.html">
   Bandit-based Online Learning using Thompson Sampling
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T198578_Booking_dot_com_Trip_Recommendation.html">
   Booking.com Trip Recommendation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T519734_Vowpal_Wabbit_Contextual_Bandit.html">
   Vowpal Wabbit Contextual Bandit
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T871537_Recommendation_Systems_using_Olist_Dataset.html">
   Recommendation systems using Olist dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T057885_Offline_Replayer_Evaluation.html">
   Offline Replayer Evaluation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T915054_method_for_effective_online_testing.html">
   Methods for effective online testing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T513987_Recsys_2020_Feature_Engineering_Tutorial.html">
   Recsys’20 Feature Engineering Tutorial
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T227901_amazon_personalize_batch_job.html">
   Amazon Personalize Batch Job
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T022961_Amazon_Personalize_Workshop.html">
   Amazon Personalize Workshop
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T424437_Collaborative_Filtering_on_ML_latest_small.html">
   Collaborative Filtering on ML-latest-small
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T539160_Building_and_Deploying_ASOS_Fashion_Recommender.html">
   Building and deploying ASOS fashion recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T757697_Simple_Similarity_based_Recommender.html">
   Simple Similarity based Recommmendations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T051594_Analytics_Zoo.html">
   Analytics Zoo
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T313645_A_B_Testing.html">
   A/B Testing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T475711_PinSage_Graph_based_Recommender.html">
   PinSage Graph-based Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T516490_Graph_Embeddings.html">
   Learn Embeddings using Graph Networks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T822164_movielens_milvus_redis_efficient_retrieval.html">
   Recommender with Redis and Milvus
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T845186_Anime_Recommender.html">
   RekoNet Anime Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T855843_kafka_spark_streaming_colab.html">
   Kafka and Spark Streaming in Colab
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T460437_Building_Models_From_Scratch.html">
   Building Models from scratch
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T855971_Conet_Model_for_Movie_Recommender.html">
   CoNet model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T996996_content_based_and_collaborative_movielens.html">
   Movie Recommendation with Content-Based and Collaborative Filtering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T239418_Simple_Movie_Recommenders.html">
   Simple Movie Recommenders
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T138337_Simple_Movie_Recommender.html">
   Simple movie recommender in implicit, explicit, and cold-start settings
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T935440_The_importance_of_Rating_Normalization.html">
   The importance of Rating Normalization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T612622_cornac_examples.html">
   Cornac Examples
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T561435_Flower_Classification.html">
   Flower classification
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T680910_Trivago_Session_based_Recommender.html">
   Trivago Session-based Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_ads_selection_using_bandits.html">
   Best Ads detection using bandit methods
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_book_crossing_surprise_svd_nmf.html">
   Book-Crossing Recommendation System
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_book_recommender_kubeflow.html">
   Books recommendations with Kubeflow Pipelines on Scaleway Kapsule
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_build_a_kubeflow_pipeline.html">
   Build a Kubeflow Pipeline
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_causal_inference.html">
   Causal Inference
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_concept_embedding_nlp.html">
   Exploring Word Embeddings
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_concept_neural_net.html">
   Neural Network
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_concept_nlp_basics.html">
   Natural Language Processing 101
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_concept_transformer_lm.html">
   TransformerLM Quick Start and Guide
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_content_based_music_recommender_lyricsfreak.html">
   Content-based method for song recommendation
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Recommender System Evaluations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_implicit_synthetic.html">
   Comparing Implicit Models on Synthetic Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_movie_recommender_tensorflow.html">
   Recommendation Systems with TensorFlow
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_movie_recommender_tensorflow_sagemaker.html">
   Movie recommender using Tensorflow in Sagemaker
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_movielens_eda_modeling.html">
   Movielens EDA and Modeling
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_read_data_from_cassandra_into_pandas.html">
   Read Cassandra Data Snapshot as DataFrame
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_rl_in_action.html">
   Reinforcement Learning fundamentals in action
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_rnn_cnn_basics.html">
   Processing sequences using RNNs and CNNs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_tf_serving_in_action.html">
   TF Serving in action
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_training_indexing_movie_recommender.html">
   Training and indexing movie recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T207114_EduRec_MOOCCube_Course_Recommender.html">
   EduRec MOOCCube Course Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T273184_Multi_Task_Learning.html">
   Multi-task Learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T661108_Book_Recommender_API.html">
   Book Recommender API
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T912764_Simple_Movie_Recommender_App.html">
   Simple Movie Recommender App
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T964554_Career_Village_Questions_Recommendation.html">
   CareerVillage Questions Recommendation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_amazon_women_apparel_tfidf_word2vec.html">
   Amazon Product Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_anime_recommender_graph_network.html">
   Anime Recommender with Bi-partite Graph Network
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_concept_self_attention.html">
   Self-Attention
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_course_recommender_svd_flask.html">
   Course Recommender with SVD based similarity
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_data_mining_similarity_measures.html">
   Concept - Data Mining Similarity Measures
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_jaccard_recommender.html">
   Jaccard Similarity based Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_live_streamer_recommender.html">
   Live Streamer Recommender with Implicit feedback
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_songs_embedding_skipgram_recommender.html">
   Song Embeddings - Skipgram Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_toy_example_car_recommender_knn.html">
   Toy example - Car Recommender using KNN method
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_wikirecs_recommender.html">
   WikiRecs
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/nbs/T990000_evaluation_metrics_basics.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/sparsh-ai/reco-book/main?urlpath=tree/nbs/T990000_evaluation_metrics_basics.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#part-1">
   Part 1
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#part-2">
   Part 2
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#hr-k">
     HR@K
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#precision-k">
     Precision@K
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#recall-k">
     Recall@K
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#map-k">
     MAP@K
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mrr-k">
     MRR@K
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ndcg-k">
     NDCG@K
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#part-3">
   Part 3
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#recall-dummy">
     Recall Dummy
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mrr-ndcg-dummy">
     MRR NDCG Dummy
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="recommender-system-evaluations">
<h1>Recommender System Evaluations<a class="headerlink" href="#recommender-system-evaluations" title="Permalink to this headline">¶</a></h1>
<div class="section" id="part-1">
<h2>Part 1<a class="headerlink" href="#part-1" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
 
<span class="k">def</span> <span class="nf">mean_reciprocal_rank</span><span class="p">(</span><span class="n">rs</span><span class="p">):</span>
  <span class="n">rs</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rs</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">size</span> <span class="k">else</span> <span class="mf">0.</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rs</span><span class="p">])</span>
 
<span class="n">mean_reciprocal_rank</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.611111111111111
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
 
<span class="k">def</span> <span class="nf">r_precision</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">z</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">r</span><span class="p">[:</span><span class="n">z</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
 
<span class="n">r_precision</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.5
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
 
<span class="k">def</span> <span class="nf">precision_at_k</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">k</span> <span class="o">&gt;=</span> <span class="mi">1</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">r</span><span class="p">)[:</span><span class="n">k</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="n">k</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Relevance score length &lt; k&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
 
<span class="n">precision_at_k</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.3333333333333333
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># import numpy as np</span>

<span class="k">def</span> <span class="nf">average_precision</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
    <span class="n">out</span> <span class="o">=</span> <span class="p">[</span><span class="n">precision_at_k</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="k">if</span> <span class="n">r</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">out</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

<span class="n">average_precision</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.41666666666666663
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">mean_average_precision</span><span class="p">(</span><span class="n">rs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">average_precision</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rs</span><span class="p">])</span>

<span class="n">mean_average_precision</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.4583333333333333
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">dcg_at_k</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asfarray</span><span class="p">(</span><span class="n">r</span><span class="p">)[:</span><span class="n">k</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">r</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)))</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">r</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;method must be 0 or 1.&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="mf">0.</span>

<span class="n">dcg_at_k</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>8.097171433256849
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">ndcg_at_k</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="n">dcg_max</span> <span class="o">=</span> <span class="n">dcg_at_k</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> <span class="n">k</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">dcg_max</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.</span>
    <span class="k">return</span> <span class="n">dcg_at_k</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span> <span class="o">/</span> <span class="n">dcg_max</span>

<span class="n">ndcg_at_k</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="mi">6</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.9488107485678985
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>

<span class="k">def</span> <span class="nf">novelty</span><span class="p">(</span><span class="n">predicted</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">list</span><span class="p">],</span> <span class="n">pop</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">u</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the novelty for a list of recommendations</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    predicted : a list of lists</span>
<span class="sd">        Ordered predictions</span>
<span class="sd">        example: [[&#39;X&#39;, &#39;Y&#39;, &#39;Z&#39;], [&#39;X&#39;, &#39;Y&#39;, &#39;Z&#39;]]</span>
<span class="sd">    pop: dictionary</span>
<span class="sd">        A dictionary of all items alongside of its occurrences counter in the training data</span>
<span class="sd">        example: {1198: 893, 1270: 876, 593: 876, 2762: 867}</span>
<span class="sd">    u: integer</span>
<span class="sd">        The number of users in the training data</span>
<span class="sd">    n: integer</span>
<span class="sd">        The length of recommended lists per user</span>
<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    novelty:</span>
<span class="sd">        The novelty of the recommendations in system level</span>
<span class="sd">    mean_self_information:</span>
<span class="sd">        The novelty of the recommendations in recommended top-N list level</span>
<span class="sd">    ----------    </span>
<span class="sd">    Metric Defintion:</span>
<span class="sd">    Zhou, T., Kuscsik, Z., Liu, J. G., Medo, M., Wakeling, J. R., &amp; Zhang, Y. C. (2010).</span>
<span class="sd">    Solving the apparent diversity-accuracy dilemma of recommender systems.</span>
<span class="sd">    Proceedings of the National Academy of Sciences, 107(10), 4511-4515.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mean_self_information</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">predicted</span><span class="p">:</span>
        <span class="n">self_information</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">:</span>
            <span class="n">self_information</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">pop</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">u</span><span class="p">))</span>
        <span class="n">mean_self_information</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">self_information</span><span class="o">/</span><span class="n">n</span><span class="p">)</span>
    <span class="n">novelty</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">mean_self_information</span><span class="p">)</span><span class="o">/</span><span class="n">k</span>
    <span class="k">return</span> <span class="n">novelty</span><span class="p">,</span> <span class="n">mean_self_information</span>

<span class="n">novelty</span><span class="p">([[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="s1">&#39;C&#39;</span><span class="p">],[</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="s1">&#39;A&#39;</span><span class="p">]],</span>
        <span class="p">{</span><span class="s1">&#39;A&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">},</span>
        <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(-1.9349400790728017, [-2.321928094887362, -1.5479520632582415])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>

<span class="k">def</span> <span class="nf">prediction_coverage</span><span class="p">(</span><span class="n">predicted</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">list</span><span class="p">],</span> <span class="n">catalog</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the prediction coverage for a list of recommendations</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    predicted : a list of lists</span>
<span class="sd">        Ordered predictions</span>
<span class="sd">        example: [[&#39;X&#39;, &#39;Y&#39;, &#39;Z&#39;], [&#39;X&#39;, &#39;Y&#39;, &#39;Z&#39;]]</span>
<span class="sd">    catalog: list</span>
<span class="sd">        A list of all unique items in the training data</span>
<span class="sd">        example: [&#39;A&#39;, &#39;B&#39;, &#39;C&#39;, &#39;X&#39;, &#39;Y&#39;, Z]</span>
<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    prediction_coverage:</span>
<span class="sd">        The prediction coverage of the recommendations as a percent</span>
<span class="sd">        rounded to 2 decimal places</span>
<span class="sd">    ----------    </span>
<span class="sd">    Metric Defintion:</span>
<span class="sd">    Ge, M., Delgado-Battenfeld, C., &amp; Jannach, D. (2010, September).</span>
<span class="sd">    Beyond accuracy: evaluating recommender systems by coverage and serendipity.</span>
<span class="sd">    In Proceedings of the fourth ACM conference on Recommender systems (pp. 257-260). ACM.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">predicted_flattened</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">predicted</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>
    <span class="n">unique_predictions</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">predicted_flattened</span><span class="p">))</span>
    <span class="n">prediction_coverage</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">unique_predictions</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">catalog</span><span class="p">)</span><span class="o">*</span> <span class="mf">1.0</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">prediction_coverage</span>

<span class="n">prediction_coverage</span><span class="p">([[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="s1">&#39;D&#39;</span><span class="p">],[</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;C&#39;</span><span class="p">]],</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="s1">&#39;C&#39;</span><span class="p">,</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="s1">&#39;E&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>80.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>

<span class="k">def</span> <span class="nf">catalog_coverage</span><span class="p">(</span><span class="n">predicted</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">list</span><span class="p">],</span> <span class="n">catalog</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the catalog coverage for k lists of recommendations</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    predicted : a list of lists</span>
<span class="sd">        Ordered predictions</span>
<span class="sd">        example: [[&#39;X&#39;, &#39;Y&#39;, &#39;Z&#39;], [&#39;X&#39;, &#39;Y&#39;, &#39;Z&#39;]]</span>
<span class="sd">    catalog: list</span>
<span class="sd">        A list of all unique items in the training data</span>
<span class="sd">        example: [&#39;A&#39;, &#39;B&#39;, &#39;C&#39;, &#39;X&#39;, &#39;Y&#39;, Z]</span>
<span class="sd">    k: integer</span>
<span class="sd">        The number of observed recommendation lists</span>
<span class="sd">        which randomly choosed in our offline setup</span>
<span class="sd">    Returns</span>
<span class="sd">    ----------</span>
<span class="sd">    catalog_coverage:</span>
<span class="sd">        The catalog coverage of the recommendations as a percent</span>
<span class="sd">        rounded to 2 decimal places</span>
<span class="sd">    ----------    </span>
<span class="sd">    Metric Defintion:</span>
<span class="sd">    Ge, M., Delgado-Battenfeld, C., &amp; Jannach, D. (2010, September).</span>
<span class="sd">    Beyond accuracy: evaluating recommender systems by coverage and serendipity.</span>
<span class="sd">    In Proceedings of the fourth ACM conference on Recommender systems (pp. 257-260). ACM.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sampling</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">predicted</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
    <span class="n">predicted_flattened</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">sampling</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>
    <span class="n">L_predictions</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">predicted_flattened</span><span class="p">))</span>
    <span class="n">catalog_coverage</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">L_predictions</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">catalog</span><span class="p">)</span><span class="o">*</span><span class="mf">1.0</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">catalog_coverage</span>

<span class="n">catalog_coverage</span><span class="p">([[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="s1">&#39;D&#39;</span><span class="p">],[</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;C&#39;</span><span class="p">],[</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;D&#39;</span><span class="p">]],</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="s1">&#39;C&#39;</span><span class="p">,</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="s1">&#39;E&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>80.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">recall_at_k</span><span class="p">(</span><span class="n">actual</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">predicted</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">predicted</span><span class="p">)</span><span class="o">&gt;</span><span class="n">k</span><span class="p">:</span>
    <span class="n">predicted</span> <span class="o">=</span> <span class="n">predicted</span><span class="p">[:</span><span class="n">k</span><span class="p">]</span>
  <span class="n">score</span> <span class="o">=</span> <span class="mf">0.0</span>
  <span class="n">num_hits</span> <span class="o">=</span> <span class="mf">0.0</span>
  <span class="k">if</span> <span class="n">actual</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">predicted</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">actual</span> <span class="ow">and</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">predicted</span><span class="p">[:</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">num_hits</span> <span class="o">+=</span> <span class="mf">1.0</span>
            <span class="n">score</span> <span class="o">+=</span> <span class="n">num_hits</span> <span class="o">/</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">score</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">actual</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">return</span> <span class="mf">0.0</span>

<span class="n">recall_at_k</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span><span class="mi">4</span><span class="p">),</span> \
<span class="n">recall_at_k</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(0.4, 0.2)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">mean_average_recall</span><span class="p">(</span><span class="n">actual</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">list</span><span class="p">],</span> <span class="n">predicted</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">list</span><span class="p">],</span> <span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">recall_at_k</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">actual</span><span class="p">,</span> <span class="n">predicted</span><span class="p">)])</span>

<span class="n">mean_average_recall</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">]],</span>
                    <span class="p">[[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">]],</span>
                    <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.225
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sqrt</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>

<span class="k">def</span> <span class="nf">mse</span><span class="p">(</span><span class="n">y</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">yhat</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="n">mse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">yhat</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mse</span>

<span class="k">def</span> <span class="nf">rmse</span><span class="p">(</span><span class="n">y</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">yhat</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">yhat</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">rmse</span>

<span class="n">rmse</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.1547005383792515
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">product</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.sparse</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">confusion_matrix</span>

<span class="k">def</span> <span class="nf">make_confusion_matrix</span><span class="p">(</span><span class="n">y</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">yhat</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">yhat</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">cm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="n">cm</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span><span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>

    <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;.2f&quot;</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">/</span> <span class="mf">2.</span> <span class="c1"># TODO: Unused argument</span>
    <span class="n">descriptions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="s2">&quot;True Positive&quot;</span><span class="p">,</span> <span class="s2">&quot;False Negative&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;False Positive&quot;</span><span class="p">,</span> <span class="s2">&quot;True Negatives&quot;</span><span class="p">]])</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="s2">&quot;red&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">]])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]],</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Greys</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">range</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="nb">format</span><span class="p">(</span><span class="n">cm</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">fmt</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;%</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">descriptions</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span>
                     <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                     <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;True&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Predicted&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Confusion Matrix&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">make_confusion_matrix</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/T990000_evaluation_metrics_basics_15_0.png" src="../_images/T990000_evaluation_metrics_basics_15_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">product</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sqrt</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">scipy.sparse</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics.pairwise</span> <span class="kn">import</span> <span class="n">cosine_similarity</span>

<span class="k">def</span> <span class="nf">personalization</span><span class="p">(</span><span class="n">predicted</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">list</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Personalization measures recommendation similarity across users.</span>
<span class="sd">    A high score indicates good personalization (user&#39;s lists of recommendations are different).</span>
<span class="sd">    A low score indicates poor personalization (user&#39;s lists of recommendations are very similar).</span>
<span class="sd">    A model is &quot;personalizing&quot; well if the set of recommendations for each user is different.</span>
<span class="sd">    Parameters:</span>
<span class="sd">    ----------</span>
<span class="sd">    predicted : a list of lists</span>
<span class="sd">        Ordered predictions</span>
<span class="sd">        example: [[&#39;X&#39;, &#39;Y&#39;, &#39;Z&#39;], [&#39;X&#39;, &#39;Y&#39;, &#39;Z&#39;]]</span>
<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">        The personalization score for all recommendations.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">make_rec_matrix</span><span class="p">(</span><span class="n">predicted</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">list</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">sp</span><span class="o">.</span><span class="n">csr_matrix</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">predicted</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span>
            <span class="n">id_vars</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s1">&#39;item&#39;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="s1">&#39;item&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;item&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;item&#39;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">*</span><span class="mi">1</span>
        <span class="n">rec_matrix</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">csr_matrix</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rec_matrix</span>

    <span class="c1">#create matrix for recommendations</span>
    <span class="n">predicted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">predicted</span><span class="p">)</span>
    <span class="n">rec_matrix_sparse</span> <span class="o">=</span> <span class="n">make_rec_matrix</span><span class="p">(</span><span class="n">predicted</span><span class="p">)</span>

    <span class="c1">#calculate similarity for every user&#39;s recommendation list</span>
    <span class="n">similarity</span> <span class="o">=</span> <span class="n">cosine_similarity</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">rec_matrix_sparse</span><span class="p">,</span> <span class="n">dense_output</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1">#get indicies for upper right triangle w/o diagonal</span>
    <span class="n">upper_right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">triu_indices</span><span class="p">(</span><span class="n">similarity</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1">#calculate average similarity</span>
    <span class="n">personalization</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">similarity</span><span class="p">[</span><span class="n">upper_right</span><span class="p">])</span>
    <span class="k">return</span> <span class="mi">1</span><span class="o">-</span><span class="n">personalization</span>

<span class="k">def</span> <span class="nf">_single_list_similarity</span><span class="p">(</span><span class="n">predicted</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">feature_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">u</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the intra-list similarity for a single list of recommendations.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    predicted : a list</span>
<span class="sd">        Ordered predictions</span>
<span class="sd">        Example: [&#39;X&#39;, &#39;Y&#39;, &#39;Z&#39;]</span>
<span class="sd">    feature_df: dataframe</span>
<span class="sd">        A dataframe with one hot encoded or latent features.</span>
<span class="sd">        The dataframe should be indexed by the id used in the recommendations.</span>
<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    ils_single_user: float</span>
<span class="sd">        The intra-list similarity for a single list of recommendations.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># exception predicted list empty</span>
    <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">predicted</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Predicted list is empty, index: </span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">u</span><span class="p">))</span>

    <span class="c1">#get features for all recommended items</span>
    <span class="n">recs_content</span> <span class="o">=</span> <span class="n">feature_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">predicted</span><span class="p">]</span>
    <span class="n">recs_content</span> <span class="o">=</span> <span class="n">recs_content</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">recs_content</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">csr_matrix</span><span class="p">(</span><span class="n">recs_content</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

    <span class="c1">#calculate similarity scores for all items in list</span>
    <span class="n">similarity</span> <span class="o">=</span> <span class="n">cosine_similarity</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">recs_content</span><span class="p">,</span> <span class="n">dense_output</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1">#get indicies for upper right triangle w/o diagonal</span>
    <span class="n">upper_right</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">triu_indices</span><span class="p">(</span><span class="n">similarity</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1">#calculate average similarity score of all recommended items in list</span>
    <span class="n">ils_single_user</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">similarity</span><span class="p">[</span><span class="n">upper_right</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">ils_single_user</span>

<span class="k">def</span> <span class="nf">intra_list_similarity</span><span class="p">(</span><span class="n">predicted</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">list</span><span class="p">],</span> <span class="n">feature_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the average intra-list similarity of all recommendations.</span>
<span class="sd">    This metric can be used to measure diversity of the list of recommended items.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    predicted : a list of lists</span>
<span class="sd">        Ordered predictions</span>
<span class="sd">        Example: [[&#39;X&#39;, &#39;Y&#39;, &#39;Z&#39;], [&#39;X&#39;, &#39;Y&#39;, &#39;Z&#39;]]</span>
<span class="sd">    feature_df: dataframe</span>
<span class="sd">        A dataframe with one hot encoded or latent features.</span>
<span class="sd">        The dataframe should be indexed by the id used in the recommendations.</span>
<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">        The average intra-list similarity for recommendations.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">feature_df</span> <span class="o">=</span> <span class="n">feature_df</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">Users</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">predicted</span><span class="p">))</span>
    <span class="n">ils</span> <span class="o">=</span> <span class="p">[</span><span class="n">_single_list_similarity</span><span class="p">(</span><span class="n">predicted</span><span class="p">[</span><span class="n">u</span><span class="p">],</span> <span class="n">feature_df</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">Users</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ils</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!pip install -q funcsigs

import matplotlib.pyplot as plt
import numpy as np
import pandas as pd
import plotly.graph_objects as go
import seaborn as sns
from funcsigs import signature
from matplotlib.lines import Line2D
from sklearn.metrics import (auc, average_precision_score,
                             precision_recall_curve, roc_curve)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">long_tail_plot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">item_id_column</span><span class="p">,</span> <span class="n">interaction_type</span><span class="p">,</span> <span class="n">percentage</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots the long tail for a user-item interaction dataset.</span>
<span class="sd">    ----------</span>
<span class="sd">    df: pandas dataframe</span>
<span class="sd">        user-item interaction dataframe</span>
<span class="sd">        example:</span>
<span class="sd">    item_id_column: str</span>
<span class="sd">        column name identifying the item ids in the dataframe</span>
<span class="sd">    interaction_type: str</span>
<span class="sd">        type of user-item interactions</span>
<span class="sd">        i.e. &#39;purchases&#39;, &#39;ratings&#39; &#39;interactions&#39;, or &#39;clicks&#39;</span>
<span class="sd">    percentage: float, default=None</span>
<span class="sd">        percent of volume to consider as the head (percent as a decimal)</span>
<span class="sd">        (if default=None no line will be plotted)</span>
<span class="sd">    x_tables bool, default=True</span>
<span class="sd">        if True, plot x-axis tick labels</span>
<span class="sd">        if False, no x-axis tick lavels will be plotted.</span>
<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">        A long tail plot</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#calculate cumulative volumes</span>
    <span class="n">volume_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">item_id_column</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="n">volume_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">item_id_column</span><span class="p">,</span> <span class="s2">&quot;volume&quot;</span><span class="p">]</span>
    <span class="n">volume_df</span><span class="p">[</span><span class="n">item_id_column</span><span class="p">]</span> <span class="o">=</span> <span class="n">volume_df</span><span class="p">[</span><span class="n">item_id_column</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">volume_df</span><span class="p">[</span><span class="s1">&#39;cumulative_volume&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">volume_df</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
    <span class="n">volume_df</span><span class="p">[</span><span class="s1">&#39;percent_of_total_volume&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">volume_df</span><span class="p">[</span><span class="s1">&#39;cumulative_volume&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">volume_df</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="c1">#line plot of cumulative volume</span>
    <span class="n">x</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">volume_df</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;volume&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">volume_df</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="c1">#set labels</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Long Tail Plot&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;# of &#39;</span> <span class="o">+</span> <span class="n">interaction_type</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">item_id_column</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">percentage</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1">#plot vertical line at the tail location</span>
        <span class="n">head</span> <span class="o">=</span> <span class="n">volume_df</span><span class="p">[</span><span class="n">volume_df</span><span class="p">[</span><span class="s2">&quot;percent_of_total_volume&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">percentage</span><span class="p">]</span>
        <span class="n">tail</span> <span class="o">=</span> <span class="n">volume_df</span><span class="p">[</span><span class="n">volume_df</span><span class="p">[</span><span class="s2">&quot;percent_of_total_volume&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">percentage</span><span class="p">]</span>
        <span class="n">items_in_head</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">head</span><span class="p">)</span>
        <span class="n">items_in_tail</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tail</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">items_in_head</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>  <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

        <span class="c1"># fill area under plot</span>
        <span class="n">head</span> <span class="o">=</span> <span class="n">head</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tail</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="n">head</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="n">head</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="n">tail</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="n">tail</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span>  <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

        <span class="c1">#create legend</span>
        <span class="n">legend_elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">items_in_head</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;: items in the head&#39;</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>
                           <span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">items_in_tail</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;: items in the tail&#39;</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">5</span><span class="p">)]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">legend_elements</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="n">volume_df</span><span class="p">[</span><span class="n">item_id_column</span><span class="p">]</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="n">volume_df</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">x_labels</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([],</span> <span class="p">[])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xticklabels</span><span class="o">=</span><span class="p">[])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">labels</span> <span class="o">=</span> <span class="n">volume_df</span><span class="p">[</span><span class="n">item_id_column</span><span class="p">],</span> <span class="n">rotation</span> <span class="o">=</span> <span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">coverage_plot</span><span class="p">(</span><span class="n">coverage_scores</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">model_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots the coverage for a set of models to compare.</span>
<span class="sd">    ----------</span>
<span class="sd">    coverage_scores: list</span>
<span class="sd">        list of coverage scores in same order as model_names</span>
<span class="sd">        example: [0.17, 0.25, 0.76]</span>
<span class="sd">    model_names: list</span>
<span class="sd">        list of model names in same order as coverage_scores</span>
<span class="sd">        example: [&#39;Model A&#39;, &#39;Model B&#39;, &#39;Model C&#39;]</span>
<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">        A coverage plot</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#create palette</span>
    <span class="n">recommender_palette</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;#ED2BFF&quot;</span><span class="p">,</span> <span class="s2">&quot;#14E2C0&quot;</span><span class="p">,</span> <span class="s2">&quot;#FF9F1C&quot;</span><span class="p">,</span> <span class="s2">&quot;#5E2BFF&quot;</span><span class="p">,</span><span class="s2">&quot;#FC5FA3&quot;</span><span class="p">]</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">set_palette</span><span class="p">(</span><span class="n">recommender_palette</span><span class="p">)</span>

    <span class="c1">#make barplot</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">model_names</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">coverage_scores</span><span class="p">)</span>

    <span class="c1">#set labels</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Catalog Coverage in %&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;coverage&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">coverage_plot</span><span class="p">([</span><span class="mf">0.17</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.76</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Model A&#39;</span><span class="p">,</span> <span class="s1">&#39;Model B&#39;</span><span class="p">,</span> <span class="s1">&#39;Model C&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/T990000_evaluation_metrics_basics_19_0.png" src="../_images/T990000_evaluation_metrics_basics_19_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">mark_plot</span><span class="p">(</span><span class="n">mark_scores</span><span class="p">,</span> <span class="n">model_names</span><span class="p">,</span> <span class="n">k_range</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots the mean average recall at k for a set of models to compare.</span>
<span class="sd">    ----------</span>
<span class="sd">    mark_scores: list of lists</span>
<span class="sd">        list of list of mar@k scores over k. This list is in same order as model_names</span>
<span class="sd">        example: [[0.17, 0.25, 0.76],[0.2, 0.5, 0.74]]</span>
<span class="sd">    model_names: list</span>
<span class="sd">        list of model names in same order as coverage_scores</span>
<span class="sd">        example: [&#39;Model A&#39;, &#39;Model B&#39;]</span>
<span class="sd">    k_range: list</span>
<span class="sd">        list or array identifying all k values in order</span>
<span class="sd">        example: [1,2,3,4,5,6,7,8,9,10]</span>
<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">        A mar@k plot</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#create palette</span>
    <span class="n">recommender_palette</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;#ED2BFF&quot;</span><span class="p">,</span> <span class="s2">&quot;#14E2C0&quot;</span><span class="p">,</span> <span class="s2">&quot;#FF9F1C&quot;</span><span class="p">,</span> <span class="s2">&quot;#5E2BFF&quot;</span><span class="p">,</span><span class="s2">&quot;#FC5FA3&quot;</span><span class="p">]</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">set_palette</span><span class="p">(</span><span class="n">recommender_palette</span><span class="p">)</span>

    <span class="c1">#lineplot</span>
    <span class="n">mark_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(</span><span class="n">mark_scores</span><span class="p">),</span> <span class="n">k_range</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">model_names</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mark_df</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">k_range</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">lines</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="c1">#set labels</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Mean Average Recall at K (MAR@K) Comparison&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;MAR@K&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;K&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">mark_plot</span><span class="p">([[</span><span class="mf">0.17</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.76</span><span class="p">],[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.74</span><span class="p">]],</span>
          <span class="p">[</span><span class="s1">&#39;Model A&#39;</span><span class="p">,</span> <span class="s1">&#39;Model B&#39;</span><span class="p">],</span>
          <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/T990000_evaluation_metrics_basics_20_0.png" src="../_images/T990000_evaluation_metrics_basics_20_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">mapk_plot</span><span class="p">(</span><span class="n">mapk_scores</span><span class="p">,</span> <span class="n">model_names</span><span class="p">,</span> <span class="n">k_range</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots the mean average precision at k for a set of models to compare.</span>
<span class="sd">    ----------</span>
<span class="sd">    mapk_scores: list of lists</span>
<span class="sd">        list of list of map@k scores over k. This lis is in same order as model_names</span>
<span class="sd">        example: [[0.17, 0.25, 0.76],[0.2, 0.5, 0.74]]</span>
<span class="sd">    model_names: list</span>
<span class="sd">        list of model names in same order as coverage_scores</span>
<span class="sd">        example: [&#39;Model A&#39;, &#39;Model B&#39;]</span>
<span class="sd">    k_range: list</span>
<span class="sd">        list or array indeitifying all k values in order</span>
<span class="sd">        example: [1,2,3,4,5,6,7,8,9,10]</span>
<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">        A map@k plot</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#create palette</span>
    <span class="n">recommender_palette</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;#ED2BFF&quot;</span><span class="p">,</span> <span class="s2">&quot;#14E2C0&quot;</span><span class="p">,</span> <span class="s2">&quot;#FF9F1C&quot;</span><span class="p">,</span> <span class="s2">&quot;#5E2BFF&quot;</span><span class="p">,</span><span class="s2">&quot;#FC5FA3&quot;</span><span class="p">]</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">set_palette</span><span class="p">(</span><span class="n">recommender_palette</span><span class="p">)</span>

    <span class="c1">#lineplot</span>
    <span class="n">mapk_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(</span><span class="n">mapk_scores</span><span class="p">),</span> <span class="n">k_range</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">model_names</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mapk_df</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">k_range</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">lines</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="c1">#set labels</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Mean Average Precision at K (MAP@K) Comparison&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;MAP@K&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;K&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">mapk_plot</span><span class="p">([[</span><span class="mf">0.17</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.76</span><span class="p">],[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.74</span><span class="p">]],</span>
          <span class="p">[</span><span class="s1">&#39;Model A&#39;</span><span class="p">,</span> <span class="s1">&#39;Model B&#39;</span><span class="p">],</span>
          <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/T990000_evaluation_metrics_basics_21_0.png" src="../_images/T990000_evaluation_metrics_basics_21_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">roc_plot</span><span class="p">(</span><span class="n">actual</span><span class="p">,</span> <span class="n">model_probs</span><span class="p">,</span> <span class="n">model_names</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Receiver Operating Characteristic Plot. Can plot multiple models.</span>
<span class="sd">    ----------</span>
<span class="sd">    actual: array of dataframe of true classes assignements.</span>
<span class="sd">        example:</span>
<span class="sd">        [1,1,0,1,0]</span>
<span class="sd">    model_probs: list of arrays</span>
<span class="sd">        a list containing classification probabilites for each model in order.</span>
<span class="sd">        example:</span>
<span class="sd">        model_probs = [class_probs_1, class_probs_2]</span>
<span class="sd">    model_names: list of strings</span>
<span class="sd">        a list containing names for each model in order.</span>
<span class="sd">        example:</span>
<span class="sd">        model_names = [&quot;GBT&quot;, &quot;Logistic Regression&quot;]</span>
<span class="sd">    figsize: size of figure</span>
<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">        Receiver Operating Characteristic Plot with AUC in the legend.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">model_names</span> <span class="o">=</span> <span class="n">make_listy</span><span class="p">(</span><span class="n">model_names</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_listy</span><span class="p">(</span><span class="n">model_probs</span><span class="p">):</span> <span class="n">model_probs</span> <span class="o">=</span> <span class="p">[</span><span class="n">model_probs</span><span class="p">]</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_names</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
        <span class="k">return</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can only compare 5 models or less.&quot;</span><span class="p">)</span>

    <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;#ED2BFF&quot;</span><span class="p">,</span> <span class="s2">&quot;#14E2C0&quot;</span><span class="p">,</span> <span class="s2">&quot;#FF9F1C&quot;</span><span class="p">,</span> <span class="s2">&quot;#5E2BFF&quot;</span><span class="p">,</span><span class="s2">&quot;#FC5FA3&quot;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">model_names</span><span class="p">)):</span>
        <span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">roc_curve</span><span class="p">(</span><span class="n">actual</span><span class="p">,</span> <span class="n">model_probs</span><span class="p">[</span><span class="n">m</span><span class="p">])</span>
        <span class="n">roc_auc</span> <span class="o">=</span> <span class="n">auc</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">fpr</span><span class="p">,</span>
                          <span class="n">y</span><span class="o">=</span><span class="n">tpr</span><span class="p">,</span>
                          <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                          <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">m</span><span class="p">],</span>
                          <span class="n">label</span> <span class="o">=</span> <span class="n">model_names</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; AUC = </span><span class="si">%0.4f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">roc_auc</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;r--&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Receiver Operating Characteristic Plot&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;True Positive Rate&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;False Positive Rate&#39;</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">precision_recall_plot</span><span class="p">(</span><span class="n">targs</span><span class="p">,</span> <span class="n">preds</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots the precision recall curve</span>
<span class="sd">    ----------</span>
<span class="sd">    targs: array-like true class labels</span>
<span class="sd">    preds: array-like predicted probabilities</span>
<span class="sd">    figsize: size of figure</span>
<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">        A precision and recall curve</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">average_precision</span> <span class="o">=</span> <span class="n">average_precision_score</span><span class="p">(</span><span class="n">targs</span><span class="p">,</span> <span class="n">preds</span><span class="p">)</span>
    <span class="n">precision</span><span class="p">,</span> <span class="n">recall</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">precision_recall_curve</span><span class="p">(</span><span class="n">targs</span><span class="p">,</span> <span class="n">preds</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    <span class="n">step_kwargs</span> <span class="o">=</span> <span class="p">({</span><span class="s1">&#39;step&#39;</span><span class="p">:</span> <span class="s1">&#39;post&#39;</span><span class="p">}</span>
                   <span class="k">if</span> <span class="s1">&#39;step&#39;</span> <span class="ow">in</span> <span class="n">signature</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">)</span><span class="o">.</span><span class="n">parameters</span>
                   <span class="k">else</span> <span class="p">{})</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">recall</span><span class="p">,</span> <span class="n">precision</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
             <span class="n">where</span><span class="o">=</span><span class="s1">&#39;post&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">recall</span><span class="p">,</span> <span class="n">precision</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">step_kwargs</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Recall&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Precision&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;2-class Precision-Recall curve: AP=</span><span class="si">{0:0.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">average_precision</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">make_listy</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span> <span class="k">return</span> <span class="p">[</span><span class="n">p</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">_</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">p</span>


<span class="k">def</span> <span class="nf">is_listy</span><span class="p">(</span><span class="n">x</span><span class="p">):</span> <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">metrics_plot</span><span class="p">(</span><span class="n">model_names</span><span class="p">,</span> <span class="n">metric_names</span><span class="p">,</span> <span class="n">scores</span><span class="p">):</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">model_name</span><span class="p">,</span> <span class="o">*</span><span class="n">vals</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">model_names</span><span class="p">,</span> <span class="o">*</span><span class="n">scores</span><span class="p">):</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatterpolar</span><span class="p">(</span>
              <span class="n">r</span><span class="o">=</span><span class="n">vals</span><span class="p">,</span>
              <span class="n">theta</span><span class="o">=</span><span class="n">metric_names</span><span class="p">,</span>
              <span class="n">fill</span><span class="o">=</span><span class="s1">&#39;tonext&#39;</span><span class="p">,</span>
              <span class="n">name</span><span class="o">=</span><span class="n">model_name</span>
        <span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
      <span class="n">polar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">radialaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
          <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
          <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>
        <span class="p">)),</span>
      <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">metrics_plot</span><span class="p">([</span><span class="s1">&#39;Model A&#39;</span><span class="p">,</span> <span class="s1">&#39;Model B&#39;</span><span class="p">,</span> <span class="s1">&#39;Model C&#39;</span><span class="p">],</span>
             <span class="p">[</span><span class="s1">&#39;Coverage&#39;</span><span class="p">,</span><span class="s1">&#39;Personalization&#39;</span><span class="p">,</span><span class="s1">&#39;Diversity&#39;</span><span class="p">],</span>
             <span class="p">[[</span><span class="mi">17</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">76</span><span class="p">],</span>
              <span class="p">[</span><span class="mi">43</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">44</span><span class="p">],</span>
              <span class="p">[</span><span class="mi">23</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">69</span><span class="p">]])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><html>
<head><meta charset="utf-8" /></head>
<body>
    <div>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_SVG"></script><script type="text/javascript">if (window.MathJax) {MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}</script>
                <script type="text/javascript">window.PlotlyConfig = {MathJaxConfig: 'local'};</script>
        <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>    
            <div id="9a2c560b-8f46-4b94-94c9-a1a2a793d222" class="plotly-graph-div" style="height:525px; width:100%;"></div>
            <script type="text/javascript">

                    window.PLOTLYENV=window.PLOTLYENV || {};

                if (document.getElementById("9a2c560b-8f46-4b94-94c9-a1a2a793d222")) {
                    Plotly.newPlot(
                        '9a2c560b-8f46-4b94-94c9-a1a2a793d222',
                        [{"fill": "tonext", "name": "Model A", "r": [17, 43, 23], "theta": ["Coverage", "Personalization", "Diversity"], "type": "scatterpolar"}, {"fill": "tonext", "name": "Model B", "r": [25, 23, 21], "theta": ["Coverage", "Personalization", "Diversity"], "type": "scatterpolar"}, {"fill": "tonext", "name": "Model C", "r": [76, 44, 69], "theta": ["Coverage", "Personalization", "Diversity"], "type": "scatterpolar"}],
                        {"polar": {"radialaxis": {"range": [0, 100], "visible": true}}, "showlegend": true, "template": {"data": {"bar": [{"error_x": {"color": "#2a3f5f"}, "error_y": {"color": "#2a3f5f"}, "marker": {"line": {"color": "#E5ECF6", "width": 0.5}}, "type": "bar"}], "barpolar": [{"marker": {"line": {"color": "#E5ECF6", "width": 0.5}}, "type": "barpolar"}], "carpet": [{"aaxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "baxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "type": "carpet"}], "choropleth": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "type": "choropleth"}], "contour": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "contour"}], "contourcarpet": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "type": "contourcarpet"}], "heatmap": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "heatmap"}], "heatmapgl": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "heatmapgl"}], "histogram": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "histogram"}], "histogram2d": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "histogram2d"}], "histogram2dcontour": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "histogram2dcontour"}], "mesh3d": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "type": "mesh3d"}], "parcoords": [{"line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "parcoords"}], "pie": [{"automargin": true, "type": "pie"}], "scatter": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scatter"}], "scatter3d": [{"line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scatter3d"}], "scattercarpet": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scattercarpet"}], "scattergeo": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scattergeo"}], "scattergl": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scattergl"}], "scattermapbox": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scattermapbox"}], "scatterpolar": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scatterpolar"}], "scatterpolargl": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scatterpolargl"}], "scatterternary": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scatterternary"}], "surface": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "surface"}], "table": [{"cells": {"fill": {"color": "#EBF0F8"}, "line": {"color": "white"}}, "header": {"fill": {"color": "#C8D4E3"}, "line": {"color": "white"}}, "type": "table"}]}, "layout": {"annotationdefaults": {"arrowcolor": "#2a3f5f", "arrowhead": 0, "arrowwidth": 1}, "coloraxis": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "colorscale": {"diverging": [[0, "#8e0152"], [0.1, "#c51b7d"], [0.2, "#de77ae"], [0.3, "#f1b6da"], [0.4, "#fde0ef"], [0.5, "#f7f7f7"], [0.6, "#e6f5d0"], [0.7, "#b8e186"], [0.8, "#7fbc41"], [0.9, "#4d9221"], [1, "#276419"]], "sequential": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "sequentialminus": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}, "colorway": ["#636efa", "#EF553B", "#00cc96", "#ab63fa", "#FFA15A", "#19d3f3", "#FF6692", "#B6E880", "#FF97FF", "#FECB52"], "font": {"color": "#2a3f5f"}, "geo": {"bgcolor": "white", "lakecolor": "white", "landcolor": "#E5ECF6", "showlakes": true, "showland": true, "subunitcolor": "white"}, "hoverlabel": {"align": "left"}, "hovermode": "closest", "mapbox": {"style": "light"}, "paper_bgcolor": "white", "plot_bgcolor": "#E5ECF6", "polar": {"angularaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "bgcolor": "#E5ECF6", "radialaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "scene": {"xaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "gridwidth": 2, "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white"}, "yaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "gridwidth": 2, "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white"}, "zaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "gridwidth": 2, "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white"}}, "shapedefaults": {"line": {"color": "#2a3f5f"}}, "ternary": {"aaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "baxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "bgcolor": "#E5ECF6", "caxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "title": {"x": 0.05}, "xaxis": {"automargin": true, "gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "zerolinewidth": 2}, "yaxis": {"automargin": true, "gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "zerolinewidth": 2}}}},
                        {"responsive": true}
                    ).then(function(){

var gd = document.getElementById('9a2c560b-8f46-4b94-94c9-a1a2a793d222');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })
                };

            </script>
        </div>
</body>
</html></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!pip install -q git+https://github.com/sparsh-ai/recochef.git
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Installing build dependencies ... ?25l?25hdone
  Getting requirements to build wheel ... ?25l?25hdone
    Preparing wheel metadata ... ?25l?25hdone
     |████████████████████████████████| 4.3MB 9.3MB/s 
?25h  Building wheel for recochef (PEP 517) ... ?25l?25hdone
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">recochef.datasets.movielens</span> <span class="kn">import</span> <span class="n">MovieLens</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">MovieLens</span><span class="p">()</span>
<span class="n">ratings</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">load_interactions</span><span class="p">()</span>
<span class="n">ratings</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>USERID</th>
      <th>ITEMID</th>
      <th>RATING</th>
      <th>TIMESTAMP</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>196</td>
      <td>242</td>
      <td>3.0</td>
      <td>881250949</td>
    </tr>
    <tr>
      <th>1</th>
      <td>186</td>
      <td>302</td>
      <td>3.0</td>
      <td>891717742</td>
    </tr>
    <tr>
      <th>2</th>
      <td>22</td>
      <td>377</td>
      <td>1.0</td>
      <td>878887116</td>
    </tr>
    <tr>
      <th>3</th>
      <td>244</td>
      <td>51</td>
      <td>2.0</td>
      <td>880606923</td>
    </tr>
    <tr>
      <th>4</th>
      <td>166</td>
      <td>346</td>
      <td>1.0</td>
      <td>886397596</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">long_tail_plot</span><span class="p">(</span><span class="n">ratings</span><span class="p">,</span> <span class="s1">&#39;ITEMID&#39;</span><span class="p">,</span> <span class="s1">&#39;ratings&#39;</span><span class="p">,</span> <span class="n">percentage</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">x_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/T990000_evaluation_metrics_basics_26_0.png" src="../_images/T990000_evaluation_metrics_basics_26_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>


<span class="k">def</span> <span class="nf">sequential_evaluation</span><span class="p">(</span><span class="n">recommender</span><span class="p">,</span>
                          <span class="n">test_sequences</span><span class="p">,</span>
                          <span class="n">evaluation_functions</span><span class="p">,</span>
                          <span class="n">users</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="n">given_k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">look_ahead</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                          <span class="n">top_n</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                          <span class="n">scroll</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs sequential evaluation of a recommender over a set of test sequences</span>
<span class="sd">    :param recommender: the instance of the recommender to test</span>
<span class="sd">    :param test_sequences: the set of test sequences</span>
<span class="sd">    :param evaluation_functions: list of evaluation metric functions</span>
<span class="sd">    :param users: (optional) the list of user ids associated to each test sequence. Required by personalized models like FPMC.</span>
<span class="sd">    :param given_k: (optional) the initial size of each user profile, starting from the first interaction in the sequence.</span>
<span class="sd">                    If &lt;0, start counting from the end of the sequence. It must be != 0.</span>
<span class="sd">    :param look_ahead: (optional) number of subsequent interactions in the sequence to be considered as ground truth.</span>
<span class="sd">                    It can be any positive number or &#39;all&#39; to extend the ground truth until the end of the sequence.</span>
<span class="sd">    :param top_n: (optional) size of the recommendation list</span>
<span class="sd">    :param scroll: (optional) whether to scroll the ground truth until the end of the sequence.</span>
<span class="sd">                If True, expand the user profile and move the ground truth forward of `step` interactions. Recompute and evaluate recommendations every time.</span>
<span class="sd">                If False, evaluate recommendations once per sequence without expanding the user profile.</span>
<span class="sd">    :param step: (optional) number of interactions that will be added to the user profile at each step of the sequential evaluation.</span>
<span class="sd">    :return: the list of the average values for each evaluation metric</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">given_k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;given_k must be != 0&#39;</span><span class="p">)</span>

    <span class="n">metrics</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">evaluation_functions</span><span class="p">))</span>
    <span class="k">with</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">test_sequences</span><span class="p">))</span> <span class="k">as</span> <span class="n">pbar</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">test_seq</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">test_sequences</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">users</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">user</span> <span class="o">=</span> <span class="n">users</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">user</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">scroll</span><span class="p">:</span>
                <span class="n">metrics</span> <span class="o">+=</span> <span class="n">sequence_sequential_evaluation</span><span class="p">(</span><span class="n">recommender</span><span class="p">,</span>
                                                          <span class="n">test_seq</span><span class="p">,</span>
                                                          <span class="n">evaluation_functions</span><span class="p">,</span>
                                                          <span class="n">user</span><span class="p">,</span>
                                                          <span class="n">given_k</span><span class="p">,</span>
                                                          <span class="n">look_ahead</span><span class="p">,</span>
                                                          <span class="n">top_n</span><span class="p">,</span>
                                                          <span class="n">step</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">metrics</span> <span class="o">+=</span> <span class="n">evaluate_sequence</span><span class="p">(</span><span class="n">recommender</span><span class="p">,</span>
                                             <span class="n">test_seq</span><span class="p">,</span>
                                             <span class="n">evaluation_functions</span><span class="p">,</span>
                                             <span class="n">user</span><span class="p">,</span>
                                             <span class="n">given_k</span><span class="p">,</span>
                                             <span class="n">look_ahead</span><span class="p">,</span>
                                             <span class="n">top_n</span><span class="p">)</span>
            <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">metrics</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_sequences</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">evaluate_sequence</span><span class="p">(</span><span class="n">recommender</span><span class="p">,</span> <span class="n">seq</span><span class="p">,</span> <span class="n">evaluation_functions</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">given_k</span><span class="p">,</span> <span class="n">look_ahead</span><span class="p">,</span> <span class="n">top_n</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param recommender: which recommender to use</span>
<span class="sd">    :param seq: the user_profile/ context</span>
<span class="sd">    :param given_k: last element used as ground truth. NB if &lt;0 it is interpreted as first elements to keep</span>
<span class="sd">    :param evaluation_functions: which function to use to evaluate the rec performance</span>
<span class="sd">    :param look_ahead: number of elements in ground truth to consider. if look_ahead = &#39;all&#39; then all the ground_truth sequence is considered</span>
<span class="sd">    :return: performance of recommender</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># safety checks</span>
    <span class="k">if</span> <span class="n">given_k</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">given_k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span> <span class="o">+</span> <span class="n">given_k</span>

    <span class="n">user_profile</span> <span class="o">=</span> <span class="n">seq</span><span class="p">[:</span><span class="n">given_k</span><span class="p">]</span>
    <span class="n">ground_truth</span> <span class="o">=</span> <span class="n">seq</span><span class="p">[</span><span class="n">given_k</span><span class="p">:]</span>

    <span class="c1"># restrict ground truth to look_ahead</span>
    <span class="n">ground_truth</span> <span class="o">=</span> <span class="n">ground_truth</span><span class="p">[:</span><span class="n">look_ahead</span><span class="p">]</span> <span class="k">if</span> <span class="n">look_ahead</span> <span class="o">!=</span> <span class="s1">&#39;all&#39;</span> <span class="k">else</span> <span class="n">ground_truth</span>
    <span class="n">ground_truth</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">ground_truth</span><span class="p">))</span>  <span class="c1"># list of list format</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">user_profile</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">ground_truth</span><span class="p">:</span>
        <span class="c1"># if any of the two missing all evaluation functions are 0</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">evaluation_functions</span><span class="p">))</span>

    <span class="n">r</span> <span class="o">=</span> <span class="n">recommender</span><span class="o">.</span><span class="n">recommend</span><span class="p">(</span><span class="n">user_profile</span><span class="p">,</span> <span class="n">user</span><span class="p">)[:</span><span class="n">top_n</span><span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">r</span><span class="p">:</span>
        <span class="c1"># no recommendation found</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">evaluation_functions</span><span class="p">))</span>
    <span class="n">reco_list</span> <span class="o">=</span> <span class="n">recommender</span><span class="o">.</span><span class="n">get_recommendation_list</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

    <span class="n">tmp_results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">evaluation_functions</span><span class="p">:</span>
        <span class="n">tmp_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">ground_truth</span><span class="p">,</span> <span class="n">reco_list</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tmp_results</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">sequence_sequential_evaluation</span><span class="p">(</span><span class="n">recommender</span><span class="p">,</span> <span class="n">seq</span><span class="p">,</span> <span class="n">evaluation_functions</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">given_k</span><span class="p">,</span> <span class="n">look_ahead</span><span class="p">,</span> <span class="n">top_n</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">given_k</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">given_k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span> <span class="o">+</span> <span class="n">given_k</span>

    <span class="n">eval_res</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">eval_cnt</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">gk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">given_k</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">seq</span><span class="p">),</span> <span class="n">step</span><span class="p">):</span>
        <span class="n">eval_res</span> <span class="o">+=</span> <span class="n">evaluate_sequence</span><span class="p">(</span><span class="n">recommender</span><span class="p">,</span> <span class="n">seq</span><span class="p">,</span> <span class="n">evaluation_functions</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">gk</span><span class="p">,</span> <span class="n">look_ahead</span><span class="p">,</span> <span class="n">top_n</span><span class="p">)</span>
        <span class="n">eval_cnt</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">eval_res</span> <span class="o">/</span> <span class="n">eval_cnt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>

<span class="kn">from</span> <span class="nn">scipy.sparse</span> <span class="kn">import</span> <span class="n">find</span>


<span class="k">def</span> <span class="nf">random_holdout</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">perc</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">1234</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Split sequence dataset randomly</span>
<span class="sd">    :param dataset: the sequence dataset</span>
<span class="sd">    :param perc: the training percentange</span>
<span class="sd">    :param seed: the random seed</span>
<span class="sd">    :return: the training and test splits</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">nseqs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
    <span class="n">train_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nseqs</span> <span class="o">*</span> <span class="n">perc</span><span class="p">)</span>
    <span class="c1"># split data according to the shuffled index and the holdout size</span>
    <span class="n">train_split</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>
    <span class="n">test_split</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="n">train_size</span><span class="p">:]</span>

    <span class="k">return</span> <span class="n">train_split</span><span class="p">,</span> <span class="n">test_split</span>


<span class="k">def</span> <span class="nf">temporal_holdout</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">ts_threshold</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Split sequence dataset using timestamps</span>
<span class="sd">    :param dataset: the sequence dataset</span>
<span class="sd">    :param ts_threshold: the timestamp from which test sequences will start</span>
<span class="sd">    :return: the training and test splits</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">train</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">ts_threshold</span><span class="p">]</span>
    <span class="n">test</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">ts_threshold</span><span class="p">]</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">clean_split</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">train</span><span class="p">,</span> <span class="n">test</span>


<span class="k">def</span> <span class="nf">last_session_out_split</span><span class="p">(</span><span class="n">data</span><span class="p">,</span>
                           <span class="n">user_key</span><span class="o">=</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span>
                           <span class="n">session_key</span><span class="o">=</span><span class="s1">&#39;session_id&#39;</span><span class="p">,</span>
                           <span class="n">time_key</span><span class="o">=</span><span class="s1">&#39;ts&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Assign the last session of every user to the test set and the remaining ones to the training set</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sessions</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="n">user_key</span><span class="p">,</span> <span class="n">time_key</span><span class="p">])</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">user_key</span><span class="p">)[</span><span class="n">session_key</span><span class="p">]</span>
    <span class="n">last_session</span> <span class="o">=</span> <span class="n">sessions</span><span class="o">.</span><span class="n">last</span><span class="p">()</span>
    <span class="n">train</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="o">~</span><span class="n">data</span><span class="o">.</span><span class="n">session_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">last_session</span><span class="o">.</span><span class="n">values</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">test</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">session_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">last_session</span><span class="o">.</span><span class="n">values</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">clean_split</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">train</span><span class="p">,</span> <span class="n">test</span>


<span class="k">def</span> <span class="nf">clean_split</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">test</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Remove new items from the test set.</span>
<span class="sd">    :param train: The training set.</span>
<span class="sd">    :param test: The test set.</span>
<span class="sd">    :return: The cleaned training and test sets.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">train_items</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">train</span><span class="p">[</span><span class="s1">&#39;sequence&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">seq</span><span class="p">:</span> <span class="n">train_items</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">seq</span><span class="p">)))</span>
    <span class="n">test</span><span class="p">[</span><span class="s1">&#39;sequence&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="s1">&#39;sequence&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">seq</span><span class="p">:</span> <span class="p">[</span><span class="n">it</span> <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">seq</span> <span class="k">if</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">train_items</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">train</span><span class="p">,</span> <span class="n">test</span>


<span class="k">def</span> <span class="nf">balance_dataset</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">number_of_elements</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">nnz</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">find</span><span class="p">(</span><span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">zero</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">number_of_elements</span><span class="p">))</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">nnz</span><span class="p">)</span>

    <span class="n">max_samples</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">zero</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">nnz</span><span class="p">))</span>

    <span class="n">nnz_indices</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">nnz</span><span class="p">,</span> <span class="n">max_samples</span><span class="p">)</span>
    <span class="n">zero_indeces</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">zero</span><span class="p">,</span> <span class="n">max_samples</span><span class="p">)</span>
    <span class="n">indeces</span> <span class="o">=</span> <span class="n">nnz_indices</span> <span class="o">+</span> <span class="n">zero_indeces</span>

    <span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="n">indeces</span><span class="p">,</span> <span class="p">:],</span> <span class="n">y</span><span class="p">[</span><span class="n">indeces</span><span class="p">,</span> <span class="p">:]</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="part-2">
<h2>Part 2<a class="headerlink" href="#part-2" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>Understanding evaluation metrics and pricing factors.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span>  <span class="nn">numpy</span>  <span class="k">as</span>  <span class="nn">np</span> 
<span class="kn">import</span>  <span class="nn">pandas</span>  <span class="k">as</span>  <span class="nn">pd</span> 
<span class="kn">import</span>  <span class="nn">math</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="hr-k">
<h3>HR&#64;K<a class="headerlink" href="#hr-k" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">hit_rate_at_k</span><span class="p">(</span><span class="n">recommended_list</span><span class="p">,</span> <span class="n">bought_list</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span> 
  <span class="n">bought_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bought_list</span><span class="p">)</span> 
  <span class="n">recommended_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">recommended_list</span><span class="p">)[:</span><span class="n">k</span><span class="p">]</span>
  <span class="n">flags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">bought_list</span><span class="p">,</span> <span class="n">recommended_list</span><span class="p">)</span> 
  <span class="k">return</span> <span class="p">(</span><span class="n">flags</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">recommended_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">156</span><span class="p">,</span> <span class="mi">1134</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">1543</span><span class="p">,</span> <span class="mi">3345</span><span class="p">,</span> <span class="mi">143</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">533</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">43</span><span class="p">]</span>  <span class="c1">#items ids</span>
<span class="n">bought_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">521</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">143</span><span class="p">,</span> <span class="mi">991</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hit_rate_at_k</span><span class="p">(</span><span class="n">recommended_list</span><span class="p">,</span> <span class="n">bought_list</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hit_rate_at_k</span><span class="p">(</span><span class="n">recommended_list</span><span class="p">,</span> <span class="n">bought_list</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="precision-k">
<h3>Precision&#64;K<a class="headerlink" href="#precision-k" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Precision = (# of recommended items that are relevant) / (# of recommended items)</p></li>
<li><p>Precision &#64; k = (# of recommended items &#64;k that are relevant) / (# of recommended items &#64;k)</p></li>
<li><p>Money Precision &#64; k = (revenue of recommended items &#64;k that are relevant) / (revenue of recommended items &#64;k)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">precision_at_k</span><span class="p">(</span><span class="n">recommended_list</span><span class="p">,</span> <span class="n">bought_list</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
  <span class="n">bought_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bought_list</span><span class="p">)</span>
  <span class="n">recommended_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">recommended_list</span><span class="p">)[:</span><span class="n">k</span><span class="p">]</span>
  
  <span class="n">flags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">bought_list</span><span class="p">,</span> <span class="n">recommended_list</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">flags</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">recommended_list</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">money_precision_at_k</span><span class="p">(</span><span class="n">recommended_list</span><span class="p">,</span> <span class="n">bought_list</span><span class="p">,</span> <span class="n">prices_recommended</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
  <span class="n">recommend_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">recommended_list</span><span class="p">)[:</span><span class="n">k</span><span class="p">]</span> 
  <span class="n">prices_recommended</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">prices_recommended</span><span class="p">)[:</span><span class="n">k</span><span class="p">]</span>
  <span class="n">flags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">recommend_list</span><span class="p">,</span> <span class="n">bought_list</span><span class="p">)</span>
  <span class="n">precision</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">flags</span><span class="p">,</span> <span class="n">prices_recommended</span><span class="p">)</span> <span class="o">/</span> <span class="n">prices_recommended</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
  <span class="k">return</span> <span class="n">precision</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">recommended_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">156</span><span class="p">,</span> <span class="mi">1134</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">1543</span><span class="p">,</span> <span class="mi">3345</span><span class="p">,</span> <span class="mi">143</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">533</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">43</span><span class="p">]</span>  <span class="c1">#items ids</span>
<span class="n">bought_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">521</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">143</span><span class="p">,</span> <span class="mi">991</span><span class="p">]</span>
<span class="n">prices_recommendede_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">400</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">340</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">190</span><span class="p">,</span><span class="mi">110</span><span class="p">,</span> <span class="mi">240</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">precision_at_k</span><span class="p">(</span><span class="n">recommended_list</span><span class="p">,</span> <span class="n">bought_list</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">precision_at_k</span><span class="p">(</span><span class="n">recommended_list</span><span class="p">,</span> <span class="n">bought_list</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.2
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">money_precision_at_k</span><span class="p">(</span><span class="n">recommended_list</span><span class="p">,</span> <span class="n">bought_list</span><span class="p">,</span> <span class="n">prices_recommendede_list</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">money_precision_at_k</span><span class="p">(</span><span class="n">recommended_list</span><span class="p">,</span> <span class="n">bought_list</span><span class="p">,</span> <span class="n">prices_recommendede_list</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.25625
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="recall-k">
<h3>Recall&#64;K<a class="headerlink" href="#recall-k" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Recall = (# of recommended items that are relevant) / (# of relevant items)</p></li>
<li><p>Recall &#64; k = (# of recommended items &#64;k that are relevant) / (# of relevant items)</p></li>
<li><p>Money Recall &#64; k = (revenue of recommended items &#64;k that are relevant) / (revenue of relevant items)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">recommended_list</span><span class="o">=</span><span class="p">[</span><span class="mi">143</span><span class="p">,</span><span class="mi">156</span><span class="p">,</span><span class="mi">1134</span><span class="p">,</span><span class="mi">991</span><span class="p">,</span><span class="mi">27</span><span class="p">,</span><span class="mi">1543</span><span class="p">,</span><span class="mi">3345</span><span class="p">,</span><span class="mi">533</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">43</span><span class="p">]</span> <span class="c1">#itemsid</span>
<span class="n">prices_recommended_list</span><span class="o">=</span><span class="p">[</span><span class="mi">400</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">340</span><span class="p">,</span><span class="mi">70</span><span class="p">,</span><span class="mi">190</span><span class="p">,</span><span class="mi">110</span><span class="p">,</span><span class="mi">240</span><span class="p">]</span>

<span class="n">bought_list</span><span class="o">=</span><span class="p">[</span><span class="mi">521</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">143</span><span class="p">,</span><span class="mi">991</span><span class="p">]</span>
<span class="n">prices_bought</span><span class="o">=</span><span class="p">[</span><span class="mi">150</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">400</span><span class="p">,</span><span class="mi">90</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">recall_at_k</span><span class="p">(</span><span class="n">recommended_list</span><span class="p">,</span> <span class="n">bought_list</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
  <span class="n">bought_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bought_list</span><span class="p">)</span>
  <span class="n">recommended_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">recommended_list</span><span class="p">)[:</span><span class="n">k</span><span class="p">]</span>
  
  <span class="n">flags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">bought_list</span><span class="p">,</span> <span class="n">recommended_list</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">flags</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">bought_list</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">money_recall_at_k</span><span class="p">(</span><span class="n">recommended_list</span><span class="p">,</span> <span class="n">bought_list</span><span class="p">,</span> <span class="n">prices_recommended</span><span class="p">,</span> <span class="n">prices_bought</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
  <span class="n">bought_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bought_list</span><span class="p">)</span>
  <span class="n">prices_bought</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">prices_bought</span><span class="p">)</span>
  <span class="n">recommended_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">recommended_list</span><span class="p">)[:</span><span class="n">k</span><span class="p">]</span>
  <span class="n">prices_recommended</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">prices_recommended</span><span class="p">)[:</span><span class="n">k</span><span class="p">]</span>

  <span class="n">flags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">recommended_list</span><span class="p">,</span> <span class="n">bought_list</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">flags</span><span class="p">,</span> <span class="n">prices_recommended</span><span class="p">)</span><span class="o">/</span><span class="n">prices_bought</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">recall_at_k</span><span class="p">(</span><span class="n">recommended_list</span><span class="p">,</span> <span class="n">bought_list</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.5
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">recall_at_k</span><span class="p">(</span><span class="n">recommended_list</span><span class="p">,</span> <span class="n">bought_list</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.5
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">money_recall_at_k</span><span class="p">(</span><span class="n">recommended_list</span><span class="p">,</span> <span class="n">bought_list</span><span class="p">,</span> <span class="n">prices_recommendede_list</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>98.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">money_recall_at_k</span><span class="p">(</span><span class="n">recommended_list</span><span class="p">,</span> <span class="n">bought_list</span><span class="p">,</span> <span class="n">prices_recommendede_list</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>49.0
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="map-k">
<h3>MAP&#64;K<a class="headerlink" href="#map-k" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>MAP &#64; k (Mean Average Precision &#64; k )</p></li>
<li><p>Average AP &#64; k for all users</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ap_k</span><span class="p">(</span><span class="n">recommended_list</span><span class="p">,</span> <span class="n">bought_list</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    
    <span class="n">bought_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bought_list</span><span class="p">)</span>
    <span class="n">recommended_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">recommended_list</span><span class="p">)[:</span><span class="n">k</span><span class="p">]</span>
    
    <span class="n">relevant_indexes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">recommended_list</span><span class="p">,</span> <span class="n">bought_list</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">relevant_indexes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    
    <span class="n">amount_relevant</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">relevant_indexes</span><span class="p">)</span>
            
    <span class="n">sum_</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">precision_at_k</span><span class="p">(</span><span class="n">recommended_list</span><span class="p">,</span> <span class="n">bought_list</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">index_relevant</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">index_relevant</span> <span class="ow">in</span> <span class="n">relevant_indexes</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">sum_</span><span class="o">/</span><span class="n">amount_relevant</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">map_k</span><span class="p">(</span><span class="n">recommended_list</span><span class="p">,</span> <span class="n">bought_list</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>

    <span class="n">amount_user</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bought_list</span><span class="p">)</span>
    <span class="n">list_ap_k</span> <span class="o">=</span> <span class="p">[</span><span class="n">ap_k</span><span class="p">(</span><span class="n">recommended_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">bought_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">amount_user</span><span class="p">)]</span>
    
    <span class="n">sum_ap_k</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">list_ap_k</span><span class="p">)</span>  
    <span class="k">return</span> <span class="n">sum_ap_k</span><span class="o">/</span><span class="n">amount_user</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#list of 3 users</span>
<span class="n">recommended_list_3_users</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">143</span><span class="p">,</span><span class="mi">156</span><span class="p">,</span><span class="mi">1134</span><span class="p">,</span><span class="mi">991</span><span class="p">,</span><span class="mi">27</span><span class="p">,</span><span class="mi">1543</span><span class="p">,</span><span class="mi">3345</span><span class="p">,</span><span class="mi">533</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">43</span><span class="p">],</span>
                            <span class="p">[</span><span class="mi">1134</span><span class="p">,</span><span class="mi">533</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">1543</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">99</span><span class="p">,</span><span class="mi">27</span><span class="p">,</span><span class="mi">3345</span><span class="p">],</span>
                            <span class="p">[</span><span class="mi">991</span><span class="p">,</span><span class="mi">3345</span><span class="p">,</span><span class="mi">27</span><span class="p">,</span><span class="mi">533</span><span class="p">,</span><span class="mi">43</span><span class="p">,</span><span class="mi">143</span><span class="p">,</span><span class="mi">1543</span><span class="p">,</span><span class="mi">156</span><span class="p">,</span><span class="mi">1134</span><span class="p">,</span><span class="mi">11</span><span class="p">]]</span>

<span class="n">bought_list_3_users</span><span class="o">=</span> <span class="p">[[</span><span class="mi">521</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">143</span><span class="p">],</span> <span class="c1">#user1</span>
                      <span class="p">[</span><span class="mi">143</span><span class="p">,</span><span class="mi">156</span><span class="p">,</span><span class="mi">991</span><span class="p">,</span><span class="mi">43</span><span class="p">,</span><span class="mi">11</span><span class="p">],</span> <span class="c1">#user2</span>
                      <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]]</span> <span class="c1">#user3</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">map_k</span><span class="p">(</span><span class="n">recommended_list_3_users</span><span class="p">,</span> <span class="n">bought_list_3_users</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.3333333333333333
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="mrr-k">
<h3>MRR&#64;K<a class="headerlink" href="#mrr-k" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">reciprocal_rank</span><span class="p">(</span><span class="n">recommended_list</span><span class="p">,</span> <span class="n">bought_list</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">recommended_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">recommended_list</span><span class="p">)</span>
    <span class="n">bought_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bought_list</span><span class="p">)</span>
    
    <span class="n">amount_user</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bought_list</span><span class="p">)</span>
    <span class="n">rr</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">amount_user</span><span class="p">):</span>    
        <span class="n">relevant_indexes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">recommended_list</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="n">k</span><span class="p">],</span> <span class="n">bought_list</span><span class="p">[</span><span class="n">i</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">relevant_indexes</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">rr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">relevant_indexes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span><span class="o">/</span><span class="n">amount_user</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">reciprocal_rank</span><span class="p">(</span><span class="n">recommended_list_3_users</span><span class="p">,</span> <span class="n">bought_list_3_users</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.7/dist-packages/ipykernel_launcher.py:3: VisibleDeprecationWarning: Creating an ndarray from ragged nested sequences (which is a list-or-tuple of lists-or-tuples-or ndarrays with different lengths or shapes) is deprecated. If you meant to do this, you must specify &#39;dtype=object&#39; when creating the ndarray
  This is separate from the ipykernel package so we can avoid doing imports until
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.3333333333333333
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="ndcg-k">
<h3>NDCG&#64;K<a class="headerlink" href="#ndcg-k" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ndcg_at_k</span><span class="p">(</span><span class="n">recommended_list</span><span class="p">,</span> <span class="n">bought_list</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">rec</span> <span class="o">=</span> <span class="n">recommended_list</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">bought_list</span>
    
    <span class="n">recommended_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">recommended_list</span><span class="p">)[:</span><span class="n">k</span><span class="p">]</span>
    <span class="n">bought_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bought_list</span><span class="p">)</span>
    
    <span class="n">flags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">recommended_list</span><span class="p">,</span> <span class="n">bought_list</span><span class="p">)</span>
    <span class="n">rank_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">recommended_list</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">rank_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rank_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">recommended_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="n">dcg</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">flags</span><span class="p">,</span> <span class="n">rank_list</span><span class="p">))</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">recommended_list</span><span class="p">)</span>

    <span class="n">i_dcg</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">rank_list</span><span class="p">))</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">recommended_list</span><span class="p">)</span>
<span class="c1">#     print(i_dcg)</span>
    <span class="k">return</span> <span class="n">dcg</span><span class="o">/</span><span class="n">i_dcg</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">recommended_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">143</span><span class="p">,</span><span class="mi">156</span><span class="p">,</span><span class="mi">1134</span><span class="p">,</span><span class="mi">991</span><span class="p">,</span><span class="mi">27</span><span class="p">,</span><span class="mi">1543</span><span class="p">,</span><span class="mi">3345</span><span class="p">,</span><span class="mi">533</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">43</span><span class="p">]</span> <span class="c1">#iditems</span>
<span class="n">prices_recommended_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">400</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">340</span><span class="p">,</span><span class="mi">70</span><span class="p">,</span><span class="mi">190</span><span class="p">,</span><span class="mi">110</span><span class="p">,</span><span class="mi">240</span><span class="p">]</span>

<span class="n">bought_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">521</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">143</span><span class="p">,</span><span class="mi">991</span><span class="p">]</span>
<span class="n">prices_bought</span> <span class="o">=</span> <span class="p">[</span><span class="mi">150</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">400</span><span class="p">,</span><span class="mi">90</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ndcg_at_k</span><span class="p">(</span><span class="n">recommended_list</span><span class="p">,</span> <span class="n">bought_list</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.489938890671454
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="part-3">
<h2>Part 3<a class="headerlink" href="#part-3" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>Evaluation Recal, MRR and NDCG on simple dummpy data.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">pathlib</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">ndcg_score</span><span class="p">,</span> <span class="n">label_ranking_average_precision_score</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="recall-dummy">
<h3>Recall Dummy<a class="headerlink" href="#recall-dummy" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">recall</span><span class="p">(</span><span class="n">test_set</span><span class="p">,</span> <span class="n">recs</span><span class="p">,</span> <span class="n">K</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">userid_subset</span><span class="o">=</span><span class="p">[]):</span>
    <span class="sd">&quot;&quot;&quot;For a test set, compute the % of users who have a hit in the top K.</span>
<span class="sd">    Args:</span>
<span class="sd">        test_set: DF with an entry for each user with the target edit-to-be-predicted</span>
<span class="sd">        recs: Dict by userid of lists of pageid recs</span>
<span class="sd">        K: Number of recs to consider when looking for a hit</span>
<span class="sd">        userid_subset: Only compute for the userids in this list</span>
<span class="sd">    Returns:</span>
<span class="sd">        float of the mean number of test entries with hits in the top K</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">userid_subset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">userid_subset</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">userid_subset</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">userid_subset</span><span class="p">)</span>

    <span class="n">hits</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">pageid</span> <span class="ow">in</span> <span class="n">recs</span><span class="p">[</span><span class="n">userid</span><span class="p">][:</span><span class="n">K</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">pageid</span><span class="p">,</span> <span class="n">userid</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">test_set</span><span class="o">.</span><span class="n">pageid</span><span class="p">,</span> <span class="n">test_set</span><span class="o">.</span><span class="n">userid</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">userid_subset</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">userid</span> <span class="ow">in</span> <span class="n">userid_subset</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">hits</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_recall_typical</span><span class="p">():</span>
    <span class="n">typical_test_set</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;userid&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">76</span><span class="p">],</span>
            <span class="s2">&quot;pageid&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">18402344</span><span class="p">,</span> <span class="mi">58812518</span><span class="p">,</span> <span class="mi">1187097</span><span class="p">,</span> <span class="mi">129540</span><span class="p">,</span> <span class="mi">53864279</span><span class="p">],</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="n">recs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="mi">63136688</span><span class="p">,</span> <span class="mi">10849236</span><span class="p">,</span> <span class="mi">19167679</span><span class="p">,</span> <span class="mi">18402344</span><span class="p">,</span> <span class="mi">19594028</span><span class="p">,</span> <span class="mi">63055098</span><span class="p">],</span>
        <span class="mi">31</span><span class="p">:</span> <span class="p">[</span><span class="mi">910445</span><span class="p">,</span> <span class="mi">33372313</span><span class="p">,</span> <span class="mi">64833595</span><span class="p">,</span> <span class="mi">59118602</span><span class="p">,</span> <span class="mi">56300556</span><span class="p">,</span> <span class="mi">66093761</span><span class="p">],</span>
        <span class="mi">32</span><span class="p">:</span> <span class="p">[</span><span class="mi">59799</span><span class="p">,</span> <span class="mi">5595351</span><span class="p">,</span> <span class="mi">140899</span><span class="p">,</span> <span class="mi">27003186</span><span class="p">,</span> <span class="mi">4494959</span><span class="p">,</span> <span class="mi">6136828</span><span class="p">],</span>
        <span class="mi">70</span><span class="p">:</span> <span class="p">[</span><span class="mi">25717</span><span class="p">,</span> <span class="mi">65930</span><span class="p">,</span> <span class="mi">2698660</span><span class="p">,</span> <span class="mi">11376</span><span class="p">,</span> <span class="mi">249268</span><span class="p">,</span> <span class="mi">32188</span><span class="p">],</span>
        <span class="mi">76</span><span class="p">:</span> <span class="p">[</span><span class="mi">67319458</span><span class="p">,</span> <span class="mi">65564103</span><span class="p">,</span> <span class="mi">64154311</span><span class="p">,</span> <span class="mi">64373673</span><span class="p">,</span> <span class="mi">67321086</span><span class="p">,</span> <span class="mi">53864279</span><span class="p">],</span>
    <span class="p">}</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">recall</span><span class="p">(</span><span class="n">typical_test_set</span><span class="p">,</span> <span class="n">recs</span><span class="p">,</span> <span class="n">K</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">userid_subset</span><span class="o">=</span><span class="kc">None</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_recall_typical</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.2
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">recall_curve</span><span class="p">(</span><span class="n">test_set</span><span class="p">,</span> <span class="n">recs</span><span class="p">,</span> <span class="n">max_k</span><span class="p">,</span> <span class="n">userid_subset</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">recall_vals</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">K</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">max_k</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">recall_vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">recall</span><span class="p">(</span><span class="n">test_set</span><span class="p">,</span> <span class="n">recs</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">userid_subset</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">recall_vals</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_recall_curve</span><span class="p">():</span>
    <span class="n">typical_test_set</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;userid&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">76</span><span class="p">],</span>
            <span class="s2">&quot;pageid&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">18402344</span><span class="p">,</span> <span class="mi">58812518</span><span class="p">,</span> <span class="mi">1187097</span><span class="p">,</span> <span class="mi">129540</span><span class="p">,</span> <span class="mi">53864279</span><span class="p">],</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="n">recs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="mi">63136688</span><span class="p">,</span> <span class="mi">10849236</span><span class="p">,</span> <span class="mi">19167679</span><span class="p">,</span> <span class="mi">18402344</span><span class="p">,</span> <span class="mi">19594028</span><span class="p">,</span> <span class="mi">63055098</span><span class="p">],</span>
        <span class="mi">31</span><span class="p">:</span> <span class="p">[</span><span class="mi">910445</span><span class="p">,</span> <span class="mi">33372313</span><span class="p">,</span> <span class="mi">64833595</span><span class="p">,</span> <span class="mi">59118602</span><span class="p">,</span> <span class="mi">56300556</span><span class="p">,</span> <span class="mi">66093761</span><span class="p">],</span>
        <span class="mi">32</span><span class="p">:</span> <span class="p">[</span><span class="mi">59799</span><span class="p">,</span> <span class="mi">5595351</span><span class="p">,</span> <span class="mi">140899</span><span class="p">,</span> <span class="mi">27003186</span><span class="p">,</span> <span class="mi">4494959</span><span class="p">,</span> <span class="mi">6136828</span><span class="p">],</span>
        <span class="mi">70</span><span class="p">:</span> <span class="p">[</span><span class="mi">25717</span><span class="p">,</span> <span class="mi">65930</span><span class="p">,</span> <span class="mi">2698660</span><span class="p">,</span> <span class="mi">11376</span><span class="p">,</span> <span class="mi">249268</span><span class="p">,</span> <span class="mi">32188</span><span class="p">],</span>
        <span class="mi">76</span><span class="p">:</span> <span class="p">[</span><span class="mi">67319458</span><span class="p">,</span> <span class="mi">65564103</span><span class="p">,</span> <span class="mi">64154311</span><span class="p">,</span> <span class="mi">64373673</span><span class="p">,</span> <span class="mi">67321086</span><span class="p">,</span> <span class="mi">53864279</span><span class="p">],</span>
    <span class="p">}</span>

    <span class="n">curve</span> <span class="o">=</span> <span class="n">recall_curve</span><span class="p">(</span><span class="n">typical_test_set</span><span class="p">,</span> <span class="n">recs</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">curve</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_recall_curve</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0.0, 0.0, 0.0, 0.2, 0.2]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="mrr-ndcg-dummy">
<h3>MRR NDCG Dummy<a class="headerlink" href="#mrr-ndcg-dummy" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">K</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">dummy_y_score</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">K</span><span class="p">))[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
<span class="n">dummy_y_score</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[19, 18, 17, 16, 15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0],
 [19, 18, 17, 16, 15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0],
 [19, 18, 17, 16, 15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0],
 [19, 18, 17, 16, 15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0],
 [19, 18, 17, 16, 15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0],
 [19, 18, 17, 16, 15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0],
 [19, 18, 17, 16, 15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0],
 [19, 18, 17, 16, 15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0],
 [19, 18, 17, 16, 15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0],
 [19, 18, 17, 16, 15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0],
 [19, 18, 17, 16, 15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0],
 [19, 18, 17, 16, 15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0],
 [19, 18, 17, 16, 15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0],
 [19, 18, 17, 16, 15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0],
 [19, 18, 17, 16, 15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0],
 [19, 18, 17, 16, 15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0],
 [19, 18, 17, 16, 15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0],
 [19, 18, 17, 16, 15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0],
 [19, 18, 17, 16, 15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0],
 [19, 18, 17, 16, 15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0]]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">y_true</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
    <span class="n">y_true</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dummy_y_score</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[19, 18, 17, 16, 15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">label_ranking_average_precision_score</span><span class="p">([</span><span class="n">y_true</span><span class="p">[</span><span class="n">i</span><span class="p">,:]],[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dummy_y_score</span><span class="p">)[</span><span class="n">i</span><span class="p">,:]]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.0
0.5
0.3333333333333333
0.25
0.2
0.16666666666666666
0.14285714285714285
0.125
0.1111111111111111
0.1
0.09090909090909091
0.08333333333333333
0.07692307692307693
0.07142857142857142
0.06666666666666667
0.0625
0.058823529411764705
0.05555555555555555
0.05263157894736842
0.05
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mmr</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">ndcg</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">):</span>
    <span class="n">mmr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label_ranking_average_precision_score</span><span class="p">([</span><span class="n">y_true</span><span class="p">[</span><span class="n">i</span><span class="p">,:]],[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dummy_y_score</span><span class="p">)[</span><span class="n">i</span><span class="p">,:]]))</span>
    <span class="n">ndcg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ndcg_score</span><span class="p">([</span><span class="n">y_true</span><span class="p">[</span><span class="n">i</span><span class="p">,:]],[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dummy_y_score</span><span class="p">)[</span><span class="n">i</span><span class="p">,:]]))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mmr</span><span class="p">,</span><span class="s2">&quot;.-&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ndcg</span><span class="p">,</span><span class="s2">&quot;.-&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s2">&quot;Mean Reciprocal Rank&quot;</span><span class="p">,</span><span class="s2">&quot;nDCG&quot;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Position of target item&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Score for hit&quot;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.1</span><span class="p">,</span><span class="mf">0.2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/T990000_evaluation_metrics_basics_82_0.png" src="../_images/T990000_evaluation_metrics_basics_82_0.png" />
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./nbs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="T990000_content_based_music_recommender_lyricsfreak.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">Content-based method for song recommendation</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="T990000_implicit_synthetic.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">Comparing Implicit Models on Synthetic Data</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Sparsh A.<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>