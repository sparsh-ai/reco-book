
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Load and process dataset &#8212; Reco Book</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Injection attack using LFM and ItemAE model trained on Toy dataset" href="T711285_Data_Poisoning_Attack_using_LFM_and_ItemAE_on_Synthetic_Dataset.html" />
    <link rel="prev" title="Adversarial Training (Regularization) on a Recommender System" href="T102448_Adversarial_Learning_for_Recommendation.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Reco Book</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../index.html">
   Tutorials in Jupyter notebook format
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  User Stories
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="US780867_Transformer_based_Recommenders.html">
   Transformer-based Recommenders
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="T034923_BERT4Rec_on_ML1M_in_PyTorch.html">
     BERT4Rec on ML-1M in PyTorch
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T595874_BERT4Rec_on_ML25M_in_PyTorch_Lightning.html">
     BERT4Rec on ML-25M
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T088416_BST_Implementation_in_MXNet.html">
     BST Implementation in MXNet
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T602245_BST_implementation_in_PyTorch.html">
     BST implementation in PyTorch
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T007665_BST_on_ML1M_in_Keras.html">
     A Transformer-based recommendation system
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T881207_BST_PTLightning_ML1M.html">
     Rating prediction using the Behavior Sequence Transformer (BST) model on ML-1M dataset in PyTorch Lightning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T757997_SASRec_PyTorch.html">
     SASRec implementation with PyTorch Library
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T225287_SASRec_PaddlePaddle.html">
     SASRec implementation with Paddle Library
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T701627_SR_SAN_Session_based_Model.html">
     SR-SAN Session-based Recommender
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T975104_SSEPT_ML1M_Tensorflow1x.html">
     SSE-PT Personalized Transformer Recommender on ML-1M in Tensorflow 1.x
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Prototypes
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="T382881_DeepWalk_Karateclub.html">
   DeepWalk from scratch referencing Karateclub library
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T384270_DeepWalk_pure_python.html">
   DeepWalk in pure python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T677598_Jaccard_Cosine_SVD_DeepWalk_ML100K.html">
   Recommender System with DeepWalk Graph Embeddings
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T815556_Node2vec_Karateclub.html">
   Node2vec from scratch referencing Karateclub library
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T894941_Node2vec_MovieLens_Keras.html">
   Graph representation learning with node2vec
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T611050_Node2vec_PyG.html">
   Node2vec from scratch in PyTorch Geometric
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T186367_Node2vec_library.html">
   Node2vec from scratch referencing node2vec library
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T331379_bayesian_personalized_ranking.html">
   BPR from scratch
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T081831_Data_Poisoning_Attacks_on_Factorization_Based_Collaborative_Filtering.html">
   Data Poisoning Attacks on Factorization-Based Collaborative Filtering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T102448_Adversarial_Learning_for_Recommendation.html">
   Adversarial Training (Regularization) on a Recommender System
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Load and process dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T711285_Data_Poisoning_Attack_using_LFM_and_ItemAE_on_Synthetic_Dataset.html">
   Injection attack using LFM and ItemAE model trained on Toy dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T355514_Black_box_Attack_on_Sequential_Recs.html">
   Black-box Attack on Sequential Recs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T873451_Statistics_fundamentals.html">
   Statictics Fundamentals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T890478_Batch_Learning_from_Bandit_Feedback_%28BLBF%29.html">
   Imports
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T257798_Off_Policy_Learning_in_Two_stage_Recommender_Systems.html">
   Off-Policy Learning in Two-stage Recommender Systems
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T471827_Adaptive_Estimator_Selection_for_Off_Policy_Evaluation.html">
   Adaptive Estimator Selection for Off-Policy Evaluation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T902666_Evaluating_the_Robustness_of_Off_Policy_Evaluation.html">
   Evaluating the Robustness of Off-Policy Evaluation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T705904_Evaluation_of_Multiple_Off_Policy_Estimators_on_Synthetic_Dataset.html">
   Evaluation of Multiple Off-Policy Estimators on Synthetic Dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T874693_Evaluating_Standard_Off_Policy_Estimators_with_Small_Sample_Open_Bandit_Dataset.html">
   Evaluating Standard Off-Policy Estimators with Small Sample Open-Bandit Dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T792262_Optimal_Off_Policy_Evaluation_from_Multiple_Logging_Policies.html">
   Optimal Off-Policy Evaluation from Multiple Logging Policies
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T167249_Offline_Policy_Evaluation_with_VW_Command_Line.html">
   Offline Policy Evaluation with VW Command Line
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T966055_OBP_Library_Workshop_Tutorials.html">
   OBP Library Workshop Tutorials
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T632722_PyTorch_Fundamentals_Part_1.html">
   PyTorch Fundamentals Part 1
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T472467_PyTorch_Fundamentals_Part_2.html">
   PyTorch Fundamentals Part 2
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T206654_PyTorch_Fundamentals_Part_3.html">
   PyTorch Fundamentals Part 3
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T536348_Attention_Mechanisms.html">
   Imports
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T500796_Agricultural_Satellite_Image_Segmentation.html">
   Agricultural Satellite Image Segmentation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T611432_Image_Analysis_with_Tensorflow.html">
   Image Analysis with Tensorflow
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T925716_MongoDB_to_CSV_Conversion.html">
   MongoDB to CSV conversion
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T396469_PDF_to_Word_Cloud_via_Email.html">
   PDF to WordCloud via Email
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T030890_Job_Scraping_and_Clustering.html">
   Job scraping and clustering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T897054_Scene_Text_Recognition.html">
   Scene Text Recognition
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T034809_Large_scale_Document_Retrieval_with_Elastic_Search.html">
   Large-scale Document Retrieval with ElasticSearch
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T467251_vowpal_wabbit_contextual_recommender.html">
   Simulating a news personalization scenario using Contextual Bandits
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T686684_similar_product_recommender.html">
   Similar Product Recommender system using Deep Learning for an online e-commerce store
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T132203_Retail_Product_Recommendations_using_Word2vec.html">
   Retail Product Recommendations using word2vec
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T501828_Recommender_Implicit_Negative_Feedback.html">
   Retail Product Recommendation with Negative Implicit Feedback
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T315965_Sequence_Aware_Recommenders_Music.html">
   Sequence Aware Recommender Systems
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T051777_image_similarity_recommendations.html">
   Similar Product Recommendations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990172_recobook_diversity_aware_book_recommender.html">
   Diversity Aware Book Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T488549_Goodreads_Diversity_Aware_Book_Recommender.html">
   Diversity Aware Book Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T023535_Kafka_MongoDB_Real_time_Streaming.html">
   Kafka MongoDB Real-time Streaming
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T622304_Session_based_Recommender_Using_Word2vec.html">
   Session-based recommendation using word2vec
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T416854_bandit_based_recommender_using_thompson_sampling_app.html">
   Bandit-based Online Learning using Thompson Sampling
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T198578_Booking_dot_com_Trip_Recommendation.html">
   Booking.com Trip Recommendation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T519734_Vowpal_Wabbit_Contextual_Bandit.html">
   Vowpal Wabbit Contextual Bandit
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T871537_Recommendation_Systems_using_Olist_Dataset.html">
   Recommendation systems using Olist dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T057885_Offline_Replayer_Evaluation.html">
   Offline Replayer Evaluation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T915054_method_for_effective_online_testing.html">
   Methods for effective online testing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T513987_Recsys_2020_Feature_Engineering_Tutorial.html">
   Recsys’20 Feature Engineering Tutorial
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T227901_amazon_personalize_batch_job.html">
   Amazon Personalize Batch Job
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T022961_Amazon_Personalize_Workshop.html">
   Amazon Personalize Workshop
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T424437_Collaborative_Filtering_on_ML_latest_small.html">
   Collaborative Filtering on ML-latest-small
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T539160_Building_and_Deploying_ASOS_Fashion_Recommender.html">
   Building and deploying ASOS fashion recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T757697_Simple_Similarity_based_Recommender.html">
   Simple Similarity based Recommmendations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T051594_Analytics_Zoo.html">
   Analytics Zoo
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T313645_A_B_Testing.html">
   A/B Testing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T475711_PinSage_Graph_based_Recommender.html">
   PinSage Graph-based Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T516490_Graph_Embeddings.html">
   Learn Embeddings using Graph Networks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T822164_movielens_milvus_redis_efficient_retrieval.html">
   Recommender with Redis and Milvus
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T845186_Anime_Recommender.html">
   RekoNet Anime Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T855843_kafka_spark_streaming_colab.html">
   Kafka and Spark Streaming in Colab
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T460437_Building_Models_From_Scratch.html">
   Building Models from scratch
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T855971_Conet_Model_for_Movie_Recommender.html">
   CoNet model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T996996_content_based_and_collaborative_movielens.html">
   Movie Recommendation with Content-Based and Collaborative Filtering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T239418_Simple_Movie_Recommenders.html">
   Simple Movie Recommenders
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T138337_Simple_Movie_Recommender.html">
   Simple movie recommender in implicit, explicit, and cold-start settings
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T935440_The_importance_of_Rating_Normalization.html">
   The importance of Rating Normalization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T612622_cornac_examples.html">
   Cornac Examples
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T561435_Flower_Classification.html">
   Flower classification
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T680910_Trivago_Session_based_Recommender.html">
   Trivago Session-based Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_ads_selection_using_bandits.html">
   Best Ads detection using bandit methods
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_book_crossing_surprise_svd_nmf.html">
   Book-Crossing Recommendation System
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_book_recommender_kubeflow.html">
   Books recommendations with Kubeflow Pipelines on Scaleway Kapsule
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_build_a_kubeflow_pipeline.html">
   Build a Kubeflow Pipeline
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_causal_inference.html">
   Causal Inference
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_concept_embedding_nlp.html">
   Exploring Word Embeddings
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_concept_neural_net.html">
   Neural Network
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_concept_nlp_basics.html">
   Natural Language Processing 101
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_concept_transformer_lm.html">
   TransformerLM Quick Start and Guide
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_content_based_music_recommender_lyricsfreak.html">
   Content-based method for song recommendation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_evaluation_metrics_basics.html">
   Recommender System Evaluations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_implicit_synthetic.html">
   Comparing Implicit Models on Synthetic Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_movie_recommender_tensorflow.html">
   Recommendation Systems with TensorFlow
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_movie_recommender_tensorflow_sagemaker.html">
   Movie recommender using Tensorflow in Sagemaker
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_movielens_eda_modeling.html">
   Movielens EDA and Modeling
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_read_data_from_cassandra_into_pandas.html">
   Read Cassandra Data Snapshot as DataFrame
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_rl_in_action.html">
   Reinforcement Learning fundamentals in action
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_rnn_cnn_basics.html">
   Processing sequences using RNNs and CNNs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_tf_serving_in_action.html">
   TF Serving in action
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_training_indexing_movie_recommender.html">
   Training and indexing movie recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T207114_EduRec_MOOCCube_Course_Recommender.html">
   EduRec MOOCCube Course Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T273184_Multi_Task_Learning.html">
   Multi-task Learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T661108_Book_Recommender_API.html">
   Book Recommender API
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T912764_Simple_Movie_Recommender_App.html">
   Simple Movie Recommender App
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T964554_Career_Village_Questions_Recommendation.html">
   CareerVillage Questions Recommendation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_amazon_women_apparel_tfidf_word2vec.html">
   Amazon Product Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_anime_recommender_graph_network.html">
   Anime Recommender with Bi-partite Graph Network
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_concept_self_attention.html">
   Self-Attention
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_course_recommender_svd_flask.html">
   Course Recommender with SVD based similarity
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_data_mining_similarity_measures.html">
   Concept - Data Mining Similarity Measures
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_jaccard_recommender.html">
   Jaccard Similarity based Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_live_streamer_recommender.html">
   Live Streamer Recommender with Implicit feedback
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_songs_embedding_skipgram_recommender.html">
   Song Embeddings - Skipgram Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_toy_example_car_recommender_knn.html">
   Toy example - Car Recommender using KNN method
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_wikirecs_recommender.html">
   WikiRecs
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/nbs/T865035_Simulating_Data_Poisoning_Attacks_against_Twitter_Recommender.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/sparsh-ai/reco-book/main?urlpath=tree/nbs/T865035_Simulating_Data_Poisoning_Attacks_against_Twitter_Recommender.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Load and process dataset
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#choose-accounts-for-poisoning-experiment">
   Choose accounts for poisoning experiment
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#build-model">
   Build model
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#recommendations-by-target-similarity">
   Recommendations by target similarity
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#recommendations-by-source-similarity">
   Recommendations by source similarity
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#validation-count-how-many-times-target-appeared-in-top-n-recommendations-for-each-source">
   Validation: count how many times target appeared in top_n recommendations for each source
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#poisoning-experiment-1-randomly-chosen-amplifiers-variable-amps-retweets">
   Poisoning experiment 1 - randomly chosen amplifiers, variable amps, retweets
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#display-results-as-a-plot">
   Display results as a plot
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#poisoning-experiment-2-amplifiers-chosen-based-on-community">
   Poisoning experiment 2 - amplifiers chosen based on community
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#poisoning-experiment-3-amplifiers-chosen-based-on-similarity-to-control-accounts">
   Poisoning experiment 3 - amplifiers chosen based on similarity to control accounts
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <p><a href="https://colab.research.google.com/github/sparsh-ai/reco-book/blob/stage/nbs/T865035_Simulating_Data_Poisoning_Attacks_against_Twitter_Recommender.ipynb" target="_parent"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"/></a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!pip install -U fastai
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Note this is broken for pytorch 1.7.x, so please use pytorch 1.6</span>
<span class="c1"># pip install torch==1.6.0 torchvision==0.7.0</span>

<span class="kn">from</span> <span class="nn">sklearn.metrics.pairwise</span> <span class="kn">import</span> <span class="n">cosine_similarity</span>

<span class="kn">from</span> <span class="nn">fastai.tabular.all</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">fastai.collab</span> <span class="kn">import</span> <span class="o">*</span>

<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="kn">import</span> <span class="nn">community</span>
<span class="kn">import</span> <span class="nn">community.community_louvain</span> <span class="k">as</span> <span class="nn">community_louvain</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Helper functions</span>
<span class="k">def</span> <span class="nf">save_ratings</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">fn</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Source,Target,Weight</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Source&quot;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Target&quot;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Weight&quot;</span><span class="p">]):</span>
            <span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">item</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">key_with_max_value</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>  
     <span class="n">v</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
     <span class="n">k</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
     <span class="k">return</span> <span class="n">k</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">v</span><span class="p">))],</span> <span class="nb">max</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">key_with_min_value</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>  
     <span class="n">v</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
     <span class="n">k</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
     <span class="k">return</span> <span class="n">k</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">v</span><span class="p">))],</span> <span class="nb">min</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_most_similar</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">matrix</span><span class="p">,</span> <span class="n">max_matches</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">uid</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">matrix</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">all_matches</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>
    <span class="n">top_matches</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">all_matches</span><span class="p">))</span>
    <span class="n">match_rating</span> <span class="o">=</span> <span class="p">[[</span><span class="n">top_matches</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">all_matches</span><span class="p">[</span><span class="n">top_matches</span><span class="p">[</span><span class="n">i</span><span class="p">]]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_matches</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">match_rating</span>

<span class="k">def</span> <span class="nf">print_similar_to_targets</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">t_matrix</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Target: &quot;</span> <span class="o">+</span> <span class="n">tid_name</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; similar to:&quot;</span><span class="p">)</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="n">get_most_similar</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">t_matrix</span><span class="p">,</span> <span class="n">t_max_matches</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">matches</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">[:</span><span class="mi">10</span><span class="p">]:</span>
            <span class="n">tid</span><span class="p">,</span> <span class="n">rating</span> <span class="o">=</span> <span class="n">item</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">tid_name</span><span class="p">[</span><span class="n">tid</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">%.4f</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">rating</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">print_similar_to_sources</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">s_matrix</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;User: &quot;</span> <span class="o">+</span> <span class="n">sid_name</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; similar to:&quot;</span><span class="p">)</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="n">get_most_similar</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">s_matrix</span><span class="p">,</span> <span class="n">s_max_matches</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">matches</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">[:</span><span class="mi">10</span><span class="p">]:</span>
            <span class="n">sid</span><span class="p">,</span> <span class="n">rating</span> <span class="o">=</span> <span class="n">item</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">sid_name</span><span class="p">[</span><span class="n">sid</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">%.4f</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">rating</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">()</span>
        
<span class="k">def</span> <span class="nf">print_target_similarity</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="n">t_matrix</span><span class="p">):</span>
    <span class="n">sim</span> <span class="o">=</span> <span class="n">t_matrix</span><span class="p">[</span><span class="n">t1</span><span class="p">][</span><span class="n">t2</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">tid_name</span><span class="p">[</span><span class="n">t1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; similarity to &quot;</span> <span class="o">+</span> <span class="n">tid_name</span><span class="p">[</span><span class="n">t2</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">%.4f</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">sim</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">make_nx_graph</span><span class="p">(</span><span class="n">inter</span><span class="p">):</span>
    <span class="n">mapping</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">source</span><span class="p">,</span> <span class="n">targets</span> <span class="ow">in</span> <span class="n">inter</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">names</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">target</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">targets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">mapping</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">source</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">count</span><span class="p">))</span>
            <span class="n">names</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
    <span class="n">g</span><span class="o">=</span><span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
    <span class="n">g</span><span class="o">.</span><span class="n">add_weighted_edges_from</span><span class="p">(</span><span class="n">mapping</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">g</span><span class="p">,</span> <span class="n">names</span>

<span class="k">def</span> <span class="nf">get_median</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">source_list</span><span class="p">):</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">source_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">var</span><span class="p">:</span>
            <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">var</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_mean</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">source_list</span><span class="p">):</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">source_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">var</span><span class="p">:</span>
            <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">var</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_jaccard_median</span><span class="p">(</span><span class="n">inter</span><span class="p">,</span> <span class="n">source_list</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
    <span class="n">g</span><span class="p">,</span> <span class="n">names</span> <span class="o">=</span> <span class="n">make_nx_graph</span><span class="p">(</span><span class="n">inter</span><span class="p">)</span>
    <span class="n">pairs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">source_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="n">pairs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">s</span><span class="p">,</span> <span class="n">target</span><span class="p">))</span>
    <span class="n">preds</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">jaccard_coefficient</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">pairs</span><span class="p">)</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">preds</span><span class="p">:</span>
        <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_jaccard_mean</span><span class="p">(</span><span class="n">inter</span><span class="p">,</span> <span class="n">source_list</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
    <span class="n">g</span><span class="p">,</span> <span class="n">names</span> <span class="o">=</span> <span class="n">make_nx_graph</span><span class="p">(</span><span class="n">inter</span><span class="p">)</span>
    <span class="n">pairs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">source_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="n">pairs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">s</span><span class="p">,</span> <span class="n">target</span><span class="p">))</span>
    <span class="n">preds</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">jaccard_coefficient</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">pairs</span><span class="p">)</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">preds</span><span class="p">:</span>
        <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_communities</span><span class="p">(</span><span class="n">inter</span><span class="p">):</span>
    <span class="n">g</span><span class="p">,</span> <span class="n">names</span> <span class="o">=</span> <span class="n">make_nx_graph</span><span class="p">(</span><span class="n">inter</span><span class="p">)</span>
    <span class="n">communities</span> <span class="o">=</span> <span class="n">community_louvain</span><span class="o">.</span><span class="n">best_partition</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>

    <span class="n">clusters</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">mod</span> <span class="ow">in</span> <span class="n">communities</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">mod</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">clusters</span><span class="p">:</span>
            <span class="n">clusters</span><span class="p">[</span><span class="n">mod</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">clusters</span><span class="p">[</span><span class="n">mod</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">clusters</span>

<span class="k">def</span> <span class="nf">get_mean_distance</span><span class="p">(</span><span class="n">inter</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">source_list</span><span class="p">):</span>
    <span class="n">g</span><span class="p">,</span> <span class="n">names</span> <span class="o">=</span> <span class="n">make_nx_graph</span><span class="p">(</span><span class="n">inter</span><span class="p">)</span>

    <span class="n">distance_vals</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">source</span> <span class="ow">in</span> <span class="n">source_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">source</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="n">length</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">shortest_path_length</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">target</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">source</span><span class="p">)</span>
            <span class="n">distance_vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">distance_vals</span><span class="p">)</span>

<span class="c1"># Return a new poisoned dataframe</span>
<span class="k">def</span> <span class="nf">get_poisoned_dataset</span><span class="p">(</span><span class="n">ratings</span><span class="p">,</span> <span class="n">amplifier_candidates</span><span class="p">,</span> <span class="n">num_amplifiers</span><span class="p">,</span> <span class="n">rating_val</span><span class="p">,</span> <span class="n">save_path</span><span class="p">):</span>
    <span class="n">ratings2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">ratings</span><span class="p">)</span>
    <span class="c1"># For base set measurements</span>
    <span class="k">if</span> <span class="n">num_amplifiers</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">rating_val</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ratings2</span>
    <span class="n">new_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">amplifiers</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">amplifier_candidates</span><span class="p">,</span> <span class="n">num_amplifiers</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">uid</span> <span class="ow">in</span> <span class="n">amplifiers</span><span class="p">:</span>
        <span class="n">new_data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">uid</span><span class="p">,</span> <span class="n">target_tid</span><span class="p">,</span> <span class="n">rating_val</span><span class="p">])</span>
        <span class="n">new_data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">uid</span><span class="p">,</span> <span class="n">high_profile_tid</span><span class="p">,</span> <span class="n">rating_val</span><span class="p">])</span>
    <span class="n">new_ratings_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">new_data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Source&#39;</span><span class="p">,</span> <span class="s1">&#39;Target&#39;</span><span class="p">,</span> <span class="s1">&#39;Weight&#39;</span><span class="p">])</span>
    <span class="n">ratings2</span> <span class="o">=</span> <span class="n">ratings2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_ratings_df</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="c1"># Save poisoned dataset for further inspection or visualization in gephi</span>
    <span class="n">interactions2</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ratings2</span><span class="p">[</span><span class="s1">&#39;Source&#39;</span><span class="p">],</span> <span class="n">ratings2</span><span class="p">[</span><span class="s1">&#39;Target&#39;</span><span class="p">],</span> <span class="n">ratings2</span><span class="p">[</span><span class="s1">&#39;Weight&#39;</span><span class="p">]):</span>
        <span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">item</span>
        <span class="n">sid_label</span> <span class="o">=</span> <span class="n">sid_name</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="n">tid_label</span> <span class="o">=</span> <span class="n">tid_name</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">sid_label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">interactions2</span><span class="p">:</span>
            <span class="n">interactions2</span><span class="p">[</span><span class="n">sid_label</span><span class="p">]</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
        <span class="n">interactions2</span><span class="p">[</span><span class="n">sid_label</span><span class="p">][</span><span class="n">tid_label</span><span class="p">]</span> <span class="o">+=</span> <span class="n">r</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Source,Target,Weight</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">tw</span> <span class="ow">in</span> <span class="n">interactions2</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">tw</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ratings2</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="load-and-process-dataset">
<h1>Load and process dataset<a class="headerlink" href="#load-and-process-dataset" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!wget -q --show-progress https://github.com/r0zetta/collaborative_filtering/raw/main/US2020/anonymized_interactions.csv
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          anonymize   0%[                    ]       0  --.-KB/s               
anonymized_interact 100%[===================&gt;]   1.31M  --.-KB/s    in 0.02s   
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load and prepare raw data</span>
<span class="n">raw</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;anonymized_interactions.csv&quot;</span><span class="p">)</span>

<span class="c1"># Source ids (accounts that retweeted)</span>
<span class="n">sid_name</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">name_sid</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">sid</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">raw</span><span class="p">[</span><span class="s1">&#39;Source&#39;</span><span class="p">]:</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">name_sid</span><span class="p">:</span>
        <span class="n">name_sid</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">sid</span>
        <span class="n">sid_name</span><span class="p">[</span><span class="n">sid</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">sid</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="c1"># Target ids (accounts that received retweets)</span>
<span class="n">tid_name</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">name_tid</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">tid</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">raw</span><span class="p">[</span><span class="s1">&#39;Target&#39;</span><span class="p">]:</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">name_tid</span><span class="p">:</span>
        <span class="n">name_tid</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">tid</span>
        <span class="n">tid_name</span><span class="p">[</span><span class="n">tid</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">tid</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of retweeters: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">name_sid</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of retweeted: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">name_tid</span><span class="p">)))</span>
<span class="c1"># Assemble ratings dataframe used to train the model</span>
<span class="n">ratings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">ratings</span><span class="p">[</span><span class="s1">&#39;Source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">name_sid</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">raw</span><span class="p">[</span><span class="s1">&#39;Source&#39;</span><span class="p">]]</span>
<span class="n">ratings</span><span class="p">[</span><span class="s1">&#39;Target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">name_tid</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">raw</span><span class="p">[</span><span class="s1">&#39;Target&#39;</span><span class="p">]]</span>
<span class="n">ratings</span><span class="p">[</span><span class="s1">&#39;Weight&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw</span><span class="p">[</span><span class="s1">&#39;Weight&#39;</span><span class="p">]</span>
<span class="n">ratings</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of retweeters: 25137
Number of retweeted: 8405
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Source</th>
      <th>Target</th>
      <th>Weight</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>1</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>2</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>3</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>4</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ratings</span><span class="p">[</span><span class="s1">&#39;Source&#39;</span><span class="p">]))</span>
<span class="n">target_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ratings</span><span class="p">[</span><span class="s1">&#39;Target&#39;</span><span class="p">]))</span>
<span class="n">target_retweeted_by</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">target_retweeted_count</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">target_retweeters</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
<span class="n">target_source_count</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
<span class="n">source_retweeted</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">source_retweets</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
<span class="n">source_target_count</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
<span class="n">interactions</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ratings</span><span class="p">[</span><span class="s1">&#39;Source&#39;</span><span class="p">],</span> <span class="n">ratings</span><span class="p">[</span><span class="s1">&#39;Target&#39;</span><span class="p">],</span> <span class="n">ratings</span><span class="p">[</span><span class="s1">&#39;Weight&#39;</span><span class="p">]):</span>
    <span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">item</span>
    <span class="k">if</span> <span class="n">sid_name</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">interactions</span><span class="p">:</span>
        <span class="n">interactions</span><span class="p">[</span><span class="n">sid_name</span><span class="p">[</span><span class="n">s</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
    <span class="n">interactions</span><span class="p">[</span><span class="n">sid_name</span><span class="p">[</span><span class="n">s</span><span class="p">]][</span><span class="n">tid_name</span><span class="p">[</span><span class="n">t</span><span class="p">]]</span> <span class="o">+=</span> <span class="n">r</span>
    <span class="n">source_retweets</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">+=</span> <span class="n">r</span>
    <span class="k">if</span> <span class="n">t</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">target_retweeted_count</span><span class="p">:</span>
        <span class="n">target_retweeted_count</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
    <span class="n">target_retweeted_count</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span>
    <span class="k">if</span> <span class="n">s</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">source_retweeted</span><span class="p">:</span>
        <span class="n">source_retweeted</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">t</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">source_retweeted</span><span class="p">[</span><span class="n">s</span><span class="p">]:</span>
        <span class="n">source_retweeted</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="n">source_target_count</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">t</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">target_retweeted_by</span><span class="p">:</span>
        <span class="n">target_retweeted_by</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">s</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">target_retweeted_by</span><span class="p">[</span><span class="n">t</span><span class="p">]:</span>
        <span class="n">target_retweeted_by</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">target_source_count</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">target_retweeters</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;labeled_ratings.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Source,Target,Weight</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">tw</span> <span class="ow">in</span> <span class="n">interactions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">tw</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of sources: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">source_list</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of targets: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">target_list</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Total number of retweet interactions: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">ratings</span><span class="p">[</span><span class="s1">&#39;Weight&#39;</span><span class="p">])))</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Targets with most retweets&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;tid</span><span class="se">\t</span><span class="s2">retweets&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">target_retweeters</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">tid_name</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Targets with most unique sources retweeting them&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;tid</span><span class="se">\t</span><span class="s2">sources&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">target_source_count</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">tid_name</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
<span class="nb">print</span><span class="p">()</span>
<span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">target_retweeters</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">also_retweeted</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">sid</span><span class="p">,</span> <span class="n">tids</span> <span class="ow">in</span> <span class="n">source_retweeted</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tids</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">tid</span> <span class="ow">in</span> <span class="n">tids</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">tid</span> <span class="o">!=</span> <span class="n">x</span><span class="p">:</span>
                        <span class="n">also_retweeted</span><span class="p">[</span><span class="n">tid</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Sources that retweeted &quot;</span> <span class="o">+</span> <span class="n">tid_name</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; also retweeted &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">also_retweeted</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; other accounts.&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">also_retweeted</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Retweeted &quot;</span> <span class="o">+</span> <span class="n">tid_name</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; times.&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

<span class="c1"># People who retweeted x also retweeted y</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sources that published the most retweets&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;sid</span><span class="se">\t</span><span class="s2">retweets&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">source_retweets</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">sid_name</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
<span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sources that retweeted the most unique targets&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;sid</span><span class="se">\t</span><span class="s2">targets&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">source_target_count</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">sid_name</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
    
<span class="n">communities</span> <span class="o">=</span> <span class="n">get_communities</span><span class="p">(</span><span class="n">interactions</span><span class="p">)</span>
<span class="n">community_sids</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">community_sizes</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
<span class="k">for</span> <span class="n">mod</span><span class="p">,</span> <span class="n">names</span> <span class="ow">in</span> <span class="n">communities</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">community_sizes</span><span class="p">[</span><span class="n">mod</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">communities</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">community_sizes</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of sources: 25137
Number of targets: 8405
Total number of retweet interactions: 95893

Targets with most retweets
tid	retweets
user_025343	5477
user_000009	3480
user_020135	2350
user_001418	2323
user_001690	1708
user_000755	1100
user_004286	1067
user_025303	788
user_004000	750
user_000596	638

Targets with most unique sources retweeting them
tid	sources
user_025343	5477
user_000009	3480
user_020135	2350
user_001418	2323
user_001690	1708
user_000755	1100
user_004286	1067
user_025303	788
user_004000	750
user_000596	638

Sources that retweeted user_025343 also retweeted 873 other accounts.
Retweeted user_000009 195 times.
Retweeted user_001418 116 times.
Retweeted user_020135 105 times.
Retweeted user_000755 85 times.
Retweeted user_004286 62 times.
Retweeted user_000596 52 times.
Retweeted user_001690 52 times.
Retweeted user_000107 46 times.
Retweeted user_004000 30 times.
Retweeted user_000340 27 times.

Sources that retweeted user_000009 also retweeted 1992 other accounts.
Retweeted user_025343 195 times.
Retweeted user_000755 112 times.
Retweeted user_001418 104 times.
Retweeted user_020135 74 times.
Retweeted user_004286 71 times.
Retweeted user_025303 66 times.
Retweeted user_000107 63 times.
Retweeted user_004000 51 times.
Retweeted user_006266 47 times.
Retweeted user_000596 46 times.

Sources that retweeted user_020135 also retweeted 3539 other accounts.
Retweeted user_025343 105 times.
Retweeted user_000009 74 times.
Retweeted user_001418 60 times.
Retweeted user_000755 35 times.
Retweeted user_025303 33 times.
Retweeted user_004286 23 times.
Retweeted user_004000 18 times.
Retweeted user_000107 18 times.
Retweeted user_025962 17 times.
Retweeted user_025212 15 times.

Sources that retweeted user_001418 also retweeted 1878 other accounts.
Retweeted user_025343 116 times.
Retweeted user_000009 104 times.
Retweeted user_020135 60 times.
Retweeted user_000107 55 times.
Retweeted user_000755 50 times.
Retweeted user_025303 39 times.
Retweeted user_004286 26 times.
Retweeted user_004000 25 times.
Retweeted user_001419 25 times.
Retweeted user_025171 21 times.

Sources that retweeted user_001690 also retweeted 336 other accounts.
Retweeted user_025343 52 times.
Retweeted user_025233 51 times.
Retweeted user_031320 46 times.
Retweeted user_031116 43 times.
Retweeted user_025301 38 times.
Retweeted user_026043 35 times.
Retweeted user_026835 34 times.
Retweeted user_025396 30 times.
Retweeted user_000009 28 times.
Retweeted user_001418 20 times.

Sources that retweeted user_000755 also retweeted 2308 other accounts.
Retweeted user_000009 112 times.
Retweeted user_025343 85 times.
Retweeted user_004286 81 times.
Retweeted user_006266 71 times.
Retweeted user_000596 68 times.
Retweeted user_001418 50 times.
Retweeted user_020135 35 times.
Retweeted user_000340 32 times.
Retweeted user_004000 30 times.
Retweeted user_000107 29 times.

Sources that retweeted user_004286 also retweeted 1583 other accounts.
Retweeted user_000340 119 times.
Retweeted user_000755 81 times.
Retweeted user_000009 71 times.
Retweeted user_025343 62 times.
Retweeted user_004347 59 times.
Retweeted user_006266 44 times.
Retweeted user_000596 27 times.
Retweeted user_001418 26 times.
Retweeted user_020135 23 times.
Retweeted user_004000 19 times.

Sources that retweeted user_025303 also retweeted 8317 other accounts.
Retweeted user_025962 101 times.
Retweeted user_025212 67 times.
Retweeted user_025233 66 times.
Retweeted user_000009 66 times.
Retweeted user_025171 58 times.
Retweeted user_026588 58 times.
Retweeted user_025194 57 times.
Retweeted user_025218 56 times.
Retweeted user_016570 54 times.
Retweeted user_026156 51 times.

Sources that retweeted user_004000 also retweeted 376 other accounts.
Retweeted user_000009 51 times.
Retweeted user_000596 32 times.
Retweeted user_000755 30 times.
Retweeted user_025343 30 times.
Retweeted user_001418 25 times.
Retweeted user_004286 19 times.
Retweeted user_020135 18 times.
Retweeted user_025303 14 times.
Retweeted user_006266 12 times.
Retweeted user_000392 11 times.

Sources that retweeted user_000596 also retweeted 514 other accounts.
Retweeted user_000755 68 times.
Retweeted user_025343 52 times.
Retweeted user_000009 46 times.
Retweeted user_004000 32 times.
Retweeted user_004286 27 times.
Retweeted user_001418 21 times.
Retweeted user_000340 18 times.
Retweeted user_006266 16 times.
Retweeted user_004347 14 times.
Retweeted user_020135 14 times.


Sources that published the most retweets
sid	retweets
user_000237	3762
user_000003	3614
user_000077	2338
user_004286	2230
user_000340	1891
user_001366	1788
user_001560	1766
user_000048	1648
user_000229	1639
user_000022	1574

Sources that retweeted the most unique targets
sid	targets
user_000237	1458
user_000003	1438
user_000077	1179
user_000048	772
user_000107	750
user_000229	721
user_000251	693
user_000022	650
user_000000	597
user_000340	593
20
Counter({4: 6788, 16: 4731, 14: 2832, 7: 2200, 6: 2128, 15: 2118, 13: 2027, 8: 1790, 5: 1732, 18: 1700, 19: 1403, 11: 1011, 17: 380, 9: 368, 0: 316, 1: 263, 12: 169, 10: 65, 2: 15, 3: 10})
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="choose-accounts-for-poisoning-experiment">
<h1>Choose accounts for poisoning experiment<a class="headerlink" href="#choose-accounts-for-poisoning-experiment" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Here a target to be boosted and a high-profile account that the target should be seen as similar are picked</span>
<span class="c1"># high_profile_tid was chosen from the original labeled dataset.</span>
<span class="c1"># It is a high-profile Twitter account that gets a lot of engagement</span>
<span class="n">high_profile_tid</span> <span class="o">=</span> <span class="mi">191</span>
<span class="n">high_profile_name</span> <span class="o">=</span> <span class="n">tid_name</span><span class="p">[</span><span class="n">high_profile_tid</span><span class="p">]</span>
<span class="n">high_profile_sid</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">if</span> <span class="n">high_profile_name</span> <span class="ow">in</span> <span class="n">name_sid</span><span class="p">:</span>
    <span class="n">high_profile_sid</span> <span class="o">=</span> <span class="n">name_sid</span><span class="p">[</span><span class="n">high_profile_name</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;high_profile_tid: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">high_profile_tid</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; == &quot;</span> <span class="o">+</span> <span class="n">tid_name</span><span class="p">[</span><span class="n">high_profile_tid</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;high_profile_sid: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">high_profile_sid</span><span class="p">))</span>
<span class="c1"># The target account was selected based on a few criteria:</span>
<span class="c1"># - it is highly retweeted in the original dataset (top 10)</span>
<span class="c1"># - the original dataset contains plenty of accounts that haven&#39;t retweeted it and high_profile_tid</span>
<span class="c1">#   (thus enabling us to create a large number of amplifier candidates below)</span>
<span class="n">target_tid</span> <span class="o">=</span> <span class="mi">4451</span>
<span class="n">target_name</span> <span class="o">=</span> <span class="n">tid_name</span><span class="p">[</span><span class="n">target_tid</span><span class="p">]</span>
<span class="n">target_sid</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">if</span> <span class="n">target_name</span> <span class="ow">in</span> <span class="n">name_sid</span><span class="p">:</span>
    <span class="n">target_sid</span> <span class="o">=</span> <span class="n">name_sid</span><span class="p">[</span><span class="n">target_name</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;target_tid: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">target_tid</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; == &quot;</span> <span class="o">+</span> <span class="n">tid_name</span><span class="p">[</span><span class="n">target_tid</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;target_sid: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">target_sid</span><span class="p">))</span>
<span class="c1"># Feel free to change these values for other experiments</span>

<span class="c1"># Pick a list of accounts that engaged with the high profile account in order to compare</span>
<span class="c1"># similarity values before and after poisoning</span>
<span class="n">num_controls</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">control_candidates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">sid</span><span class="p">,</span> <span class="n">tids</span> <span class="ow">in</span> <span class="n">source_retweeted</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">high_profile_tid</span> <span class="ow">in</span> <span class="n">tids</span><span class="p">:</span>
            <span class="n">control_candidates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sid</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Candidates for control accounts: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">control_candidates</span><span class="p">)))</span>
<span class="n">controls</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">control_candidates</span><span class="p">,</span> <span class="n">num_controls</span><span class="p">)</span>
<span class="c1"># For consistency&#39;s sake, here&#39;s a hard-coded list of control candidates </span>
<span class="c1"># (selected by running the above code once)</span>
<span class="c1"># controls = [229, 6266, 340, 124, 25, 4000, 89, 4347, 1947, 20144, 14, 22, 107, 13426, 237, 708, 1560, 62, 9, 11]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">controls</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>high_profile_tid: 191 == user_025303
high_profile_sid: None
target_tid: 4451 == user_004286
target_sid: 4286
Candidates for control accounts: 53
[41, 1399, 6266, 14, 128, 25, 708, 408, 614, 1560, 280, 89, 22, 4286, 3, 1608, 350, 0, 4000, 130]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Find accounts that engaged with both high_profile and target</span>
<span class="n">retweeted_target</span> <span class="o">=</span> <span class="n">target_retweeted_by</span><span class="p">[</span><span class="n">target_tid</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of accounts that retweeted target:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">retweeted_target</span><span class="p">))</span>
<span class="n">retweeted_high_profile</span> <span class="o">=</span> <span class="n">target_retweeted_by</span><span class="p">[</span><span class="n">high_profile_tid</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of accounts that retweeted high-profile:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">retweeted_high_profile</span><span class="p">))</span>
<span class="n">retweeted_both</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">retweeted_target</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">retweeted_high_profile</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of accounts that retweeted both:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">retweeted_both</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of accounts that retweeted target:
1067
Number of accounts that retweeted high-profile:
788
Number of accounts that retweeted both:
13
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Feature analysis of communities </span>

<span class="n">retweeted_target</span> <span class="o">=</span> <span class="n">target_retweeted_by</span><span class="p">[</span><span class="n">target_tid</span><span class="p">]</span>
<span class="n">retweeted_target_count</span> <span class="o">=</span> <span class="n">target_retweeted_count</span><span class="p">[</span><span class="n">target_tid</span><span class="p">]</span>
<span class="n">retweeted_high_profile</span> <span class="o">=</span> <span class="n">target_retweeted_by</span><span class="p">[</span><span class="n">high_profile_tid</span><span class="p">]</span>
<span class="n">retweeted_high_profile_count</span> <span class="o">=</span> <span class="n">target_retweeted_count</span><span class="p">[</span><span class="n">high_profile_tid</span><span class="p">]</span>

<span class="n">G</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="n">make_nx_graph</span><span class="p">(</span><span class="n">interactions</span><span class="p">)</span>
<span class="n">pr</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">pagerank</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>

<span class="n">num_amplifiers</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">community_features</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">mod</span><span class="p">,</span> <span class="n">names</span> <span class="ow">in</span> <span class="n">communities</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">amplifier_candidates</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">name_sid</span><span class="p">:</span>
            <span class="n">sid</span> <span class="o">=</span> <span class="n">name_sid</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">sid</span> <span class="ow">in</span> <span class="n">source_retweeted</span><span class="p">:</span>
                <span class="n">rtw</span> <span class="o">=</span> <span class="n">source_retweeted</span><span class="p">[</span><span class="n">sid</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">high_profile_tid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rtw</span> <span class="ow">and</span> <span class="n">target_tid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rtw</span><span class="p">:</span>
                    <span class="n">amplifier_candidates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sid</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">amplifier_candidates</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">num_amplifiers</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mod: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; size: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)))</span>
    <span class="n">community_features</span><span class="p">[</span><span class="n">mod</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">community_features</span><span class="p">[</span><span class="n">mod</span><span class="p">][</span><span class="s2">&quot;Community size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
    
    <span class="n">community_total_retweets</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">name_sid</span><span class="p">:</span>
            <span class="n">community_total_retweets</span> <span class="o">+=</span> <span class="n">source_retweets</span><span class="p">[</span><span class="n">name_sid</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span>
    <span class="n">community_features</span><span class="p">[</span><span class="n">mod</span><span class="p">][</span><span class="s2">&quot;Total retweets&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">community_total_retweets</span>

    <span class="n">mpr</span> <span class="o">=</span> <span class="n">get_mean</span><span class="p">(</span><span class="n">pr</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span>
    <span class="n">community_features</span><span class="p">[</span><span class="n">mod</span><span class="p">][</span><span class="s1">&#39;Mean pagerank * 10e5&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mpr</span> <span class="o">*</span> <span class="mi">100000</span>

    <span class="n">jaccard</span> <span class="o">=</span> <span class="n">get_jaccard_mean</span><span class="p">(</span><span class="n">interactions</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">target_name</span><span class="p">)</span>
    <span class="n">mod_name</span> <span class="o">=</span> <span class="s1">&#39;Mean Jaccard coefficient between accounts in community and target * 10e4&#39;</span>
    <span class="n">community_features</span><span class="p">[</span><span class="n">mod</span><span class="p">][</span><span class="n">mod_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">jaccard</span> <span class="o">*</span> <span class="mi">10000</span>

    <span class="n">sid_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">name_sid</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">names</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">name_sid</span><span class="p">]</span>
    <span class="n">rtw_target_sids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">retweeted_target</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">sid_list</span><span class="p">))</span>
    <span class="n">community_features</span><span class="p">[</span><span class="n">mod</span><span class="p">][</span><span class="s1">&#39;Unique accounts in community that retweeted target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rtw_target_sids</span><span class="p">)</span>
    <span class="n">rtw_target_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">sid</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">retweeted_target_count</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">sid</span> <span class="ow">in</span> <span class="n">rtw_target_sids</span><span class="p">:</span>
            <span class="n">rtw_target_count</span> <span class="o">+=</span> <span class="n">count</span>
    <span class="n">community_features</span><span class="p">[</span><span class="n">mod</span><span class="p">][</span><span class="s1">&#39;Total retweets of target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rtw_target_count</span>
    <span class="n">rhps</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">retweeted_high_profile</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">sid_list</span><span class="p">))</span>
    <span class="n">community_features</span><span class="p">[</span><span class="n">mod</span><span class="p">][</span><span class="s1">&#39;Unique accounts in community that retweeted high-profile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rhps</span><span class="p">)</span>
    <span class="n">rhpc</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">sid</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">retweeted_high_profile_count</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">sid</span> <span class="ow">in</span> <span class="n">rhps</span><span class="p">:</span>
            <span class="n">rhpc</span> <span class="o">+=</span> <span class="n">count</span>
    <span class="n">community_features</span><span class="p">[</span><span class="n">mod</span><span class="p">][</span><span class="s1">&#39;Total retweets of high-profile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rhpc</span>
    <span class="n">community_retweet_counts</span> <span class="o">=</span> <span class="p">[</span><span class="n">source_retweets</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sid_list</span><span class="p">]</span>
    <span class="n">community_features</span><span class="p">[</span><span class="n">mod</span><span class="p">][</span><span class="s1">&#39;Mean retweets per account&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">community_retweet_counts</span><span class="p">)</span>
    <span class="n">community_features</span><span class="p">[</span><span class="n">mod</span><span class="p">][</span><span class="s1">&#39;Max retweet count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">community_retweet_counts</span><span class="p">)</span>
    
    <span class="n">controls_in_mod</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">sid_list</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">controls</span><span class="p">))</span>
    <span class="n">community_features</span><span class="p">[</span><span class="n">mod</span><span class="p">][</span><span class="s1">&#39;Number of control accounts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">controls_in_mod</span><span class="p">)</span>
        
    <span class="n">rtw_controls_sids</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">rtw_controls_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">sid</span> <span class="ow">in</span> <span class="n">controls</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">sid</span> <span class="ow">in</span> <span class="n">target_retweeted_count</span><span class="p">:</span>
            <span class="n">rcl</span> <span class="o">=</span> <span class="n">target_retweeted_count</span><span class="p">[</span><span class="n">sid</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">rcl</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sid_list</span><span class="p">:</span>
                    <span class="n">rtw_controls_sids</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">rtw_controls_count</span> <span class="o">+=</span> <span class="n">c</span>
    <span class="n">community_features</span><span class="p">[</span><span class="n">mod</span><span class="p">][</span><span class="s1">&#39;Accounts in this community that retweeted control accounts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rtw_controls_sids</span>
    <span class="n">community_features</span><span class="p">[</span><span class="n">mod</span><span class="p">][</span><span class="s1">&#39;Total control account retweets published by this community&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rtw_controls_count</span>
    
    <span class="n">target_mean_path_len</span> <span class="o">=</span> <span class="n">get_mean_distance</span><span class="p">(</span><span class="n">interactions</span><span class="p">,</span> <span class="n">target_name</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span>
    <span class="n">community_features</span><span class="p">[</span><span class="n">mod</span><span class="p">][</span><span class="s1">&#39;Mean path length between community nodes and target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target_mean_path_len</span>

<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">community_features</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mod: 5 size: 1732
Mod: 4 size: 6788
Mod: 13 size: 2027
Mod: 6 size: 2128
Mod: 7 size: 2200
Mod: 8 size: 1790
Mod: 9 size: 368
Mod: 11 size: 1011
Mod: 0 size: 316
Mod: 14 size: 2832
Mod: 15 size: 2118
Mod: 16 size: 4731
Mod: 18 size: 1700
Mod: 19 size: 1403
Mod: 1 size: 263
{
    &quot;5&quot;: {
        &quot;Community size&quot;: 1732,
        &quot;Total retweets&quot;: 6993,
        &quot;Mean pagerank * 10e5&quot;: 3.3609910753994643,
        &quot;Mean Jaccard coefficient between accounts in community and target * 10e4&quot;: 2.464483096763413,
        &quot;Unique accounts in community that retweeted target&quot;: 25,
        &quot;Total retweets of target&quot;: 30,
        &quot;Unique accounts in community that retweeted high-profile&quot;: 17,
        &quot;Total retweets of high-profile&quot;: 179,
        &quot;Mean retweets per account&quot;: 12.4875,
        &quot;Max retweet count&quot;: 3614,
        &quot;Number of control accounts&quot;: 3,
        &quot;Accounts in this community that retweeted control accounts&quot;: 16,
        &quot;Total control account retweets published by this community&quot;: 41,
        &quot;Mean path length between community nodes and target&quot;: 2.8204387990762125
    },
    &quot;4&quot;: {
        &quot;Community size&quot;: 6788,
        &quot;Total retweets&quot;: 30847,
        &quot;Mean pagerank * 10e5&quot;: 3.8704404375633885,
        &quot;Mean Jaccard coefficient between accounts in community and target * 10e4&quot;: 2.601203270529362,
        &quot;Unique accounts in community that retweeted target&quot;: 45,
        &quot;Total retweets of target&quot;: 45,
        &quot;Unique accounts in community that retweeted high-profile&quot;: 451,
        &quot;Total retweets of high-profile&quot;: 1918,
        &quot;Mean retweets per account&quot;: 10.428329952670724,
        &quot;Max retweet count&quot;: 3762,
        &quot;Number of control accounts&quot;: 12,
        &quot;Accounts in this community that retweeted control accounts&quot;: 51,
        &quot;Total control account retweets published by this community&quot;: 163,
        &quot;Mean path length between community nodes and target&quot;: 2.8267530936947556
    },
    &quot;13&quot;: {
        &quot;Community size&quot;: 2027,
        &quot;Total retweets&quot;: 8341,
        &quot;Mean pagerank * 10e5&quot;: 3.0427188437092,
        &quot;Mean Jaccard coefficient between accounts in community and target * 10e4&quot;: 10.338629393017436,
        &quot;Unique accounts in community that retweeted target&quot;: 810,
        &quot;Total retweets of target&quot;: 1866,
        &quot;Unique accounts in community that retweeted high-profile&quot;: 29,
        &quot;Total retweets of high-profile&quot;: 195,
        &quot;Mean retweets per account&quot;: 4.953087885985748,
        &quot;Max retweet count&quot;: 2230,
        &quot;Number of control accounts&quot;: 1,
        &quot;Accounts in this community that retweeted control accounts&quot;: 7,
        &quot;Total control account retweets published by this community&quot;: 14,
        &quot;Mean path length between community nodes and target&quot;: 1.6102614701529354
    },
    &quot;6&quot;: {
        &quot;Community size&quot;: 2128,
        &quot;Total retweets&quot;: 4002,
        &quot;Mean pagerank * 10e5&quot;: 2.657491775783397,
        &quot;Mean Jaccard coefficient between accounts in community and target * 10e4&quot;: 0.48294840862218325,
        &quot;Unique accounts in community that retweeted target&quot;: 5,
        &quot;Total retweets of target&quot;: 6,
        &quot;Unique accounts in community that retweeted high-profile&quot;: 24,
        &quot;Total retweets of high-profile&quot;: 93,
        &quot;Mean retweets per account&quot;: 1.9084406294706724,
        &quot;Max retweet count&quot;: 316,
        &quot;Number of control accounts&quot;: 0,
        &quot;Accounts in this community that retweeted control accounts&quot;: 2,
        &quot;Total control account retweets published by this community&quot;: 3,
        &quot;Mean path length between community nodes and target&quot;: 2.9572368421052633
    },
    &quot;7&quot;: {
        &quot;Community size&quot;: 2200,
        &quot;Total retweets&quot;: 2937,
        &quot;Mean pagerank * 10e5&quot;: 2.7137859935440716,
        &quot;Mean Jaccard coefficient between accounts in community and target * 10e4&quot;: 0.23498782080449318,
        &quot;Unique accounts in community that retweeted target&quot;: 12,
        &quot;Total retweets of target&quot;: 12,
        &quot;Unique accounts in community that retweeted high-profile&quot;: 18,
        &quot;Total retweets of high-profile&quot;: 21,
        &quot;Mean retweets per account&quot;: 1.3522099447513811,
        &quot;Max retweet count&quot;: 99,
        &quot;Number of control accounts&quot;: 0,
        &quot;Accounts in this community that retweeted control accounts&quot;: 0,
        &quot;Total control account retweets published by this community&quot;: 0,
        &quot;Mean path length between community nodes and target&quot;: 2.9754545454545456
    },
    &quot;8&quot;: {
        &quot;Community size&quot;: 1790,
        &quot;Total retweets&quot;: 2903,
        &quot;Mean pagerank * 10e5&quot;: 2.462985992896287,
        &quot;Mean Jaccard coefficient between accounts in community and target * 10e4&quot;: 3.0160866817603185,
        &quot;Unique accounts in community that retweeted target&quot;: 8,
        &quot;Total retweets of target&quot;: 15,
        &quot;Unique accounts in community that retweeted high-profile&quot;: 143,
        &quot;Total retweets of high-profile&quot;: 144,
        &quot;Mean retweets per account&quot;: 1.6579097658480868,
        &quot;Max retweet count&quot;: 14,
        &quot;Number of control accounts&quot;: 0,
        &quot;Accounts in this community that retweeted control accounts&quot;: 0,
        &quot;Total control account retweets published by this community&quot;: 0,
        &quot;Mean path length between community nodes and target&quot;: 2.7290502793296088
    },
    &quot;9&quot;: {
        &quot;Community size&quot;: 368,
        &quot;Total retweets&quot;: 916,
        &quot;Mean pagerank * 10e5&quot;: 2.4530808698514166,
        &quot;Mean Jaccard coefficient between accounts in community and target * 10e4&quot;: 1.119970402798572,
        &quot;Unique accounts in community that retweeted target&quot;: 2,
        &quot;Total retweets of target&quot;: 2,
        &quot;Unique accounts in community that retweeted high-profile&quot;: 4,
        &quot;Total retweets of high-profile&quot;: 26,
        &quot;Mean retweets per account&quot;: 3.7387755102040816,
        &quot;Max retweet count&quot;: 453,
        &quot;Number of control accounts&quot;: 0,
        &quot;Accounts in this community that retweeted control accounts&quot;: 0,
        &quot;Total control account retweets published by this community&quot;: 0,
        &quot;Mean path length between community nodes and target&quot;: 2.9375
    },
    &quot;11&quot;: {
        &quot;Community size&quot;: 1011,
        &quot;Total retweets&quot;: 2753,
        &quot;Mean pagerank * 10e5&quot;: 2.533428400347708,
        &quot;Mean Jaccard coefficient between accounts in community and target * 10e4&quot;: 1.4985948455454323,
        &quot;Unique accounts in community that retweeted target&quot;: 16,
        &quot;Total retweets of target&quot;: 16,
        &quot;Unique accounts in community that retweeted high-profile&quot;: 5,
        &quot;Total retweets of high-profile&quot;: 67,
        &quot;Mean retweets per account&quot;: 4.066469719350074,
        &quot;Max retweet count&quot;: 1337,
        &quot;Number of control accounts&quot;: 0,
        &quot;Accounts in this community that retweeted control accounts&quot;: 8,
        &quot;Total control account retweets published by this community&quot;: 10,
        &quot;Mean path length between community nodes and target&quot;: 2.8793273986152323
    },
    &quot;0&quot;: {
        &quot;Community size&quot;: 316,
        &quot;Total retweets&quot;: 422,
        &quot;Mean pagerank * 10e5&quot;: 2.4167147539962066,
        &quot;Mean Jaccard coefficient between accounts in community and target * 10e4&quot;: 0.3843263949190513,
        &quot;Unique accounts in community that retweeted target&quot;: 0,
        &quot;Total retweets of target&quot;: 0,
        &quot;Unique accounts in community that retweeted high-profile&quot;: 2,
        &quot;Total retweets of high-profile&quot;: 8,
        &quot;Mean retweets per account&quot;: 1.5071428571428571,
        &quot;Max retweet count&quot;: 83,
        &quot;Number of control accounts&quot;: 0,
        &quot;Accounts in this community that retweeted control accounts&quot;: 0,
        &quot;Total control account retweets published by this community&quot;: 0,
        &quot;Mean path length between community nodes and target&quot;: 2.9873417721518987
    },
    &quot;14&quot;: {
        &quot;Community size&quot;: 2832,
        &quot;Total retweets&quot;: 8948,
        &quot;Mean pagerank * 10e5&quot;: 3.28031447262505,
        &quot;Mean Jaccard coefficient between accounts in community and target * 10e4&quot;: 0.6513799766556582,
        &quot;Unique accounts in community that retweeted target&quot;: 17,
        &quot;Total retweets of target&quot;: 18,
        &quot;Unique accounts in community that retweeted high-profile&quot;: 48,
        &quot;Total retweets of high-profile&quot;: 146,
        &quot;Mean retweets per account&quot;: 3.1934332619557457,
        &quot;Max retweet count&quot;: 474,
        &quot;Number of control accounts&quot;: 0,
        &quot;Accounts in this community that retweeted control accounts&quot;: 28,
        &quot;Total control account retweets published by this community&quot;: 33,
        &quot;Mean path length between community nodes and target&quot;: 2.9304378531073447
    },
    &quot;15&quot;: {
        &quot;Community size&quot;: 2118,
        &quot;Total retweets&quot;: 7996,
        &quot;Mean pagerank * 10e5&quot;: 3.0658868074881442,
        &quot;Mean Jaccard coefficient between accounts in community and target * 10e4&quot;: 8.101145425432588,
        &quot;Unique accounts in community that retweeted target&quot;: 87,
        &quot;Total retweets of target&quot;: 133,
        &quot;Unique accounts in community that retweeted high-profile&quot;: 20,
        &quot;Total retweets of high-profile&quot;: 175,
        &quot;Mean retweets per account&quot;: 4.776583034647551,
        &quot;Max retweet count&quot;: 1559,
        &quot;Number of control accounts&quot;: 1,
        &quot;Accounts in this community that retweeted control accounts&quot;: 1,
        &quot;Total control account retweets published by this community&quot;: 1,
        &quot;Mean path length between community nodes and target&quot;: 2.076487252124646
    },
    &quot;16&quot;: {
        &quot;Community size&quot;: 4731,
        &quot;Total retweets&quot;: 7462,
        &quot;Mean pagerank * 10e5&quot;: 2.9388526883025943,
        &quot;Mean Jaccard coefficient between accounts in community and target * 10e4&quot;: 0.07620219836547157,
        &quot;Unique accounts in community that retweeted target&quot;: 6,
        &quot;Total retweets of target&quot;: 6,
        &quot;Unique accounts in community that retweeted high-profile&quot;: 3,
        &quot;Total retweets of high-profile&quot;: 3,
        &quot;Mean retweets per account&quot;: 1.5775898520084566,
        &quot;Max retweet count&quot;: 47,
        &quot;Number of control accounts&quot;: 0,
        &quot;Accounts in this community that retweeted control accounts&quot;: 0,
        &quot;Total control account retweets published by this community&quot;: 0,
        &quot;Mean path length between community nodes and target&quot;: 2.990276897061932
    },
    &quot;18&quot;: {
        &quot;Community size&quot;: 1700,
        &quot;Total retweets&quot;: 5060,
        &quot;Mean pagerank * 10e5&quot;: 3.1481328039343177,
        &quot;Mean Jaccard coefficient between accounts in community and target * 10e4&quot;: 0.4859522880791683,
        &quot;Unique accounts in community that retweeted target&quot;: 3,
        &quot;Total retweets of target&quot;: 4,
        &quot;Unique accounts in community that retweeted high-profile&quot;: 5,
        &quot;Total retweets of high-profile&quot;: 8,
        &quot;Mean retweets per account&quot;: 2.987012987012987,
        &quot;Max retweet count&quot;: 200,
        &quot;Number of control accounts&quot;: 0,
        &quot;Accounts in this community that retweeted control accounts&quot;: 0,
        &quot;Total control account retweets published by this community&quot;: 0,
        &quot;Mean path length between community nodes and target&quot;: 2.9870588235294115
    },
    &quot;19&quot;: {
        &quot;Community size&quot;: 1403,
        &quot;Total retweets&quot;: 4509,
        &quot;Mean pagerank * 10e5&quot;: 2.9641682427635305,
        &quot;Mean Jaccard coefficient between accounts in community and target * 10e4&quot;: 1.35368187770119,
        &quot;Unique accounts in community that retweeted target&quot;: 26,
        &quot;Total retweets of target&quot;: 29,
        &quot;Unique accounts in community that retweeted high-profile&quot;: 13,
        &quot;Total retweets of high-profile&quot;: 25,
        &quot;Mean retweets per account&quot;: 3.349925705794948,
        &quot;Max retweet count&quot;: 839,
        &quot;Number of control accounts&quot;: 1,
        &quot;Accounts in this community that retweeted control accounts&quot;: 1,
        &quot;Total control account retweets published by this community&quot;: 1,
        &quot;Mean path length between community nodes and target&quot;: 2.888096935138988
    },
    &quot;1&quot;: {
        &quot;Community size&quot;: 263,
        &quot;Total retweets&quot;: 300,
        &quot;Mean pagerank * 10e5&quot;: 2.7254952136734767,
        &quot;Mean Jaccard coefficient between accounts in community and target * 10e4&quot;: 0.10385694246498493,
        &quot;Unique accounts in community that retweeted target&quot;: 1,
        &quot;Total retweets of target&quot;: 1,
        &quot;Unique accounts in community that retweeted high-profile&quot;: 0,
        &quot;Total retweets of high-profile&quot;: 0,
        &quot;Mean retweets per account&quot;: 1.1406844106463878,
        &quot;Max retweet count&quot;: 4,
        &quot;Number of control accounts&quot;: 0,
        &quot;Accounts in this community that retweeted control accounts&quot;: 0,
        &quot;Total control account retweets published by this community&quot;: 0,
        &quot;Mean path length between community nodes and target&quot;: 2.9771863117870723
    }
}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">highlight_max</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="n">is_max</span> <span class="o">=</span> <span class="n">s</span> <span class="o">==</span> <span class="n">s</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;background-color: yellow&#39;</span> <span class="k">if</span> <span class="n">v</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">is_max</span><span class="p">]</span>
<span class="k">def</span> <span class="nf">highlight_min</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="n">is_min</span> <span class="o">=</span> <span class="n">s</span> <span class="o">==</span> <span class="n">s</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;background-color: orange&#39;</span> <span class="k">if</span> <span class="n">v</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">is_min</span><span class="p">]</span>
<span class="n">fe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">community_features</span><span class="p">)</span>
<span class="n">fe</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">highlight_max</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">highlight_min</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style  type="text/css" >
#T_d5de2536_244c_11ec_a99c_0242ac1c0002row0_col1,#T_d5de2536_244c_11ec_a99c_0242ac1c0002row1_col1,#T_d5de2536_244c_11ec_a99c_0242ac1c0002row2_col1,#T_d5de2536_244c_11ec_a99c_0242ac1c0002row3_col2,#T_d5de2536_244c_11ec_a99c_0242ac1c0002row4_col2,#T_d5de2536_244c_11ec_a99c_0242ac1c0002row5_col2,#T_d5de2536_244c_11ec_a99c_0242ac1c0002row6_col1,#T_d5de2536_244c_11ec_a99c_0242ac1c0002row7_col1,#T_d5de2536_244c_11ec_a99c_0242ac1c0002row8_col0,#T_d5de2536_244c_11ec_a99c_0242ac1c0002row9_col1,#T_d5de2536_244c_11ec_a99c_0242ac1c0002row10_col1,#T_d5de2536_244c_11ec_a99c_0242ac1c0002row11_col1,#T_d5de2536_244c_11ec_a99c_0242ac1c0002row12_col1,#T_d5de2536_244c_11ec_a99c_0242ac1c0002row13_col11{
            background-color:  yellow;
        }#T_d5de2536_244c_11ec_a99c_0242ac1c0002row0_col14,#T_d5de2536_244c_11ec_a99c_0242ac1c0002row1_col14,#T_d5de2536_244c_11ec_a99c_0242ac1c0002row2_col8,#T_d5de2536_244c_11ec_a99c_0242ac1c0002row3_col11,#T_d5de2536_244c_11ec_a99c_0242ac1c0002row4_col8,#T_d5de2536_244c_11ec_a99c_0242ac1c0002row5_col8,#T_d5de2536_244c_11ec_a99c_0242ac1c0002row6_col14,#T_d5de2536_244c_11ec_a99c_0242ac1c0002row7_col14,#T_d5de2536_244c_11ec_a99c_0242ac1c0002row8_col14,#T_d5de2536_244c_11ec_a99c_0242ac1c0002row9_col14,#T_d5de2536_244c_11ec_a99c_0242ac1c0002row10_col3,#T_d5de2536_244c_11ec_a99c_0242ac1c0002row10_col4,#T_d5de2536_244c_11ec_a99c_0242ac1c0002row10_col5,#T_d5de2536_244c_11ec_a99c_0242ac1c0002row10_col6,#T_d5de2536_244c_11ec_a99c_0242ac1c0002row10_col7,#T_d5de2536_244c_11ec_a99c_0242ac1c0002row10_col8,#T_d5de2536_244c_11ec_a99c_0242ac1c0002row10_col9,#T_d5de2536_244c_11ec_a99c_0242ac1c0002row10_col11,#T_d5de2536_244c_11ec_a99c_0242ac1c0002row10_col12,#T_d5de2536_244c_11ec_a99c_0242ac1c0002row10_col14,#T_d5de2536_244c_11ec_a99c_0242ac1c0002row11_col4,#T_d5de2536_244c_11ec_a99c_0242ac1c0002row11_col5,#T_d5de2536_244c_11ec_a99c_0242ac1c0002row11_col6,#T_d5de2536_244c_11ec_a99c_0242ac1c0002row11_col8,#T_d5de2536_244c_11ec_a99c_0242ac1c0002row11_col11,#T_d5de2536_244c_11ec_a99c_0242ac1c0002row11_col12,#T_d5de2536_244c_11ec_a99c_0242ac1c0002row11_col14,#T_d5de2536_244c_11ec_a99c_0242ac1c0002row12_col4,#T_d5de2536_244c_11ec_a99c_0242ac1c0002row12_col5,#T_d5de2536_244c_11ec_a99c_0242ac1c0002row12_col6,#T_d5de2536_244c_11ec_a99c_0242ac1c0002row12_col8,#T_d5de2536_244c_11ec_a99c_0242ac1c0002row12_col11,#T_d5de2536_244c_11ec_a99c_0242ac1c0002row12_col12,#T_d5de2536_244c_11ec_a99c_0242ac1c0002row12_col14,#T_d5de2536_244c_11ec_a99c_0242ac1c0002row13_col2{
            background-color:  orange;
        }</style><table id="T_d5de2536_244c_11ec_a99c_0242ac1c0002" ><thead>    <tr>        <th class="blank level0" ></th>        <th class="col_heading level0 col0" >5</th>        <th class="col_heading level0 col1" >4</th>        <th class="col_heading level0 col2" >13</th>        <th class="col_heading level0 col3" >6</th>        <th class="col_heading level0 col4" >7</th>        <th class="col_heading level0 col5" >8</th>        <th class="col_heading level0 col6" >9</th>        <th class="col_heading level0 col7" >11</th>        <th class="col_heading level0 col8" >0</th>        <th class="col_heading level0 col9" >14</th>        <th class="col_heading level0 col10" >15</th>        <th class="col_heading level0 col11" >16</th>        <th class="col_heading level0 col12" >18</th>        <th class="col_heading level0 col13" >19</th>        <th class="col_heading level0 col14" >1</th>    </tr></thead><tbody>
                <tr>
                        <th id="T_d5de2536_244c_11ec_a99c_0242ac1c0002level0_row0" class="row_heading level0 row0" >Community size</th>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row0_col0" class="data row0 col0" >1732.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row0_col1" class="data row0 col1" >6788.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row0_col2" class="data row0 col2" >2027.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row0_col3" class="data row0 col3" >2128.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row0_col4" class="data row0 col4" >2200.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row0_col5" class="data row0 col5" >1790.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row0_col6" class="data row0 col6" >368.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row0_col7" class="data row0 col7" >1011.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row0_col8" class="data row0 col8" >316.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row0_col9" class="data row0 col9" >2832.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row0_col10" class="data row0 col10" >2118.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row0_col11" class="data row0 col11" >4731.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row0_col12" class="data row0 col12" >1700.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row0_col13" class="data row0 col13" >1403.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row0_col14" class="data row0 col14" >263.00</td>
            </tr>
            <tr>
                        <th id="T_d5de2536_244c_11ec_a99c_0242ac1c0002level0_row1" class="row_heading level0 row1" >Total retweets</th>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row1_col0" class="data row1 col0" >6993.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row1_col1" class="data row1 col1" >30847.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row1_col2" class="data row1 col2" >8341.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row1_col3" class="data row1 col3" >4002.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row1_col4" class="data row1 col4" >2937.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row1_col5" class="data row1 col5" >2903.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row1_col6" class="data row1 col6" >916.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row1_col7" class="data row1 col7" >2753.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row1_col8" class="data row1 col8" >422.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row1_col9" class="data row1 col9" >8948.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row1_col10" class="data row1 col10" >7996.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row1_col11" class="data row1 col11" >7462.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row1_col12" class="data row1 col12" >5060.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row1_col13" class="data row1 col13" >4509.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row1_col14" class="data row1 col14" >300.00</td>
            </tr>
            <tr>
                        <th id="T_d5de2536_244c_11ec_a99c_0242ac1c0002level0_row2" class="row_heading level0 row2" >Mean pagerank * 10e5</th>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row2_col0" class="data row2 col0" >3.36</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row2_col1" class="data row2 col1" >3.87</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row2_col2" class="data row2 col2" >3.04</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row2_col3" class="data row2 col3" >2.66</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row2_col4" class="data row2 col4" >2.71</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row2_col5" class="data row2 col5" >2.46</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row2_col6" class="data row2 col6" >2.45</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row2_col7" class="data row2 col7" >2.53</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row2_col8" class="data row2 col8" >2.42</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row2_col9" class="data row2 col9" >3.28</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row2_col10" class="data row2 col10" >3.07</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row2_col11" class="data row2 col11" >2.94</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row2_col12" class="data row2 col12" >3.15</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row2_col13" class="data row2 col13" >2.96</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row2_col14" class="data row2 col14" >2.73</td>
            </tr>
            <tr>
                        <th id="T_d5de2536_244c_11ec_a99c_0242ac1c0002level0_row3" class="row_heading level0 row3" >Mean Jaccard coefficient between accounts in community and target * 10e4</th>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row3_col0" class="data row3 col0" >2.46</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row3_col1" class="data row3 col1" >2.60</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row3_col2" class="data row3 col2" >10.34</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row3_col3" class="data row3 col3" >0.48</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row3_col4" class="data row3 col4" >0.23</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row3_col5" class="data row3 col5" >3.02</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row3_col6" class="data row3 col6" >1.12</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row3_col7" class="data row3 col7" >1.50</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row3_col8" class="data row3 col8" >0.38</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row3_col9" class="data row3 col9" >0.65</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row3_col10" class="data row3 col10" >8.10</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row3_col11" class="data row3 col11" >0.08</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row3_col12" class="data row3 col12" >0.49</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row3_col13" class="data row3 col13" >1.35</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row3_col14" class="data row3 col14" >0.10</td>
            </tr>
            <tr>
                        <th id="T_d5de2536_244c_11ec_a99c_0242ac1c0002level0_row4" class="row_heading level0 row4" >Unique accounts in community that retweeted target</th>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row4_col0" class="data row4 col0" >25.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row4_col1" class="data row4 col1" >45.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row4_col2" class="data row4 col2" >810.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row4_col3" class="data row4 col3" >5.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row4_col4" class="data row4 col4" >12.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row4_col5" class="data row4 col5" >8.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row4_col6" class="data row4 col6" >2.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row4_col7" class="data row4 col7" >16.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row4_col8" class="data row4 col8" >0.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row4_col9" class="data row4 col9" >17.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row4_col10" class="data row4 col10" >87.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row4_col11" class="data row4 col11" >6.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row4_col12" class="data row4 col12" >3.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row4_col13" class="data row4 col13" >26.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row4_col14" class="data row4 col14" >1.00</td>
            </tr>
            <tr>
                        <th id="T_d5de2536_244c_11ec_a99c_0242ac1c0002level0_row5" class="row_heading level0 row5" >Total retweets of target</th>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row5_col0" class="data row5 col0" >30.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row5_col1" class="data row5 col1" >45.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row5_col2" class="data row5 col2" >1866.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row5_col3" class="data row5 col3" >6.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row5_col4" class="data row5 col4" >12.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row5_col5" class="data row5 col5" >15.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row5_col6" class="data row5 col6" >2.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row5_col7" class="data row5 col7" >16.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row5_col8" class="data row5 col8" >0.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row5_col9" class="data row5 col9" >18.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row5_col10" class="data row5 col10" >133.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row5_col11" class="data row5 col11" >6.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row5_col12" class="data row5 col12" >4.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row5_col13" class="data row5 col13" >29.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row5_col14" class="data row5 col14" >1.00</td>
            </tr>
            <tr>
                        <th id="T_d5de2536_244c_11ec_a99c_0242ac1c0002level0_row6" class="row_heading level0 row6" >Unique accounts in community that retweeted high-profile</th>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row6_col0" class="data row6 col0" >17.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row6_col1" class="data row6 col1" >451.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row6_col2" class="data row6 col2" >29.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row6_col3" class="data row6 col3" >24.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row6_col4" class="data row6 col4" >18.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row6_col5" class="data row6 col5" >143.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row6_col6" class="data row6 col6" >4.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row6_col7" class="data row6 col7" >5.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row6_col8" class="data row6 col8" >2.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row6_col9" class="data row6 col9" >48.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row6_col10" class="data row6 col10" >20.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row6_col11" class="data row6 col11" >3.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row6_col12" class="data row6 col12" >5.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row6_col13" class="data row6 col13" >13.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row6_col14" class="data row6 col14" >0.00</td>
            </tr>
            <tr>
                        <th id="T_d5de2536_244c_11ec_a99c_0242ac1c0002level0_row7" class="row_heading level0 row7" >Total retweets of high-profile</th>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row7_col0" class="data row7 col0" >179.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row7_col1" class="data row7 col1" >1918.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row7_col2" class="data row7 col2" >195.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row7_col3" class="data row7 col3" >93.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row7_col4" class="data row7 col4" >21.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row7_col5" class="data row7 col5" >144.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row7_col6" class="data row7 col6" >26.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row7_col7" class="data row7 col7" >67.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row7_col8" class="data row7 col8" >8.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row7_col9" class="data row7 col9" >146.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row7_col10" class="data row7 col10" >175.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row7_col11" class="data row7 col11" >3.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row7_col12" class="data row7 col12" >8.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row7_col13" class="data row7 col13" >25.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row7_col14" class="data row7 col14" >0.00</td>
            </tr>
            <tr>
                        <th id="T_d5de2536_244c_11ec_a99c_0242ac1c0002level0_row8" class="row_heading level0 row8" >Mean retweets per account</th>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row8_col0" class="data row8 col0" >12.49</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row8_col1" class="data row8 col1" >10.43</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row8_col2" class="data row8 col2" >4.95</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row8_col3" class="data row8 col3" >1.91</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row8_col4" class="data row8 col4" >1.35</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row8_col5" class="data row8 col5" >1.66</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row8_col6" class="data row8 col6" >3.74</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row8_col7" class="data row8 col7" >4.07</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row8_col8" class="data row8 col8" >1.51</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row8_col9" class="data row8 col9" >3.19</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row8_col10" class="data row8 col10" >4.78</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row8_col11" class="data row8 col11" >1.58</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row8_col12" class="data row8 col12" >2.99</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row8_col13" class="data row8 col13" >3.35</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row8_col14" class="data row8 col14" >1.14</td>
            </tr>
            <tr>
                        <th id="T_d5de2536_244c_11ec_a99c_0242ac1c0002level0_row9" class="row_heading level0 row9" >Max retweet count</th>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row9_col0" class="data row9 col0" >3614.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row9_col1" class="data row9 col1" >3762.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row9_col2" class="data row9 col2" >2230.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row9_col3" class="data row9 col3" >316.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row9_col4" class="data row9 col4" >99.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row9_col5" class="data row9 col5" >14.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row9_col6" class="data row9 col6" >453.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row9_col7" class="data row9 col7" >1337.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row9_col8" class="data row9 col8" >83.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row9_col9" class="data row9 col9" >474.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row9_col10" class="data row9 col10" >1559.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row9_col11" class="data row9 col11" >47.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row9_col12" class="data row9 col12" >200.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row9_col13" class="data row9 col13" >839.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row9_col14" class="data row9 col14" >4.00</td>
            </tr>
            <tr>
                        <th id="T_d5de2536_244c_11ec_a99c_0242ac1c0002level0_row10" class="row_heading level0 row10" >Number of control accounts</th>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row10_col0" class="data row10 col0" >3.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row10_col1" class="data row10 col1" >12.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row10_col2" class="data row10 col2" >1.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row10_col3" class="data row10 col3" >0.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row10_col4" class="data row10 col4" >0.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row10_col5" class="data row10 col5" >0.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row10_col6" class="data row10 col6" >0.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row10_col7" class="data row10 col7" >0.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row10_col8" class="data row10 col8" >0.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row10_col9" class="data row10 col9" >0.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row10_col10" class="data row10 col10" >1.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row10_col11" class="data row10 col11" >0.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row10_col12" class="data row10 col12" >0.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row10_col13" class="data row10 col13" >1.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row10_col14" class="data row10 col14" >0.00</td>
            </tr>
            <tr>
                        <th id="T_d5de2536_244c_11ec_a99c_0242ac1c0002level0_row11" class="row_heading level0 row11" >Accounts in this community that retweeted control accounts</th>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row11_col0" class="data row11 col0" >16.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row11_col1" class="data row11 col1" >51.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row11_col2" class="data row11 col2" >7.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row11_col3" class="data row11 col3" >2.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row11_col4" class="data row11 col4" >0.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row11_col5" class="data row11 col5" >0.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row11_col6" class="data row11 col6" >0.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row11_col7" class="data row11 col7" >8.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row11_col8" class="data row11 col8" >0.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row11_col9" class="data row11 col9" >28.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row11_col10" class="data row11 col10" >1.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row11_col11" class="data row11 col11" >0.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row11_col12" class="data row11 col12" >0.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row11_col13" class="data row11 col13" >1.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row11_col14" class="data row11 col14" >0.00</td>
            </tr>
            <tr>
                        <th id="T_d5de2536_244c_11ec_a99c_0242ac1c0002level0_row12" class="row_heading level0 row12" >Total control account retweets published by this community</th>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row12_col0" class="data row12 col0" >41.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row12_col1" class="data row12 col1" >163.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row12_col2" class="data row12 col2" >14.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row12_col3" class="data row12 col3" >3.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row12_col4" class="data row12 col4" >0.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row12_col5" class="data row12 col5" >0.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row12_col6" class="data row12 col6" >0.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row12_col7" class="data row12 col7" >10.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row12_col8" class="data row12 col8" >0.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row12_col9" class="data row12 col9" >33.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row12_col10" class="data row12 col10" >1.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row12_col11" class="data row12 col11" >0.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row12_col12" class="data row12 col12" >0.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row12_col13" class="data row12 col13" >1.00</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row12_col14" class="data row12 col14" >0.00</td>
            </tr>
            <tr>
                        <th id="T_d5de2536_244c_11ec_a99c_0242ac1c0002level0_row13" class="row_heading level0 row13" >Mean path length between community nodes and target</th>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row13_col0" class="data row13 col0" >2.82</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row13_col1" class="data row13 col1" >2.83</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row13_col2" class="data row13 col2" >1.61</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row13_col3" class="data row13 col3" >2.96</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row13_col4" class="data row13 col4" >2.98</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row13_col5" class="data row13 col5" >2.73</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row13_col6" class="data row13 col6" >2.94</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row13_col7" class="data row13 col7" >2.88</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row13_col8" class="data row13 col8" >2.99</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row13_col9" class="data row13 col9" >2.93</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row13_col10" class="data row13 col10" >2.08</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row13_col11" class="data row13 col11" >2.99</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row13_col12" class="data row13 col12" >2.99</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row13_col13" class="data row13 col13" >2.89</td>
                        <td id="T_d5de2536_244c_11ec_a99c_0242ac1c0002row13_col14" class="data row13 col14" >2.98</td>
            </tr>
    </tbody></table></div></div>
</div>
</div>
<div class="section" id="build-model">
<h1>Build model<a class="headerlink" href="#build-model" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Given a ratings dataframe containing columns &quot;Source&quot;, &quot;Target&quot;, &quot;Weight&quot;</span>
<span class="c1"># train a collaborative filtering model and return the target and source weight embeds</span>
<span class="k">def</span> <span class="nf">make_model_collab</span><span class="p">(</span><span class="n">ratings</span><span class="p">,</span> <span class="n">epochs</span><span class="p">):</span>
    <span class="n">min_rating</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">ratings</span><span class="p">[</span><span class="s2">&quot;Weight&quot;</span><span class="p">])</span>
    <span class="n">max_rating</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ratings</span><span class="p">[</span><span class="s2">&quot;Weight&quot;</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Min rating: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">min_rating</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; Max rating: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">max_rating</span><span class="p">))</span>
    <span class="n">dls</span> <span class="o">=</span> <span class="n">CollabDataLoaders</span><span class="o">.</span><span class="n">from_df</span><span class="p">(</span><span class="n">ratings</span><span class="p">,</span> <span class="n">item_name</span><span class="o">=</span><span class="s1">&#39;Target&#39;</span><span class="p">,</span> <span class="n">bs</span><span class="o">=</span><span class="mi">64</span><span class="p">)</span>
    <span class="n">learn</span> <span class="o">=</span> <span class="n">collab_learner</span><span class="p">(</span><span class="n">dls</span><span class="p">,</span> <span class="n">n_factors</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">y_range</span><span class="o">=</span><span class="p">(</span><span class="n">min_rating</span><span class="p">,</span> <span class="n">max_rating</span><span class="p">))</span>
    <span class="n">learn</span><span class="o">.</span><span class="n">fit_one_cycle</span><span class="p">(</span><span class="n">epochs</span><span class="p">)</span>
    <span class="c1"># Model weights</span>
    <span class="n">target_w</span> <span class="o">=</span> <span class="n">learn</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">weight</span><span class="p">(</span><span class="n">dls</span><span class="o">.</span><span class="n">classes</span><span class="p">[</span><span class="s1">&#39;Target&#39;</span><span class="p">],</span> <span class="n">is_item</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">source_w</span> <span class="o">=</span> <span class="n">learn</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">weight</span><span class="p">(</span><span class="n">dls</span><span class="o">.</span><span class="n">classes</span><span class="p">[</span><span class="s1">&#39;Source&#39;</span><span class="p">],</span> <span class="n">is_item</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">target_w</span><span class="p">,</span> <span class="n">source_w</span>

<span class="k">def</span> <span class="nf">make_model_nn</span><span class="p">(</span><span class="n">ratings</span><span class="p">,</span> <span class="n">epochs</span><span class="p">):</span>
    <span class="n">min_rating</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">ratings</span><span class="p">[</span><span class="s2">&quot;Weight&quot;</span><span class="p">])</span>
    <span class="n">max_rating</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ratings</span><span class="p">[</span><span class="s2">&quot;Weight&quot;</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Min rating: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">min_rating</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; Max rating: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">max_rating</span><span class="p">))</span>
    <span class="n">dls</span> <span class="o">=</span> <span class="n">CollabDataLoaders</span><span class="o">.</span><span class="n">from_df</span><span class="p">(</span><span class="n">ratings</span><span class="p">,</span> <span class="n">item_name</span><span class="o">=</span><span class="s1">&#39;Target&#39;</span><span class="p">,</span> <span class="n">bs</span><span class="o">=</span><span class="mi">64</span><span class="p">)</span>
    <span class="n">learn</span> <span class="o">=</span> <span class="n">collab_learner</span><span class="p">(</span><span class="n">dls</span><span class="p">,</span> <span class="n">use_nn</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                           <span class="n">emb_szs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;userId&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="s1">&#39;movieId&#39;</span><span class="p">:</span><span class="mi">50</span><span class="p">},</span> 
                           <span class="n">layers</span><span class="o">=</span><span class="p">[</span><span class="mi">256</span><span class="p">,</span> <span class="mi">128</span><span class="p">],</span> <span class="n">y_range</span><span class="o">=</span><span class="p">(</span><span class="n">min_rating</span><span class="p">,</span> <span class="n">max_rating</span><span class="p">))</span>

    <span class="n">learn</span><span class="o">.</span><span class="n">fit_one_cycle</span><span class="p">(</span><span class="n">epochs</span><span class="p">)</span>
    <span class="n">target_w</span> <span class="o">=</span> <span class="n">to_np</span><span class="p">(</span><span class="n">learn</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">embeds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
    <span class="n">source_w</span> <span class="o">=</span> <span class="n">to_np</span><span class="p">(</span><span class="n">learn</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">embeds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
    <span class="k">return</span> <span class="n">target_w</span><span class="p">,</span> <span class="n">source_w</span>

<span class="k">def</span> <span class="nf">make_model</span><span class="p">(</span><span class="n">ratings</span><span class="p">,</span> <span class="n">model_type</span><span class="p">,</span> <span class="n">epochs</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Model type: &quot;</span> <span class="o">+</span> <span class="n">model_type</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">model_type</span> <span class="o">==</span> <span class="s2">&quot;nn&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">make_model_nn</span><span class="p">(</span><span class="n">ratings</span><span class="p">,</span> <span class="n">epochs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">make_model_collab</span><span class="p">(</span><span class="n">ratings</span><span class="p">,</span> <span class="n">epochs</span><span class="p">)</span>

<span class="n">epochs</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">model_type</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Train collab model on base dataset</span>
<span class="n">target_w</span><span class="p">,</span> <span class="n">source_w</span> <span class="o">=</span> <span class="n">make_model</span><span class="p">(</span><span class="n">ratings</span><span class="p">,</span> <span class="n">model_type</span><span class="p">,</span> <span class="n">epochs</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">target_w</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">source_w</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># Calculate cosine similarity matrix between all targets in the set</span>
<span class="n">t_matrix</span> <span class="o">=</span> <span class="n">cosine_similarity</span><span class="p">(</span><span class="n">target_w</span><span class="p">)</span>
                            
<span class="nb">print</span><span class="p">(</span><span class="n">t_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>

<span class="c1"># Calculate cosine similarity matrix between all sources in the set</span>
<span class="n">s_matrix</span> <span class="o">=</span> <span class="n">cosine_similarity</span><span class="p">(</span><span class="n">source_w</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">s_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8812.553711</td>
      <td>8495.390625</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4816.820312</td>
      <td>4669.122070</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2437.082520</td>
      <td>3102.752197</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1614.862305</td>
      <td>2611.380371</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1467.526245</td>
      <td>2539.028076</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>torch.Size([7251, 50])
torch.Size([21071, 50])
(7251, 7251)

(21071, 21071)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="recommendations-by-target-similarity">
<h1>Recommendations by target similarity<a class="headerlink" href="#recommendations-by-target-similarity" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">t_max_matches</span> <span class="o">=</span> <span class="mi">100</span> <span class="c1"># top_n matches when doing target similarity</span>

<span class="c1"># Show closest matches to selected targets</span>
<span class="n">samples</span> <span class="o">=</span> <span class="p">[</span><span class="n">target_tid</span><span class="p">,</span> <span class="n">high_profile_tid</span><span class="p">]</span>
<span class="n">print_similar_to_targets</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">t_matrix</span><span class="p">)</span>
<span class="n">print_target_similarity</span><span class="p">(</span><span class="n">target_tid</span><span class="p">,</span> <span class="n">high_profile_tid</span><span class="p">,</span> <span class="n">t_matrix</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Target: user_004286 similar to:
user_004286 1.0000
user_029017 0.9463
user_029316 0.9452
user_029150 0.9427
user_028743 0.9376
user_029228 0.9373
user_029816 0.9370
user_028817 0.9361
user_013935 0.9360
user_029312 0.9356

Target: user_025303 similar to:
user_025303 1.0000
user_025403 0.9370
user_025581 0.9361
user_025511 0.9351
user_025376 0.9341
user_026830 0.9320
user_025505 0.9313
user_025148 0.9290
user_025582 0.9282
user_025413 0.9279

user_004286 similarity to user_025303: 0.8578
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># graph tid similarity, to make a visualization</span>
<span class="n">tid_inter</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.99</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tid_name</span><span class="p">))</span>
<span class="k">for</span> <span class="n">tid</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">tid_name</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="n">get_most_similar</span><span class="p">(</span><span class="n">tid</span><span class="p">,</span> <span class="n">t_matrix</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">matches</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
            <span class="n">tid2</span><span class="p">,</span> <span class="n">sim</span> <span class="o">=</span> <span class="n">item</span>
            <span class="n">name2</span> <span class="o">=</span> <span class="n">tid_name</span><span class="p">[</span><span class="n">tid2</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">!=</span> <span class="n">name2</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">sim</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tid_inter</span><span class="p">:</span>
                        <span class="n">tid_inter</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
                    <span class="n">tid_inter</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">name2</span><span class="p">]</span> <span class="o">=</span> <span class="n">sim</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving&quot;</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;tid_inter.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Source,Target,Weight</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">source</span><span class="p">,</span> <span class="n">targets</span> <span class="ow">in</span> <span class="n">tid_inter</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">target</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="n">targets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">source</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">target</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>8405
Saving
Done
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Build recommendations for source based on who they&#39;ve retweeted</span>
<span class="c1"># For each target retweeted by a source, see if we have an entry in most_similar</span>
<span class="c1"># If we do, add each item to the recommended counter</span>
<span class="c1"># Assign the value to be the source&#39;s rating multiplied by the similarity score</span>
<span class="c1"># We&#39;ll also record what the user has already retweeted so we can recommend a target they haven&#39;t yet retweeted</span>

<span class="c1"># for target, num_retweets in get_source_retweets(source):</span>
<span class="c1">#    for similar, similarity in get_most_similar(target):</span>
<span class="c1">#        recommended[similar] += num_retweets * similarity</span>

<span class="k">def</span> <span class="nf">get_user_recommendations_by_target</span><span class="p">(</span><span class="n">ratings</span><span class="p">,</span> <span class="n">sid</span><span class="p">,</span> <span class="n">t_matrix</span><span class="p">):</span>
    <span class="n">s_ratings</span> <span class="o">=</span> <span class="n">ratings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ratings</span><span class="p">[</span><span class="s1">&#39;Source&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sid</span><span class="p">]</span>
    <span class="n">s_ratings</span> <span class="o">=</span> <span class="n">s_ratings</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;Weight&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">s_r</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">s_ratings</span><span class="p">[</span><span class="s1">&#39;Target&#39;</span><span class="p">],</span> <span class="n">s_ratings</span><span class="p">[</span><span class="s1">&#39;Weight&#39;</span><span class="p">]))</span>
    <span class="n">recommended</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
    <span class="n">seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">s_r</span><span class="p">:</span>
        <span class="n">tid</span><span class="p">,</span> <span class="n">trating</span> <span class="o">=</span> <span class="n">item</span>
        <span class="k">if</span> <span class="n">tid</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">t_matrix</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tid</span><span class="p">)</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="n">get_most_similar</span><span class="p">(</span><span class="n">tid</span><span class="p">,</span> <span class="n">t_matrix</span><span class="p">,</span> <span class="n">t_max_matches</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">matches</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
                <span class="n">t</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">entry</span>
                <span class="n">recommended</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">trating</span>

    <span class="c1"># Now we&#39;ll build a recomendations list that contains the highest scored items</span>
    <span class="c1"># calculated above that the user hasn&#39;t already rated</span>
    <span class="n">seen_recommendations</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
    <span class="n">not_seen_recommendations</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">tid</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="n">recommended</span><span class="o">.</span><span class="n">most_common</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">seen_recommendations</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">10</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">not_seen_recommendations</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="k">if</span> <span class="n">tid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
            <span class="n">not_seen_recommendations</span><span class="p">[</span><span class="n">tid</span><span class="p">]</span> <span class="o">=</span> <span class="n">score</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">seen_recommendations</span><span class="p">[</span><span class="n">tid</span><span class="p">]</span> <span class="o">=</span> <span class="n">score</span>
    <span class="k">return</span> <span class="n">seen_recommendations</span><span class="p">,</span> <span class="n">not_seen_recommendations</span>

<span class="k">def</span> <span class="nf">print_recommendations_by_target</span><span class="p">(</span><span class="n">sid</span><span class="p">,</span> <span class="n">seen_recommendations</span><span class="p">,</span> <span class="n">not_seen_recommendations</span><span class="p">):</span>
    <span class="n">s_ratings</span> <span class="o">=</span> <span class="n">ratings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ratings</span><span class="p">[</span><span class="s1">&#39;Source&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sid</span><span class="p">]</span>
    <span class="n">s_ratings</span> <span class="o">=</span> <span class="n">s_ratings</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;Weight&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">s_r</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">s_ratings</span><span class="p">[</span><span class="s1">&#39;Target&#39;</span><span class="p">],</span> <span class="n">s_ratings</span><span class="p">[</span><span class="s1">&#39;Weight&#39;</span><span class="p">]))</span>
    <span class="n">num_ratings</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s_r</span><span class="p">)</span>

    <span class="n">ind_rating</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">s_r</span><span class="p">:</span>
        <span class="n">ind</span><span class="p">,</span> <span class="n">trating</span> <span class="o">=</span> <span class="n">item</span>
        <span class="n">ind_rating</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">trating</span>

    <span class="c1"># Now let&#39;s print the output and see if it&#39;s sane</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;User: &quot;</span> <span class="o">+</span> <span class="n">sid_name</span><span class="p">[</span><span class="n">sid</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; retweeted &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num_ratings</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; different accounts.&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="n">top10</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">s_r</span><span class="p">[:</span><span class="mi">10</span><span class="p">]:</span>
        <span class="n">tid</span><span class="p">,</span> <span class="n">trating</span> <span class="o">=</span> <span class="n">item</span>
        <span class="n">top10</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tid</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Retweeted by user: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">trating</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; times, total retweets: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">target_retweeters</span><span class="p">[</span><span class="n">tid</span><span class="p">])</span> 
        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">  &quot;</span> <span class="o">+</span> <span class="n">tid_name</span><span class="p">[</span><span class="n">tid</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Recommended (seen):&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">seen_recommendations</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%.4f</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">c</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">(retweeted by user: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ind_rating</span><span class="p">[</span><span class="n">x</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; times,&quot;</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; total retweets: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">target_retweeters</span><span class="p">[</span><span class="n">x</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">tid_name</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="n">target_tid</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; [X]&quot;</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">top10</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; [*]&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Recommended (not seen):&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">not_seen_recommendations</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%.4f</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">c</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot; (total retweets: &quot;</span> 
        <span class="n">msg</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">target_retweeters</span><span class="p">[</span><span class="n">x</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;)</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">tid_name</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>                  
        <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="n">target_tid</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; [X]&quot;</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">top10</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; [*]&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=====================================================&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">print_user_recommendations_by_target</span><span class="p">(</span><span class="n">ratings</span><span class="p">,</span> <span class="n">sid</span><span class="p">,</span> <span class="n">t_matrix</span><span class="p">):</span>
    <span class="n">seen</span><span class="p">,</span> <span class="n">not_seen</span> <span class="o">=</span> <span class="n">get_user_recommendations_by_target</span><span class="p">(</span><span class="n">ratings</span><span class="p">,</span> <span class="n">sid</span><span class="p">,</span> <span class="n">t_matrix</span><span class="p">)</span>
    <span class="n">print_recommendations_by_target</span><span class="p">(</span><span class="n">sid</span><span class="p">,</span> <span class="n">seen</span><span class="p">,</span> <span class="n">not_seen</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Display target-based recommendations for control set</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">controls</span><span class="p">:</span>
    <span class="n">print_user_recommendations_by_target</span><span class="p">(</span><span class="n">ratings</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">t_matrix</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>User: user_000041 retweeted 171 different accounts.

Retweeted by user: 14 times, total retweets: 788	  user_025303
Retweeted by user: 4 times, total retweets: 2	  user_027283
Retweeted by user: 3 times, total retweets: 6	  user_004906
Retweeted by user: 3 times, total retweets: 101	  user_025218
Retweeted by user: 2 times, total retweets: 77	  user_025764
Retweeted by user: 2 times, total retweets: 43	  user_025266
Retweeted by user: 2 times, total retweets: 20	  user_024491
Retweeted by user: 2 times, total retweets: 82	  user_027313
Retweeted by user: 2 times, total retweets: 1	  user_027277
Retweeted by user: 2 times, total retweets: 126	  user_025171

Recommended (seen):
48.8365	(retweeted by user: 1 times, total retweets: 29)	user_025942
42.7630	(retweeted by user: 2 times, total retweets: 126)	user_025171 [*]
40.4249	(retweeted by user: 2 times, total retweets: 245)	user_025233
35.6384	(retweeted by user: 1 times, total retweets: 1)	user_009511
32.3609	(retweeted by user: 1 times, total retweets: 1)	user_027312
28.7078	(retweeted by user: 1 times, total retweets: 41)	user_025172
26.3055	(retweeted by user: 1 times, total retweets: 4)	user_027015
26.1725	(retweeted by user: 1 times, total retweets: 13)	user_008105
25.7324	(retweeted by user: 1 times, total retweets: 2)	user_027303
24.9139	(retweeted by user: 1 times, total retweets: 203)	user_025663

Recommended (not seen):
52.5307	 (total retweets: 3)	user_004600
52.4995	 (total retweets: 1)	user_025214
52.1691	 (total retweets: 33)	user_025199
51.2871	 (total retweets: 10)	user_015612
50.9438	 (total retweets: 1)	user_025923
49.6617	 (total retweets: 1)	user_027429
48.5878	 (total retweets: 9)	user_025249
47.8366	 (total retweets: 6)	user_025536
46.8852	 (total retweets: 2)	user_025859
46.7490	 (total retweets: 1)	user_025190
=====================================================

User: user_001399 retweeted 334 different accounts.

Retweeted by user: 16 times, total retweets: 150	  user_025301
Retweeted by user: 14 times, total retweets: 56	  user_025465
Retweeted by user: 14 times, total retweets: 46	  user_025297
Retweeted by user: 13 times, total retweets: 29	  user_025942
Retweeted by user: 13 times, total retweets: 24	  user_026703
Retweeted by user: 12 times, total retweets: 788	  user_025303
Retweeted by user: 12 times, total retweets: 101	  user_025218
Retweeted by user: 10 times, total retweets: 126	  user_025171
Retweeted by user: 10 times, total retweets: 28	  user_026180
Retweeted by user: 9 times, total retweets: 36	  user_025586

Recommended (seen):
151.5809	(retweeted by user: 1 times, total retweets: 39)	user_025139
147.9042	(retweeted by user: 1 times, total retweets: 9)	user_025574
143.2622	(retweeted by user: 2 times, total retweets: 4)	user_025936
128.4922	(retweeted by user: 1 times, total retweets: 14)	user_000823
124.4895	(retweeted by user: 1 times, total retweets: 22)	user_025505
123.6784	(retweeted by user: 1 times, total retweets: 17)	user_025204
120.0533	(retweeted by user: 1 times, total retweets: 39)	user_025259
119.6218	(retweeted by user: 10 times, total retweets: 126)	user_025171 [*]
114.4224	(retweeted by user: 13 times, total retweets: 24)	user_026703 [*]
105.7112	(retweeted by user: 4 times, total retweets: 99)	user_025647

Recommended (not seen):
179.6198	 (total retweets: 2)	user_025772
179.3164	 (total retweets: 1)	user_025800
175.0290	 (total retweets: 9)	user_025249
170.9015	 (total retweets: 1)	user_025421
167.8751	 (total retweets: 6)	user_004886
167.8292	 (total retweets: 2)	user_026083
160.6796	 (total retweets: 2)	user_008896
157.2509	 (total retweets: 1)	user_025475
155.9263	 (total retweets: 1)	user_025190
155.6776	 (total retweets: 3)	user_025337
=====================================================

User: user_006266 retweeted 500 different accounts.

Retweeted by user: 64 times, total retweets: 87	  user_000681
Retweeted by user: 62 times, total retweets: 788	  user_025303
Retweeted by user: 53 times, total retweets: 86	  user_025939
Retweeted by user: 44 times, total retweets: 6	  user_013766
Retweeted by user: 31 times, total retweets: 15	  user_004758
Retweeted by user: 31 times, total retweets: 245	  user_025233
Retweeted by user: 29 times, total retweets: 2	  user_031843
Retweeted by user: 25 times, total retweets: 13	  user_004964
Retweeted by user: 22 times, total retweets: 1100	  user_000755
Retweeted by user: 21 times, total retweets: 8	  user_031585

Recommended (seen):
202.3899	(retweeted by user: 1 times, total retweets: 40)	user_001344
172.5645	(retweeted by user: 1 times, total retweets: 379)	user_025212
154.1248	(retweeted by user: 1 times, total retweets: 12)	user_026044
153.0848	(retweeted by user: 1 times, total retweets: 16)	user_025243
139.3697	(retweeted by user: 1 times, total retweets: 5)	user_025481
136.9217	(retweeted by user: 1 times, total retweets: 17)	user_025434
132.6535	(retweeted by user: 1 times, total retweets: 14)	user_026538
122.5429	(retweeted by user: 1 times, total retweets: 7)	user_026879
117.0084	(retweeted by user: 2 times, total retweets: 126)	user_025171
110.4074	(retweeted by user: 64 times, total retweets: 87)	user_000681 [*]

Recommended (not seen):
297.2000	 (total retweets: 1)	user_025800
294.5797	 (total retweets: 6)	user_004886
251.6302	 (total retweets: 1)	user_026214
243.3813	 (total retweets: 1)	user_025262
237.2009	 (total retweets: 1)	user_025330
232.6240	 (total retweets: 9)	user_025249
226.7633	 (total retweets: 1)	user_025190
226.3602	 (total retweets: 6)	user_026767
224.2011	 (total retweets: 8)	user_026310
218.7240	 (total retweets: 2)	user_026083
=====================================================

User: user_000014 retweeted 226 different accounts.

Retweeted by user: 34 times, total retweets: 126	  user_025171
Retweeted by user: 25 times, total retweets: 86	  user_025939
Retweeted by user: 24 times, total retweets: 193	  user_025194
Retweeted by user: 18 times, total retweets: 245	  user_025233
Retweeted by user: 14 times, total retweets: 68	  user_025428
Retweeted by user: 13 times, total retweets: 788	  user_025303
Retweeted by user: 11 times, total retweets: 39	  user_025139
Retweeted by user: 9 times, total retweets: 89	  user_025208
Retweeted by user: 8 times, total retweets: 70	  user_025162
Retweeted by user: 7 times, total retweets: 53	  user_025244

Recommended (seen):
158.7361	(retweeted by user: 11 times, total retweets: 39)	user_025139 [*]
140.8370	(retweeted by user: 1 times, total retweets: 15)	user_025436
132.8563	(retweeted by user: 1 times, total retweets: 17)	user_025204
131.4559	(retweeted by user: 1 times, total retweets: 379)	user_025212
127.8204	(retweeted by user: 2 times, total retweets: 24)	user_026703
119.3941	(retweeted by user: 2 times, total retweets: 39)	user_025259
114.0425	(retweeted by user: 1 times, total retweets: 8)	user_019367
113.7450	(retweeted by user: 34 times, total retweets: 126)	user_025171 [*]
111.5292	(retweeted by user: 7 times, total retweets: 50)	user_026187
108.2051	(retweeted by user: 1 times, total retweets: 43)	user_025460

Recommended (not seen):
195.3126	 (total retweets: 6)	user_004886
192.5603	 (total retweets: 2)	user_025772
189.2482	 (total retweets: 1)	user_026214
186.8731	 (total retweets: 9)	user_025249
177.8761	 (total retweets: 2)	user_026083
177.7744	 (total retweets: 1)	user_025800
167.4285	 (total retweets: 1)	user_025721
164.9791	 (total retweets: 9)	user_025574
161.4338	 (total retweets: 3)	user_026099
160.7082	 (total retweets: 1)	user_025599
=====================================================

User: user_000128 retweeted 77 different accounts.

Retweeted by user: 27 times, total retweets: 66	  user_025143
Retweeted by user: 15 times, total retweets: 788	  user_025303
Retweeted by user: 7 times, total retweets: 37	  user_025147
Retweeted by user: 7 times, total retweets: 245	  user_025233
Retweeted by user: 6 times, total retweets: 78	  user_025670
Retweeted by user: 5 times, total retweets: 116	  user_026156
Retweeted by user: 4 times, total retweets: 45	  user_025170
Retweeted by user: 4 times, total retweets: 1	  user_028614
Retweeted by user: 4 times, total retweets: 58	  user_025178
Retweeted by user: 3 times, total retweets: 68	  user_025428

Recommended (seen):
51.2738	(retweeted by user: 2 times, total retweets: 39)	user_025139
44.5299	(retweeted by user: 1 times, total retweets: 99)	user_025647
44.3164	(retweeted by user: 1 times, total retweets: 39)	user_025259
42.1819	(retweeted by user: 27 times, total retweets: 66)	user_025143 [*]
33.6317	(retweeted by user: 1 times, total retweets: 10)	user_025702
27.7101	(retweeted by user: 1 times, total retweets: 22)	user_025505
19.7311	(retweeted by user: 7 times, total retweets: 245)	user_025233 [*]
18.4347	(retweeted by user: 2 times, total retweets: 10)	user_027109
17.7303	(retweeted by user: 15 times, total retweets: 788)	user_025303 [*]
17.4360	(retweeted by user: 2 times, total retweets: 36)	user_025245

Recommended (not seen):
67.3543	 (total retweets: 16)	user_025243
65.8506	 (total retweets: 1)	user_025402
65.5913	 (total retweets: 15)	user_006342
60.7599	 (total retweets: 1)	user_027486
58.2954	 (total retweets: 1)	user_026228
54.0357	 (total retweets: 14)	user_000823
53.8916	 (total retweets: 3)	user_026720
53.5386	 (total retweets: 379)	user_025212
53.0458	 (total retweets: 1)	user_025205
53.0342	 (total retweets: 16)	user_025217
=====================================================

User: user_000025 retweeted 111 different accounts.

Retweeted by user: 40 times, total retweets: 788	  user_025303
Retweeted by user: 13 times, total retweets: 1	  user_012787
Retweeted by user: 9 times, total retweets: 67	  user_025251
Retweeted by user: 9 times, total retweets: 18	  user_026143
Retweeted by user: 9 times, total retweets: 10	  user_027109
Retweeted by user: 8 times, total retweets: 101	  user_025218
Retweeted by user: 8 times, total retweets: 37	  user_025147
Retweeted by user: 8 times, total retweets: 150	  user_025301
Retweeted by user: 7 times, total retweets: 22	  user_026639
Retweeted by user: 7 times, total retweets: 36	  user_025586

Recommended (seen):
82.6597	(retweeted by user: 1 times, total retweets: 16)	user_025243
53.7978	(retweeted by user: 1 times, total retweets: 379)	user_025212
53.5644	(retweeted by user: 40 times, total retweets: 788)	user_025303 [*]
52.7477	(retweeted by user: 9 times, total retweets: 10)	user_027109 [*]
45.4996	(retweeted by user: 2 times, total retweets: 66)	user_025143
45.4813	(retweeted by user: 5 times, total retweets: 25)	user_025220
45.2705	(retweeted by user: 2 times, total retweets: 47)	user_015124
42.5467	(retweeted by user: 1 times, total retweets: 8)	user_025203
42.0846	(retweeted by user: 1 times, total retweets: 9)	user_026010
41.8017	(retweeted by user: 1 times, total retweets: 99)	user_025647

Recommended (not seen):
100.0311	 (total retweets: 2)	user_008896
96.8132	 (total retweets: 1)	user_025585
96.7845	 (total retweets: 1)	user_009768
95.4911	 (total retweets: 1)	user_025402
90.4609	 (total retweets: 1)	user_025261
90.4084	 (total retweets: 1)	user_025319
88.5255	 (total retweets: 1)	user_025385
85.8555	 (total retweets: 1)	user_025213
83.0724	 (total retweets: 34)	user_025314
82.5219	 (total retweets: 15)	user_006342
=====================================================

User: user_000708 retweeted 130 different accounts.

Retweeted by user: 22 times, total retweets: 126	  user_025171
Retweeted by user: 18 times, total retweets: 788	  user_025303
Retweeted by user: 10 times, total retweets: 70	  user_025162
Retweeted by user: 9 times, total retweets: 56	  user_025465
Retweeted by user: 7 times, total retweets: 66	  user_025143
Retweeted by user: 6 times, total retweets: 67	  user_025251
Retweeted by user: 5 times, total retweets: 44	  user_026113
Retweeted by user: 4 times, total retweets: 53	  user_025244
Retweeted by user: 4 times, total retweets: 26	  user_026313
Retweeted by user: 4 times, total retweets: 245	  user_025233

Recommended (seen):
68.0444	(retweeted by user: 2 times, total retweets: 39)	user_025139
51.2584	(retweeted by user: 1 times, total retweets: 379)	user_025212
43.3632	(retweeted by user: 7 times, total retweets: 66)	user_025143 [*]
41.2894	(retweeted by user: 1 times, total retweets: 61)	user_025396
38.6370	(retweeted by user: 22 times, total retweets: 126)	user_025171 [*]
36.9752	(retweeted by user: 1 times, total retweets: 11)	user_025417
36.8584	(retweeted by user: 1 times, total retweets: 2)	user_026603
34.2014	(retweeted by user: 1 times, total retweets: 89)	user_025208
33.1005	(retweeted by user: 2 times, total retweets: 22)	user_025600
31.5625	(retweeted by user: 1 times, total retweets: 2)	user_012180

Recommended (not seen):
84.4567	 (total retweets: 2)	user_025772
81.6547	 (total retweets: 6)	user_004886
79.4707	 (total retweets: 9)	user_025249
78.7695	 (total retweets: 2)	user_026083
77.7121	 (total retweets: 1)	user_025721
76.9892	 (total retweets: 16)	user_025243
74.6437	 (total retweets: 1)	user_025231
73.7676	 (total retweets: 1)	user_025190
72.9647	 (total retweets: 9)	user_026329
69.8830	 (total retweets: 2)	user_025799
=====================================================

User: user_000408 retweeted 494 different accounts.

Retweeted by user: 6 times, total retweets: 27	  user_026028
Retweeted by user: 6 times, total retweets: 22	  user_025993
Retweeted by user: 5 times, total retweets: 93	  user_000408
Retweeted by user: 5 times, total retweets: 86	  user_025939
Retweeted by user: 5 times, total retweets: 13	  user_025787
Retweeted by user: 5 times, total retweets: 1	  user_030728
Retweeted by user: 4 times, total retweets: 126	  user_025171
Retweeted by user: 4 times, total retweets: 2	  user_030730
Retweeted by user: 4 times, total retweets: 58	  user_025825
Retweeted by user: 4 times, total retweets: 788	  user_025303

Recommended (seen):
104.9148	(retweeted by user: 4 times, total retweets: 126)	user_025171 [*]
93.9673	(retweeted by user: 1 times, total retweets: 39)	user_025259
89.9846	(retweeted by user: 1 times, total retweets: 15)	user_025436
82.3823	(retweeted by user: 1 times, total retweets: 23)	user_025389
81.8121	(retweeted by user: 2 times, total retweets: 39)	user_025139
77.4080	(retweeted by user: 1 times, total retweets: 50)	user_026187
69.1686	(retweeted by user: 1 times, total retweets: 17)	user_025850
64.5676	(retweeted by user: 1 times, total retweets: 89)	user_025208
59.5548	(retweeted by user: 1 times, total retweets: 8)	user_019367
58.4454	(retweeted by user: 1 times, total retweets: 32)	user_010440

Recommended (not seen):
107.9184	 (total retweets: 2)	user_025772
107.8904	 (total retweets: 1)	user_026684
106.1909	 (total retweets: 16)	user_025243
105.3507	 (total retweets: 1)	user_026214
100.1849	 (total retweets: 1)	user_026693
100.1594	 (total retweets: 9)	user_025249
100.0080	 (total retweets: 1)	user_025190
99.8162	 (total retweets: 1)	user_025273
98.7815	 (total retweets: 1)	user_025800
98.7529	 (total retweets: 9)	user_025574
=====================================================

User: user_000614 retweeted 140 different accounts.

Retweeted by user: 10 times, total retweets: 4	  user_030941
Retweeted by user: 8 times, total retweets: 126	  user_025171
Retweeted by user: 7 times, total retweets: 1	  user_030942
Retweeted by user: 7 times, total retweets: 17	  user_026023
Retweeted by user: 7 times, total retweets: 245	  user_025233
Retweeted by user: 6 times, total retweets: 116	  user_026156
Retweeted by user: 6 times, total retweets: 50	  user_026187
Retweeted by user: 6 times, total retweets: 4	  user_006910
Retweeted by user: 6 times, total retweets: 88	  user_025206
Retweeted by user: 5 times, total retweets: 52	  user_026068

Recommended (seen):
50.0549	(retweeted by user: 1 times, total retweets: 23)	user_025389
42.1177	(retweeted by user: 8 times, total retweets: 126)	user_025171 [*]
35.3989	(retweeted by user: 6 times, total retweets: 50)	user_026187 [*]
33.9030	(retweeted by user: 2 times, total retweets: 67)	user_025251
33.3979	(retweeted by user: 1 times, total retweets: 39)	user_025259
33.3960	(retweeted by user: 4 times, total retweets: 38)	user_026129
29.5914	(retweeted by user: 3 times, total retweets: 27)	user_025802
28.9582	(retweeted by user: 1 times, total retweets: 89)	user_025208
25.4420	(retweeted by user: 7 times, total retweets: 245)	user_025233 [*]
24.7516	(retweeted by user: 1 times, total retweets: 7)	user_026780

Recommended (not seen):
67.1743	 (total retweets: 6)	user_004886
63.9266	 (total retweets: 1)	user_026214
58.8971	 (total retweets: 1)	user_025800
57.5716	 (total retweets: 1)	user_026686
57.5145	 (total retweets: 1)	user_025273
57.2163	 (total retweets: 2)	user_025772
55.8550	 (total retweets: 9)	user_025249
55.2149	 (total retweets: 1)	user_025421
54.0379	 (total retweets: 7)	user_025840
53.8102	 (total retweets: 15)	user_025436
=====================================================

User: user_001560 retweeted 453 different accounts.

Retweeted by user: 73 times, total retweets: 150	  user_025301
Retweeted by user: 53 times, total retweets: 245	  user_025233
Retweeted by user: 37 times, total retweets: 101	  user_025218
Retweeted by user: 37 times, total retweets: 25	  user_025220
Retweeted by user: 35 times, total retweets: 6	  user_025470
Retweeted by user: 34 times, total retweets: 114	  user_025253
Retweeted by user: 30 times, total retweets: 39	  user_025259
Retweeted by user: 29 times, total retweets: 7	  user_025542
Retweeted by user: 26 times, total retweets: 17	  user_025304
Retweeted by user: 26 times, total retweets: 44	  user_026113

Recommended (seen):
459.8987	(retweeted by user: 1 times, total retweets: 3)	user_025337
377.2581	(retweeted by user: 1 times, total retweets: 16)	user_025243
364.3216	(retweeted by user: 1 times, total retweets: 39)	user_025139
348.2954	(retweeted by user: 1 times, total retweets: 9)	user_026329
339.1222	(retweeted by user: 1 times, total retweets: 34)	user_025314
327.0607	(retweeted by user: 17 times, total retweets: 66)	user_025143
326.0568	(retweeted by user: 1 times, total retweets: 22)	user_025505
324.1868	(retweeted by user: 5 times, total retweets: 99)	user_025647
314.3277	(retweeted by user: 14 times, total retweets: 17)	user_025204
313.2206	(retweeted by user: 30 times, total retweets: 39)	user_025259 [*]

Recommended (not seen):
497.6573	 (total retweets: 2)	user_008896
467.8657	 (total retweets: 1)	user_025800
459.2218	 (total retweets: 2)	user_025772
457.0036	 (total retweets: 2)	user_026083
440.0443	 (total retweets: 1)	user_025585
437.8850	 (total retweets: 1)	user_025234
436.9799	 (total retweets: 3)	user_026720
435.4440	 (total retweets: 1)	user_009768
422.7246	 (total retweets: 1)	user_025627
407.8793	 (total retweets: 1)	user_025319
=====================================================

User: user_000280 retweeted 102 different accounts.

Retweeted by user: 6 times, total retweets: 1	  user_030370
Retweeted by user: 4 times, total retweets: 245	  user_025233
Retweeted by user: 4 times, total retweets: 126	  user_025171
Retweeted by user: 2 times, total retweets: 19	  user_026666
Retweeted by user: 2 times, total retweets: 15	  user_025824
Retweeted by user: 2 times, total retweets: 788	  user_025303
Retweeted by user: 2 times, total retweets: 1	  user_030389
Retweeted by user: 2 times, total retweets: 101	  user_025218
Retweeted by user: 2 times, total retweets: 17	  user_027194
Retweeted by user: 2 times, total retweets: 150	  user_025301

Recommended (seen):
31.3678	(retweeted by user: 6 times, total retweets: 1)	user_030370 [*]
30.9720	(retweeted by user: 1 times, total retweets: 1)	user_030372
28.1422	(retweeted by user: 2 times, total retweets: 1)	user_030389 [*]
26.1096	(retweeted by user: 1 times, total retweets: 1)	user_030386
18.8515	(retweeted by user: 1 times, total retweets: 1)	user_030367
17.3443	(retweeted by user: 1 times, total retweets: 1)	user_030411
16.9238	(retweeted by user: 1 times, total retweets: 1)	user_030390
16.6874	(retweeted by user: 1 times, total retweets: 1)	user_030381
15.6780	(retweeted by user: 1 times, total retweets: 9)	user_025249
13.4814	(retweeted by user: 1 times, total retweets: 1)	user_030383

Recommended (not seen):
38.4778	 (total retweets: 2)	user_030181
38.1586	 (total retweets: 2)	user_014836
37.4496	 (total retweets: 2)	user_005184
35.6210	 (total retweets: 2)	user_030318
35.6193	 (total retweets: 1)	user_025853
35.5972	 (total retweets: 2)	user_030259
34.9581	 (total retweets: 1)	user_030246
34.6434	 (total retweets: 1)	user_030183
34.6376	 (total retweets: 8)	user_027323
33.7859	 (total retweets: 1)	user_030267
=====================================================

User: user_000089 retweeted 172 different accounts.

Retweeted by user: 53 times, total retweets: 788	  user_025303
Retweeted by user: 37 times, total retweets: 245	  user_025233
Retweeted by user: 7 times, total retweets: 193	  user_025194
Retweeted by user: 7 times, total retweets: 45	  user_026405
Retweeted by user: 5 times, total retweets: 68	  user_025428
Retweeted by user: 5 times, total retweets: 101	  user_025218
Retweeted by user: 5 times, total retweets: 126	  user_025171
Retweeted by user: 4 times, total retweets: 34	  user_000089
Retweeted by user: 3 times, total retweets: 16	  user_026015
Retweeted by user: 3 times, total retweets: 45	  user_025170

Recommended (seen):
78.3793	(retweeted by user: 1 times, total retweets: 29)	user_025257
70.2019	(retweeted by user: 1 times, total retweets: 2)	user_025689
64.4564	(retweeted by user: 1 times, total retweets: 9)	user_025229
64.3183	(retweeted by user: 1 times, total retweets: 9)	user_016083
60.8247	(retweeted by user: 37 times, total retweets: 245)	user_025233 [*]
59.2107	(retweeted by user: 53 times, total retweets: 788)	user_025303 [*]
51.9405	(retweeted by user: 3 times, total retweets: 24)	user_010214
51.5576	(retweeted by user: 1 times, total retweets: 3)	user_026585
50.2137	(retweeted by user: 2 times, total retweets: 36)	user_025245
48.4081	(retweeted by user: 1 times, total retweets: 203)	user_025663

Recommended (not seen):
98.6631	 (total retweets: 16)	user_025243
97.3584	 (total retweets: 1)	user_025261
94.7640	 (total retweets: 1)	user_026057
91.5833	 (total retweets: 1)	user_025800
90.3547	 (total retweets: 1)	user_025923
90.2483	 (total retweets: 2)	user_008896
89.6449	 (total retweets: 1)	user_009768
88.7468	 (total retweets: 3)	user_026580
87.9357	 (total retweets: 1)	user_026214
87.8704	 (total retweets: 1)	user_025426
=====================================================

User: user_000022 retweeted 650 different accounts.

Retweeted by user: 82 times, total retweets: 788	  user_025303
Retweeted by user: 58 times, total retweets: 245	  user_025233
Retweeted by user: 29 times, total retweets: 114	  user_025253
Retweeted by user: 25 times, total retweets: 6	  user_016321
Retweeted by user: 20 times, total retweets: 5	  user_025768
Retweeted by user: 20 times, total retweets: 43	  user_025814
Retweeted by user: 17 times, total retweets: 193	  user_025194
Retweeted by user: 15 times, total retweets: 88	  user_025206
Retweeted by user: 15 times, total retweets: 17	  user_025219
Retweeted by user: 14 times, total retweets: 89	  user_025208

Recommended (seen):
386.9583	(retweeted by user: 1 times, total retweets: 15)	user_025436
382.2952	(retweeted by user: 1 times, total retweets: 7)	user_025840
381.5516	(retweeted by user: 1 times, total retweets: 16)	user_025243
370.1053	(retweeted by user: 1 times, total retweets: 6)	user_026767
356.3874	(retweeted by user: 3 times, total retweets: 39)	user_025139
349.3455	(retweeted by user: 1 times, total retweets: 14)	user_000823
348.2829	(retweeted by user: 1 times, total retweets: 1)	user_027131
337.9262	(retweeted by user: 1 times, total retweets: 3)	user_004600
311.6509	(retweeted by user: 10 times, total retweets: 379)	user_025212
301.1314	(retweeted by user: 2 times, total retweets: 8)	user_025203

Recommended (not seen):
479.0210	 (total retweets: 1)	user_025800
439.9754	 (total retweets: 6)	user_004886
432.8152	 (total retweets: 2)	user_026083
432.3273	 (total retweets: 1)	user_025421
431.8622	 (total retweets: 9)	user_025249
422.5876	 (total retweets: 1)	user_026214
417.7508	 (total retweets: 1)	user_025426
404.4471	 (total retweets: 1)	user_025273
391.7235	 (total retweets: 2)	user_025772
390.7023	 (total retweets: 1)	user_026686
=====================================================

User: user_004286 retweeted 566 different accounts.

Retweeted by user: 90 times, total retweets: 37	  user_026470
Retweeted by user: 76 times, total retweets: 38	  user_004572
Retweeted by user: 56 times, total retweets: 20	  user_005961
Retweeted by user: 40 times, total retweets: 14	  user_005507
Retweeted by user: 38 times, total retweets: 15	  user_007254
Retweeted by user: 36 times, total retweets: 13	  user_004964
Retweeted by user: 36 times, total retweets: 12	  user_011143
Retweeted by user: 35 times, total retweets: 12	  user_004767
Retweeted by user: 34 times, total retweets: 788	  user_025303
Retweeted by user: 34 times, total retweets: 24	  user_010214

Recommended (seen):
269.1095	(retweeted by user: 7 times, total retweets: 3)	user_004600
249.3311	(retweeted by user: 2 times, total retweets: 29)	user_025257
240.7201	(retweeted by user: 1 times, total retweets: 6)	user_004886
225.9536	(retweeted by user: 1 times, total retweets: 66)	user_025143
212.4156	(retweeted by user: 1 times, total retweets: 18)	user_027309
197.0263	(retweeted by user: 16 times, total retweets: 17)	user_004591
194.2260	(retweeted by user: 1 times, total retweets: 7)	user_011207
181.5173	(retweeted by user: 9 times, total retweets: 40)	user_001344
179.4158	(retweeted by user: 1 times, total retweets: 3)	user_000225
166.1397	(retweeted by user: 1 times, total retweets: 126)	user_025171

Recommended (not seen):
324.9718	 (total retweets: 1)	user_025409
307.5569	 (total retweets: 2)	user_025799
305.4636	 (total retweets: 9)	user_025249
304.9499	 (total retweets: 3)	user_002380
302.0213	 (total retweets: 6)	user_026767
295.8419	 (total retweets: 1)	user_026057
292.5050	 (total retweets: 11)	user_027227
291.1258	 (total retweets: 1)	user_009706
290.8040	 (total retweets: 3)	user_025337
289.6052	 (total retweets: 11)	user_025513
=====================================================

User: user_000003 retweeted 1438 different accounts.

Retweeted by user: 166 times, total retweets: 245	  user_025233
Retweeted by user: 129 times, total retweets: 788	  user_025303
Retweeted by user: 44 times, total retweets: 24	  user_026570
Retweeted by user: 38 times, total retweets: 30	  user_026039
Retweeted by user: 32 times, total retweets: 36	  user_025586
Retweeted by user: 31 times, total retweets: 126	  user_025171
Retweeted by user: 28 times, total retweets: 101	  user_025218
Retweeted by user: 25 times, total retweets: 2	  user_025859
Retweeted by user: 24 times, total retweets: 5	  user_026259
Retweeted by user: 23 times, total retweets: 9	  user_026726

Recommended (seen):
1343.3835	(retweeted by user: 1 times, total retweets: 9)	user_025249
1307.1718	(retweeted by user: 4 times, total retweets: 6)	user_004886
1274.3030	(retweeted by user: 1 times, total retweets: 1)	user_025800
1258.7790	(retweeted by user: 3 times, total retweets: 1)	user_026214
1243.5297	(retweeted by user: 1 times, total retweets: 2)	user_026083
1157.4717	(retweeted by user: 1 times, total retweets: 3)	user_026580
1105.9703	(retweeted by user: 1 times, total retweets: 9)	user_025574
1101.3642	(retweeted by user: 1 times, total retweets: 2)	user_025772
1063.5725	(retweeted by user: 1 times, total retweets: 2)	user_025848
1042.5446	(retweeted by user: 1 times, total retweets: 1)	user_026057

Recommended (not seen):
1208.4055	 (total retweets: 6)	user_026767
1185.5039	 (total retweets: 1)	user_025421
1184.4398	 (total retweets: 1)	user_027131
1101.3486	 (total retweets: 1)	user_025262
1096.6607	 (total retweets: 1)	user_025426
1065.2608	 (total retweets: 1)	user_025273
1033.8537	 (total retweets: 1)	user_025599
992.5331	 (total retweets: 6)	user_026765
942.9417	 (total retweets: 23)	user_025389
928.2829	 (total retweets: 1)	user_009511
=====================================================

User: user_001608 retweeted 183 different accounts.

Retweeted by user: 150 times, total retweets: 788	  user_025303
Retweeted by user: 33 times, total retweets: 126	  user_025171
Retweeted by user: 29 times, total retweets: 32	  user_026005
Retweeted by user: 28 times, total retweets: 101	  user_025218
Retweeted by user: 19 times, total retweets: 56	  user_025465
Retweeted by user: 19 times, total retweets: 30	  user_026341
Retweeted by user: 17 times, total retweets: 116	  user_026156
Retweeted by user: 14 times, total retweets: 42	  user_026557
Retweeted by user: 13 times, total retweets: 150	  user_025301
Retweeted by user: 10 times, total retweets: 57	  user_025227

Recommended (seen):
256.0153	(retweeted by user: 1 times, total retweets: 16)	user_025243
193.0317	(retweeted by user: 1 times, total retweets: 11)	user_026804
157.4856	(retweeted by user: 1 times, total retweets: 12)	user_025579
153.5339	(retweeted by user: 150 times, total retweets: 788)	user_025303 [*]
141.7567	(retweeted by user: 1 times, total retweets: 9)	user_016083
122.7980	(retweeted by user: 2 times, total retweets: 9)	user_025574
117.5177	(retweeted by user: 6 times, total retweets: 39)	user_025139
107.5245	(retweeted by user: 1 times, total retweets: 39)	user_025259
97.1774	(retweeted by user: 1 times, total retweets: 32)	user_010440
96.6985	(retweeted by user: 2 times, total retweets: 50)	user_026187

Recommended (not seen):
259.4791	 (total retweets: 2)	user_008896
250.3242	 (total retweets: 1)	user_025585
247.5008	 (total retweets: 1)	user_025319
246.4938	 (total retweets: 1)	user_009768
243.5737	 (total retweets: 15)	user_006342
239.6741	 (total retweets: 1)	user_026228
238.8959	 (total retweets: 1)	user_025213
218.9241	 (total retweets: 1)	user_027486
217.4335	 (total retweets: 1)	user_028801
216.9636	 (total retweets: 34)	user_025314
=====================================================

User: user_000350 retweeted 310 different accounts.

Retweeted by user: 60 times, total retweets: 788	  user_025303
Retweeted by user: 39 times, total retweets: 193	  user_025194
Retweeted by user: 39 times, total retweets: 39	  user_025139
Retweeted by user: 39 times, total retweets: 45	  user_025963
Retweeted by user: 33 times, total retweets: 101	  user_025218
Retweeted by user: 30 times, total retweets: 15	  user_026155
Retweeted by user: 29 times, total retweets: 67	  user_025251
Retweeted by user: 26 times, total retweets: 126	  user_025171
Retweeted by user: 25 times, total retweets: 67	  user_025406
Retweeted by user: 20 times, total retweets: 38	  user_026129

Recommended (seen):
286.7356	(retweeted by user: 1 times, total retweets: 9)	user_025574
283.6980	(retweeted by user: 2 times, total retweets: 2)	user_026083
257.9613	(retweeted by user: 4 times, total retweets: 50)	user_026187
256.7509	(retweeted by user: 39 times, total retweets: 39)	user_025139 [*]
249.6424	(retweeted by user: 1 times, total retweets: 15)	user_025436
245.5857	(retweeted by user: 1 times, total retweets: 379)	user_025212
239.3103	(retweeted by user: 1 times, total retweets: 17)	user_025204
237.9224	(retweeted by user: 2 times, total retweets: 17)	user_025434
234.6891	(retweeted by user: 2 times, total retweets: 39)	user_025259
222.7447	(retweeted by user: 1 times, total retweets: 16)	user_025217

Recommended (not seen):
323.2721	 (total retweets: 6)	user_004886
306.7871	 (total retweets: 2)	user_025772
306.4703	 (total retweets: 1)	user_025800
299.4849	 (total retweets: 9)	user_025249
297.6036	 (total retweets: 16)	user_025243
297.3324	 (total retweets: 3)	user_026580
289.5139	 (total retweets: 1)	user_026228
282.8612	 (total retweets: 3)	user_025337
278.6279	 (total retweets: 1)	user_026214
278.3343	 (total retweets: 1)	user_025721
=====================================================

User: user_000000 retweeted 597 different accounts.

Retweeted by user: 18 times, total retweets: 5	  user_025420
Retweeted by user: 13 times, total retweets: 150	  user_025301
Retweeted by user: 10 times, total retweets: 8	  user_025203
Retweeted by user: 10 times, total retweets: 89	  user_025208
Retweeted by user: 9 times, total retweets: 245	  user_025233
Retweeted by user: 8 times, total retweets: 10	  user_025575
Retweeted by user: 7 times, total retweets: 788	  user_025303
Retweeted by user: 7 times, total retweets: 3	  user_025281
Retweeted by user: 7 times, total retweets: 70	  user_025162
Retweeted by user: 6 times, total retweets: 41	  user_025173

Recommended (seen):
417.6258	(retweeted by user: 1 times, total retweets: 1)	user_025234
353.8237	(retweeted by user: 1 times, total retweets: 1)	user_025627
338.6660	(retweeted by user: 1 times, total retweets: 1)	user_025585
320.5969	(retweeted by user: 1 times, total retweets: 1)	user_009768
317.3101	(retweeted by user: 1 times, total retweets: 1)	user_025319
311.0392	(retweeted by user: 3 times, total retweets: 16)	user_025243
311.0050	(retweeted by user: 2 times, total retweets: 6)	user_025416
301.7710	(retweeted by user: 1 times, total retweets: 2)	user_025605
299.7247	(retweeted by user: 1 times, total retweets: 1)	user_025517
295.4651	(retweeted by user: 3 times, total retweets: 66)	user_025143

Recommended (not seen):
388.8048	 (total retweets: 2)	user_008896
383.3070	 (total retweets: 3)	user_026720
318.2116	 (total retweets: 39)	user_026449
279.3876	 (total retweets: 3)	user_026512
270.5311	 (total retweets: 2)	user_026083
260.5410	 (total retweets: 1)	user_026228
251.1179	 (total retweets: 1)	user_026190
250.6562	 (total retweets: 1)	user_027486
248.5110	 (total retweets: 1)	user_009706
241.5610	 (total retweets: 15)	user_006342
=====================================================

User: user_004000 retweeted 54 different accounts.

Retweeted by user: 21 times, total retweets: 22	  user_000392
Retweeted by user: 12 times, total retweets: 37	  user_000305
Retweeted by user: 9 times, total retweets: 20	  user_001184
Retweeted by user: 8 times, total retweets: 36	  user_000093
Retweeted by user: 6 times, total retweets: 638	  user_000596
Retweeted by user: 5 times, total retweets: 788	  user_025303
Retweeted by user: 5 times, total retweets: 2	  user_005424
Retweeted by user: 4 times, total retweets: 65	  user_025179
Retweeted by user: 3 times, total retweets: 5	  user_027821
Retweeted by user: 3 times, total retweets: 13	  user_000253

Recommended (seen):
27.0374	(retweeted by user: 1 times, total retweets: 245)	user_025233
25.7979	(retweeted by user: 1 times, total retweets: 2)	user_000574
21.0000	(retweeted by user: 21 times, total retweets: 22)	user_000392 [*]
19.7607	(retweeted by user: 9 times, total retweets: 20)	user_001184 [*]
15.4069	(retweeted by user: 1 times, total retweets: 6)	user_026727
12.0000	(retweeted by user: 12 times, total retweets: 37)	user_000305 [*]
8.4761	(retweeted by user: 1 times, total retweets: 3)	user_026720
8.0000	(retweeted by user: 8 times, total retweets: 36)	user_000093 [*]
7.6858	(retweeted by user: 1 times, total retweets: 66)	user_025143
6.0000	(retweeted by user: 6 times, total retweets: 638)	user_000596 [*]

Recommended (not seen):
51.9306	 (total retweets: 1)	user_025923
45.2567	 (total retweets: 33)	user_025199
34.5398	 (total retweets: 1)	user_025190
33.6816	 (total retweets: 1)	user_025214
32.5827	 (total retweets: 1)	user_025377
31.9279	 (total retweets: 9)	user_025249
31.6254	 (total retweets: 1)	user_026192
31.5442	 (total retweets: 1)	user_026913
31.2138	 (total retweets: 2)	user_008896
30.9603	 (total retweets: 6)	user_025536
=====================================================

User: user_000130 retweeted 354 different accounts.

Retweeted by user: 59 times, total retweets: 788	  user_025303
Retweeted by user: 24 times, total retweets: 66	  user_025143
Retweeted by user: 20 times, total retweets: 17	  user_026333
Retweeted by user: 17 times, total retweets: 78	  user_025670
Retweeted by user: 15 times, total retweets: 193	  user_025194
Retweeted by user: 14 times, total retweets: 53	  user_025244
Retweeted by user: 14 times, total retweets: 70	  user_025162
Retweeted by user: 14 times, total retweets: 99	  user_025647
Retweeted by user: 14 times, total retweets: 245	  user_025233
Retweeted by user: 13 times, total retweets: 9	  user_027508

Recommended (seen):
175.8614	(retweeted by user: 2 times, total retweets: 6)	user_026765
169.0621	(retweeted by user: 1 times, total retweets: 6)	user_025416
168.8978	(retweeted by user: 24 times, total retweets: 66)	user_025143 [*]
168.2937	(retweeted by user: 1 times, total retweets: 22)	user_025505
166.6541	(retweeted by user: 1 times, total retweets: 39)	user_025259
158.5505	(retweeted by user: 1 times, total retweets: 10)	user_023501
152.5042	(retweeted by user: 1 times, total retweets: 34)	user_025314
145.4979	(retweeted by user: 14 times, total retweets: 99)	user_025647 [*]
144.9301	(retweeted by user: 1 times, total retweets: 22)	user_025600
144.1935	(retweeted by user: 1 times, total retweets: 29)	user_025257

Recommended (not seen):
245.8383	 (total retweets: 2)	user_025772
240.7783	 (total retweets: 15)	user_006342
236.8186	 (total retweets: 16)	user_025243
235.2369	 (total retweets: 1)	user_025627
229.4985	 (total retweets: 1)	user_025234
221.6061	 (total retweets: 1)	user_026228
219.8975	 (total retweets: 2)	user_008896
217.6056	 (total retweets: 1)	user_025402
211.6956	 (total retweets: 6)	user_004886
211.1682	 (total retweets: 1)	user_025585
=====================================================
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="recommendations-by-source-similarity">
<h1>Recommendations by source similarity<a class="headerlink" href="#recommendations-by-source-similarity" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">s_max_matches</span> <span class="o">=</span> <span class="mi">100</span> <span class="c1"># top_n matches when doing source similarity</span>

<span class="c1"># Print 10 closest sources for control set</span>
<span class="n">print_similar_to_sources</span><span class="p">(</span><span class="n">controls</span><span class="p">,</span> <span class="n">s_matrix</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>User: user_000041 similar to:
user_000041 1.0000
user_000009 0.9965
user_001337 0.9951
user_001294 0.9941
user_000081 0.9940
user_001196 0.9940
user_001382 0.9935
user_000004 0.9926
user_000023 0.9922
user_000113 0.9921

User: user_001399 similar to:
user_001399 1.0000
user_002612 0.9282
user_010184 0.9250
user_008121 0.9249
user_007165 0.9222
user_020202 0.9214
user_020235 0.9211
user_003773 0.9195
user_018445 0.9193
user_007467 0.9189

User: user_006266 similar to:
user_006266 1.0000
user_012485 0.8891
user_010670 0.8844
user_006267 0.8771
user_014171 0.8707
user_003740 0.8653
user_000946 0.8622
user_004077 0.8565
user_014186 0.8555
user_009665 0.8504

User: user_000014 similar to:
user_000014 1.0000
user_000304 0.9957
user_001213 0.9945
user_001382 0.9943
user_001104 0.9938
user_001214 0.9922
user_000009 0.9920
user_001617 0.9918
user_002581 0.9910
user_000204 0.9907

User: user_000128 similar to:
user_000128 1.0000
user_014245 0.9254
user_010120 0.9219
user_002604 0.9141
user_012511 0.9120
user_013106 0.9117
user_003769 0.9115
user_019708 0.9107
user_000582 0.9091
user_014986 0.9085

User: user_000025 similar to:
user_000025 1.0000
user_000035 0.9157
user_000642 0.9149
user_000323 0.9141
user_000457 0.9133
user_001006 0.9098
user_000271 0.9043
user_000504 0.9041
user_000351 0.9034
user_001046 0.9019

User: user_000708 similar to:
user_000708 1.0000
user_007599 0.9448
user_003083 0.9424
user_003227 0.9415
user_011669 0.9392
user_003833 0.9381
user_006478 0.9380
user_005993 0.9373
user_007343 0.9372
user_008605 0.9361

User: user_000408 similar to:
user_000408 1.0000
user_000739 0.9260
user_000214 0.9253
user_000099 0.9218
user_000512 0.9193
user_000329 0.9119
user_000150 0.9109
user_000443 0.9109
user_000830 0.9092
user_006258 0.9090

User: user_000614 similar to:
user_000614 1.0000
user_003833 0.9453
user_005429 0.9344
user_009634 0.9310
user_001876 0.9301
user_005600 0.9290
user_011669 0.9283
user_009716 0.9279
user_006027 0.9277
user_010584 0.9266

User: user_001560 similar to:
user_001560 1.0000
user_013713 0.8356
user_001558 0.7707
user_000643 0.7156
user_019573 0.7146
user_001792 0.6946
user_017787 0.6935
user_019155 0.6910
user_012974 0.6891
user_018035 0.6862

User: user_000280 similar to:
user_000280 1.0000
user_002705 0.9204
user_000437 0.9172
user_000515 0.9146
user_001191 0.9124
user_000228 0.9122
user_000130 0.9099
user_000470 0.9099
user_000159 0.9097
user_000319 0.9095

User: user_000089 similar to:
user_000089 1.0000
user_013944 0.9301
user_008747 0.9288
user_005405 0.9285
user_008918 0.9275
user_007166 0.9233
user_007688 0.9226
user_009349 0.9205
user_001907 0.9203
user_008722 0.9201

User: user_000022 similar to:
user_000022 1.0000
user_000296 0.9969
user_001196 0.9966
user_000004 0.9959
user_000113 0.9956
user_000024 0.9953
user_000023 0.9948
user_000481 0.9940
user_000431 0.9939
user_000081 0.9939

User: user_004286 similar to:
user_004286 1.0000
user_020235 0.9381
user_002590 0.9356
user_008257 0.9312
user_008819 0.9300
user_020991 0.9294
user_007516 0.9294
user_016054 0.9280
user_002644 0.9274
user_006308 0.9273

User: user_000003 similar to:
user_000003 1.0000
user_008268 0.9308
user_000940 0.9286
user_008541 0.9276
user_001503 0.9264
user_000039 0.9254
user_000528 0.9252
user_000887 0.9242
user_002950 0.9238
user_006087 0.9230

User: user_001608 similar to:
user_001608 1.0000
user_005765 0.8819
user_008774 0.8816
user_001304 0.8783
user_006104 0.8734
user_006522 0.8720
user_003379 0.8702
user_005720 0.8690
user_012127 0.8687
user_004181 0.8632

User: user_000350 similar to:
user_000350 1.0000
user_000407 0.8913
user_000739 0.8910
user_000728 0.8841
user_000948 0.8797
user_000165 0.8784
user_000562 0.8770
user_000226 0.8769
user_000323 0.8768
user_000209 0.8749

User: user_000000 similar to:
user_000000 1.0000
user_017839 0.4556
user_014965 0.4311
user_011137 0.4257
user_020086 0.4067
user_019929 0.3994
user_003704 0.3935
user_011648 0.3910
user_019855 0.3888
user_018943 0.3882

User: user_004000 similar to:
user_004000 1.0000
user_014235 0.8868
user_000993 0.8833
user_006489 0.8827
user_014644 0.8807
user_014991 0.8800
user_000243 0.8796
user_000210 0.8796
user_002474 0.8787
user_008114 0.8767

User: user_000130 similar to:
user_000130 1.0000
user_001269 0.9270
user_000191 0.9259
user_000401 0.9249
user_000457 0.9231
user_000741 0.9190
user_002705 0.9167
user_001133 0.9166
user_001191 0.9162
user_001046 0.9143
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Recommendations based on source similarity</span>
<span class="c1"># From the previously calculated source similarities, calculate recommendations thus:</span>
<span class="c1"># For each similar source, obtain their list of target ratings</span>
<span class="c1"># Record a counter for each target where we add a value: similarity * rating</span>
<span class="c1"># Once we have a ranked list of recommendations, choose the top items</span>
<span class="c1"># based on whether the original user has rated the target or not</span>

<span class="c1"># for similar_source, similarity in get_most_similar(source):</span>
<span class="c1">#     for target, num_retweets in get_source_retweets(similar_source):</span>
<span class="c1">#         recommended[target] += similarity * num_retweets</span>


<span class="k">def</span> <span class="nf">get_user_recommendations_by_source</span><span class="p">(</span><span class="n">ratings</span><span class="p">,</span> <span class="n">sid</span><span class="p">,</span> <span class="n">s_matrix</span><span class="p">):</span>
    <span class="n">s_ratings</span> <span class="o">=</span> <span class="n">ratings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ratings</span><span class="p">[</span><span class="s1">&#39;Source&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sid</span><span class="p">]</span>
    <span class="n">s_ratings</span> <span class="o">=</span> <span class="n">s_ratings</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;Weight&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">s_r</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">s_ratings</span><span class="p">[</span><span class="s1">&#39;Target&#39;</span><span class="p">],</span> <span class="n">s_ratings</span><span class="p">[</span><span class="s1">&#39;Weight&#39;</span><span class="p">]))</span>
    <span class="n">seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">tid_rating</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">s_r</span><span class="p">:</span>
        <span class="n">tid</span><span class="p">,</span> <span class="n">trating</span> <span class="o">=</span> <span class="n">item</span>
        <span class="n">tid_rating</span><span class="p">[</span><span class="n">tid</span><span class="p">]</span> <span class="o">=</span> <span class="n">trating</span>
        <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tid</span><span class="p">)</span>

    <span class="n">recommended</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
    <span class="n">matches</span> <span class="o">=</span> <span class="n">get_most_similar</span><span class="p">(</span><span class="n">sid</span><span class="p">,</span> <span class="n">s_matrix</span><span class="p">,</span> <span class="n">s_max_matches</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">matches</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
            <span class="n">sid</span><span class="p">,</span> <span class="n">similarity</span> <span class="o">=</span> <span class="n">item</span>
            <span class="n">ur</span> <span class="o">=</span> <span class="n">ratings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ratings</span><span class="p">[</span><span class="s1">&#39;Source&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sid</span><span class="p">]</span>
            <span class="n">ur</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">ur</span><span class="p">[</span><span class="s1">&#39;Target&#39;</span><span class="p">],</span> <span class="n">ur</span><span class="p">[</span><span class="s1">&#39;Weight&#39;</span><span class="p">]))</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">ur</span><span class="p">:</span>
                <span class="n">tid</span><span class="p">,</span> <span class="n">mr</span> <span class="o">=</span> <span class="n">entry</span>
                <span class="n">recommended</span><span class="p">[</span><span class="n">tid</span><span class="p">]</span> <span class="o">+=</span> <span class="n">similarity</span> <span class="o">*</span> <span class="n">mr</span>

    <span class="c1"># Now we&#39;ll build a recomendations list that contains the highest scored items</span>
    <span class="c1"># calculated above that the user hasn&#39;t already rated</span>
    <span class="n">seen_recommendations</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
    <span class="n">not_seen_recommendations</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">tid</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="n">recommended</span><span class="o">.</span><span class="n">most_common</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">seen_recommendations</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">10</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">not_seen_recommendations</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="k">if</span> <span class="n">tid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
            <span class="n">not_seen_recommendations</span><span class="p">[</span><span class="n">tid</span><span class="p">]</span> <span class="o">=</span> <span class="n">score</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">seen_recommendations</span><span class="p">[</span><span class="n">tid</span><span class="p">]</span> <span class="o">=</span> <span class="n">score</span>
    <span class="k">return</span> <span class="n">seen_recommendations</span><span class="p">,</span> <span class="n">not_seen_recommendations</span>

<span class="k">def</span> <span class="nf">print_recommendations_by_source</span><span class="p">(</span><span class="n">sid</span><span class="p">,</span> <span class="n">seen_recommendations</span><span class="p">,</span> <span class="n">not_seen_recommendations</span><span class="p">):</span>
    <span class="n">s_ratings</span> <span class="o">=</span> <span class="n">ratings</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ratings</span><span class="p">[</span><span class="s1">&#39;Source&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sid</span><span class="p">]</span>
    <span class="n">s_ratings</span> <span class="o">=</span> <span class="n">s_ratings</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;Weight&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">s_r</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">s_ratings</span><span class="p">[</span><span class="s1">&#39;Target&#39;</span><span class="p">],</span> <span class="n">s_ratings</span><span class="p">[</span><span class="s1">&#39;Weight&#39;</span><span class="p">]))</span>
    <span class="n">num_ratings</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s_r</span><span class="p">)</span>

    <span class="n">tid_rating</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">s_r</span><span class="p">:</span>
        <span class="n">tid</span><span class="p">,</span> <span class="n">mrating</span> <span class="o">=</span> <span class="n">item</span>
        <span class="n">tid_rating</span><span class="p">[</span><span class="n">tid</span><span class="p">]</span> <span class="o">=</span> <span class="n">mrating</span>

    <span class="c1"># Now let&#39;s print the output and see if it&#39;s sane</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;User: &quot;</span> <span class="o">+</span> <span class="n">sid_name</span><span class="p">[</span><span class="n">sid</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; retweeted &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num_ratings</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; different accounts.&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="n">top10</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">s_r</span><span class="p">[:</span><span class="mi">10</span><span class="p">]:</span>
        <span class="n">tid</span><span class="p">,</span> <span class="n">trating</span> <span class="o">=</span> <span class="n">item</span>
        <span class="n">top10</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tid</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Retweeted by user: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">trating</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; times, total retweets: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">target_retweeters</span><span class="p">[</span><span class="n">tid</span><span class="p">])</span> 
        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">  &quot;</span> <span class="o">+</span> <span class="n">tid_name</span><span class="p">[</span><span class="n">tid</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Recommended (seen):&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">seen_recommendations</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%.4f</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">c</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; (retweeted by user: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">tid_rating</span><span class="p">[</span><span class="n">x</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; times,&quot;</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; total retweets: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">target_retweeters</span><span class="p">[</span><span class="n">x</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span> 
        <span class="n">msg</span> <span class="o">+=</span> <span class="n">tid_name</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="n">target_tid</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; [X]&quot;</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">top10</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; [*]&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Recommended (not seen):&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">not_seen_recommendations</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%.4f</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">c</span> 
        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; (total retweets: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">target_retweeters</span><span class="p">[</span><span class="n">x</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;)</span><span class="se">\t</span><span class="s2">&quot;</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="n">tid_name</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="n">target_tid</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; [X]&quot;</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">top10</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; [*]&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=====================================================&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">print_user_recommendations_by_source</span><span class="p">(</span><span class="n">ratings</span><span class="p">,</span> <span class="n">sid</span><span class="p">,</span> <span class="n">s_matrix</span><span class="p">):</span>
    <span class="n">seen</span><span class="p">,</span> <span class="n">not_seen</span> <span class="o">=</span> <span class="n">get_user_recommendations_by_source</span><span class="p">(</span><span class="n">ratings</span><span class="p">,</span> <span class="n">sid</span><span class="p">,</span> <span class="n">s_matrix</span><span class="p">)</span>
    <span class="n">print_recommendations_by_source</span><span class="p">(</span><span class="n">sid</span><span class="p">,</span> <span class="n">seen</span><span class="p">,</span> <span class="n">not_seen</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Print source-based recommendations for control set</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">controls</span><span class="p">:</span>
    <span class="n">print_user_recommendations_by_source</span><span class="p">(</span><span class="n">ratings</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">s_matrix</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>User: user_000041 retweeted 171 different accounts.

Retweeted by user: 14 times, total retweets: 788	  user_025303
Retweeted by user: 4 times, total retweets: 2	  user_027283
Retweeted by user: 3 times, total retweets: 6	  user_004906
Retweeted by user: 3 times, total retweets: 101	  user_025218
Retweeted by user: 2 times, total retweets: 77	  user_025764
Retweeted by user: 2 times, total retweets: 43	  user_025266
Retweeted by user: 2 times, total retweets: 20	  user_024491
Retweeted by user: 2 times, total retweets: 82	  user_027313
Retweeted by user: 2 times, total retweets: 1	  user_027277
Retweeted by user: 2 times, total retweets: 126	  user_025171

Recommended (seen):
392.8223 (retweeted by user: 14 times, total retweets: 788)	user_025303 [*]
182.9197 (retweeted by user: 2 times, total retweets: 245)	user_025233
128.1706 (retweeted by user: 3 times, total retweets: 101)	user_025218 [*]
103.9492 (retweeted by user: 1 times, total retweets: 3480)	user_000009
83.8019 (retweeted by user: 2 times, total retweets: 126)	user_025171 [*]
66.1050 (retweeted by user: 1 times, total retweets: 86)	user_025939
32.5235 (retweeted by user: 1 times, total retweets: 30)	user_026341
30.6058 (retweeted by user: 1 times, total retweets: 50)	user_026187
30.5841 (retweeted by user: 1 times, total retweets: 53)	user_025244
29.6298 (retweeted by user: 1 times, total retweets: 64)	user_025200

Recommended (not seen):
184.0515 (total retweets: 44)	user_000237
179.2550 (total retweets: 89)	user_025208
168.3494 (total retweets: 70)	user_025162
116.4563 (total retweets: 193)	user_025194
76.9369 (total retweets: 150)	user_025301
56.2737 (total retweets: 78)	user_025670
54.4845 (total retweets: 114)	user_025253
51.2427 (total retweets: 68)	user_025428
44.3187 (total retweets: 44)	user_026113
43.4366 (total retweets: 67)	user_025251
=====================================================

User: user_001399 retweeted 334 different accounts.

Retweeted by user: 16 times, total retweets: 150	  user_025301
Retweeted by user: 14 times, total retweets: 56	  user_025465
Retweeted by user: 14 times, total retweets: 46	  user_025297
Retweeted by user: 13 times, total retweets: 29	  user_025942
Retweeted by user: 13 times, total retweets: 24	  user_026703
Retweeted by user: 12 times, total retweets: 788	  user_025303
Retweeted by user: 12 times, total retweets: 101	  user_025218
Retweeted by user: 10 times, total retweets: 126	  user_025171
Retweeted by user: 10 times, total retweets: 28	  user_026180
Retweeted by user: 9 times, total retweets: 36	  user_025586

Recommended (seen):
62.7155 (retweeted by user: 3 times, total retweets: 70)	user_025162
58.5201 (retweeted by user: 16 times, total retweets: 150)	user_025301 [*]
55.4294 (retweeted by user: 12 times, total retweets: 788)	user_025303 [*]
35.6820 (retweeted by user: 4 times, total retweets: 86)	user_025939
35.3458 (retweeted by user: 10 times, total retweets: 126)	user_025171 [*]
33.7147 (retweeted by user: 12 times, total retweets: 101)	user_025218 [*]
31.1434 (retweeted by user: 4 times, total retweets: 89)	user_025208
30.8577 (retweeted by user: 1 times, total retweets: 27)	user_025415
30.1581 (retweeted by user: 3 times, total retweets: 43)	user_025814
30.0482 (retweeted by user: 2 times, total retweets: 245)	user_025233

Recommended (not seen):
66.2299 (total retweets: 5477)	user_025343
36.1772 (total retweets: 3480)	user_000009
33.4769 (total retweets: 12)	user_025471
24.4291 (total retweets: 14)	user_025356
23.5351 (total retweets: 1708)	user_001690
23.5243 (total retweets: 45)	user_025963
20.8247 (total retweets: 26)	user_026012
19.9052 (total retweets: 56)	user_025530
19.0004 (total retweets: 29)	user_025457
18.9980 (total retweets: 114)	user_025253
=====================================================

User: user_006266 retweeted 500 different accounts.

Retweeted by user: 64 times, total retweets: 87	  user_000681
Retweeted by user: 62 times, total retweets: 788	  user_025303
Retweeted by user: 53 times, total retweets: 86	  user_025939
Retweeted by user: 44 times, total retweets: 6	  user_013766
Retweeted by user: 31 times, total retweets: 15	  user_004758
Retweeted by user: 31 times, total retweets: 245	  user_025233
Retweeted by user: 29 times, total retweets: 2	  user_031843
Retweeted by user: 25 times, total retweets: 13	  user_004964
Retweeted by user: 22 times, total retweets: 1100	  user_000755
Retweeted by user: 21 times, total retweets: 8	  user_031585

Recommended (seen):
76.0119 (retweeted by user: 53 times, total retweets: 86)	user_025939 [*]
73.5014 (retweeted by user: 62 times, total retweets: 788)	user_025303 [*]
64.8289 (retweeted by user: 64 times, total retweets: 87)	user_000681 [*]
49.0950 (retweeted by user: 31 times, total retweets: 245)	user_025233 [*]
44.0000 (retweeted by user: 44 times, total retweets: 6)	user_013766 [*]
31.0000 (retweeted by user: 31 times, total retweets: 15)	user_004758 [*]
29.9168 (retweeted by user: 2 times, total retweets: 126)	user_025171
29.4129 (retweeted by user: 22 times, total retweets: 1100)	user_000755 [*]
29.0000 (retweeted by user: 29 times, total retweets: 2)	user_031843 [*]
26.5307 (retweeted by user: 6 times, total retweets: 193)	user_025194

Recommended (not seen):
89.1228 (total retweets: 3480)	user_000009
25.1308 (total retweets: 1708)	user_001690
20.0555 (total retweets: 5477)	user_025343
19.0714 (total retweets: 2323)	user_001418
12.3199 (total retweets: 68)	user_025428
9.0319 (total retweets: 39)	user_025139
5.7476 (total retweets: 50)	user_026187
5.7476 (total retweets: 53)	user_025244
4.9339 (total retweets: 45)	user_026405
4.9302 (total retweets: 37)	user_025147
=====================================================

User: user_000014 retweeted 226 different accounts.

Retweeted by user: 34 times, total retweets: 126	  user_025171
Retweeted by user: 25 times, total retweets: 86	  user_025939
Retweeted by user: 24 times, total retweets: 193	  user_025194
Retweeted by user: 18 times, total retweets: 245	  user_025233
Retweeted by user: 14 times, total retweets: 68	  user_025428
Retweeted by user: 13 times, total retweets: 788	  user_025303
Retweeted by user: 11 times, total retweets: 39	  user_025139
Retweeted by user: 9 times, total retweets: 89	  user_025208
Retweeted by user: 8 times, total retweets: 70	  user_025162
Retweeted by user: 7 times, total retweets: 53	  user_025244

Recommended (seen):
390.6331 (retweeted by user: 13 times, total retweets: 788)	user_025303 [*]
182.0008 (retweeted by user: 18 times, total retweets: 245)	user_025233 [*]
178.5564 (retweeted by user: 9 times, total retweets: 89)	user_025208 [*]
167.7519 (retweeted by user: 8 times, total retweets: 70)	user_025162 [*]
127.5774 (retweeted by user: 4 times, total retweets: 101)	user_025218
115.3055 (retweeted by user: 24 times, total retweets: 193)	user_025194 [*]
84.0018 (retweeted by user: 34 times, total retweets: 126)	user_025171 [*]
66.1885 (retweeted by user: 25 times, total retweets: 86)	user_025939 [*]
56.0742 (retweeted by user: 5 times, total retweets: 78)	user_025670
54.0814 (retweeted by user: 2 times, total retweets: 114)	user_025253

Recommended (not seen):
183.2729 (total retweets: 44)	user_000237
90.1363 (total retweets: 3480)	user_000009
75.5582 (total retweets: 150)	user_025301
36.2625 (total retweets: 22)	user_025600
34.3024 (total retweets: 1)	user_002482
33.4018 (total retweets: 51)	user_025350
33.3266 (total retweets: 5)	user_026824
32.3675 (total retweets: 30)	user_026341
29.4282 (total retweets: 64)	user_025200
27.4469 (total retweets: 23)	user_025583
=====================================================

User: user_000128 retweeted 77 different accounts.

Retweeted by user: 27 times, total retweets: 66	  user_025143
Retweeted by user: 15 times, total retweets: 788	  user_025303
Retweeted by user: 7 times, total retweets: 37	  user_025147
Retweeted by user: 7 times, total retweets: 245	  user_025233
Retweeted by user: 6 times, total retweets: 78	  user_025670
Retweeted by user: 5 times, total retweets: 116	  user_026156
Retweeted by user: 4 times, total retweets: 45	  user_025170
Retweeted by user: 4 times, total retweets: 1	  user_028614
Retweeted by user: 4 times, total retweets: 58	  user_025178
Retweeted by user: 3 times, total retweets: 68	  user_025428

Recommended (seen):
66.6537 (retweeted by user: 15 times, total retweets: 788)	user_025303 [*]
29.2543 (retweeted by user: 3 times, total retweets: 68)	user_025428 [*]
27.8751 (retweeted by user: 27 times, total retweets: 66)	user_025143 [*]
22.8785 (retweeted by user: 1 times, total retweets: 101)	user_025218
16.5017 (retweeted by user: 6 times, total retweets: 78)	user_025670 [*]
15.7782 (retweeted by user: 7 times, total retweets: 245)	user_025233 [*]
12.6266 (retweeted by user: 3 times, total retweets: 126)	user_025171
9.3757 (retweeted by user: 5 times, total retweets: 116)	user_026156 [*]
7.2509 (retweeted by user: 2 times, total retweets: 150)	user_025301
7.0000 (retweeted by user: 7 times, total retweets: 37)	user_025147 [*]

Recommended (not seen):
104.1419 (total retweets: 19)	user_000124
43.7184 (total retweets: 5477)	user_025343
29.7548 (total retweets: 13)	user_025765
19.7356 (total retweets: 638)	user_000596
16.6277 (total retweets: 56)	user_025465
15.1069 (total retweets: 2323)	user_001418
14.2997 (total retweets: 1708)	user_001690
14.0023 (total retweets: 43)	user_025266
14.0023 (total retweets: 57)	user_025227
12.2520 (total retweets: 36)	user_025586
=====================================================

User: user_000025 retweeted 111 different accounts.

Retweeted by user: 40 times, total retweets: 788	  user_025303
Retweeted by user: 13 times, total retweets: 1	  user_012787
Retweeted by user: 9 times, total retweets: 67	  user_025251
Retweeted by user: 9 times, total retweets: 18	  user_026143
Retweeted by user: 9 times, total retweets: 10	  user_027109
Retweeted by user: 8 times, total retweets: 101	  user_025218
Retweeted by user: 8 times, total retweets: 37	  user_025147
Retweeted by user: 8 times, total retweets: 150	  user_025301
Retweeted by user: 7 times, total retweets: 22	  user_026639
Retweeted by user: 7 times, total retweets: 36	  user_025586

Recommended (seen):
107.3815 (retweeted by user: 40 times, total retweets: 788)	user_025303 [*]
33.3151 (retweeted by user: 5 times, total retweets: 245)	user_025233
31.4028 (retweeted by user: 2 times, total retweets: 66)	user_025143
28.4361 (retweeted by user: 2 times, total retweets: 126)	user_025171
25.5913 (retweeted by user: 7 times, total retweets: 193)	user_025194
23.0651 (retweeted by user: 8 times, total retweets: 150)	user_025301 [*]
22.6135 (retweeted by user: 4 times, total retweets: 78)	user_025670
22.0577 (retweeted by user: 8 times, total retweets: 101)	user_025218 [*]
21.7879 (retweeted by user: 4 times, total retweets: 17)	user_026333
21.3293 (retweeted by user: 8 times, total retweets: 37)	user_025147 [*]

Recommended (not seen):
129.9567 (total retweets: 3480)	user_000009
66.2388 (total retweets: 638)	user_000596
18.5532 (total retweets: 40)	user_025473
17.9269 (total retweets: 18)	user_027309
15.9335 (total retweets: 281)	user_007196
13.3099 (total retweets: 74)	user_025224
12.4332 (total retweets: 28)	user_025551
12.2344 (total retweets: 2)	user_024512
11.5622 (total retweets: 9)	user_027508
11.5325 (total retweets: 116)	user_026156
=====================================================

User: user_000708 retweeted 130 different accounts.

Retweeted by user: 22 times, total retweets: 126	  user_025171
Retweeted by user: 18 times, total retweets: 788	  user_025303
Retweeted by user: 10 times, total retweets: 70	  user_025162
Retweeted by user: 9 times, total retweets: 56	  user_025465
Retweeted by user: 7 times, total retweets: 66	  user_025143
Retweeted by user: 6 times, total retweets: 67	  user_025251
Retweeted by user: 5 times, total retweets: 44	  user_026113
Retweeted by user: 4 times, total retweets: 53	  user_025244
Retweeted by user: 4 times, total retweets: 26	  user_026313
Retweeted by user: 4 times, total retweets: 245	  user_025233

Recommended (seen):
22.0000 (retweeted by user: 22 times, total retweets: 126)	user_025171 [*]
18.9256 (retweeted by user: 18 times, total retweets: 788)	user_025303 [*]
10.0000 (retweeted by user: 10 times, total retweets: 70)	user_025162 [*]
9.9264 (retweeted by user: 9 times, total retweets: 56)	user_025465 [*]
7.0000 (retweeted by user: 7 times, total retweets: 66)	user_025143 [*]
6.0000 (retweeted by user: 6 times, total retweets: 67)	user_025251 [*]
5.0000 (retweeted by user: 5 times, total retweets: 44)	user_026113 [*]
4.9321 (retweeted by user: 4 times, total retweets: 245)	user_025233 [*]
4.0000 (retweeted by user: 4 times, total retweets: 26)	user_026313 [*]
4.0000 (retweeted by user: 4 times, total retweets: 53)	user_025244 [*]

Recommended (not seen):
35.3123 (total retweets: 5477)	user_025343
31.5598 (total retweets: 3480)	user_000009
17.6201 (total retweets: 2323)	user_001418
8.3686 (total retweets: 1100)	user_000755
8.3337 (total retweets: 1708)	user_001690
6.4870 (total retweets: 2350)	user_020135
5.5710 (total retweets: 750)	user_004000
3.7107 (total retweets: 638)	user_000596
3.7040 (total retweets: 1067)	user_004286 [X]
2.7914 (total retweets: 281)	user_007196
=====================================================

User: user_000408 retweeted 494 different accounts.

Retweeted by user: 6 times, total retweets: 27	  user_026028
Retweeted by user: 6 times, total retweets: 22	  user_025993
Retweeted by user: 5 times, total retweets: 93	  user_000408
Retweeted by user: 5 times, total retweets: 86	  user_025939
Retweeted by user: 5 times, total retweets: 13	  user_025787
Retweeted by user: 5 times, total retweets: 1	  user_030728
Retweeted by user: 4 times, total retweets: 126	  user_025171
Retweeted by user: 4 times, total retweets: 2	  user_030730
Retweeted by user: 4 times, total retweets: 58	  user_025825
Retweeted by user: 4 times, total retweets: 788	  user_025303

Recommended (seen):
100.7861 (retweeted by user: 4 times, total retweets: 788)	user_025303 [*]
32.4834 (retweeted by user: 4 times, total retweets: 245)	user_025233
28.1795 (retweeted by user: 4 times, total retweets: 126)	user_025171 [*]
24.3128 (retweeted by user: 1 times, total retweets: 193)	user_025194
22.6774 (retweeted by user: 1 times, total retweets: 150)	user_025301
21.0606 (retweeted by user: 3 times, total retweets: 78)	user_025670
20.8975 (retweeted by user: 1 times, total retweets: 101)	user_025218
19.3902 (retweeted by user: 3 times, total retweets: 70)	user_025162
13.5545 (retweeted by user: 4 times, total retweets: 67)	user_025251
12.1466 (retweeted by user: 1 times, total retweets: 28)	user_025551

Recommended (not seen):
112.3503 (total retweets: 3480)	user_000009
99.3766 (total retweets: 638)	user_000596
30.2798 (total retweets: 66)	user_025143
20.6328 (total retweets: 17)	user_026333
19.8508 (total retweets: 37)	user_025147
18.0398 (total retweets: 40)	user_025473
17.3086 (total retweets: 18)	user_027309
16.7403 (total retweets: 281)	user_007196
16.3491 (total retweets: 53)	user_025244
13.8416 (total retweets: 18)	user_026143
=====================================================

User: user_000614 retweeted 140 different accounts.

Retweeted by user: 10 times, total retweets: 4	  user_030941
Retweeted by user: 8 times, total retweets: 126	  user_025171
Retweeted by user: 7 times, total retweets: 1	  user_030942
Retweeted by user: 7 times, total retweets: 17	  user_026023
Retweeted by user: 7 times, total retweets: 245	  user_025233
Retweeted by user: 6 times, total retweets: 116	  user_026156
Retweeted by user: 6 times, total retweets: 50	  user_026187
Retweeted by user: 6 times, total retweets: 4	  user_006910
Retweeted by user: 6 times, total retweets: 88	  user_025206
Retweeted by user: 5 times, total retweets: 52	  user_026068

Recommended (seen):
28.0721 (retweeted by user: 8 times, total retweets: 126)	user_025171 [*]
21.4227 (retweeted by user: 5 times, total retweets: 788)	user_025303
11.5607 (retweeted by user: 7 times, total retweets: 245)	user_025233 [*]
10.0000 (retweeted by user: 10 times, total retweets: 4)	user_030941 [*]
8.7371 (retweeted by user: 6 times, total retweets: 88)	user_025206 [*]
7.8325 (retweeted by user: 6 times, total retweets: 50)	user_026187 [*]
7.7438 (retweeted by user: 5 times, total retweets: 101)	user_025218
7.4742 (retweeted by user: 2 times, total retweets: 67)	user_025251
7.0000 (retweeted by user: 7 times, total retweets: 17)	user_026023 [*]
7.0000 (retweeted by user: 7 times, total retweets: 1)	user_030942 [*]

Recommended (not seen):
24.7671 (total retweets: 5477)	user_025343
22.0036 (total retweets: 1708)	user_001690
19.3035 (total retweets: 3480)	user_000009
14.7279 (total retweets: 2323)	user_001418
9.1237 (total retweets: 70)	user_025162
8.2113 (total retweets: 56)	user_025465
7.3661 (total retweets: 750)	user_004000
6.4457 (total retweets: 1067)	user_004286 [X]
6.3866 (total retweets: 66)	user_025143
4.5906 (total retweets: 1100)	user_000755
=====================================================

User: user_001560 retweeted 453 different accounts.

Retweeted by user: 73 times, total retweets: 150	  user_025301
Retweeted by user: 53 times, total retweets: 245	  user_025233
Retweeted by user: 37 times, total retweets: 101	  user_025218
Retweeted by user: 37 times, total retweets: 25	  user_025220
Retweeted by user: 35 times, total retweets: 6	  user_025470
Retweeted by user: 34 times, total retweets: 114	  user_025253
Retweeted by user: 30 times, total retweets: 39	  user_025259
Retweeted by user: 29 times, total retweets: 7	  user_025542
Retweeted by user: 26 times, total retweets: 17	  user_025304
Retweeted by user: 26 times, total retweets: 44	  user_026113

Recommended (seen):
73.0000 (retweeted by user: 73 times, total retweets: 150)	user_025301 [*]
55.5738 (retweeted by user: 53 times, total retweets: 245)	user_025233 [*]
40.8846 (retweeted by user: 37 times, total retweets: 101)	user_025218 [*]
37.0000 (retweeted by user: 37 times, total retweets: 25)	user_025220 [*]
35.0000 (retweeted by user: 35 times, total retweets: 6)	user_025470 [*]
34.0000 (retweeted by user: 34 times, total retweets: 114)	user_025253 [*]
30.0000 (retweeted by user: 30 times, total retweets: 39)	user_025259 [*]
29.0000 (retweeted by user: 29 times, total retweets: 7)	user_025542 [*]
26.0000 (retweeted by user: 26 times, total retweets: 17)	user_025304 [*]
26.0000 (retweeted by user: 26 times, total retweets: 44)	user_026113 [*]

Recommended (not seen):
21.3464 (total retweets: 5477)	user_025343
12.9937 (total retweets: 2350)	user_020135
9.6956 (total retweets: 2323)	user_001418
8.4630 (total retweets: 3480)	user_000009
4.7045 (total retweets: 1708)	user_001690
3.8846 (total retweets: 43)	user_025865
3.3695 (total retweets: 1100)	user_000755
2.6136 (total retweets: 1067)	user_004286 [X]
2.5897 (total retweets: 17)	user_025596
1.9423 (total retweets: 16)	user_025565
=====================================================

User: user_000280 retweeted 102 different accounts.

Retweeted by user: 6 times, total retweets: 1	  user_030370
Retweeted by user: 4 times, total retweets: 245	  user_025233
Retweeted by user: 4 times, total retweets: 126	  user_025171
Retweeted by user: 2 times, total retweets: 19	  user_026666
Retweeted by user: 2 times, total retweets: 15	  user_025824
Retweeted by user: 2 times, total retweets: 788	  user_025303
Retweeted by user: 2 times, total retweets: 1	  user_030389
Retweeted by user: 2 times, total retweets: 101	  user_025218
Retweeted by user: 2 times, total retweets: 17	  user_027194
Retweeted by user: 2 times, total retweets: 150	  user_025301

Recommended (seen):
164.2845 (retweeted by user: 2 times, total retweets: 788)	user_025303 [*]
42.0912 (retweeted by user: 4 times, total retweets: 245)	user_025233 [*]
24.5806 (retweeted by user: 4 times, total retweets: 126)	user_025171 [*]
24.2218 (retweeted by user: 2 times, total retweets: 150)	user_025301 [*]
20.6815 (retweeted by user: 1 times, total retweets: 37)	user_025147
16.9660 (retweeted by user: 2 times, total retweets: 101)	user_025218 [*]
16.3517 (retweeted by user: 1 times, total retweets: 53)	user_025244
15.3575 (retweeted by user: 1 times, total retweets: 65)	user_025179
11.4118 (retweeted by user: 1 times, total retweets: 13)	user_007785
9.8742 (retweeted by user: 1 times, total retweets: 316)	user_025962

Recommended (not seen):
109.9275 (total retweets: 3480)	user_000009
102.7185 (total retweets: 638)	user_000596
94.5765 (total retweets: 87)	user_000681
54.6699 (total retweets: 31)	user_004988
35.5741 (total retweets: 25)	user_000813
32.9863 (total retweets: 67)	user_025406
32.1502 (total retweets: 57)	user_025937
31.4422 (total retweets: 66)	user_025143
31.2354 (total retweets: 21)	user_020218
30.3678 (total retweets: 15)	user_004758
=====================================================

User: user_000089 retweeted 172 different accounts.

Retweeted by user: 53 times, total retweets: 788	  user_025303
Retweeted by user: 37 times, total retweets: 245	  user_025233
Retweeted by user: 7 times, total retweets: 193	  user_025194
Retweeted by user: 7 times, total retweets: 45	  user_026405
Retweeted by user: 5 times, total retweets: 68	  user_025428
Retweeted by user: 5 times, total retweets: 101	  user_025218
Retweeted by user: 5 times, total retweets: 126	  user_025171
Retweeted by user: 4 times, total retweets: 34	  user_000089
Retweeted by user: 3 times, total retweets: 16	  user_026015
Retweeted by user: 3 times, total retweets: 45	  user_025170

Recommended (seen):
62.0694 (retweeted by user: 53 times, total retweets: 788)	user_025303 [*]
40.6423 (retweeted by user: 37 times, total retweets: 245)	user_025233 [*]
8.8157 (retweeted by user: 7 times, total retweets: 193)	user_025194 [*]
7.0000 (retweeted by user: 7 times, total retweets: 45)	user_026405 [*]
5.9074 (retweeted by user: 5 times, total retweets: 68)	user_025428 [*]
5.6302 (retweeted by user: 2 times, total retweets: 116)	user_026156
5.0000 (retweeted by user: 5 times, total retweets: 126)	user_025171 [*]
5.0000 (retweeted by user: 5 times, total retweets: 101)	user_025218 [*]
4.0000 (retweeted by user: 4 times, total retweets: 34)	user_000089 [*]
3.9074 (retweeted by user: 3 times, total retweets: 45)	user_025170 [*]

Recommended (not seen):
68.0051 (total retweets: 3480)	user_000009
35.5275 (total retweets: 638)	user_000596
18.2056 (total retweets: 5477)	user_025343
13.6685 (total retweets: 2323)	user_001418
8.1987 (total retweets: 1100)	user_000755
7.2802 (total retweets: 2350)	user_020135
7.2419 (total retweets: 1708)	user_001690
5.4547 (total retweets: 750)	user_004000
3.6396 (total retweets: 1067)	user_004286 [X]
2.7430 (total retweets: 91)	user_000614
=====================================================

User: user_000022 retweeted 650 different accounts.

Retweeted by user: 82 times, total retweets: 788	  user_025303
Retweeted by user: 58 times, total retweets: 245	  user_025233
Retweeted by user: 29 times, total retweets: 114	  user_025253
Retweeted by user: 25 times, total retweets: 6	  user_016321
Retweeted by user: 20 times, total retweets: 5	  user_025768
Retweeted by user: 20 times, total retweets: 43	  user_025814
Retweeted by user: 17 times, total retweets: 193	  user_025194
Retweeted by user: 15 times, total retweets: 88	  user_025206
Retweeted by user: 15 times, total retweets: 17	  user_025219
Retweeted by user: 14 times, total retweets: 89	  user_025208

Recommended (seen):
394.1764 (retweeted by user: 82 times, total retweets: 788)	user_025303 [*]
183.6858 (retweeted by user: 58 times, total retweets: 245)	user_025233 [*]
180.3365 (retweeted by user: 14 times, total retweets: 89)	user_025208 [*]
168.3349 (retweeted by user: 2 times, total retweets: 70)	user_025162
128.8816 (retweeted by user: 12 times, total retweets: 101)	user_025218
116.8500 (retweeted by user: 17 times, total retweets: 193)	user_025194 [*]
83.9190 (retweeted by user: 6 times, total retweets: 126)	user_025171
76.4119 (retweeted by user: 10 times, total retweets: 150)	user_025301
67.1941 (retweeted by user: 10 times, total retweets: 86)	user_025939
56.4595 (retweeted by user: 4 times, total retweets: 78)	user_025670

Recommended (not seen):
185.2532 (total retweets: 44)	user_000237
108.2281 (total retweets: 3480)	user_000009
36.6544 (total retweets: 22)	user_025600
34.6731 (total retweets: 1)	user_002482
33.6991 (total retweets: 51)	user_025350
33.6855 (total retweets: 5)	user_026824
32.6929 (total retweets: 30)	user_026341
28.5157 (total retweets: 1708)	user_001690
24.7665 (total retweets: 6)	user_028427
24.7375 (total retweets: 37)	user_025147
=====================================================

User: user_004286 retweeted 566 different accounts.

Retweeted by user: 90 times, total retweets: 37	  user_026470
Retweeted by user: 76 times, total retweets: 38	  user_004572
Retweeted by user: 56 times, total retweets: 20	  user_005961
Retweeted by user: 40 times, total retweets: 14	  user_005507
Retweeted by user: 38 times, total retweets: 15	  user_007254
Retweeted by user: 36 times, total retweets: 13	  user_004964
Retweeted by user: 36 times, total retweets: 12	  user_011143
Retweeted by user: 35 times, total retweets: 12	  user_004767
Retweeted by user: 34 times, total retweets: 788	  user_025303
Retweeted by user: 34 times, total retweets: 24	  user_010214

Recommended (seen):
90.0000 (retweeted by user: 90 times, total retweets: 37)	user_026470 [*]
76.0000 (retweeted by user: 76 times, total retweets: 38)	user_004572 [*]
56.0000 (retweeted by user: 56 times, total retweets: 20)	user_005961 [*]
40.0000 (retweeted by user: 40 times, total retweets: 14)	user_005507 [*]
38.0000 (retweeted by user: 38 times, total retweets: 15)	user_007254 [*]
36.0000 (retweeted by user: 36 times, total retweets: 13)	user_004964 [*]
36.0000 (retweeted by user: 36 times, total retweets: 12)	user_011143 [*]
35.0000 (retweeted by user: 35 times, total retweets: 12)	user_004767 [*]
34.0000 (retweeted by user: 34 times, total retweets: 19)	user_025144
34.0000 (retweeted by user: 34 times, total retweets: 24)	user_010214 [*]

Recommended (not seen):
42.0206 (total retweets: 1708)	user_001690
32.9911 (total retweets: 3480)	user_000009
27.4723 (total retweets: 5477)	user_025343
9.1769 (total retweets: 750)	user_004000
8.2358 (total retweets: 1100)	user_000755
5.4911 (total retweets: 2323)	user_001418
3.6854 (total retweets: 638)	user_000596
2.7522 (total retweets: 289)	user_001947
2.7472 (total retweets: 281)	user_007196
1.8624 (total retweets: 2350)	user_020135
=====================================================

User: user_000003 retweeted 1438 different accounts.

Retweeted by user: 166 times, total retweets: 245	  user_025233
Retweeted by user: 129 times, total retweets: 788	  user_025303
Retweeted by user: 44 times, total retweets: 24	  user_026570
Retweeted by user: 38 times, total retweets: 30	  user_026039
Retweeted by user: 32 times, total retweets: 36	  user_025586
Retweeted by user: 31 times, total retweets: 126	  user_025171
Retweeted by user: 28 times, total retweets: 101	  user_025218
Retweeted by user: 25 times, total retweets: 2	  user_025859
Retweeted by user: 24 times, total retweets: 5	  user_026259
Retweeted by user: 23 times, total retweets: 9	  user_026726

Recommended (seen):
366.5245 (retweeted by user: 129 times, total retweets: 788)	user_025303 [*]
252.8488 (retweeted by user: 166 times, total retweets: 245)	user_025233 [*]
161.0592 (retweeted by user: 21 times, total retweets: 70)	user_025162
159.6363 (retweeted by user: 15 times, total retweets: 89)	user_025208
124.0980 (retweeted by user: 28 times, total retweets: 101)	user_025218 [*]
76.0266 (retweeted by user: 12 times, total retweets: 193)	user_025194
68.5269 (retweeted by user: 31 times, total retweets: 126)	user_025171 [*]
62.7604 (retweeted by user: 17 times, total retweets: 150)	user_025301
54.4050 (retweeted by user: 16 times, total retweets: 78)	user_025670
50.6115 (retweeted by user: 14 times, total retweets: 44)	user_026113

Recommended (not seen):
172.1073 (total retweets: 44)	user_000237
96.7632 (total retweets: 3480)	user_000009
32.0397 (total retweets: 1)	user_002482
30.2089 (total retweets: 5)	user_026824
22.8855 (total retweets: 6)	user_028427
21.0312 (total retweets: 2323)	user_001418
15.5621 (total retweets: 4)	user_028094
14.6467 (total retweets: 3)	user_028230
13.7207 (total retweets: 25)	user_026770
13.6627 (total retweets: 43)	user_025460
=====================================================

User: user_001608 retweeted 183 different accounts.

Retweeted by user: 150 times, total retweets: 788	  user_025303
Retweeted by user: 33 times, total retweets: 126	  user_025171
Retweeted by user: 29 times, total retweets: 32	  user_026005
Retweeted by user: 28 times, total retweets: 101	  user_025218
Retweeted by user: 19 times, total retweets: 56	  user_025465
Retweeted by user: 19 times, total retweets: 30	  user_026341
Retweeted by user: 17 times, total retweets: 116	  user_026156
Retweeted by user: 14 times, total retweets: 42	  user_026557
Retweeted by user: 13 times, total retweets: 150	  user_025301
Retweeted by user: 10 times, total retweets: 57	  user_025227

Recommended (seen):
173.0355 (retweeted by user: 150 times, total retweets: 788)	user_025303 [*]
37.7003 (retweeted by user: 33 times, total retweets: 126)	user_025171 [*]
35.7186 (retweeted by user: 28 times, total retweets: 101)	user_025218 [*]
33.7495 (retweeted by user: 4 times, total retweets: 245)	user_025233
29.0000 (retweeted by user: 29 times, total retweets: 32)	user_026005 [*]
21.2586 (retweeted by user: 17 times, total retweets: 116)	user_026156 [*]
19.8783 (retweeted by user: 19 times, total retweets: 30)	user_026341 [*]
19.8517 (retweeted by user: 19 times, total retweets: 56)	user_025465 [*]
17.0723 (retweeted by user: 6 times, total retweets: 70)	user_025162
16.4184 (retweeted by user: 13 times, total retweets: 150)	user_025301 [*]

Recommended (not seen):
26.4480 (total retweets: 1708)	user_001690
18.7377 (total retweets: 45)	user_025963
17.9427 (total retweets: 462)	user_000340
15.2947 (total retweets: 5477)	user_025343
14.2679 (total retweets: 3480)	user_000009
13.6274 (total retweets: 27)	user_026123
13.2756 (total retweets: 2323)	user_001418
12.7757 (total retweets: 16)	user_026304
11.9240 (total retweets: 17)	user_026146
11.9240 (total retweets: 2)	user_028463
=====================================================

User: user_000350 retweeted 310 different accounts.

Retweeted by user: 60 times, total retweets: 788	  user_025303
Retweeted by user: 39 times, total retweets: 193	  user_025194
Retweeted by user: 39 times, total retweets: 39	  user_025139
Retweeted by user: 39 times, total retweets: 45	  user_025963
Retweeted by user: 33 times, total retweets: 101	  user_025218
Retweeted by user: 30 times, total retweets: 15	  user_026155
Retweeted by user: 29 times, total retweets: 67	  user_025251
Retweeted by user: 26 times, total retweets: 126	  user_025171
Retweeted by user: 25 times, total retweets: 67	  user_025406
Retweeted by user: 20 times, total retweets: 38	  user_026129

Recommended (seen):
192.8604 (retweeted by user: 60 times, total retweets: 788)	user_025303 [*]
64.9295 (retweeted by user: 39 times, total retweets: 193)	user_025194 [*]
61.1861 (retweeted by user: 1 times, total retweets: 66)	user_025143
55.0183 (retweeted by user: 25 times, total retweets: 67)	user_025406 [*]
49.3797 (retweeted by user: 26 times, total retweets: 126)	user_025171 [*]
48.0139 (retweeted by user: 33 times, total retweets: 101)	user_025218 [*]
45.6932 (retweeted by user: 39 times, total retweets: 45)	user_025963 [*]
44.0441 (retweeted by user: 39 times, total retweets: 39)	user_025139 [*]
37.3279 (retweeted by user: 29 times, total retweets: 67)	user_025251 [*]
37.2915 (retweeted by user: 3 times, total retweets: 245)	user_025233

Recommended (not seen):
110.2196 (total retweets: 3480)	user_000009
90.9330 (total retweets: 87)	user_000681
76.9398 (total retweets: 638)	user_000596
54.2054 (total retweets: 31)	user_004988
39.2467 (total retweets: 37)	user_025147
34.2043 (total retweets: 25)	user_000813
30.0344 (total retweets: 21)	user_020218
29.2001 (total retweets: 15)	user_004758
28.3658 (total retweets: 6)	user_009559
23.3663 (total retweets: 15)	user_010381
=====================================================

User: user_000000 retweeted 597 different accounts.

Retweeted by user: 18 times, total retweets: 5	  user_025420
Retweeted by user: 13 times, total retweets: 150	  user_025301
Retweeted by user: 10 times, total retweets: 8	  user_025203
Retweeted by user: 10 times, total retweets: 89	  user_025208
Retweeted by user: 9 times, total retweets: 245	  user_025233
Retweeted by user: 8 times, total retweets: 10	  user_025575
Retweeted by user: 7 times, total retweets: 788	  user_025303
Retweeted by user: 7 times, total retweets: 3	  user_025281
Retweeted by user: 7 times, total retweets: 70	  user_025162
Retweeted by user: 6 times, total retweets: 41	  user_025173

Recommended (seen):
18.0000 (retweeted by user: 18 times, total retweets: 5)	user_025420 [*]
13.0000 (retweeted by user: 13 times, total retweets: 150)	user_025301 [*]
11.2304 (retweeted by user: 2 times, total retweets: 2350)	user_020135
10.0000 (retweeted by user: 10 times, total retweets: 8)	user_025203 [*]
10.0000 (retweeted by user: 10 times, total retweets: 89)	user_025208 [*]
9.7832 (retweeted by user: 1 times, total retweets: 5477)	user_025343
9.3343 (retweeted by user: 9 times, total retweets: 245)	user_025233 [*]
8.0744 (retweeted by user: 7 times, total retweets: 788)	user_025303 [*]
8.0000 (retweeted by user: 8 times, total retweets: 10)	user_025575 [*]
7.0000 (retweeted by user: 7 times, total retweets: 70)	user_025162 [*]

Recommended (not seen):
21.0424 (total retweets: 3480)	user_000009
2.8862 (total retweets: 2323)	user_001418
2.5079 (total retweets: 1100)	user_000755
2.3039 (total retweets: 638)	user_000596
2.0652 (total retweets: 1708)	user_001690
1.0436 (total retweets: 55)	user_000023
1.0192 (total retweets: 1067)	user_004286 [X]
0.7467 (total retweets: 750)	user_004000
0.7349 (total retweets: 129)	user_000130
0.7006 (total retweets: 462)	user_000340
=====================================================

User: user_004000 retweeted 54 different accounts.

Retweeted by user: 21 times, total retweets: 22	  user_000392
Retweeted by user: 12 times, total retweets: 37	  user_000305
Retweeted by user: 9 times, total retweets: 20	  user_001184
Retweeted by user: 8 times, total retweets: 36	  user_000093
Retweeted by user: 6 times, total retweets: 638	  user_000596
Retweeted by user: 5 times, total retweets: 788	  user_025303
Retweeted by user: 5 times, total retweets: 2	  user_005424
Retweeted by user: 4 times, total retweets: 65	  user_025179
Retweeted by user: 3 times, total retweets: 5	  user_027821
Retweeted by user: 3 times, total retweets: 13	  user_000253

Recommended (seen):
23.4447 (retweeted by user: 1 times, total retweets: 66)	user_025143
22.6615 (retweeted by user: 21 times, total retweets: 22)	user_000392 [*]
22.2969 (retweeted by user: 6 times, total retweets: 638)	user_000596 [*]
18.3229 (retweeted by user: 5 times, total retweets: 788)	user_025303 [*]
12.0000 (retweeted by user: 12 times, total retweets: 37)	user_000305 [*]
9.8308 (retweeted by user: 9 times, total retweets: 20)	user_001184 [*]
8.0000 (retweeted by user: 8 times, total retweets: 36)	user_000093 [*]
7.6607 (retweeted by user: 1 times, total retweets: 245)	user_025233
6.3995 (retweeted by user: 3 times, total retweets: 750)	user_004000
5.0000 (retweeted by user: 5 times, total retweets: 2)	user_005424 [*]

Recommended (not seen):
28.8210 (total retweets: 5477)	user_025343
20.2422 (total retweets: 2323)	user_001418
18.5374 (total retweets: 1067)	user_004286 [X]
13.6469 (total retweets: 3480)	user_000009
8.4555 (total retweets: 1708)	user_001690
5.9446 (total retweets: 1100)	user_000755
5.8190 (total retweets: 37)	user_025147
5.1132 (total retweets: 614)	user_000107
4.9877 (total retweets: 78)	user_025670
4.1564 (total retweets: 116)	user_026156
=====================================================

User: user_000130 retweeted 354 different accounts.

Retweeted by user: 59 times, total retweets: 788	  user_025303
Retweeted by user: 24 times, total retweets: 66	  user_025143
Retweeted by user: 20 times, total retweets: 17	  user_026333
Retweeted by user: 17 times, total retweets: 78	  user_025670
Retweeted by user: 15 times, total retweets: 193	  user_025194
Retweeted by user: 14 times, total retweets: 53	  user_025244
Retweeted by user: 14 times, total retweets: 70	  user_025162
Retweeted by user: 14 times, total retweets: 99	  user_025647
Retweeted by user: 14 times, total retweets: 245	  user_025233
Retweeted by user: 13 times, total retweets: 9	  user_027508

Recommended (seen):
99.9465 (retweeted by user: 59 times, total retweets: 788)	user_025303 [*]
33.8838 (retweeted by user: 24 times, total retweets: 66)	user_025143 [*]
28.5683 (retweeted by user: 14 times, total retweets: 245)	user_025233 [*]
23.5576 (retweeted by user: 20 times, total retweets: 17)	user_026333 [*]
22.3370 (retweeted by user: 17 times, total retweets: 78)	user_025670 [*]
22.1141 (retweeted by user: 15 times, total retweets: 193)	user_025194 [*]
21.9510 (retweeted by user: 13 times, total retweets: 37)	user_025147
21.7493 (retweeted by user: 11 times, total retweets: 150)	user_025301
21.1778 (retweeted by user: 13 times, total retweets: 126)	user_025171
17.5781 (retweeted by user: 14 times, total retweets: 53)	user_025244 [*]

Recommended (not seen):
115.9152 (total retweets: 3480)	user_000009
74.5622 (total retweets: 638)	user_000596
18.5186 (total retweets: 18)	user_027309
17.0561 (total retweets: 281)	user_007196
11.5622 (total retweets: 1)	user_012787
10.7727 (total retweets: 2323)	user_001418
9.6934 (total retweets: 44)	user_000237
8.0046 (total retweets: 10)	user_027109
7.1385 (total retweets: 2350)	user_020135
6.4815 (total retweets: 6)	user_026767
=====================================================
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="validation-count-how-many-times-target-appeared-in-top-n-recommendations-for-each-source">
<h1>Validation: count how many times target appeared in top_n recommendations for each source<a class="headerlink" href="#validation-count-how-many-times-target-appeared-in-top-n-recommendations-for-each-source" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">validate_target_target</span><span class="p">(</span><span class="n">ratings</span><span class="p">,</span> <span class="n">sid</span><span class="p">,</span> <span class="n">t_matrix</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">top_n</span><span class="p">):</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">seen</span><span class="p">,</span> <span class="n">not_seen</span> <span class="o">=</span> <span class="n">get_user_recommendations_by_target</span><span class="p">(</span><span class="n">ratings</span><span class="p">,</span> <span class="n">sid</span><span class="p">,</span> <span class="n">t_matrix</span><span class="p">)</span>
    <span class="n">top_tids</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">not_seen</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="n">top_n</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">top_tids</span><span class="p">:</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">ret</span>

<span class="k">def</span> <span class="nf">validate_target_source</span><span class="p">(</span><span class="n">ratings</span><span class="p">,</span> <span class="n">sid</span><span class="p">,</span> <span class="n">s_matrix</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">top_n</span><span class="p">):</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">seen</span><span class="p">,</span> <span class="n">not_seen</span> <span class="o">=</span> <span class="n">get_user_recommendations_by_source</span><span class="p">(</span><span class="n">ratings</span><span class="p">,</span> <span class="n">sid</span><span class="p">,</span> <span class="n">s_matrix</span><span class="p">)</span>
    <span class="n">top_tids</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">not_seen</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="n">top_n</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">top_tids</span><span class="p">:</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">ret</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">top_n</span> <span class="o">=</span> <span class="mi">3</span>
<span class="k">for</span> <span class="n">sid</span> <span class="ow">in</span> <span class="n">controls</span><span class="p">:</span>
    <span class="n">found</span> <span class="o">=</span> <span class="n">validate_target_target</span><span class="p">(</span><span class="n">ratings</span><span class="p">,</span> <span class="n">sid</span><span class="p">,</span> <span class="n">t_matrix</span><span class="p">,</span> <span class="n">target_tid</span><span class="p">,</span> <span class="n">top_n</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">found</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">ret</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Target was in top &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">top_n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; target-based recommendations for &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; users in control list.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Target was in top 3 target-based recommendations for 0 users in control list.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">res</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">top_n</span> <span class="o">=</span> <span class="mi">3</span>
<span class="k">for</span> <span class="n">sid</span> <span class="ow">in</span> <span class="n">controls</span><span class="p">:</span>
    <span class="n">found</span> <span class="o">=</span> <span class="n">validate_target_source</span><span class="p">(</span><span class="n">ratings</span><span class="p">,</span> <span class="n">sid</span><span class="p">,</span> <span class="n">s_matrix</span><span class="p">,</span> <span class="n">target_tid</span><span class="p">,</span> <span class="n">top_n</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">found</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Target was in top &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">top_n</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; source-based recommendations for &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">res</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; users in control list.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Target was in top 3 source-based recommendations for 1 users in control list.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># STOP</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="poisoning-experiment-1-randomly-chosen-amplifiers-variable-amps-retweets">
<h1>Poisoning experiment 1 - randomly chosen amplifiers, variable amps, retweets<a class="headerlink" href="#poisoning-experiment-1-randomly-chosen-amplifiers-variable-amps-retweets" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p>with differing numbers of amplifiers and retweets:</p>
<ul>
<li><p>repeat “iterations” times</p>
<ul>
<li><p>create new poisoned dataframe based on supplied parameters</p></li>
<li><p>save csv for gephi visualization</p></li>
<li><p>train model</p></li>
<li><p>run source-based and target-based recommendations, see how often target appears in top_n recommendations</p></li>
<li><p>record all results to be graphed later</p></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run poisoning experiment 1</span>
<span class="c1"># Note that this cell can take a number of hours to run</span>

<span class="c1"># These are the experiments to run</span>
<span class="c1"># Each pair of numbers denotes [num_amplifiers, num_retweets]</span>
<span class="c1"># A poisoned copy of the dataset is generated as follows:</span>
<span class="c1"># 1. Make a copy of the original dataset</span>
<span class="c1"># 2. Randomly select num_amplifiers accounts from amplifier candidates</span>
<span class="c1"># 3. For each selected amplifier, add two rows to the copied dataset:</span>
<span class="c1">#    amplifier - target - num_retweets</span>
<span class="c1">#    amplifier - high_profile_user - num_retweets</span>
<span class="c1"># 4. Perform the rest of the experiment (train model, analyze recomendations)</span>
<span class="n">experiments</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
               <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">],</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">50</span><span class="p">],</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span>
               <span class="p">[</span><span class="mi">20</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">],</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span><span class="mi">50</span><span class="p">],</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span>
               <span class="p">[</span><span class="mi">50</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span><span class="mi">20</span><span class="p">],</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">],</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span>
               <span class="p">[</span><span class="mi">100</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span><span class="mi">20</span><span class="p">],</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span><span class="mi">50</span><span class="p">],</span>
               <span class="p">[</span><span class="mi">200</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">200</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">200</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="mi">200</span><span class="p">,</span><span class="mi">20</span><span class="p">],</span> <span class="p">[</span><span class="mi">200</span><span class="p">,</span><span class="mi">50</span><span class="p">],</span>
               <span class="p">[</span><span class="mi">500</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">500</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">500</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="mi">500</span><span class="p">,</span><span class="mi">20</span><span class="p">],</span> <span class="p">[</span><span class="mi">500</span><span class="p">,</span><span class="mi">50</span><span class="p">],</span>
               <span class="p">[</span><span class="mi">1000</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1000</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">1000</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="mi">1000</span><span class="p">,</span><span class="mi">20</span><span class="p">],</span> <span class="p">[</span><span class="mi">1000</span><span class="p">,</span><span class="mi">50</span><span class="p">],</span>
               <span class="p">[</span><span class="mi">2000</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2000</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">2000</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="mi">2000</span><span class="p">,</span><span class="mi">20</span><span class="p">],</span> <span class="p">[</span><span class="mi">2000</span><span class="p">,</span><span class="mi">50</span><span class="p">],</span>
               <span class="p">[</span><span class="mi">4000</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">4000</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">4000</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="mi">4000</span><span class="p">,</span><span class="mi">20</span><span class="p">],</span> <span class="p">[</span><span class="mi">4000</span><span class="p">,</span><span class="mi">50</span><span class="p">]]</span>

<span class="n">samples</span> <span class="o">=</span> <span class="p">[</span><span class="n">target_tid</span><span class="p">,</span> <span class="n">high_profile_tid</span><span class="p">]</span>
<span class="n">top_n</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">iterations</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">epochs</span> <span class="o">=</span> <span class="mi">5</span>

<span class="c1"># 1. Pick random accounts (not in control set) to do the boosting </span>
<span class="c1"># that havent engaged with either high profile or target</span>
<span class="n">amplifier_candidates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">sid</span><span class="p">,</span> <span class="n">tids</span> <span class="ow">in</span> <span class="n">source_retweeted</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">inter</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">tids</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">controls</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">inter</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">high_profile_tid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tids</span> <span class="ow">and</span> <span class="n">target_tid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tids</span><span class="p">:</span>
                <span class="n">amplifier_candidates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sid</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of random amplifier candidates: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">amplifier_candidates</span><span class="p">)))</span>

<span class="c1"># Loop through the experiment parameters</span>
<span class="c1"># For each set of parameters, perform the experiment iterations number of times</span>
<span class="n">result_source</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">result_target</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">save_dir</span> <span class="o">=</span> <span class="s2">&quot;US2020/exp1&quot;</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">save_dir</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_dir</span><span class="p">)</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">experiments</span><span class="p">:</span>
    <span class="n">amps</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">item</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Experiment:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; amps:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">amps</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; r:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; take:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">save_path</span> <span class="o">=</span> <span class="n">save_dir</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">amps</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span>
        <span class="n">new_ratings</span> <span class="o">=</span> <span class="n">get_poisoned_dataset</span><span class="p">(</span><span class="n">ratings</span><span class="p">,</span> <span class="n">amplifier_candidates</span><span class="p">,</span> <span class="n">amps</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">save_path</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Base dataset length: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ratings</span><span class="p">))</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; Poisoned dataset length: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">new_ratings</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">new_target_w</span><span class="p">,</span> <span class="n">new_source_w</span> <span class="o">=</span> <span class="n">make_model</span><span class="p">(</span><span class="n">new_ratings</span><span class="p">,</span> <span class="n">model_type</span><span class="p">,</span> <span class="n">epochs</span><span class="p">)</span>
        <span class="n">new_t_matrix</span> <span class="o">=</span> <span class="n">cosine_similarity</span><span class="p">(</span><span class="n">new_target_w</span><span class="p">)</span>
        <span class="n">print_target_similarity</span><span class="p">(</span><span class="n">target_tid</span><span class="p">,</span> <span class="n">high_profile_tid</span><span class="p">,</span> <span class="n">new_t_matrix</span><span class="p">)</span>
        <span class="n">new_s_matrix</span> <span class="o">=</span> <span class="n">cosine_similarity</span><span class="p">(</span><span class="n">new_source_w</span><span class="p">)</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">sid</span> <span class="ow">in</span> <span class="n">controls</span><span class="p">:</span>
            <span class="n">found</span> <span class="o">=</span> <span class="n">validate_target_target</span><span class="p">(</span><span class="n">new_ratings</span><span class="p">,</span> <span class="n">sid</span><span class="p">,</span> <span class="n">new_t_matrix</span><span class="p">,</span> <span class="n">target_tid</span><span class="p">,</span> <span class="n">top_n</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">found</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Target was in top &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">top_n</span><span class="p">)</span> 
        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; target recommendations for &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span> 
        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; users in control list.&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">result_target</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">amps</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">ret</span><span class="p">])</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">save_dir</span> <span class="o">+</span> <span class="s2">&quot;/result_target.json&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">result_target</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
        <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">sid</span> <span class="ow">in</span> <span class="n">controls</span><span class="p">:</span>
            <span class="n">found</span> <span class="o">=</span> <span class="n">validate_target_source</span><span class="p">(</span><span class="n">new_ratings</span><span class="p">,</span> <span class="n">sid</span><span class="p">,</span> <span class="n">new_s_matrix</span><span class="p">,</span> <span class="n">target_tid</span><span class="p">,</span> <span class="n">top_n</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">found</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Target was in top &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">top_n</span><span class="p">)</span> 
        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; source recommendations for &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> 
        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; users in control list.&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">result_source</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">amps</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">res</span><span class="p">])</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">save_dir</span> <span class="o">+</span> <span class="s2">&quot;/result_source.json&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">result_source</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of random amplifier candidates: 23256

Experiment:1 amps:0 r:0 take:0
Base dataset length: 52920 Poisoned dataset length: 52920
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8794.023438</td>
      <td>8474.701172</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4793.515137</td>
      <td>4715.096680</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2482.211670</td>
      <td>3186.336670</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1646.312012</td>
      <td>2704.375244</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1493.106689</td>
      <td>2633.339844</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8395
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 0 users in control list.

Experiment:2 amps:0 r:0 take:1
Base dataset length: 52920 Poisoned dataset length: 52920
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8797.510742</td>
      <td>8507.350586</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4780.299316</td>
      <td>4720.615723</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2479.473877</td>
      <td>3168.660645</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1572.855591</td>
      <td>2682.748535</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1452.523438</td>
      <td>2611.063965</td>
      <td>00:14</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8706
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 2 users in control list.

Experiment:3 amps:0 r:0 take:2
Base dataset length: 52920 Poisoned dataset length: 52920
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8806.810547</td>
      <td>8533.323242</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4774.619141</td>
      <td>4752.689941</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2405.743896</td>
      <td>3209.593750</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1637.464355</td>
      <td>2723.090088</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1468.291260</td>
      <td>2651.237061</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8998
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 1 users in control list.

Experiment:4 amps:0 r:0 take:3
Base dataset length: 52920 Poisoned dataset length: 52920
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8800.289062</td>
      <td>8450.008789</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4727.339844</td>
      <td>4671.356934</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2389.022705</td>
      <td>3153.755371</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1585.594849</td>
      <td>2680.343262</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1407.343872</td>
      <td>2610.307129</td>
      <td>00:12</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8317
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 0 users in control list.

Experiment:5 amps:0 r:0 take:4
Base dataset length: 52920 Poisoned dataset length: 52920
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8786.551758</td>
      <td>8509.749023</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4764.883301</td>
      <td>4729.192871</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2436.162598</td>
      <td>3179.987793</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1574.234619</td>
      <td>2694.327393</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1385.106567</td>
      <td>2622.516602</td>
      <td>00:12</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.9125
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 1 users in control list.

Experiment:6 amps:0 r:0 take:5
Base dataset length: 52920 Poisoned dataset length: 52920
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8789.201172</td>
      <td>8528.486328</td>
      <td>00:14</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4756.785156</td>
      <td>4793.092285</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2397.587158</td>
      <td>3268.953613</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1599.799316</td>
      <td>2787.300537</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1438.879395</td>
      <td>2715.955322</td>
      <td>00:12</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.7124
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 0 users in control list.

Experiment:7 amps:0 r:0 take:6
Base dataset length: 52920 Poisoned dataset length: 52920
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8811.308594</td>
      <td>8512.632812</td>
      <td>00:14</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4774.034180</td>
      <td>4721.980957</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2436.042236</td>
      <td>3182.324951</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1637.547607</td>
      <td>2698.079102</td>
      <td>00:14</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1403.356812</td>
      <td>2626.590332</td>
      <td>00:12</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8037
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 2 users in control list.

Experiment:8 amps:0 r:0 take:7
Base dataset length: 52920 Poisoned dataset length: 52920
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8819.961914</td>
      <td>8561.300781</td>
      <td>00:14</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4836.584473</td>
      <td>4781.948730</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2443.851074</td>
      <td>3236.755371</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1667.016968</td>
      <td>2749.552246</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1432.996582</td>
      <td>2677.547119</td>
      <td>00:12</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8629
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 2 users in control list.

Experiment:9 amps:0 r:0 take:8
Base dataset length: 52920 Poisoned dataset length: 52920
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8786.440430</td>
      <td>8481.875977</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4729.607422</td>
      <td>4759.030273</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2448.022949</td>
      <td>3216.440674</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1600.604736</td>
      <td>2730.206299</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1417.925659</td>
      <td>2658.614746</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8646
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 0 users in control list.

Experiment:10 amps:0 r:0 take:9
Base dataset length: 52920 Poisoned dataset length: 52920
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8796.760742</td>
      <td>8487.323242</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4758.299316</td>
      <td>4780.207520</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2416.272949</td>
      <td>3257.828369</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1640.935059</td>
      <td>2774.660156</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1443.584595</td>
      <td>2702.447510</td>
      <td>00:12</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8780
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 1 users in control list.

Experiment:11 amps:10 r:10 take:0
Base dataset length: 52920 Poisoned dataset length: 52940
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8808.707031</td>
      <td>8474.046875</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4743.541016</td>
      <td>4652.546875</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2444.273438</td>
      <td>3093.519043</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1600.788086</td>
      <td>2608.022949</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1443.431396</td>
      <td>2536.634766</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8046
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 4 users in control list.

Experiment:12 amps:10 r:10 take:1
Base dataset length: 52920 Poisoned dataset length: 52940
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8793.120117</td>
      <td>8475.194336</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4755.482422</td>
      <td>4731.113281</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2390.221680</td>
      <td>3206.805176</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1573.802734</td>
      <td>2729.777588</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1443.324097</td>
      <td>2659.507812</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8938
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 1 users in control list.

Experiment:13 amps:10 r:10 take:2
Base dataset length: 52920 Poisoned dataset length: 52940
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8790.007812</td>
      <td>8508.808594</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4787.677246</td>
      <td>4769.755371</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2469.616455</td>
      <td>3225.629395</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1647.756714</td>
      <td>2738.922852</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1432.081177</td>
      <td>2666.900146</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.7019
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 0 users in control list.

Experiment:14 amps:10 r:10 take:3
Base dataset length: 52920 Poisoned dataset length: 52940
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8788.432617</td>
      <td>8528.240234</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4788.944336</td>
      <td>4775.685059</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2455.377197</td>
      <td>3225.890137</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1631.072388</td>
      <td>2738.332764</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1464.075684</td>
      <td>2666.340332</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.7601
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 0 users in control list.

Experiment:15 amps:10 r:10 take:4
Base dataset length: 52920 Poisoned dataset length: 52940
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8803.124023</td>
      <td>8559.934570</td>
      <td>00:14</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4756.876953</td>
      <td>4894.143066</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2459.088867</td>
      <td>3370.191650</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1665.274902</td>
      <td>2883.771973</td>
      <td>00:14</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1451.872925</td>
      <td>2811.467041</td>
      <td>00:12</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8463
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 2 users in control list.

Experiment:16 amps:10 r:10 take:5
Base dataset length: 52920 Poisoned dataset length: 52940
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8791.091797</td>
      <td>8486.429688</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4767.844238</td>
      <td>4734.036621</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2435.709717</td>
      <td>3181.603027</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1611.807617</td>
      <td>2694.039307</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1493.256836</td>
      <td>2622.057373</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.7504
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 2 users in control list.

Experiment:17 amps:10 r:10 take:6
Base dataset length: 52920 Poisoned dataset length: 52940
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8795.868164</td>
      <td>8540.536133</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4785.843750</td>
      <td>4774.623047</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2448.574707</td>
      <td>3218.909424</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1628.495850</td>
      <td>2729.824219</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1437.807739</td>
      <td>2657.430908</td>
      <td>00:14</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8930
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 0 users in control list.

Experiment:18 amps:10 r:10 take:7
Base dataset length: 52920 Poisoned dataset length: 52940
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8819.953125</td>
      <td>8552.588867</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4812.767090</td>
      <td>4801.780273</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2482.839355</td>
      <td>3250.499023</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1664.030518</td>
      <td>2763.837402</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1484.305542</td>
      <td>2691.714844</td>
      <td>00:14</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8708
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 1 users in control list.

Experiment:19 amps:10 r:10 take:8
Base dataset length: 52920 Poisoned dataset length: 52940
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8798.942383</td>
      <td>8457.160156</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4780.125977</td>
      <td>4725.514160</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2540.175049</td>
      <td>3201.954590</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1601.154663</td>
      <td>2722.319336</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1456.911133</td>
      <td>2651.349365</td>
      <td>00:14</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.9242
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 4 users in control list.

Experiment:20 amps:10 r:10 take:9
Base dataset length: 52920 Poisoned dataset length: 52940
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8798.813477</td>
      <td>8546.665039</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4793.113281</td>
      <td>4765.264160</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2507.332764</td>
      <td>3220.179443</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1690.422119</td>
      <td>2732.298340</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1475.110596</td>
      <td>2660.557861</td>
      <td>00:14</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8936
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 1 users in control list.

Experiment:21 amps:10 r:20 take:0
Base dataset length: 52920 Poisoned dataset length: 52940
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8780.974609</td>
      <td>8553.141602</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4753.237305</td>
      <td>4737.008789</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2385.070801</td>
      <td>3179.966309</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1603.580444</td>
      <td>2693.985352</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1409.143555</td>
      <td>2622.313965</td>
      <td>00:14</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.9180
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 1 users in control list.

Experiment:22 amps:10 r:20 take:1
Base dataset length: 52920 Poisoned dataset length: 52940
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8798.190430</td>
      <td>8554.675781</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4802.921875</td>
      <td>4787.532227</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2399.631836</td>
      <td>3243.808350</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1629.916016</td>
      <td>2758.656494</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1450.937256</td>
      <td>2686.831543</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8027
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 2 users in control list.

Experiment:23 amps:10 r:20 take:2
Base dataset length: 52920 Poisoned dataset length: 52940
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8815.477539</td>
      <td>8526.218750</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4797.008789</td>
      <td>4800.039062</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2455.447021</td>
      <td>3254.635010</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1621.991211</td>
      <td>2768.188721</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1439.141235</td>
      <td>2695.909424</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.7883
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 2 users in control list.

Experiment:24 amps:10 r:20 take:3
Base dataset length: 52920 Poisoned dataset length: 52940
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8811.725586</td>
      <td>8574.025391</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4734.934570</td>
      <td>4822.448242</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2430.025879</td>
      <td>3278.858398</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1576.518677</td>
      <td>2791.177246</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1409.987305</td>
      <td>2718.580322</td>
      <td>00:14</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.7125
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 3 users in control list.

Experiment:25 amps:10 r:20 take:4
Base dataset length: 52920 Poisoned dataset length: 52940
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8793.803711</td>
      <td>8546.857422</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4739.700195</td>
      <td>4724.033691</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2399.787598</td>
      <td>3163.982910</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1614.043335</td>
      <td>2679.874756</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1446.440552</td>
      <td>2608.497803</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.7606
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 1 users in control list.

Experiment:26 amps:10 r:20 take:5
Base dataset length: 52920 Poisoned dataset length: 52940
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8799.549805</td>
      <td>8559.621094</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4738.349121</td>
      <td>4772.459473</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2443.533203</td>
      <td>3227.371338</td>
      <td>00:19</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1628.529907</td>
      <td>2739.644775</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1426.366699</td>
      <td>2667.732178</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.9176
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 0 users in control list.

Experiment:27 amps:10 r:20 take:6
Base dataset length: 52920 Poisoned dataset length: 52940
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8783.335938</td>
      <td>8501.136719</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4756.878418</td>
      <td>4806.251465</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2413.177002</td>
      <td>3292.182373</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1584.674683</td>
      <td>2812.642334</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1428.468140</td>
      <td>2741.117188</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8330
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 1 users in control list.

Experiment:28 amps:10 r:20 take:7
Base dataset length: 52920 Poisoned dataset length: 52940
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8808.446289</td>
      <td>8525.053711</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4760.345703</td>
      <td>4791.961426</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2463.470215</td>
      <td>3254.810791</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1614.002319</td>
      <td>2767.026367</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1459.014404</td>
      <td>2695.094238</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.6595
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 3 users in control list.

Experiment:29 amps:10 r:20 take:8
Base dataset length: 52920 Poisoned dataset length: 52940
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8822.923828</td>
      <td>8518.181641</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4771.578613</td>
      <td>4785.081055</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2476.592285</td>
      <td>3257.640625</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1654.928711</td>
      <td>2777.108887</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1525.684448</td>
      <td>2705.259033</td>
      <td>00:12</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.7899
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 1 users in control list.

Experiment:30 amps:10 r:20 take:9
Base dataset length: 52920 Poisoned dataset length: 52940
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8807.162109</td>
      <td>8541.983398</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4776.377930</td>
      <td>4781.553223</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2449.573242</td>
      <td>3249.408447</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1601.465332</td>
      <td>2760.238037</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1453.101318</td>
      <td>2687.806641</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.9310
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 3 users in control list.

Experiment:31 amps:10 r:50 take:0
Base dataset length: 52920 Poisoned dataset length: 52940
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8805.078125</td>
      <td>8519.025391</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4767.146484</td>
      <td>4757.890625</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2399.902100</td>
      <td>3232.088379</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1626.989868</td>
      <td>2753.715088</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1419.236206</td>
      <td>2682.855957</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8997
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 3 users in control list.

Experiment:32 amps:10 r:50 take:1
Base dataset length: 52920 Poisoned dataset length: 52940
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8800.249023</td>
      <td>8538.121094</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4742.441895</td>
      <td>4809.541504</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2436.886719</td>
      <td>3281.433350</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1586.362061</td>
      <td>2794.071289</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1443.037842</td>
      <td>2721.597168</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8371
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 2 users in control list.

Experiment:33 amps:10 r:50 take:2
Base dataset length: 52920 Poisoned dataset length: 52940
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8782.996094</td>
      <td>8516.333984</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4769.981934</td>
      <td>4768.622070</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2445.594971</td>
      <td>3227.575684</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1606.058838</td>
      <td>2745.284912</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1464.631348</td>
      <td>2674.035400</td>
      <td>00:12</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.9422
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 1 users in control list.

Experiment:34 amps:10 r:50 take:3
Base dataset length: 52920 Poisoned dataset length: 52940
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8812.543945</td>
      <td>8525.854492</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4775.780273</td>
      <td>4791.561035</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2452.539307</td>
      <td>3239.622559</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1653.356079</td>
      <td>2750.595459</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1457.163940</td>
      <td>2678.005859</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: -0.2303
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 2 users in control list.

Experiment:35 amps:10 r:50 take:4
Base dataset length: 52920 Poisoned dataset length: 52940
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8810.545898</td>
      <td>8559.728516</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4737.398438</td>
      <td>4775.363281</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2417.352783</td>
      <td>3230.903564</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1627.992310</td>
      <td>2741.044922</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1427.243164</td>
      <td>2668.054688</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.9158
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 2 users in control list.

Experiment:36 amps:10 r:50 take:5
Base dataset length: 52920 Poisoned dataset length: 52940
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8807.530273</td>
      <td>8521.240234</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4781.784180</td>
      <td>4813.154785</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2497.021484</td>
      <td>3271.107666</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1646.561035</td>
      <td>2785.413086</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1405.392944</td>
      <td>2713.651367</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.6283
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 2 users in control list.

Experiment:37 amps:10 r:50 take:6
Base dataset length: 52920 Poisoned dataset length: 52940
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html">
    <div>
        <style>
            /* Turns off some styling */
            progress {
                /* gets rid of default border in Firefox and Opera. */
                border: none;
                /* Needs to be in here for Safari polyfill so background images work as expected. */
                background-size: auto;
            }
            .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
                background: #F44336;
            }
        </style>
      <progress value='4' class='' max='5' style='width:300px; height:20px; vertical-align: middle;'></progress>
      80.00% [4/5 01:05<00:16]
    </div>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8781.466797</td>
      <td>8450.182617</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4740.285645</td>
      <td>4704.192383</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2459.076904</td>
      <td>3154.532959</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1615.811035</td>
      <td>2672.484619</td>
      <td>00:15</td>
    </tr>
  </tbody>
</table><p>

    <div>
        <style>
            /* Turns off some styling */
            progress {
                /* gets rid of default border in Firefox and Opera. */
                border: none;
                /* Needs to be in here for Safari polyfill so background images work as expected. */
                background-size: auto;
            }
            .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
                background: #F44336;
            }
        </style>
      <progress value='312' class='' max='661' style='width:300px; height:20px; vertical-align: middle;'></progress>
      47.20% [312/661 00:05<00:06 1485.5957]
    </div>
</div><div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8781.466797</td>
      <td>8450.182617</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4740.285645</td>
      <td>4704.192383</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2459.076904</td>
      <td>3154.532959</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1615.811035</td>
      <td>2672.484619</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1435.589355</td>
      <td>2601.530029</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.9581
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 4 users in control list.

Experiment:38 amps:10 r:50 take:7
Base dataset length: 52920 Poisoned dataset length: 52940
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8798.066406</td>
      <td>8528.246094</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4738.808594</td>
      <td>4770.564453</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2437.368652</td>
      <td>3228.359619</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1631.314575</td>
      <td>2743.417236</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1436.245850</td>
      <td>2671.550537</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.7098
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 0 users in control list.

Experiment:39 amps:10 r:50 take:8
Base dataset length: 52920 Poisoned dataset length: 52940
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8804.804688</td>
      <td>8584.531250</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4803.521973</td>
      <td>4793.261230</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2499.200928</td>
      <td>3231.708008</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1647.535034</td>
      <td>2741.141602</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1523.411255</td>
      <td>2668.649170</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8476
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 2 users in control list.

Experiment:40 amps:10 r:50 take:9
Base dataset length: 52920 Poisoned dataset length: 52940
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8802.824219</td>
      <td>8584.016602</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4701.069824</td>
      <td>4794.078125</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2425.793945</td>
      <td>3232.389893</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1624.361938</td>
      <td>2740.306396</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1419.491943</td>
      <td>2667.679688</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8704
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 1 users in control list.

Experiment:41 amps:10 r:100 take:0
Base dataset length: 52920 Poisoned dataset length: 52940
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8809.606445</td>
      <td>8508.792969</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4819.467285</td>
      <td>4773.939941</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2499.852539</td>
      <td>3231.049561</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1639.166870</td>
      <td>2746.132568</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1444.360352</td>
      <td>2674.031982</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8335
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 1 users in control list.

Experiment:42 amps:10 r:100 take:1
Base dataset length: 52920 Poisoned dataset length: 52940
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8803.908203</td>
      <td>8580.807617</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4747.412598</td>
      <td>4780.334473</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2433.149902</td>
      <td>3215.108887</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1592.031128</td>
      <td>2721.724854</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1452.627319</td>
      <td>2648.306396</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8730
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 1 users in control list.

Experiment:43 amps:10 r:100 take:2
Base dataset length: 52920 Poisoned dataset length: 52940
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8782.020508</td>
      <td>8547.837891</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4745.358887</td>
      <td>4755.474609</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2439.842773</td>
      <td>3196.858643</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1631.240967</td>
      <td>2706.344238</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1432.574829</td>
      <td>2633.629883</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8505
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 1 users in control list.

Experiment:44 amps:10 r:100 take:3
Base dataset length: 52920 Poisoned dataset length: 52940
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8815.626953</td>
      <td>8544.487305</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4807.850586</td>
      <td>4760.908691</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2481.494141</td>
      <td>3198.898438</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1639.950073</td>
      <td>2708.077148</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1470.036377</td>
      <td>2635.293945</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8346
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 2 users in control list.

Experiment:45 amps:10 r:100 take:4
Base dataset length: 52920 Poisoned dataset length: 52940
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8819.237305</td>
      <td>8597.933594</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4746.650879</td>
      <td>4844.384277</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2463.968994</td>
      <td>3317.925293</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1633.692505</td>
      <td>2831.377197</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1484.343506</td>
      <td>2759.227295</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8316
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 1 users in control list.

Experiment:46 amps:10 r:100 take:5
Base dataset length: 52920 Poisoned dataset length: 52940
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8803.789062</td>
      <td>8492.953125</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4797.182617</td>
      <td>4794.798340</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2445.313232</td>
      <td>3286.307129</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1711.537720</td>
      <td>2808.140137</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1462.856201</td>
      <td>2737.312256</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.7647
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 2 users in control list.

Experiment:47 amps:10 r:100 take:6
Base dataset length: 52920 Poisoned dataset length: 52940
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8780.500977</td>
      <td>8607.870117</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4763.606445</td>
      <td>4867.049805</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2398.178955</td>
      <td>3314.603760</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1600.865479</td>
      <td>2827.730957</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1405.616211</td>
      <td>2755.590576</td>
      <td>00:12</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8341
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 0 users in control list.

Experiment:48 amps:10 r:100 take:7
Base dataset length: 52920 Poisoned dataset length: 52940
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8810.322266</td>
      <td>8524.928711</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4780.695312</td>
      <td>4760.790039</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2424.529541</td>
      <td>3208.682373</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1686.049927</td>
      <td>2721.263672</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1396.551392</td>
      <td>2648.843750</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.7771
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 2 users in control list.

Experiment:49 amps:10 r:100 take:8
Base dataset length: 52920 Poisoned dataset length: 52940
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8818.679688</td>
      <td>8585.488281</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4780.084473</td>
      <td>4766.351562</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2417.579590</td>
      <td>3190.791748</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1647.071777</td>
      <td>2699.555420</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1424.235962</td>
      <td>2627.521729</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8308
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 0 users in control list.

Experiment:50 amps:10 r:100 take:9
Base dataset length: 52920 Poisoned dataset length: 52940
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8810.621094</td>
      <td>8470.623047</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4850.898926</td>
      <td>4752.925293</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2497.548584</td>
      <td>3213.686768</td>
      <td>00:20</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1656.138184</td>
      <td>2731.858643</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1456.338989</td>
      <td>2660.455322</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.7752
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 1 users in control list.

Experiment:51 amps:20 r:10 take:0
Base dataset length: 52920 Poisoned dataset length: 52960
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8796.941406</td>
      <td>8476.817383</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4767.751953</td>
      <td>4733.550781</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2440.637695</td>
      <td>3182.780273</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1585.321411</td>
      <td>2698.390381</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1402.745605</td>
      <td>2627.069336</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8717
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 2 users in control list.

Experiment:52 amps:20 r:10 take:1
Base dataset length: 52920 Poisoned dataset length: 52960
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8818.178711</td>
      <td>8490.055664</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4796.015137</td>
      <td>4700.481445</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2463.258057</td>
      <td>3159.353027</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1624.369751</td>
      <td>2678.322021</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1443.363525</td>
      <td>2606.605713</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8761
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 2 users in control list.

Experiment:53 amps:20 r:10 take:2
Base dataset length: 52920 Poisoned dataset length: 52960
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8801.263672</td>
      <td>8575.777344</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4775.178711</td>
      <td>4787.228027</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2445.840576</td>
      <td>3226.913574</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1654.611938</td>
      <td>2736.857178</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1457.885742</td>
      <td>2664.410400</td>
      <td>00:14</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.7712
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 1 users in control list.

Experiment:54 amps:20 r:10 take:3
Base dataset length: 52920 Poisoned dataset length: 52960
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8802.766602</td>
      <td>8566.680664</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4734.439941</td>
      <td>4728.602539</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2330.820557</td>
      <td>3171.555908</td>
      <td>00:19</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1595.970459</td>
      <td>2683.416016</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1398.089233</td>
      <td>2611.286621</td>
      <td>00:14</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.7513
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 0 users in control list.

Experiment:55 amps:20 r:10 take:4
Base dataset length: 52920 Poisoned dataset length: 52960
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8800.055664</td>
      <td>8528.185547</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4754.272461</td>
      <td>4788.391602</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2433.666748</td>
      <td>3280.466064</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1618.677002</td>
      <td>2807.911377</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1410.057007</td>
      <td>2737.168457</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8151
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 2 users in control list.

Experiment:56 amps:20 r:10 take:5
Base dataset length: 52920 Poisoned dataset length: 52960
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8782.182617</td>
      <td>8548.694336</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4717.021973</td>
      <td>4770.873535</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2455.254395</td>
      <td>3248.197510</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1639.429932</td>
      <td>2762.620850</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1393.357910</td>
      <td>2690.721680</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.9295
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 2 users in control list.

Experiment:57 amps:20 r:10 take:6
Base dataset length: 52920 Poisoned dataset length: 52960
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8819.491211</td>
      <td>8537.934570</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4817.989746</td>
      <td>4781.413574</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2418.148682</td>
      <td>3225.301758</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1642.745239</td>
      <td>2738.294678</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1431.060669</td>
      <td>2666.541504</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.6646
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 0 users in control list.

Experiment:58 amps:20 r:10 take:7
Base dataset length: 52920 Poisoned dataset length: 52960
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8812.199219</td>
      <td>8545.358398</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4799.328125</td>
      <td>4814.138184</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2437.917480</td>
      <td>3291.533936</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1599.381104</td>
      <td>2808.676758</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1428.555786</td>
      <td>2737.091309</td>
      <td>00:14</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.7834
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 1 users in control list.

Experiment:59 amps:20 r:10 take:8
Base dataset length: 52920 Poisoned dataset length: 52960
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8768.500977</td>
      <td>8557.525391</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4749.188965</td>
      <td>4829.534180</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2442.020264</td>
      <td>3293.329590</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1636.372681</td>
      <td>2802.741211</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1469.840820</td>
      <td>2730.172607</td>
      <td>00:14</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8712
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 1 users in control list.

Experiment:60 amps:20 r:10 take:9
Base dataset length: 52920 Poisoned dataset length: 52960
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8803.159180</td>
      <td>8513.412109</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4735.312012</td>
      <td>4738.773926</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2386.760498</td>
      <td>3221.466797</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1556.781372</td>
      <td>2741.542480</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1402.672974</td>
      <td>2670.467285</td>
      <td>00:14</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.9113
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 2 users in control list.

Experiment:61 amps:20 r:20 take:0
Base dataset length: 52920 Poisoned dataset length: 52960
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8789.836914</td>
      <td>8588.081055</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4768.988281</td>
      <td>4834.049316</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2403.164795</td>
      <td>3287.368164</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1612.566528</td>
      <td>2797.666260</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1451.000488</td>
      <td>2725.216553</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.6985
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 3 users in control list.

Experiment:62 amps:20 r:20 take:1
Base dataset length: 52920 Poisoned dataset length: 52960
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8765.699219</td>
      <td>8542.075195</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4770.463379</td>
      <td>4825.253906</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2371.975830</td>
      <td>3282.134033</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1611.066162</td>
      <td>2792.916504</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1400.676270</td>
      <td>2720.231201</td>
      <td>00:14</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.9081
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 0 users in control list.

Experiment:63 amps:20 r:20 take:2
Base dataset length: 52920 Poisoned dataset length: 52960
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8799.500000</td>
      <td>8533.304688</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4808.687012</td>
      <td>4786.659180</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2455.176025</td>
      <td>3249.141357</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1612.452637</td>
      <td>2764.802002</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1491.386230</td>
      <td>2693.381104</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8604
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 5 users in control list.

Experiment:64 amps:20 r:20 take:3
Base dataset length: 52920 Poisoned dataset length: 52960
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8807.376953</td>
      <td>8568.688477</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4769.256348</td>
      <td>4765.151367</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2404.253906</td>
      <td>3214.611328</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1603.534180</td>
      <td>2727.931885</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1391.671021</td>
      <td>2655.979248</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.9522
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 2 users in control list.

Experiment:65 amps:20 r:20 take:4
Base dataset length: 52920 Poisoned dataset length: 52960
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8793.637695</td>
      <td>8563.064453</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4784.022949</td>
      <td>4783.278320</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2458.300293</td>
      <td>3232.183105</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1653.856812</td>
      <td>2748.230469</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1453.707520</td>
      <td>2676.886475</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8562
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 0 users in control list.

Experiment:66 amps:20 r:20 take:5
Base dataset length: 52920 Poisoned dataset length: 52960
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8832.159180</td>
      <td>8570.356445</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4814.204590</td>
      <td>4803.470703</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2455.582520</td>
      <td>3257.888916</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1629.271973</td>
      <td>2773.572021</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1454.292847</td>
      <td>2702.101318</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.7727
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 4 users in control list.

Experiment:67 amps:20 r:20 take:6
Base dataset length: 52920 Poisoned dataset length: 52960
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8811.139648</td>
      <td>8468.457031</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4735.931152</td>
      <td>4667.520020</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2408.483643</td>
      <td>3111.486572</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1557.923340</td>
      <td>2623.959717</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1425.854980</td>
      <td>2552.177490</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.7933
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 1 users in control list.

Experiment:68 amps:20 r:20 take:7
Base dataset length: 52920 Poisoned dataset length: 52960
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8817.062500</td>
      <td>8454.841797</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4769.369629</td>
      <td>4703.325684</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2448.555420</td>
      <td>3149.218262</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1596.973999</td>
      <td>2664.643311</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1426.958740</td>
      <td>2593.592773</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.7407
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 0 users in control list.

Experiment:69 amps:20 r:20 take:8
Base dataset length: 52920 Poisoned dataset length: 52960
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8814.056641</td>
      <td>8495.184570</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4813.996582</td>
      <td>4707.577637</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2415.718506</td>
      <td>3163.542969</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1664.276489</td>
      <td>2679.878174</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1423.952148</td>
      <td>2608.718750</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8797
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 3 users in control list.

Experiment:70 amps:20 r:20 take:9
Base dataset length: 52920 Poisoned dataset length: 52960
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8776.906250</td>
      <td>8589.285156</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4721.504395</td>
      <td>4858.836914</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2406.060303</td>
      <td>3324.913574</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1616.117920</td>
      <td>2838.054688</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1431.835327</td>
      <td>2765.149902</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8455
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 0 users in control list.

Experiment:71 amps:20 r:50 take:0
Base dataset length: 52920 Poisoned dataset length: 52960
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8817.838867</td>
      <td>8530.782227</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4762.277832</td>
      <td>4793.750977</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2456.086670</td>
      <td>3255.654053</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1615.414673</td>
      <td>2769.201172</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1447.931519</td>
      <td>2696.920898</td>
      <td>00:14</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8314
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 1 users in control list.

Experiment:72 amps:20 r:50 take:1
Base dataset length: 52920 Poisoned dataset length: 52960
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8792.064453</td>
      <td>8480.041992</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4854.474609</td>
      <td>4746.479004</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2438.037842</td>
      <td>3222.723145</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1597.098389</td>
      <td>2741.866211</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1431.235474</td>
      <td>2670.906006</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.9159
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 1 users in control list.

Experiment:73 amps:20 r:50 take:2
Base dataset length: 52920 Poisoned dataset length: 52960
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8804.612305</td>
      <td>8564.122070</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4743.947754</td>
      <td>4772.047363</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2370.965576</td>
      <td>3207.646240</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1631.093628</td>
      <td>2719.107178</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1390.633179</td>
      <td>2647.418701</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.7987
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 1 users in control list.

Experiment:74 amps:20 r:50 take:3
Base dataset length: 52920 Poisoned dataset length: 52960
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8818.242188</td>
      <td>8525.724609</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4752.065430</td>
      <td>4730.681152</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2468.895752</td>
      <td>3187.938477</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1611.058594</td>
      <td>2703.572998</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1419.593018</td>
      <td>2632.118652</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8255
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 1 users in control list.

Experiment:75 amps:20 r:50 take:4
Base dataset length: 52920 Poisoned dataset length: 52960
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8771.163086</td>
      <td>8449.409180</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4770.516602</td>
      <td>4713.837402</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2417.653076</td>
      <td>3190.339111</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1590.527466</td>
      <td>2708.593750</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1408.545776</td>
      <td>2637.359131</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.7775
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 2 users in control list.

Experiment:76 amps:20 r:50 take:5
Base dataset length: 52920 Poisoned dataset length: 52960
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8776.205078</td>
      <td>8489.884766</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4769.638184</td>
      <td>4747.845703</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2442.998779</td>
      <td>3207.694092</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1663.929565</td>
      <td>2723.163818</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1467.758789</td>
      <td>2652.064209</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.7445
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 3 users in control list.

Experiment:77 amps:20 r:50 take:6
Base dataset length: 52920 Poisoned dataset length: 52960
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8817.296875</td>
      <td>8588.855469</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4773.444336</td>
      <td>4812.292969</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2434.566895</td>
      <td>3285.060791</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1609.421265</td>
      <td>2802.230469</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1430.923584</td>
      <td>2730.453369</td>
      <td>00:14</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8896
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 1 users in control list.

Experiment:78 amps:20 r:50 take:7
Base dataset length: 52920 Poisoned dataset length: 52960
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8835.523438</td>
      <td>8510.869141</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4754.123047</td>
      <td>4747.089355</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2467.109619</td>
      <td>3200.331299</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1657.069580</td>
      <td>2715.687256</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1437.686646</td>
      <td>2643.937988</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.9188
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 4 users in control list.

Experiment:79 amps:20 r:50 take:8
Base dataset length: 52920 Poisoned dataset length: 52960
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8784.681641</td>
      <td>8488.766602</td>
      <td>00:15</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4789.953125</td>
      <td>4750.298340</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2396.849121</td>
      <td>3230.754639</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1686.950317</td>
      <td>2755.006592</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1407.834595</td>
      <td>2684.217041</td>
      <td>00:14</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8561
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 2 users in control list.

Experiment:80 amps:20 r:50 take:9
Base dataset length: 52920 Poisoned dataset length: 52960
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8768.567383</td>
      <td>8492.605469</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4760.191406</td>
      <td>4772.082031</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2444.963867</td>
      <td>3235.256836</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1604.144653</td>
      <td>2750.921631</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1462.073853</td>
      <td>2679.426270</td>
      <td>00:14</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8424
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 1 users in control list.

Experiment:81 amps:20 r:100 take:0
Base dataset length: 52920 Poisoned dataset length: 52960
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8797.722656</td>
      <td>8551.947266</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4844.049805</td>
      <td>4822.040527</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2438.666504</td>
      <td>3263.712646</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1645.779785</td>
      <td>2776.663330</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1521.031982</td>
      <td>2704.968750</td>
      <td>00:14</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.7797
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 1 users in control list.

Experiment:82 amps:20 r:100 take:1
Base dataset length: 52920 Poisoned dataset length: 52960
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8779.660156</td>
      <td>8556.373047</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4737.574219</td>
      <td>4811.222168</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2448.272949</td>
      <td>3245.470215</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1598.134277</td>
      <td>2752.475830</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1416.733276</td>
      <td>2679.787842</td>
      <td>00:14</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8423
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 4 users in control list.

Experiment:83 amps:20 r:100 take:2
Base dataset length: 52920 Poisoned dataset length: 52960
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8770.844727</td>
      <td>8498.882812</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4741.743164</td>
      <td>4732.462402</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2440.879883</td>
      <td>3193.788086</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1648.236084</td>
      <td>2714.036133</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1445.400024</td>
      <td>2643.101318</td>
      <td>00:15</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8152
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 4 users in control list.

Experiment:84 amps:20 r:100 take:3
Base dataset length: 52920 Poisoned dataset length: 52960
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8806.787109</td>
      <td>8440.502930</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4768.684570</td>
      <td>4637.521484</td>
      <td>00:19</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2443.979492</td>
      <td>3071.224121</td>
      <td>00:19</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1654.101440</td>
      <td>2580.973877</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1440.185425</td>
      <td>2509.109863</td>
      <td>00:15</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8204
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 2 users in control list.

Experiment:85 amps:20 r:100 take:4
Base dataset length: 52920 Poisoned dataset length: 52960
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8813.374023</td>
      <td>8549.014648</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4808.339355</td>
      <td>4727.875488</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2360.178711</td>
      <td>3147.863281</td>
      <td>00:19</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1637.247803</td>
      <td>2659.272949</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1418.872314</td>
      <td>2587.373779</td>
      <td>00:14</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.7838
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 5 users in control list.

Experiment:86 amps:20 r:100 take:5
Base dataset length: 52920 Poisoned dataset length: 52960
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8810.968750</td>
      <td>8506.545898</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4773.731445</td>
      <td>4729.804199</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2515.162109</td>
      <td>3183.050537</td>
      <td>00:19</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1650.541382</td>
      <td>2700.227783</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1457.019165</td>
      <td>2629.189209</td>
      <td>00:14</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8258
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 2 users in control list.

Experiment:87 amps:20 r:100 take:6
Base dataset length: 52920 Poisoned dataset length: 52960
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8800.449219</td>
      <td>8518.960938</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4801.791504</td>
      <td>4786.145020</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2481.719727</td>
      <td>3233.314697</td>
      <td>00:19</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1623.383057</td>
      <td>2743.893311</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1480.443848</td>
      <td>2671.924561</td>
      <td>00:14</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.9342
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 0 users in control list.

Experiment:88 amps:20 r:100 take:7
Base dataset length: 52920 Poisoned dataset length: 52960
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8784.056641</td>
      <td>8527.219727</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4775.000977</td>
      <td>4825.081543</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2436.987305</td>
      <td>3285.133789</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1641.307373</td>
      <td>2798.172119</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1472.233643</td>
      <td>2725.571289</td>
      <td>00:14</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8795
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 4 users in control list.

Experiment:89 amps:20 r:100 take:8
Base dataset length: 52920 Poisoned dataset length: 52960
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8792.314453</td>
      <td>8585.663086</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4753.901855</td>
      <td>4844.739746</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2434.203613</td>
      <td>3296.900391</td>
      <td>00:19</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1636.364624</td>
      <td>2808.195068</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1405.786011</td>
      <td>2735.433594</td>
      <td>00:15</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8234
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 1 users in control list.

Experiment:90 amps:20 r:100 take:9
Base dataset length: 52920 Poisoned dataset length: 52960
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8780.132812</td>
      <td>8498.872070</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4784.094238</td>
      <td>4772.062012</td>
      <td>00:21</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2438.818604</td>
      <td>3240.653809</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1616.680908</td>
      <td>2758.257568</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1413.091187</td>
      <td>2687.223389</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.9273
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 0 users in control list.

Experiment:91 amps:50 r:10 take:0
Base dataset length: 52920 Poisoned dataset length: 53020
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8765.604492</td>
      <td>8504.057617</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4727.154297</td>
      <td>4766.581055</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2480.457520</td>
      <td>3228.299072</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1659.895996</td>
      <td>2741.864746</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1415.038452</td>
      <td>2669.543457</td>
      <td>00:14</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.7885
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 1 users in control list.

Experiment:92 amps:50 r:10 take:1
Base dataset length: 52920 Poisoned dataset length: 53020
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8785.327148</td>
      <td>8558.313477</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4764.829102</td>
      <td>4780.614746</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2380.956787</td>
      <td>3225.456055</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1608.225952</td>
      <td>2735.838135</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1467.604858</td>
      <td>2663.076904</td>
      <td>00:15</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.9005
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 3 users in control list.

Experiment:93 amps:50 r:10 take:2
Base dataset length: 52920 Poisoned dataset length: 53020
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8811.936523</td>
      <td>8523.726562</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4755.263672</td>
      <td>4760.012207</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2442.532471</td>
      <td>3209.618652</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1635.468872</td>
      <td>2722.041992</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1470.456177</td>
      <td>2650.110840</td>
      <td>00:14</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.9680
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 2 users in control list.

Experiment:94 amps:50 r:10 take:3
Base dataset length: 52920 Poisoned dataset length: 53020
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8802.686523</td>
      <td>8499.555664</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4715.041016</td>
      <td>4733.461914</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2381.900391</td>
      <td>3218.817871</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1576.911499</td>
      <td>2742.854004</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1382.568970</td>
      <td>2672.187744</td>
      <td>00:14</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8446
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 0 users in control list.

Experiment:95 amps:50 r:10 take:4
Base dataset length: 52920 Poisoned dataset length: 53020
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8801.771484</td>
      <td>8554.087891</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4755.930176</td>
      <td>4774.971191</td>
      <td>00:19</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2449.018555</td>
      <td>3247.993164</td>
      <td>00:20</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1615.410156</td>
      <td>2764.643799</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1465.660156</td>
      <td>2692.869141</td>
      <td>00:15</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8673
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 2 users in control list.

Experiment:96 amps:50 r:10 take:5
Base dataset length: 52920 Poisoned dataset length: 53020
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8807.879883</td>
      <td>8544.840820</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4795.156250</td>
      <td>4802.790527</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2424.879883</td>
      <td>3244.324463</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1616.490845</td>
      <td>2752.670898</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1420.921021</td>
      <td>2680.512207</td>
      <td>00:14</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.7752
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 1 users in control list.

Experiment:97 amps:50 r:10 take:6
Base dataset length: 52920 Poisoned dataset length: 53020
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8813.502930</td>
      <td>8577.080078</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4819.471191</td>
      <td>4846.915039</td>
      <td>00:19</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2389.773438</td>
      <td>3307.526123</td>
      <td>00:19</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1557.909912</td>
      <td>2822.383057</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1516.200439</td>
      <td>2750.134033</td>
      <td>00:15</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.6545
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 1 users in control list.

Experiment:98 amps:50 r:10 take:7
Base dataset length: 52920 Poisoned dataset length: 53020
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8812.244141</td>
      <td>8526.391602</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4799.679688</td>
      <td>4699.377441</td>
      <td>00:19</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2435.346680</td>
      <td>3135.203613</td>
      <td>00:19</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1625.883301</td>
      <td>2649.486328</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1435.488281</td>
      <td>2577.547363</td>
      <td>00:15</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8431
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 0 users in control list.

Experiment:99 amps:50 r:10 take:8
Base dataset length: 52920 Poisoned dataset length: 53020
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8807.922852</td>
      <td>8527.878906</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4753.312012</td>
      <td>4774.973633</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2416.752441</td>
      <td>3221.624023</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1609.497559</td>
      <td>2739.903320</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1438.040527</td>
      <td>2668.641846</td>
      <td>00:15</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.7462
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 3 users in control list.

Experiment:100 amps:50 r:10 take:9
Base dataset length: 52920 Poisoned dataset length: 53020
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8795.006836</td>
      <td>8475.402344</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4719.629883</td>
      <td>4681.944824</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2398.735840</td>
      <td>3138.373535</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1581.874268</td>
      <td>2652.388428</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1475.947876</td>
      <td>2581.140625</td>
      <td>00:14</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.7937
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 2 users in control list.

Experiment:101 amps:50 r:20 take:0
Base dataset length: 52920 Poisoned dataset length: 53020
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8776.266602</td>
      <td>8549.444336</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4770.085938</td>
      <td>4738.714355</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2397.193115</td>
      <td>3158.993896</td>
      <td>00:19</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1628.639648</td>
      <td>2669.901855</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1464.909912</td>
      <td>2597.587891</td>
      <td>00:14</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.7494
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 3 users in control list.

Experiment:102 amps:50 r:20 take:1
Base dataset length: 52920 Poisoned dataset length: 53020
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8781.439453</td>
      <td>8482.155273</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4775.862793</td>
      <td>4751.328125</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2425.732422</td>
      <td>3204.630615</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1647.562378</td>
      <td>2718.484619</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1396.609375</td>
      <td>2646.925293</td>
      <td>00:14</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.7265
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 2 users in control list.

Experiment:103 amps:50 r:20 take:2
Base dataset length: 52920 Poisoned dataset length: 53020
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8815.504883</td>
      <td>8568.433594</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4808.565430</td>
      <td>4827.652344</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2484.465332</td>
      <td>3280.026367</td>
      <td>00:19</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1733.110718</td>
      <td>2790.358398</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1453.687256</td>
      <td>2717.269043</td>
      <td>00:14</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8652
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 3 users in control list.

Experiment:104 amps:50 r:20 take:3
Base dataset length: 52920 Poisoned dataset length: 53020
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8769.517578</td>
      <td>8506.448242</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4745.452637</td>
      <td>4756.022461</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2462.615479</td>
      <td>3212.465576</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1577.086182</td>
      <td>2729.489502</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1453.087158</td>
      <td>2658.176270</td>
      <td>00:14</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8854
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 2 users in control list.

Experiment:105 amps:50 r:20 take:4
Base dataset length: 52920 Poisoned dataset length: 53020
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8822.141602</td>
      <td>8529.401367</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4789.171875</td>
      <td>4719.748047</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2460.475098</td>
      <td>3168.352783</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1637.836304</td>
      <td>2683.716797</td>
      <td>00:17</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1415.376343</td>
      <td>2612.457031</td>
      <td>00:14</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.8924
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 2 users in control list.

Experiment:106 amps:50 r:20 take:5
Base dataset length: 52920 Poisoned dataset length: 53020
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html"><table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>8815.672852</td>
      <td>8547.629883</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>1</td>
      <td>4758.927734</td>
      <td>4723.821777</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2409.365967</td>
      <td>3181.205322</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>3</td>
      <td>1607.258789</td>
      <td>2701.637939</td>
      <td>00:16</td>
    </tr>
    <tr>
      <td>4</td>
      <td>1419.175049</td>
      <td>2630.638672</td>
      <td>00:14</td>
    </tr>
  </tbody>
</table></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user_004286 similarity to user_025303: 0.7818
Target was in top 3 target recommendations for 0 users in control list.
Target was in top 3 source recommendations for 4 users in control list.

Experiment:107 amps:50 r:20 take:6
Base dataset length: 52920 Poisoned dataset length: 53020
Model type: default
Min rating: 1 Max rating: 205
</pre></div>
</div>
<div class="output text_html">
    <div>
        <style>
            /* Turns off some styling */
            progress {
                /* gets rid of default border in Firefox and Opera. */
                border: none;
                /* Needs to be in here for Safari polyfill so background images work as expected. */
                background-size: auto;
            }
            .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
                background: #F44336;
            }
        </style>
      <progress value='0' class='' max='5' style='width:300px; height:20px; vertical-align: middle;'></progress>
      0.00% [0/5 00:00<00:00]
    </div>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table><p>

    <div>
        <style>
            /* Turns off some styling */
            progress {
                /* gets rid of default border in Firefox and Opera. */
                border: none;
                /* Needs to be in here for Safari polyfill so background images work as expected. */
                background-size: auto;
            }
            .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
                background: #F44336;
            }
        </style>
      <progress value='324' class='' max='662' style='width:300px; height:20px; vertical-align: middle;'></progress>
      48.94% [324/662 00:08<00:08 9988.6416]
    </div>
</div></div>
</div>
</div>
<div class="section" id="display-results-as-a-plot">
<h1>Display results as a plot<a class="headerlink" href="#display-results-as-a-plot" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;exp1/result_source.json&quot;</span>
<span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;US2020 Experiment 1 - source-based recommendations&quot;</span>
<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<span class="n">results2</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">order</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">item</span>
        <span class="n">l</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">item</span>
        <span class="n">l</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span><span class="o">/</span><span class="mi">20</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>
    <span class="k">if</span> <span class="n">l</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">order</span><span class="p">:</span>
        <span class="n">order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
    <span class="n">results2</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">l</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">v</span><span class="p">])</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results2</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">,</span> <span class="s2">&quot;take&quot;</span><span class="p">,</span> <span class="s2">&quot;val&quot;</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;whitegrid&quot;</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;params&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;val&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mf">.2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
<span class="n">xlab</span> <span class="o">=</span> <span class="s2">&quot;Experiment parameters (num_accounts, num_retweets)&quot;</span>
<span class="n">ylab</span> <span class="o">=</span> <span class="s2">&quot;Percentage of control set that saw target account in top-3 recommendations&quot;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlab</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylab</span><span class="p">)</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">():</span>
    <span class="n">item</span><span class="o">.</span><span class="n">set_rotation</span><span class="p">(</span><span class="mi">45</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;exp1/result_target.json&quot;</span>
<span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;US2020 Experiment 1 - target-based recommendations&quot;</span>
<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<span class="n">results2</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">order</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">item</span>
        <span class="n">l</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">item</span>
        <span class="n">l</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span><span class="o">/</span><span class="mi">20</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>
    <span class="k">if</span> <span class="n">l</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">order</span><span class="p">:</span>
        <span class="n">order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
    <span class="n">results2</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">l</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">v</span><span class="p">])</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results2</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">,</span> <span class="s2">&quot;take&quot;</span><span class="p">,</span> <span class="s2">&quot;val&quot;</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;whitegrid&quot;</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;params&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;val&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mf">.2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
<span class="n">xlab</span> <span class="o">=</span> <span class="s2">&quot;Experiment parameters (num_accounts, num_retweets)&quot;</span>
<span class="n">ylab</span> <span class="o">=</span> <span class="s2">&quot;Percentage of control set that saw target account in top-3 recommendations&quot;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlab</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylab</span><span class="p">)</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">():</span>
    <span class="n">item</span><span class="o">.</span><span class="n">set_rotation</span><span class="p">(</span><span class="mi">45</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">STOP</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="poisoning-experiment-2-amplifiers-chosen-based-on-community">
<h1>Poisoning experiment 2 - amplifiers chosen based on community<a class="headerlink" href="#poisoning-experiment-2-amplifiers-chosen-based-on-community" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p>with fixed number of amplifiers and retweets:</p>
<ul>
<li><p>iterate through communities (discovered from louvain method)</p></li>
<li><p>if a community contains at least num_amplifiers, select a set of amplifiers randomly from the community</p></li>
<li><p>repeat “iterations” times</p>
<ul>
<li><p>create new poisoned dataframe based on supplied parameters</p></li>
<li><p>train model</p></li>
<li><p>run source-based and target-based recommendations, see how often target appears in top_n recommendations</p></li>
<li><p>record all results to be graphed later</p></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run poisoning experiment 2</span>

<span class="n">num_amplifiers</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">num_retweets</span> <span class="o">=</span> <span class="mi">20</span>

<span class="n">samples</span> <span class="o">=</span> <span class="p">[</span><span class="n">target_tid</span><span class="p">,</span> <span class="n">high_profile_tid</span><span class="p">]</span>
<span class="n">top_n</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">iterations</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">epochs</span> <span class="o">=</span> <span class="mi">5</span>

<span class="n">result_source</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">result_target</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">save_dir</span> <span class="o">=</span> <span class="s2">&quot;exp2&quot;</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">save_dir</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_dir</span><span class="p">)</span>

<span class="n">target_name</span> <span class="o">=</span> <span class="n">tid_name</span><span class="p">[</span><span class="n">target_tid</span><span class="p">]</span>
<span class="n">high_profile_name</span> <span class="o">=</span> <span class="n">tid_name</span><span class="p">[</span><span class="n">high_profile_tid</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Community labels: &quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">communities</span><span class="o">.</span><span class="n">keys</span><span class="p">()]))</span>
<span class="k">for</span> <span class="n">mod</span><span class="p">,</span> <span class="n">names</span> <span class="ow">in</span> <span class="n">communities</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">target_name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;target: &quot;</span> <span class="o">+</span> <span class="n">target_name</span> <span class="o">+</span> <span class="s2">&quot; in community: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; size: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">high_profile_name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;high_profile: &quot;</span> <span class="o">+</span> <span class="n">high_profile_name</span> <span class="o">+</span> <span class="s2">&quot; in community: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; size: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)))</span>

<span class="k">for</span> <span class="n">mod</span><span class="p">,</span> <span class="n">names</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">communities</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Community: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; contains &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; names.&quot;</span><span class="p">)</span>
    <span class="n">amplifier_candidates</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">name_sid</span><span class="p">:</span>
            <span class="n">sid</span> <span class="o">=</span> <span class="n">name_sid</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">sid</span> <span class="ow">in</span> <span class="n">source_retweeted</span><span class="p">:</span>
                <span class="n">rtw</span> <span class="o">=</span> <span class="n">source_retweeted</span><span class="p">[</span><span class="n">sid</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">high_profile_tid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rtw</span> <span class="ow">and</span> <span class="n">target_tid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rtw</span><span class="p">:</span>
                    <span class="n">amplifier_candidates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sid</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">amplifier_candidates</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">num_amplifiers</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Skipping community: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; (only found &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">amplifier_candidates</span><span class="p">))</span><span class="o">+</span><span class="s2">&quot; candidates).&quot;</span><span class="p">)</span>
        <span class="k">continue</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Experiment:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; community:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; take:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">save_path</span> <span class="o">=</span> <span class="n">save_dir</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span>
        <span class="n">new_ratings</span> <span class="o">=</span> <span class="n">get_poisoned_dataset</span><span class="p">(</span><span class="n">ratings</span><span class="p">,</span> <span class="n">amplifier_candidates</span><span class="p">,</span> 
                                           <span class="n">num_amplifiers</span><span class="p">,</span> <span class="n">num_retweets</span><span class="p">,</span> <span class="n">save_path</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Base dataset length: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ratings</span><span class="p">))</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; Poisoned dataset length: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">new_ratings</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">new_target_w</span><span class="p">,</span> <span class="n">new_source_w</span> <span class="o">=</span> <span class="n">make_model</span><span class="p">(</span><span class="n">new_ratings</span><span class="p">,</span> <span class="n">model_type</span><span class="p">,</span> <span class="n">epochs</span><span class="p">)</span>
        <span class="n">new_t_matrix</span> <span class="o">=</span> <span class="n">cosine_similarity</span><span class="p">(</span><span class="n">new_target_w</span><span class="p">)</span>
        <span class="n">print_target_similarity</span><span class="p">(</span><span class="n">target_tid</span><span class="p">,</span> <span class="n">high_profile_tid</span><span class="p">,</span> <span class="n">new_t_matrix</span><span class="p">)</span>
        <span class="n">new_s_matrix</span> <span class="o">=</span> <span class="n">cosine_similarity</span><span class="p">(</span><span class="n">new_source_w</span><span class="p">)</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">sid</span> <span class="ow">in</span> <span class="n">controls</span><span class="p">:</span>
            <span class="n">found</span> <span class="o">=</span> <span class="n">validate_target_target</span><span class="p">(</span><span class="n">new_ratings</span><span class="p">,</span> <span class="n">sid</span><span class="p">,</span> <span class="n">new_t_matrix</span><span class="p">,</span> <span class="n">target_tid</span><span class="p">,</span> <span class="n">top_n</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">found</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Target was in top &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">top_n</span><span class="p">)</span> 
        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; target recommendations for &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span> 
        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; users in control list.&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">result_target</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">mod</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">ret</span><span class="p">])</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">save_dir</span> <span class="o">+</span> <span class="s2">&quot;/result_target.json&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">result_target</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
        <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">sid</span> <span class="ow">in</span> <span class="n">controls</span><span class="p">:</span>
            <span class="n">found</span> <span class="o">=</span> <span class="n">validate_target_source</span><span class="p">(</span><span class="n">new_ratings</span><span class="p">,</span> <span class="n">sid</span><span class="p">,</span> <span class="n">new_s_matrix</span><span class="p">,</span> <span class="n">target_tid</span><span class="p">,</span> <span class="n">top_n</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">found</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Target was in top &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">top_n</span><span class="p">)</span> 
        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; source recommendations for &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> 
        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; users in control list.&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">result_source</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">mod</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">res</span><span class="p">])</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">save_dir</span> <span class="o">+</span> <span class="s2">&quot;/result_source.json&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">result_source</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;exp2/result_source.json&quot;</span>
<span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;US2020 Experiment 2 - source-based recommendations&quot;</span>
<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<span class="n">results2</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">order</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">item</span>
        <span class="n">l</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">item</span>
        <span class="n">l</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span><span class="o">/</span><span class="mi">20</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>
    <span class="k">if</span> <span class="n">l</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">order</span><span class="p">:</span>
        <span class="n">order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
    <span class="n">results2</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">l</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">v</span><span class="p">])</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results2</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">,</span> <span class="s2">&quot;take&quot;</span><span class="p">,</span> <span class="s2">&quot;val&quot;</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;whitegrid&quot;</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;params&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;val&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mf">.2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
<span class="n">xlab</span> <span class="o">=</span> <span class="s2">&quot;Experiment parameters (community label)&quot;</span>
<span class="n">ylab</span> <span class="o">=</span> <span class="s2">&quot;Percentage of control set that saw target account in top-3 recommendations&quot;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlab</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylab</span><span class="p">)</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">():</span>
    <span class="n">item</span><span class="o">.</span><span class="n">set_rotation</span><span class="p">(</span><span class="mi">45</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;exp2/result_target.json&quot;</span>
<span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;US2020 Experiment 2 - target-based recommendations&quot;</span>
<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<span class="n">results2</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">order</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">item</span>
        <span class="n">l</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">item</span>
        <span class="n">l</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span><span class="o">/</span><span class="mi">20</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>
    <span class="k">if</span> <span class="n">l</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">order</span><span class="p">:</span>
        <span class="n">order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
    <span class="n">results2</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">l</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">v</span><span class="p">])</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results2</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">,</span> <span class="s2">&quot;take&quot;</span><span class="p">,</span> <span class="s2">&quot;val&quot;</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;whitegrid&quot;</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;params&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;val&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mf">.2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
<span class="n">xlab</span> <span class="o">=</span> <span class="s2">&quot;Experiment parameters (community label)&quot;</span>
<span class="n">ylab</span> <span class="o">=</span> <span class="s2">&quot;Percentage of control set that saw target account in top-3 recommendations&quot;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlab</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylab</span><span class="p">)</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">():</span>
    <span class="n">item</span><span class="o">.</span><span class="n">set_rotation</span><span class="p">(</span><span class="mi">45</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">STOP</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="poisoning-experiment-3-amplifiers-chosen-based-on-similarity-to-control-accounts">
<h1>Poisoning experiment 3 - amplifiers chosen based on similarity to control accounts<a class="headerlink" href="#poisoning-experiment-3-amplifiers-chosen-based-on-similarity-to-control-accounts" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p>with varying number of amplifiers and retweets:</p>
<ul>
<li><p>select a set of amplifiers that are similar to control accounts</p></li>
<li><p>repeat “iterations” times</p>
<ul>
<li><p>create new poisoned dataframe based on supplied parameters</p></li>
<li><p>train model</p></li>
<li><p>run source-based and target-based recommendations, see how often target appears in top_n recommendations</p></li>
<li><p>record all results to be graphed later</p></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run poisoning experiment 3</span>

<span class="n">experiments</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
               <span class="p">[</span><span class="mi">100</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span><span class="mi">20</span><span class="p">],</span>
               <span class="p">[</span><span class="mi">200</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">200</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">200</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="mi">200</span><span class="p">,</span><span class="mi">20</span><span class="p">],</span> 
               <span class="p">[</span><span class="mi">500</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">500</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">500</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="mi">500</span><span class="p">,</span><span class="mi">20</span><span class="p">],</span> 
               <span class="p">[</span><span class="mi">1000</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1000</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">1000</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="mi">1000</span><span class="p">,</span><span class="mi">20</span><span class="p">],</span>
               <span class="p">[</span><span class="mi">2000</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2000</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">2000</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="mi">2000</span><span class="p">,</span><span class="mi">20</span><span class="p">]]</span>

<span class="n">samples</span> <span class="o">=</span> <span class="p">[</span><span class="n">target_tid</span><span class="p">,</span> <span class="n">high_profile_tid</span><span class="p">]</span>
<span class="n">top_n</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">iterations</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">epochs</span> <span class="o">=</span> <span class="mi">5</span>

<span class="c1"># 1. Pick accounts most similar to those in the control set</span>
<span class="c1"># that havent engaged with either high profile or target</span>
<span class="c1"># and aren&#39;t in the control group</span>
<span class="n">amplifier_candidates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">sims</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="k">for</span> <span class="n">sid</span> <span class="ow">in</span> <span class="n">controls</span><span class="p">:</span>
    <span class="n">sim</span> <span class="o">=</span> <span class="n">get_most_similar</span><span class="p">(</span><span class="n">sid</span><span class="p">,</span> <span class="n">s_matrix</span><span class="p">,</span> <span class="mi">250</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">sim</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">s</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">controls</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">source_retweeted</span><span class="p">:</span>
                <span class="n">rtw</span> <span class="o">=</span> <span class="n">source_retweeted</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">high_profile_tid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rtw</span> <span class="ow">and</span> <span class="n">target_tid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rtw</span><span class="p">:</span>
                    <span class="n">sims</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">amplifier_candidates</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sims</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of amplifier candidates: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">amplifier_candidates</span><span class="p">)))</span>
<span class="c1"># Loop through the experiment parameters</span>
<span class="c1"># For each set of parameters, perform the experiment iterations number of times</span>
<span class="n">result_source</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">result_target</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">save_dir</span> <span class="o">=</span> <span class="s2">&quot;exp3&quot;</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">save_dir</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_dir</span><span class="p">)</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">experiments</span><span class="p">:</span>
    <span class="n">amps</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">item</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Experiment:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; amps:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">amps</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; r:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; take:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">save_path</span> <span class="o">=</span> <span class="n">save_dir</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">amps</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.csv&quot;</span>
        <span class="n">new_ratings</span> <span class="o">=</span> <span class="n">get_poisoned_dataset</span><span class="p">(</span><span class="n">ratings</span><span class="p">,</span> <span class="n">amplifier_candidates</span><span class="p">,</span> <span class="n">amps</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">save_path</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Base dataset length: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ratings</span><span class="p">))</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; Poisoned dataset length: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">new_ratings</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">new_target_w</span><span class="p">,</span> <span class="n">new_source_w</span> <span class="o">=</span> <span class="n">make_model</span><span class="p">(</span><span class="n">new_ratings</span><span class="p">,</span> <span class="n">model_type</span><span class="p">,</span> <span class="n">epochs</span><span class="p">)</span>
        <span class="n">new_t_matrix</span> <span class="o">=</span> <span class="n">cosine_similarity</span><span class="p">(</span><span class="n">new_target_w</span><span class="p">)</span>
        <span class="n">print_target_similarity</span><span class="p">(</span><span class="n">target_tid</span><span class="p">,</span> <span class="n">high_profile_tid</span><span class="p">,</span> <span class="n">new_t_matrix</span><span class="p">)</span>
        <span class="n">new_s_matrix</span> <span class="o">=</span> <span class="n">cosine_similarity</span><span class="p">(</span><span class="n">new_source_w</span><span class="p">)</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">sid</span> <span class="ow">in</span> <span class="n">controls</span><span class="p">:</span>
            <span class="n">found</span> <span class="o">=</span> <span class="n">validate_target_target</span><span class="p">(</span><span class="n">new_ratings</span><span class="p">,</span> <span class="n">sid</span><span class="p">,</span> <span class="n">new_t_matrix</span><span class="p">,</span> <span class="n">target_tid</span><span class="p">,</span> <span class="n">top_n</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">found</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Target was in top &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">top_n</span><span class="p">)</span> 
        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; target recommendations for &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span> 
        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; users in control list.&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">result_target</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">amps</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">ret</span><span class="p">])</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">save_dir</span> <span class="o">+</span> <span class="s2">&quot;/result_target.json&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">result_target</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
        <span class="n">res</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">sid</span> <span class="ow">in</span> <span class="n">controls</span><span class="p">:</span>
            <span class="n">found</span> <span class="o">=</span> <span class="n">validate_target_source</span><span class="p">(</span><span class="n">new_ratings</span><span class="p">,</span> <span class="n">sid</span><span class="p">,</span> <span class="n">new_s_matrix</span><span class="p">,</span> <span class="n">target_tid</span><span class="p">,</span> <span class="n">top_n</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">found</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Target was in top &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">top_n</span><span class="p">)</span> 
        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; source recommendations for &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> 
        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; users in control list.&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">result_source</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">amps</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">res</span><span class="p">])</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">save_dir</span> <span class="o">+</span> <span class="s2">&quot;/result_source.json&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">result_source</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;exp3/result_source.json&quot;</span>
<span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;US2020 Experiment 3 - source-based recommendations&quot;</span>
<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<span class="n">results2</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">order</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">item</span>
        <span class="n">l</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">item</span>
        <span class="n">l</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span><span class="o">/</span><span class="mi">20</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>
    <span class="k">if</span> <span class="n">l</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">order</span><span class="p">:</span>
        <span class="n">order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
    <span class="n">results2</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">l</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">v</span><span class="p">])</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results2</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">,</span> <span class="s2">&quot;take&quot;</span><span class="p">,</span> <span class="s2">&quot;val&quot;</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;whitegrid&quot;</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;params&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;val&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mf">.2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
<span class="n">xlab</span> <span class="o">=</span> <span class="s2">&quot;Experiment parameters (num_accounts, num_retweets)&quot;</span>
<span class="n">ylab</span> <span class="o">=</span> <span class="s2">&quot;Percentage of control set that saw target account in top-3 recommendations&quot;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlab</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylab</span><span class="p">)</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">():</span>
    <span class="n">item</span><span class="o">.</span><span class="n">set_rotation</span><span class="p">(</span><span class="mi">45</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;exp3/result_target.json&quot;</span>
<span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;US2020 Experiment 3 - target-based recommendations&quot;</span>
<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<span class="n">results2</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">order</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">item</span>
        <span class="n">l</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">m</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">item</span>
        <span class="n">l</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span><span class="o">/</span><span class="mi">20</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span>
    <span class="k">if</span> <span class="n">l</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">order</span><span class="p">:</span>
        <span class="n">order</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
    <span class="n">results2</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">l</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">v</span><span class="p">])</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results2</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">,</span> <span class="s2">&quot;take&quot;</span><span class="p">,</span> <span class="s2">&quot;val&quot;</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;whitegrid&quot;</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;params&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;val&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mf">.2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
<span class="n">xlab</span> <span class="o">=</span> <span class="s2">&quot;Experiment parameters (num_accounts, num_retweets)&quot;</span>
<span class="n">ylab</span> <span class="o">=</span> <span class="s2">&quot;Percentage of control set that saw target account in top-3 recommendations&quot;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlab</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylab</span><span class="p">)</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">():</span>
    <span class="n">item</span><span class="o">.</span><span class="n">set_rotation</span><span class="p">(</span><span class="mi">45</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">STOP</span>
</pre></div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./nbs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="T102448_Adversarial_Learning_for_Recommendation.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">Adversarial Training (Regularization) on a Recommender System</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="T711285_Data_Poisoning_Attack_using_LFM_and_ItemAE_on_Synthetic_Dataset.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">Injection attack using LFM and ItemAE model trained on Toy dataset</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Sparsh A.<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>