
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Amazon Personalize Workshop &#8212; Reco Book</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet" />
  <link href="../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Collaborative Filtering on ML-latest-small" href="T424437_Collaborative_Filtering_on_ML_latest_small.html" />
    <link rel="prev" title="Amazon Personalize Batch Job" href="T227901_amazon_personalize_batch_job.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Reco Book</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../index.html">
   Tutorials in Jupyter notebook format
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  User Stories
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="US780867_Transformer_based_Recommenders.html">
   Transformer-based Recommenders
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="T034923_BERT4Rec_on_ML1M_in_PyTorch.html">
     BERT4Rec on ML-1M in PyTorch
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T595874_BERT4Rec_on_ML25M_in_PyTorch_Lightning.html">
     BERT4Rec on ML-25M
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T088416_BST_Implementation_in_MXNet.html">
     BST Implementation in MXNet
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T602245_BST_implementation_in_PyTorch.html">
     BST implementation in PyTorch
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T007665_BST_on_ML1M_in_Keras.html">
     A Transformer-based recommendation system
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T881207_BST_PTLightning_ML1M.html">
     Rating prediction using the Behavior Sequence Transformer (BST) model on ML-1M dataset in PyTorch Lightning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T025247_BST_using_Deepctr_library.html">
     BST using Deepctr library
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T757997_SASRec_PyTorch.html">
     SASRec implementation with PyTorch Library
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T225287_SASRec_PaddlePaddle.html">
     SASRec implementation with Paddle Library
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T701627_SR_SAN_Session_based_Model.html">
     SR-SAN Session-based Recommender
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T975104_SSEPT_ML1M_Tensorflow1x.html">
     SSE-PT Personalized Transformer Recommender on ML-1M in Tensorflow 1.x
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T472955_GCSAN_Session_based_Model.html">
     GCSAN Session-based Recommender
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T970274_Transformers4Rec_Session_based_Recommender_on_Yoochoose.html">
     End-to-end session-based recommendation with Transformers4Rec
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T382183_Transformers4Rec_XLNet_on_Synthetic_data.html">
     Transformers4Rec XLNet on Synthetic data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="T793395_Session_based_recommendation_on_REES46_Dataset.html">
     End-to-end Session-based recommendation on REES46 Dataset
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Prototypes
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="T382881_DeepWalk_Karateclub.html">
   DeepWalk from scratch referencing Karateclub library
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T384270_DeepWalk_pure_python.html">
   DeepWalk in pure python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T677598_Jaccard_Cosine_SVD_DeepWalk_ML100K.html">
   Recommender System with DeepWalk Graph Embeddings
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T815556_Node2vec_Karateclub.html">
   Node2vec from scratch referencing Karateclub library
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T894941_Node2vec_MovieLens_Keras.html">
   Graph representation learning with node2vec
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T611050_Node2vec_PyG.html">
   Node2vec from scratch in PyTorch Geometric
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T186367_Node2vec_library.html">
   Node2vec from scratch referencing node2vec library
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T331379_bayesian_personalized_ranking.html">
   BPR from scratch
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T081831_Data_Poisoning_Attacks_on_Factorization_Based_Collaborative_Filtering.html">
   Data Poisoning Attacks on Factorization-Based Collaborative Filtering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T102448_Adversarial_Learning_for_Recommendation.html">
   Adversarial Training (Regularization) on a Recommender System
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T865035_Simulating_Data_Poisoning_Attacks_against_Twitter_Recommender.html">
   Load and process dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T711285_Data_Poisoning_Attack_using_LFM_and_ItemAE_on_Synthetic_Dataset.html">
   Injection attack using LFM and ItemAE model trained on Toy dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T355514_Black_box_Attack_on_Sequential_Recs.html">
   Black-box Attack on Sequential Recs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T873451_Statistics_fundamentals.html">
   Statictics Fundamentals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T890478_Batch_Learning_from_Bandit_Feedback_%28BLBF%29.html">
   Imports
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T257798_Off_Policy_Learning_in_Two_stage_Recommender_Systems.html">
   Off-Policy Learning in Two-stage Recommender Systems
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T471827_Adaptive_Estimator_Selection_for_Off_Policy_Evaluation.html">
   Adaptive Estimator Selection for Off-Policy Evaluation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T902666_Evaluating_the_Robustness_of_Off_Policy_Evaluation.html">
   Evaluating the Robustness of Off-Policy Evaluation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T705904_Evaluation_of_Multiple_Off_Policy_Estimators_on_Synthetic_Dataset.html">
   Evaluation of Multiple Off-Policy Estimators on Synthetic Dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T874693_Evaluating_Standard_Off_Policy_Estimators_with_Small_Sample_Open_Bandit_Dataset.html">
   Evaluating Standard Off-Policy Estimators with Small Sample Open-Bandit Dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T792262_Optimal_Off_Policy_Evaluation_from_Multiple_Logging_Policies.html">
   Optimal Off-Policy Evaluation from Multiple Logging Policies
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T167249_Offline_Policy_Evaluation_with_VW_Command_Line.html">
   Offline Policy Evaluation with VW Command Line
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T966055_OBP_Library_Workshop_Tutorials.html">
   OBP Library Workshop Tutorials
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T632722_PyTorch_Fundamentals_Part_1.html">
   PyTorch Fundamentals Part 1
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T472467_PyTorch_Fundamentals_Part_2.html">
   PyTorch Fundamentals Part 2
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T206654_PyTorch_Fundamentals_Part_3.html">
   PyTorch Fundamentals Part 3
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T536348_Attention_Mechanisms.html">
   Imports
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T500796_Agricultural_Satellite_Image_Segmentation.html">
   Agricultural Satellite Image Segmentation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T611432_Image_Analysis_with_Tensorflow.html">
   Image Analysis with Tensorflow
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T925716_MongoDB_to_CSV_Conversion.html">
   MongoDB to CSV conversion
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T396469_PDF_to_Word_Cloud_via_Email.html">
   PDF to WordCloud via Email
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T030890_Job_Scraping_and_Clustering.html">
   Job scraping and clustering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T897054_Scene_Text_Recognition.html">
   Scene Text Recognition
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T034809_Large_scale_Document_Retrieval_with_Elastic_Search.html">
   Large-scale Document Retrieval with ElasticSearch
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T467251_vowpal_wabbit_contextual_recommender.html">
   Simulating a news personalization scenario using Contextual Bandits
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T686684_similar_product_recommender.html">
   Similar Product Recommender system using Deep Learning for an online e-commerce store
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T132203_Retail_Product_Recommendations_using_Word2vec.html">
   Retail Product Recommendations using word2vec
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T501828_Recommender_Implicit_Negative_Feedback.html">
   Retail Product Recommendation with Negative Implicit Feedback
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T315965_Sequence_Aware_Recommenders_Music.html">
   Sequence Aware Recommender Systems
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T051777_image_similarity_recommendations.html">
   Similar Product Recommendations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990172_recobook_diversity_aware_book_recommender.html">
   Diversity Aware Book Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T488549_Goodreads_Diversity_Aware_Book_Recommender.html">
   Diversity Aware Book Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T023535_Kafka_MongoDB_Real_time_Streaming.html">
   Kafka MongoDB Real-time Streaming
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T622304_Session_based_Recommender_Using_Word2vec.html">
   Session-based recommendation using word2vec
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T416854_bandit_based_recommender_using_thompson_sampling_app.html">
   Bandit-based Online Learning using Thompson Sampling
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T198578_Booking_dot_com_Trip_Recommendation.html">
   Booking.com Trip Recommendation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T519734_Vowpal_Wabbit_Contextual_Bandit.html">
   Vowpal Wabbit Contextual Bandit
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T871537_Recommendation_Systems_using_Olist_Dataset.html">
   Recommendation systems using Olist dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T057885_Offline_Replayer_Evaluation.html">
   Offline Replayer Evaluation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T915054_method_for_effective_online_testing.html">
   Methods for effective online testing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T513987_Recsys_2020_Feature_Engineering_Tutorial.html">
   Recsys’20 Feature Engineering Tutorial
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T227901_amazon_personalize_batch_job.html">
   Amazon Personalize Batch Job
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Amazon Personalize Workshop
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T424437_Collaborative_Filtering_on_ML_latest_small.html">
   Collaborative Filtering on ML-latest-small
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T539160_Building_and_Deploying_ASOS_Fashion_Recommender.html">
   Building and deploying ASOS fashion recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T757697_Simple_Similarity_based_Recommender.html">
   Simple Similarity based Recommmendations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T051594_Analytics_Zoo.html">
   Analytics Zoo
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T313645_A_B_Testing.html">
   A/B Testing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T475711_PinSage_Graph_based_Recommender.html">
   PinSage Graph-based Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T516490_Graph_Embeddings.html">
   Learn Embeddings using Graph Networks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T822164_movielens_milvus_redis_efficient_retrieval.html">
   Recommender with Redis and Milvus
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T845186_Anime_Recommender.html">
   RekoNet Anime Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T855843_kafka_spark_streaming_colab.html">
   Kafka and Spark Streaming in Colab
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T460437_Building_Models_From_Scratch.html">
   Building Models from scratch
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T855971_Conet_Model_for_Movie_Recommender.html">
   CoNet model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T996996_content_based_and_collaborative_movielens.html">
   Movie Recommendation with Content-Based and Collaborative Filtering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T239418_Simple_Movie_Recommenders.html">
   Simple Movie Recommenders
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T138337_Simple_Movie_Recommender.html">
   Simple movie recommender in implicit, explicit, and cold-start settings
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T935440_The_importance_of_Rating_Normalization.html">
   The importance of Rating Normalization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T612622_cornac_examples.html">
   Cornac Examples
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T561435_Flower_Classification.html">
   Flower classification
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T680910_Trivago_Session_based_Recommender.html">
   Trivago Session-based Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_ads_selection_using_bandits.html">
   Best Ads detection using bandit methods
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_book_crossing_surprise_svd_nmf.html">
   Book-Crossing Recommendation System
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_book_recommender_kubeflow.html">
   Books recommendations with Kubeflow Pipelines on Scaleway Kapsule
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_build_a_kubeflow_pipeline.html">
   Build a Kubeflow Pipeline
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_causal_inference.html">
   Causal Inference
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_concept_embedding_nlp.html">
   Exploring Word Embeddings
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_concept_neural_net.html">
   Neural Network
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_concept_nlp_basics.html">
   Natural Language Processing 101
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_concept_transformer_lm.html">
   TransformerLM Quick Start and Guide
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_content_based_music_recommender_lyricsfreak.html">
   Content-based method for song recommendation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_evaluation_metrics_basics.html">
   Recommender System Evaluations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_implicit_synthetic.html">
   Comparing Implicit Models on Synthetic Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_movie_recommender_tensorflow.html">
   Recommendation Systems with TensorFlow
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_movie_recommender_tensorflow_sagemaker.html">
   Movie recommender using Tensorflow in Sagemaker
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_movielens_eda_modeling.html">
   Movielens EDA and Modeling
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_read_data_from_cassandra_into_pandas.html">
   Read Cassandra Data Snapshot as DataFrame
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_rl_in_action.html">
   Reinforcement Learning fundamentals in action
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_rnn_cnn_basics.html">
   Processing sequences using RNNs and CNNs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_tf_serving_in_action.html">
   TF Serving in action
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990000_training_indexing_movie_recommender.html">
   Training and indexing movie recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T207114_EduRec_MOOCCube_Course_Recommender.html">
   EduRec MOOCCube Course Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T273184_Multi_Task_Learning.html">
   Multi-task Learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T661108_Book_Recommender_API.html">
   Book Recommender API
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T912764_Simple_Movie_Recommender_App.html">
   Simple Movie Recommender App
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T964554_Career_Village_Questions_Recommendation.html">
   CareerVillage Questions Recommendation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_amazon_women_apparel_tfidf_word2vec.html">
   Amazon Product Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_anime_recommender_graph_network.html">
   Anime Recommender with Bi-partite Graph Network
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_concept_self_attention.html">
   Self-Attention
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_course_recommender_svd_flask.html">
   Course Recommender with SVD based similarity
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_data_mining_similarity_measures.html">
   Concept - Data Mining Similarity Measures
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_jaccard_recommender.html">
   Jaccard Similarity based Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_live_streamer_recommender.html">
   Live Streamer Recommender with Implicit feedback
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_songs_embedding_skipgram_recommender.html">
   Song Embeddings - Skipgram Recommender
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_toy_example_car_recommender_knn.html">
   Toy example - Car Recommender using KNN method
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T990001_wikirecs_recommender.html">
   WikiRecs
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/nbs/T022961_Amazon_Personalize_Workshop.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/sparsh-ai/reco-book/main?urlpath=tree/nbs/T022961_Amazon_Personalize_Workshop.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#part-1-build-your-campaign">
   Part 1 - Build your campaign
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#how-to-use-the-notebook">
     How to Use the Notebook
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#imports">
     Imports
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#configure-the-data">
     Configure the data
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#specify-a-bucket-and-data-output-location">
       Specify a Bucket and Data Output Location
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#download-prepare-and-upload-training-data">
       Download, Prepare, and Upload Training Data
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#download-and-explore-the-dataset">
         Download and Explore the Dataset
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#prepare-and-upload-data">
         Prepare and Upload Data
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#create-schema">
       Create Schema
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#create-and-wait-for-dataset-group">
       Create and Wait for Dataset Group
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#create-dataset-group">
         Create Dataset Group
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#wait-for-dataset-group-to-have-active-status">
         Wait for Dataset Group to Have ACTIVE Status
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#create-dataset">
         Create Dataset
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#attach-policy-to-s3-bucket">
         Attach Policy to S3 Bucket
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#create-personalize-role">
         Create Personalize Role
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#import-the-data">
     Import the data
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#create-dataset-import-job">
       Create Dataset Import Job
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#wait-for-dataset-import-job-to-have-active-status">
       Wait for Dataset Import Job to Have ACTIVE Status
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-the-solution-and-version">
     Create the Solution and Version
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#select-recipe">
       Select Recipe
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#user-personalization">
         User Personalization
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#create-and-wait-for-solution">
       Create and Wait for Solution
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#create-solution">
         Create Solution
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#create-solution-version">
         Create Solution Version
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#wait-for-solution-version-to-have-active-status">
         Wait for Solution Version to Have ACTIVE Status
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#get-metrics-of-solution-version">
         Get Metrics of Solution Version
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-and-wait-for-the-campaign">
     Create and Wait for the Campaign
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#create-campaign">
       Create Campaign
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#wait-for-campaign-to-have-active-status">
       Wait for Campaign to Have ACTIVE Status
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#get-sample-recommendations">
     Get Sample Recommendations
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#call-getrecommendations">
       Call GetRecommendations
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#review">
     Review
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#notes-for-the-next-notebook">
     Notes for the Next Notebook:
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#part-2-view-campaign-and-interactions">
   Part 2 - View Campaign and Interactions
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#creating-an-event-tracker">
     Creating an Event Tracker
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#configuring-source-data">
     Configuring Source Data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#getting-recommendations">
     Getting Recommendations
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#simulating-user-behavior">
     Simulating User Behavior
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#conclusion">
     Conclusion
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#part-3-cleanup-the-resources">
   Part 3 - Cleanup the resources
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#defining-the-things-to-cleanup">
     Defining the Things to Cleanup
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#empty-your-s3-bucket">
     Empty Your S3 Bucket
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#iam-policy-cleanup">
     IAM Policy Cleanup
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#last-step">
       Last Step
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#part-4-security-best-practices-optional">
   Part 4 - Security best practices (optional)
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#get-the-personalize-boto3-client">
     Get the Personalize boto3 Client
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     Specify a Bucket and Data Output Location
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id2">
     Download, Prepare, and Upload Training Data
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id3">
       Download and Explore the Dataset
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#optional-security-practice-protect-data-at-rest-encrypt-decrypt-your-dataset">
       Optional security practice: Protect data at rest - Encrypt/decrypt your dataset
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#optional-security-practice-protect-data-in-transit-ssl-access-only-for-s3-bucket">
       Optional security practice: Protect data in transit - SSL access only for S3 bucket
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#additional-security-note">
       Additional security note:
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#optional-security-practice-validate-bucket-owner-matches-your-account-canonical-id">
       Optional security practice: validate bucket owner matches your account canonical id
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#optional-security-practice-protect-data-integrity-enable-s3-bucket-versioning">
       Optional security practice: Protect data integrity - Enable S3 bucket versioning
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id4">
       Prepare and Upload Data
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id5">
     Create Schema
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#optional-security-practice-protect-data-at-rest-encrypt-datasets-under-personalize">
       Optional security practice - Protect data at rest - Encrypt datasets under Personalize
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-and-wait-for-encrypted-dataset-group">
     Create and Wait for Encrypted Dataset Group
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#create-encrypted-dataset-group">
       Create Encrypted Dataset Group
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id6">
       Wait for Dataset Group to Have ACTIVE Status
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id7">
     Create Dataset
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#prepare-create-and-wait-for-dataset-import-job">
     Prepare, Create, and Wait for Dataset Import Job
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id8">
       Attach Policy to S3 Bucket
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id9">
       Create Personalize Role
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id10">
       Create Dataset Import Job
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id11">
       Wait for Dataset Import Job to Have ACTIVE Status
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id12">
     Select Recipe
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id13">
     Create and Wait for Solution
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id14">
       Create Solution
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id15">
       Create Solution Version
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id16">
       Wait for Solution Version to Have ACTIVE Status
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#get-metrics-of-solution">
       Get Metrics of Solution
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-and-wait-for-campaign">
     Create and Wait for Campaign
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id17">
       Create Campaign
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id18">
       Wait for Campaign to Have ACTIVE Status
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#get-recommendations">
     Get Recommendations
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#select-a-user-and-an-item">
       Select a User and an Item
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id19">
       Call GetRecommendations
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="amazon-personalize-workshop">
<h1>Amazon Personalize Workshop<a class="headerlink" href="#amazon-personalize-workshop" title="Permalink to this headline">¶</a></h1>
<div class="section" id="part-1-build-your-campaign">
<h2>Part 1 - Build your campaign<a class="headerlink" href="#part-1-build-your-campaign" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>This notebook will walk you through the steps to build a recommendation model for movies based on data collected from the movielens data set. The goal is to recommend movies that are relevant based on a particular user. The data is coming from the MovieLens project.</p>
</div></blockquote>
<div class="section" id="how-to-use-the-notebook">
<h3>How to Use the Notebook<a class="headerlink" href="#how-to-use-the-notebook" title="Permalink to this headline">¶</a></h3>
<p>Code is broken up into cells like the one below. There’s a triangular <code class="docutils literal notranslate"><span class="pre">Run</span></code> button at the top of this page you can click to execute each cell and move onto the next, or you can press <code class="docutils literal notranslate"><span class="pre">Shift</span></code> + <code class="docutils literal notranslate"><span class="pre">Enter</span></code> while in the cell to execute it and move onto the next one.</p>
<p>As a cell is executing you’ll notice a line to the side showcase an <code class="docutils literal notranslate"><span class="pre">*</span></code> while the cell is running or it will update to a number to indicate the last cell that completed executing after it has finished exectuting all the code within a cell.</p>
<p>Simply follow the instructions below and execute the cells to get started with Amazon Personalize.</p>
</div>
<div class="section" id="imports">
<h3>Imports<a class="headerlink" href="#imports" title="Permalink to this headline">¶</a></h3>
<p>Python ships with a broad collection of libraries and we need to import those as well as the ones installed to help us like <a class="reference external" href="https://aws.amazon.com/sdk-for-python/">boto3</a> (AWS SDK for python) and <a class="reference external" href="https://pandas.pydata.org/">Pandas</a>/<a class="reference external" href="https://numpy.org/">Numpy</a> which are core data science tools.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># Imports
import boto3
import json
import numpy as np
import pandas as pd
import time
!conda install -y -c conda-forge unzip
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Collecting package metadata (current_repodata.json): done
Solving environment: | 
The environment is inconsistent, please check the package plan carefully
The following packages are causing the inconsistency:

  - conda-forge/noarch::seaborn-base==0.11.1=pyhd8ed1ab_1
  - conda-forge/noarch::nbclassic==0.2.6=pyhd8ed1ab_0
  - conda-forge/linux-64::blaze==0.11.3=py36_0
  - conda-forge/linux-64::matplotlib==3.3.4=py36h5fab9bb_0
  - defaults/linux-64::_anaconda_depends==5.1.0=py36_2
  - conda-forge/noarch::jupyterlab==3.0.9=pyhd8ed1ab_0
  - conda-forge/noarch::python-language-server==0.36.2=pyhd8ed1ab_0
  - conda-forge/noarch::jupyterlab_server==2.3.0=pyhd8ed1ab_0
  - conda-forge/noarch::pyls-black==0.4.6=pyh9f0ad1d_0
  - conda-forge/linux-64::scikit-image==0.16.2=py36hb3f55d8_0
  - conda-forge/noarch::black==20.8b1=py_1
  - conda-forge/linux-64::anyio==2.1.0=py36h5fab9bb_0
  - conda-forge/linux-64::jupyter_server==1.4.1=py36h5fab9bb_0
  - conda-forge/linux-64::bokeh==2.2.3=py36h5fab9bb_0
  - conda-forge/noarch::aiobotocore==1.2.1=pyhd8ed1ab_0
  - conda-forge/noarch::numpydoc==1.1.0=py_1
  - conda-forge/linux-64::spyder==4.2.0=py36h5fab9bb_0
  - conda-forge/noarch::pyls-spyder==0.3.2=pyhd8ed1ab_0
  - conda-forge/noarch::odo==0.5.1=py_1
  - conda-forge/noarch::imageio==2.9.0=py_0
  - conda-forge/linux-64::yarl==1.6.3=py36h8f6f2f9_1
  - conda-forge/noarch::sphinx==3.5.1=pyhd8ed1ab_0
  - conda-forge/noarch::seaborn==0.11.1=hd8ed1ab_1
  - conda-forge/linux-64::jupyter==1.0.0=py36h5fab9bb_6
  - conda-forge/noarch::dask==2021.2.0=pyhd8ed1ab_0
  - conda-forge/linux-64::idna_ssl==1.1.0=py36h9f0ad1d_1001
  - conda-forge/linux-64::matplotlib-base==3.3.4=py36hd391965_0
  - conda-forge/noarch::anaconda-client==1.7.2=py_0
  - conda-forge/noarch::anaconda-project==0.9.1=pyhd8ed1ab_0
done


==&gt; WARNING: A newer version of conda exists. &lt;==
  current version: 4.8.4
  latest version: 4.10.1

Please update conda by running

    $ conda update -n base -c defaults conda



## Package Plan ##

  environment location: /home/ec2-user/anaconda3/envs/python3

  added / updated specs:
    - unzip


The following packages will be downloaded:

    package                    |            build
    ---------------------------|-----------------
    aiohttp-3.7.4.post0        |   py36h8f6f2f9_0         622 KB  conda-forge
    astroid-2.5.8              |   py36h5fab9bb_0         316 KB  conda-forge
    botocore-1.19.52           |     pyhd3eb1b0_0         3.5 MB
    ca-certificates-2021.5.30  |       ha878542_0         136 KB  conda-forge
    certifi-2021.5.30          |   py36h5fab9bb_0         141 KB  conda-forge
    dataclasses-0.8            |     pyh787bdff_0          22 KB  conda-forge
    docutils-0.15.2            |   py36h5fab9bb_2         738 KB  conda-forge
    flask-cors-3.0.10          |     pyhd8ed1ab_0          15 KB  conda-forge
    jupyter_console-5.2.0      |           py36_1          34 KB  conda-forge
    lxml-4.6.3                 |   py36h04a5ba7_0         1.5 MB  conda-forge
    openjpeg-2.4.0             |       hb52868f_1         444 KB  conda-forge
    pillow-8.2.0               |   py36ha6010c0_1         688 KB  conda-forge
    pylint-2.7.2               |   py36h5fab9bb_0         466 KB  conda-forge
    unzip-6.0                  |       h7f98852_2         143 KB  conda-forge
    urllib3-1.25.11            |             py_0          93 KB  conda-forge
    ------------------------------------------------------------
                                           Total:         8.8 MB

The following NEW packages will be INSTALLED:

  aiohttp            conda-forge/linux-64::aiohttp-3.7.4.post0-py36h8f6f2f9_0
  astroid            conda-forge/linux-64::astroid-2.5.8-py36h5fab9bb_0
  botocore           pkgs/main/noarch::botocore-1.19.52-pyhd3eb1b0_0
  colorama           conda-forge/noarch::colorama-0.4.4-pyh9f0ad1d_0
  dataclasses        conda-forge/noarch::dataclasses-0.8-pyh787bdff_0
  docutils           conda-forge/linux-64::docutils-0.15.2-py36h5fab9bb_2
  flask-cors         conda-forge/noarch::flask-cors-3.0.10-pyhd8ed1ab_0
  idna               conda-forge/noarch::idna-2.10-pyh9f0ad1d_0
  jupyter_console    conda-forge/linux-64::jupyter_console-5.2.0-py36_1
  lxml               conda-forge/linux-64::lxml-4.6.3-py36h04a5ba7_0
  openjpeg           conda-forge/linux-64::openjpeg-2.4.0-hb52868f_1
  pillow             conda-forge/linux-64::pillow-8.2.0-py36ha6010c0_1
  pylint             conda-forge/linux-64::pylint-2.7.2-py36h5fab9bb_0
  requests           conda-forge/noarch::requests-2.25.1-pyhd3deb0d_0
  unzip              conda-forge/linux-64::unzip-6.0-h7f98852_2
  urllib3            conda-forge/noarch::urllib3-1.25.11-py_0

The following packages will be UPDATED:

  ca-certificates                      2020.12.5-ha878542_0 --&gt; 2021.5.30-ha878542_0
  certifi                          2020.12.5-py36h5fab9bb_1 --&gt; 2021.5.30-py36h5fab9bb_0



Downloading and Extracting Packages
docutils-0.15.2      | 738 KB    | ##################################### | 100% 
lxml-4.6.3           | 1.5 MB    | ##################################### | 100% 
botocore-1.19.52     | 3.5 MB    | ##################################### | 100% 
jupyter_console-5.2. | 34 KB     | ##################################### | 100% 
urllib3-1.25.11      | 93 KB     | ##################################### | 100% 
flask-cors-3.0.10    | 15 KB     | ##################################### | 100% 
openjpeg-2.4.0       | 444 KB    | ##################################### | 100% 
pillow-8.2.0         | 688 KB    | ##################################### | 100% 
aiohttp-3.7.4.post0  | 622 KB    | ##################################### | 100% 
astroid-2.5.8        | 316 KB    | ##################################### | 100% 
certifi-2021.5.30    | 141 KB    | ##################################### | 100% 
pylint-2.7.2         | 466 KB    | ##################################### | 100% 
dataclasses-0.8      | 22 KB     | ##################################### | 100% 
ca-certificates-2021 | 136 KB    | ##################################### | 100% 
unzip-6.0            | 143 KB    | ##################################### | 100% 
Preparing transaction: done
Verifying transaction: done
Executing transaction: done
</pre></div>
</div>
</div>
</div>
<p>Next you will want to validate that your environment can communicate successfully with Amazon Personalize, the lines below do just that.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Configure the SDK to Personalize:</span>
<span class="n">personalize</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;personalize&#39;</span><span class="p">)</span>
<span class="n">personalize_runtime</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;personalize-runtime&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">aws_account_number</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;sts&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_caller_identity</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Account&#39;</span><span class="p">)</span>
<span class="n">aws_account_number</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;284105231590&#39;
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="configure-the-data">
<h3>Configure the data<a class="headerlink" href="#configure-the-data" title="Permalink to this headline">¶</a></h3>
<p>Data is imported into Amazon Personalize through Amazon S3, below we will specify a bucket that you have created within AWS for the purposes of this exercise.</p>
<p>Below you will update the <code class="docutils literal notranslate"><span class="pre">bucket</span></code> variable to instead be set to the value that you created earlier in the CloudFormation steps, this should be in a text file from your earlier work. the <code class="docutils literal notranslate"><span class="pre">filename</span></code> does not need to be changed.</p>
<div class="section" id="specify-a-bucket-and-data-output-location">
<h4>Specify a Bucket and Data Output Location<a class="headerlink" href="#specify-a-bucket-and-data-output-location" title="Permalink to this headline">¶</a></h4>
<p>Be sure to update the <code class="docutils literal notranslate"><span class="pre">bucket</span></code> value if you customized it during deployment of the CloudFormation template. Click in the cell below to make changes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bucket</span> <span class="o">=</span> <span class="s2">&quot;personalizedemobucket202106200728&quot;</span>       <span class="c1"># replace with the name of your S3 bucket</span>
<span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;movie-lens-100k.csv&quot;</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="download-prepare-and-upload-training-data">
<h4>Download, Prepare, and Upload Training Data<a class="headerlink" href="#download-prepare-and-upload-training-data" title="Permalink to this headline">¶</a></h4>
<p>At present you do not have the MovieLens data loaded locally yet for examination, execute the lines below to download the latest copy and to examine it quickly.</p>
<div class="section" id="download-and-explore-the-dataset">
<h5>Download and Explore the Dataset<a class="headerlink" href="#download-and-explore-the-dataset" title="Permalink to this headline">¶</a></h5>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!wget -N http://files.grouplens.org/datasets/movielens/ml-100k.zip
!unzip -o ml-100k.zip
data = pd.read_csv(&#39;./ml-100k/u.data&#39;, sep=&#39;\t&#39;, names=[&#39;USER_ID&#39;, &#39;ITEM_ID&#39;, &#39;RATING&#39;, &#39;TIMESTAMP&#39;])
pd.set_option(&#39;display.max_rows&#39;, 5)
data
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--2021-06-20 02:18:52--  http://files.grouplens.org/datasets/movielens/ml-100k.zip
Resolving files.grouplens.org (files.grouplens.org)... 128.101.65.152
Connecting to files.grouplens.org (files.grouplens.org)|128.101.65.152|:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 4924029 (4.7M) [application/zip]
Saving to: ‘ml-100k.zip’

ml-100k.zip         100%[===================&gt;]   4.70M  13.0MB/s    in 0.4s    

2021-06-20 02:18:53 (13.0 MB/s) - ‘ml-100k.zip’ saved [4924029/4924029]

Archive:  ml-100k.zip
   creating: ml-100k/
  inflating: ml-100k/allbut.pl       
  inflating: ml-100k/mku.sh          
  inflating: ml-100k/README          
  inflating: ml-100k/u.data          
  inflating: ml-100k/u.genre         
  inflating: ml-100k/u.info          
  inflating: ml-100k/u.item          
  inflating: ml-100k/u.occupation    
  inflating: ml-100k/u.user          
  inflating: ml-100k/u1.base         
  inflating: ml-100k/u1.test         
  inflating: ml-100k/u2.base         
  inflating: ml-100k/u2.test         
  inflating: ml-100k/u3.base         
  inflating: ml-100k/u3.test         
  inflating: ml-100k/u4.base         
  inflating: ml-100k/u4.test         
  inflating: ml-100k/u5.base         
  inflating: ml-100k/u5.test         
  inflating: ml-100k/ua.base         
  inflating: ml-100k/ua.test         
  inflating: ml-100k/ub.base         
  inflating: ml-100k/ub.test         
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>USER_ID</th>
      <th>ITEM_ID</th>
      <th>RATING</th>
      <th>TIMESTAMP</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>196</td>
      <td>242</td>
      <td>3</td>
      <td>881250949</td>
    </tr>
    <tr>
      <th>1</th>
      <td>186</td>
      <td>302</td>
      <td>3</td>
      <td>891717742</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>99998</th>
      <td>13</td>
      <td>225</td>
      <td>2</td>
      <td>882399156</td>
    </tr>
    <tr>
      <th>99999</th>
      <td>12</td>
      <td>203</td>
      <td>3</td>
      <td>879959583</td>
    </tr>
  </tbody>
</table>
<p>100000 rows × 4 columns</p>
</div></div></div>
</div>
</div>
<div class="section" id="prepare-and-upload-data">
<h5>Prepare and Upload Data<a class="headerlink" href="#prepare-and-upload-data" title="Permalink to this headline">¶</a></h5>
<p>As you can see the data contains a UserID, ItemID, Rating, and Timestamp.</p>
<p>We are now going to remove the items with low rankings, and remove the Rating column before we build our model.</p>
<p>Once done we will now save the file as a new CSV and then upload it to S3.</p>
<p>All of that is done by executing the lines in the cell below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;RATING&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">]</span>                <span class="c1"># Keep only movies rated higher than 3 out of 5.</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;USER_ID&#39;</span><span class="p">,</span> <span class="s1">&#39;ITEM_ID&#39;</span><span class="p">,</span> <span class="s1">&#39;TIMESTAMP&#39;</span><span class="p">]]</span> <span class="c1"># select columns that match the columns in the schema below</span>
<span class="n">data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">boto3</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">Bucket</span><span class="p">(</span><span class="n">bucket</span><span class="p">)</span><span class="o">.</span><span class="n">Object</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">upload_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="create-schema">
<h4>Create Schema<a class="headerlink" href="#create-schema" title="Permalink to this headline">¶</a></h4>
<p>A core component of how Personalize understands your data comes from the Schema that is defined below. This configuration tells the service how to digest the data provided via your CSV file. Note the columns and types align to what was in the file you created above.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">schema</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;record&quot;</span><span class="p">,</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Interactions&quot;</span><span class="p">,</span>
    <span class="s2">&quot;namespace&quot;</span><span class="p">:</span> <span class="s2">&quot;com.amazonaws.personalize.schema&quot;</span><span class="p">,</span>
    <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;USER_ID&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;ITEM_ID&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;TIMESTAMP&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;long&quot;</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0&quot;</span>
<span class="p">}</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">create_schema_response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">create_schema</span><span class="p">(</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;personalize-demo-schema&quot;</span><span class="p">,</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">schema_arn</span> <span class="o">=</span> <span class="n">create_schema_response</span><span class="p">[</span><span class="s1">&#39;schemaArn&#39;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">create_schema_response</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">schema_arn</span> <span class="o">=</span> <span class="s2">&quot;arn:aws:personalize:us-east-1:</span><span class="si">{}</span><span class="s2">:schema/personalize-demo-schema&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">aws_account_number</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Resource already exist with ARN :</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">schema_arn</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Resource already exist with ARN :arn:aws:personalize:us-east-1:284105231590:schema/personalize-demo-schema
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="create-and-wait-for-dataset-group">
<h4>Create and Wait for Dataset Group<a class="headerlink" href="#create-and-wait-for-dataset-group" title="Permalink to this headline">¶</a></h4>
<p>The largest grouping in Personalize is a Dataset Group, this will isolate your data, event trackers, solutions, and campaigns. Grouping things together that share a common collection of data. Feel free to alter the name below if you’d like.</p>
<div class="section" id="create-dataset-group">
<h5>Create Dataset Group<a class="headerlink" href="#create-dataset-group" title="Permalink to this headline">¶</a></h5>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">create_dataset_group_response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">create_dataset_group</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;personalize-launch-demo&quot;</span><span class="p">)</span>
    <span class="n">dataset_group_arn</span> <span class="o">=</span> <span class="n">create_dataset_group_response</span><span class="p">[</span><span class="s1">&#39;datasetGroupArn&#39;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">create_dataset_group_response</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">dataset_group_arn</span> <span class="o">=</span> <span class="s2">&quot;arn:aws:personalize:us-east-1:</span><span class="si">{}</span><span class="s2">:dataset-group/personalize-launch-demo&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">aws_account_number</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Resource already exist with ARN :</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dataset_group_arn</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
  &quot;datasetGroupArn&quot;: &quot;arn:aws:personalize:us-east-1:284105231590:dataset-group/personalize-launch-demo&quot;,
  &quot;ResponseMetadata&quot;: {
    &quot;RequestId&quot;: &quot;998c048b-22ba-42fc-bb58-c5c6d8c390b6&quot;,
    &quot;HTTPStatusCode&quot;: 200,
    &quot;HTTPHeaders&quot;: {
      &quot;content-type&quot;: &quot;application/x-amz-json-1.1&quot;,
      &quot;date&quot;: &quot;Sun, 20 Jun 2021 02:43:40 GMT&quot;,
      &quot;x-amzn-requestid&quot;: &quot;998c048b-22ba-42fc-bb58-c5c6d8c390b6&quot;,
      &quot;content-length&quot;: &quot;102&quot;,
      &quot;connection&quot;: &quot;keep-alive&quot;
    },
    &quot;RetryAttempts&quot;: 0
  }
}
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="wait-for-dataset-group-to-have-active-status">
<h5>Wait for Dataset Group to Have ACTIVE Status<a class="headerlink" href="#wait-for-dataset-group-to-have-active-status" title="Permalink to this headline">¶</a></h5>
<p>Before we can use the Dataset Group in any items below it must be active, execute the cell below and wait for it to show active.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">max_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span> <span class="c1"># 3 hours</span>
<span class="k">while</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">max_time</span><span class="p">:</span>
    <span class="n">describe_dataset_group_response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">describe_dataset_group</span><span class="p">(</span>
        <span class="n">datasetGroupArn</span> <span class="o">=</span> <span class="n">dataset_group_arn</span>
    <span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">describe_dataset_group_response</span><span class="p">[</span><span class="s2">&quot;datasetGroup&quot;</span><span class="p">][</span><span class="s2">&quot;status&quot;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DatasetGroup: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">status</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;ACTIVE&quot;</span> <span class="ow">or</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;CREATE FAILED&quot;</span><span class="p">:</span>
        <span class="k">break</span>
        
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DatasetGroup: ACTIVE
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="create-dataset">
<h5>Create Dataset<a class="headerlink" href="#create-dataset" title="Permalink to this headline">¶</a></h5>
<p>After the group, the next thing to create is the actual datasets, in this example we will only create 1 for the interactions data. Execute the cells below to create it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dataset_type</span> <span class="o">=</span> <span class="s2">&quot;INTERACTIONS&quot;</span>
<span class="n">create_dataset_response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;personalize-launch-interactions&quot;</span><span class="p">,</span>
    <span class="n">datasetType</span> <span class="o">=</span> <span class="n">dataset_type</span><span class="p">,</span>
    <span class="n">datasetGroupArn</span> <span class="o">=</span> <span class="n">dataset_group_arn</span><span class="p">,</span>
    <span class="n">schemaArn</span> <span class="o">=</span> <span class="n">schema_arn</span>
<span class="p">)</span>

<span class="n">dataset_arn</span> <span class="o">=</span> <span class="n">create_dataset_response</span><span class="p">[</span><span class="s1">&#39;datasetArn&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">create_dataset_response</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
  &quot;datasetArn&quot;: &quot;arn:aws:personalize:us-east-1:284105231590:dataset/personalize-launch-demo/INTERACTIONS&quot;,
  &quot;ResponseMetadata&quot;: {
    &quot;RequestId&quot;: &quot;7a6533d3-4358-4040-aa09-ce251236d3ff&quot;,
    &quot;HTTPStatusCode&quot;: 200,
    &quot;HTTPHeaders&quot;: {
      &quot;content-type&quot;: &quot;application/x-amz-json-1.1&quot;,
      &quot;date&quot;: &quot;Sun, 20 Jun 2021 02:45:56 GMT&quot;,
      &quot;x-amzn-requestid&quot;: &quot;7a6533d3-4358-4040-aa09-ce251236d3ff&quot;,
      &quot;content-length&quot;: &quot;104&quot;,
      &quot;connection&quot;: &quot;keep-alive&quot;
    },
    &quot;RetryAttempts&quot;: 0
  }
}
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="attach-policy-to-s3-bucket">
<h5>Attach Policy to S3 Bucket<a class="headerlink" href="#attach-policy-to-s3-bucket" title="Permalink to this headline">¶</a></h5>
<p>Amazon Personalize needs to be able to read the content of your S3 bucket that you created earlier. The lines below will do that.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">s3</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s2">&quot;s3&quot;</span><span class="p">)</span>

<span class="n">policy</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Version&quot;</span><span class="p">:</span> <span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Id&quot;</span><span class="p">:</span> <span class="s2">&quot;PersonalizeS3BucketAccessPolicy&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Statement&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;Sid&quot;</span><span class="p">:</span> <span class="s2">&quot;PersonalizeS3BucketAccessPolicy&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Effect&quot;</span><span class="p">:</span> <span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Principal&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;Service&quot;</span><span class="p">:</span> <span class="s2">&quot;personalize.amazonaws.com&quot;</span>
            <span class="p">},</span>
            <span class="s2">&quot;Action&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;s3:GetObject&quot;</span><span class="p">,</span>
                <span class="s2">&quot;s3:ListBucket&quot;</span>
            <span class="p">],</span>
            <span class="s2">&quot;Resource&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;arn:aws:s3:::</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bucket</span><span class="p">),</span>
                <span class="s2">&quot;arn:aws:s3:::</span><span class="si">{}</span><span class="s2">/*&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bucket</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>

<span class="n">s3</span><span class="o">.</span><span class="n">put_bucket_policy</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">,</span> <span class="n">Policy</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">policy</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;ResponseMetadata&#39;: {&#39;RequestId&#39;: &#39;V0GWAVB6A7MYM4H3&#39;,
  &#39;HostId&#39;: &#39;JKRdfmw/tDRvtC3jhfRi62TLCltQTxUUnTV8gQOzkf1cs+IGsxyvc06+wB4g92NUUnORjZEXWNs=&#39;,
  &#39;HTTPStatusCode&#39;: 204,
  &#39;HTTPHeaders&#39;: {&#39;x-amz-id-2&#39;: &#39;JKRdfmw/tDRvtC3jhfRi62TLCltQTxUUnTV8gQOzkf1cs+IGsxyvc06+wB4g92NUUnORjZEXWNs=&#39;,
   &#39;x-amz-request-id&#39;: &#39;V0GWAVB6A7MYM4H3&#39;,
   &#39;date&#39;: &#39;Sun, 20 Jun 2021 02:46:28 GMT&#39;,
   &#39;server&#39;: &#39;AmazonS3&#39;},
  &#39;RetryAttempts&#39;: 0}}
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="create-personalize-role">
<h5>Create Personalize Role<a class="headerlink" href="#create-personalize-role" title="Permalink to this headline">¶</a></h5>
<p>Also Amazon Personalize needs the ability to assume Roles in AWS in order to have the permissions to execute certain tasks, the lines below grant that.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">iam</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s2">&quot;iam&quot;</span><span class="p">)</span>

<span class="n">role_name</span> <span class="o">=</span> <span class="s2">&quot;PersonalizeRoleDemo&quot;</span>
<span class="n">assume_role_policy_document</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Version&quot;</span><span class="p">:</span> <span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Statement&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">&quot;Effect&quot;</span><span class="p">:</span> <span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Principal&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;Service&quot;</span><span class="p">:</span> <span class="s2">&quot;personalize.amazonaws.com&quot;</span>
          <span class="p">},</span>
          <span class="s2">&quot;Action&quot;</span><span class="p">:</span> <span class="s2">&quot;sts:AssumeRole&quot;</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>

<span class="n">create_role_response</span> <span class="o">=</span> <span class="n">iam</span><span class="o">.</span><span class="n">create_role</span><span class="p">(</span>
    <span class="n">RoleName</span> <span class="o">=</span> <span class="n">role_name</span><span class="p">,</span>
    <span class="n">AssumeRolePolicyDocument</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">assume_role_policy_document</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># AmazonPersonalizeFullAccess provides access to any S3 bucket with a name that includes &quot;personalize&quot; or &quot;Personalize&quot; </span>
<span class="c1"># if you would like to use a bucket with a different name, please consider creating and attaching a new policy</span>
<span class="c1"># that provides read access to your bucket or attaching the AmazonS3ReadOnlyAccess policy to the role</span>
<span class="n">policy_arn</span> <span class="o">=</span> <span class="s2">&quot;arn:aws:iam::aws:policy/service-role/AmazonPersonalizeFullAccess&quot;</span>
<span class="n">iam</span><span class="o">.</span><span class="n">attach_role_policy</span><span class="p">(</span>
    <span class="n">RoleName</span> <span class="o">=</span> <span class="n">role_name</span><span class="p">,</span>
    <span class="n">PolicyArn</span> <span class="o">=</span> <span class="n">policy_arn</span>
<span class="p">)</span>

<span class="c1"># Now add S3 support</span>
<span class="n">iam</span><span class="o">.</span><span class="n">attach_role_policy</span><span class="p">(</span>
    <span class="n">PolicyArn</span><span class="o">=</span><span class="s1">&#39;arn:aws:iam::aws:policy/AmazonS3FullAccess&#39;</span><span class="p">,</span>
    <span class="n">RoleName</span><span class="o">=</span><span class="n">role_name</span>
<span class="p">)</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span> <span class="c1"># wait for a minute to allow IAM role policy attachment to propagate</span>

<span class="n">role_arn</span> <span class="o">=</span> <span class="n">create_role_response</span><span class="p">[</span><span class="s2">&quot;Role&quot;</span><span class="p">][</span><span class="s2">&quot;Arn&quot;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">role_arn</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>arn:aws:iam::284105231590:role/PersonalizeRoleDemo
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="import-the-data">
<h3>Import the data<a class="headerlink" href="#import-the-data" title="Permalink to this headline">¶</a></h3>
<p>Earlier you created the DatasetGroup and Dataset to house your information, now you will execute an import job that will load the data from S3 into Amazon Personalize for usage building your model.</p>
<div class="section" id="create-dataset-import-job">
<h4>Create Dataset Import Job<a class="headerlink" href="#create-dataset-import-job" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">create_dataset_import_job_response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">create_dataset_import_job</span><span class="p">(</span>
    <span class="n">jobName</span> <span class="o">=</span> <span class="s2">&quot;personalize-demo-import1&quot;</span><span class="p">,</span>
    <span class="n">datasetArn</span> <span class="o">=</span> <span class="n">dataset_arn</span><span class="p">,</span>
    <span class="n">dataSource</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;dataLocation&quot;</span><span class="p">:</span> <span class="s2">&quot;s3://</span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
    <span class="p">},</span>
    <span class="n">roleArn</span> <span class="o">=</span> <span class="n">role_arn</span>
<span class="p">)</span>

<span class="n">dataset_import_job_arn</span> <span class="o">=</span> <span class="n">create_dataset_import_job_response</span><span class="p">[</span><span class="s1">&#39;datasetImportJobArn&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">create_dataset_import_job_response</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
  &quot;datasetImportJobArn&quot;: &quot;arn:aws:personalize:us-east-1:284105231590:dataset-import-job/personalize-demo-import1&quot;,
  &quot;ResponseMetadata&quot;: {
    &quot;RequestId&quot;: &quot;f766900d-2d98-4791-8788-3b4e4153e932&quot;,
    &quot;HTTPStatusCode&quot;: 200,
    &quot;HTTPHeaders&quot;: {
      &quot;content-type&quot;: &quot;application/x-amz-json-1.1&quot;,
      &quot;date&quot;: &quot;Sun, 20 Jun 2021 02:49:04 GMT&quot;,
      &quot;x-amzn-requestid&quot;: &quot;f766900d-2d98-4791-8788-3b4e4153e932&quot;,
      &quot;content-length&quot;: &quot;112&quot;,
      &quot;connection&quot;: &quot;keep-alive&quot;
    },
    &quot;RetryAttempts&quot;: 0
  }
}
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="wait-for-dataset-import-job-to-have-active-status">
<h4>Wait for Dataset Import Job to Have ACTIVE Status<a class="headerlink" href="#wait-for-dataset-import-job-to-have-active-status" title="Permalink to this headline">¶</a></h4>
<p>It can take a while before the import job completes, please wait until you see that it is active below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">max_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span> <span class="c1"># 3 hours</span>
<span class="k">while</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">max_time</span><span class="p">:</span>
    <span class="n">describe_dataset_import_job_response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">describe_dataset_import_job</span><span class="p">(</span>
        <span class="n">datasetImportJobArn</span> <span class="o">=</span> <span class="n">dataset_import_job_arn</span>
    <span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">describe_dataset_import_job_response</span><span class="p">[</span><span class="s2">&quot;datasetImportJob&quot;</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DatasetImportJob: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">status</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;ACTIVE&quot;</span> <span class="ow">or</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;CREATE FAILED&quot;</span><span class="p">:</span>
        <span class="k">break</span>
        
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DatasetImportJob: CREATE PENDING
DatasetImportJob: CREATE IN_PROGRESS
DatasetImportJob: CREATE IN_PROGRESS
DatasetImportJob: ACTIVE
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="create-the-solution-and-version">
<h3>Create the Solution and Version<a class="headerlink" href="#create-the-solution-and-version" title="Permalink to this headline">¶</a></h3>
<p>In Amazon Personalize a trained model is called a Solution, each Solution can have many specific versions that relate to a given volume of data when the model was trained.</p>
<p>To begin we will list all the recipies that are supported, a recipie is an algorithm that has not been trained on your data yet. After listing you’ll select one and use that to build your model.</p>
<div class="section" id="select-recipe">
<h4>Select Recipe<a class="headerlink" href="#select-recipe" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">list_recipes_response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">list_recipes</span><span class="p">()</span>
<span class="n">list_recipes_response</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;recipes&#39;: [{&#39;name&#39;: &#39;aws-hrnn&#39;,
   &#39;recipeArn&#39;: &#39;arn:aws:personalize:::recipe/aws-hrnn&#39;,
   &#39;status&#39;: &#39;ACTIVE&#39;,
   &#39;creationDateTime&#39;: datetime.datetime(2019, 6, 10, 0, 0, tzinfo=tzlocal()),
   &#39;lastUpdatedDateTime&#39;: datetime.datetime(2021, 2, 6, 19, 6, 40, 447000, tzinfo=tzlocal())},
  {&#39;name&#39;: &#39;aws-hrnn-coldstart&#39;,
   &#39;recipeArn&#39;: &#39;arn:aws:personalize:::recipe/aws-hrnn-coldstart&#39;,
   &#39;status&#39;: &#39;ACTIVE&#39;,
   &#39;creationDateTime&#39;: datetime.datetime(2019, 6, 10, 0, 0, tzinfo=tzlocal()),
   &#39;lastUpdatedDateTime&#39;: datetime.datetime(2021, 2, 6, 19, 6, 40, 447000, tzinfo=tzlocal())},
  {&#39;name&#39;: &#39;aws-hrnn-metadata&#39;,
   &#39;recipeArn&#39;: &#39;arn:aws:personalize:::recipe/aws-hrnn-metadata&#39;,
   &#39;status&#39;: &#39;ACTIVE&#39;,
   &#39;creationDateTime&#39;: datetime.datetime(2019, 6, 10, 0, 0, tzinfo=tzlocal()),
   &#39;lastUpdatedDateTime&#39;: datetime.datetime(2021, 2, 6, 19, 6, 40, 447000, tzinfo=tzlocal())},
  {&#39;name&#39;: &#39;aws-personalized-ranking&#39;,
   &#39;recipeArn&#39;: &#39;arn:aws:personalize:::recipe/aws-personalized-ranking&#39;,
   &#39;status&#39;: &#39;ACTIVE&#39;,
   &#39;creationDateTime&#39;: datetime.datetime(2019, 6, 10, 0, 0, tzinfo=tzlocal()),
   &#39;lastUpdatedDateTime&#39;: datetime.datetime(2021, 2, 6, 19, 6, 40, 447000, tzinfo=tzlocal())},
  {&#39;name&#39;: &#39;aws-popularity-count&#39;,
   &#39;recipeArn&#39;: &#39;arn:aws:personalize:::recipe/aws-popularity-count&#39;,
   &#39;status&#39;: &#39;ACTIVE&#39;,
   &#39;creationDateTime&#39;: datetime.datetime(2019, 6, 10, 0, 0, tzinfo=tzlocal()),
   &#39;lastUpdatedDateTime&#39;: datetime.datetime(2021, 2, 6, 19, 6, 40, 447000, tzinfo=tzlocal())},
  {&#39;name&#39;: &#39;aws-sims&#39;,
   &#39;recipeArn&#39;: &#39;arn:aws:personalize:::recipe/aws-sims&#39;,
   &#39;status&#39;: &#39;ACTIVE&#39;,
   &#39;creationDateTime&#39;: datetime.datetime(2019, 6, 10, 0, 0, tzinfo=tzlocal()),
   &#39;lastUpdatedDateTime&#39;: datetime.datetime(2021, 2, 6, 19, 6, 40, 447000, tzinfo=tzlocal())},
  {&#39;name&#39;: &#39;aws-user-personalization&#39;,
   &#39;recipeArn&#39;: &#39;arn:aws:personalize:::recipe/aws-user-personalization&#39;,
   &#39;status&#39;: &#39;ACTIVE&#39;,
   &#39;creationDateTime&#39;: datetime.datetime(2019, 6, 10, 0, 0, tzinfo=tzlocal()),
   &#39;lastUpdatedDateTime&#39;: datetime.datetime(2021, 2, 6, 19, 6, 40, 447000, tzinfo=tzlocal())}],
 &#39;ResponseMetadata&#39;: {&#39;RequestId&#39;: &#39;4a9fd177-5443-495c-abcf-3e3a50f7ae86&#39;,
  &#39;HTTPStatusCode&#39;: 200,
  &#39;HTTPHeaders&#39;: {&#39;content-type&#39;: &#39;application/x-amz-json-1.1&#39;,
   &#39;date&#39;: &#39;Sun, 20 Jun 2021 02:52:04 GMT&#39;,
   &#39;x-amzn-requestid&#39;: &#39;4a9fd177-5443-495c-abcf-3e3a50f7ae86&#39;,
   &#39;content-length&#39;: &#39;1259&#39;,
   &#39;connection&#39;: &#39;keep-alive&#39;},
  &#39;RetryAttempts&#39;: 0}}
</pre></div>
</div>
</div>
</div>
<div class="section" id="user-personalization">
<h5>User Personalization<a class="headerlink" href="#user-personalization" title="Permalink to this headline">¶</a></h5>
<p>The <a class="reference external" href="https://docs.aws.amazon.com/personalize/latest/dg/native-recipe-new-item-USER_PERSONALIZATION.html">User-Personalization</a> (aws-user-personalization) recipe is optimized for all USER_PERSONALIZATION recommendation scenarios. When recommending items, it uses automatic item exploration.</p>
<p>With automatic exploration, Amazon Personalize automatically tests different item recommendations, learns from how users interact with these recommended items, and boosts recommendations for items that drive better engagement and conversion. This improves item discovery and engagement when you have a fast-changing catalog, or when new items, such as news articles or promotions, are more relevant to users when fresh.</p>
<p>You can balance how much to explore (where items with less interactions data or relevance are recommended more frequently) against how much to exploit (where recommendations are based on what we know or relevance). Amazon Personalize automatically adjusts future recommendations based on implicit user feedback.</p>
<p>First, select the recipe by finding the ARN in the list of recipes above.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">recipe_arn</span> <span class="o">=</span> <span class="s2">&quot;arn:aws:personalize:::recipe/aws-user-personalization&quot;</span> <span class="c1"># aws-user-personalization selected for demo purposes</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="create-and-wait-for-solution">
<h4>Create and Wait for Solution<a class="headerlink" href="#create-and-wait-for-solution" title="Permalink to this headline">¶</a></h4>
<p>First you will create the solution with the API, then you will create a version. It will take several minutes to train the model and thus create your version of a solution. Once it gets started and you are seeing the in progress notifications it is a good time to take a break, grab a coffee, etc.</p>
<div class="section" id="create-solution">
<h5>Create Solution<a class="headerlink" href="#create-solution" title="Permalink to this headline">¶</a></h5>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">create_solution_response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">create_solution</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;personalize-demo-soln-user-personalization&quot;</span><span class="p">,</span>
    <span class="n">datasetGroupArn</span> <span class="o">=</span> <span class="n">dataset_group_arn</span><span class="p">,</span>
    <span class="n">recipeArn</span> <span class="o">=</span> <span class="n">recipe_arn</span>
<span class="p">)</span>

<span class="n">solution_arn</span> <span class="o">=</span> <span class="n">create_solution_response</span><span class="p">[</span><span class="s1">&#39;solutionArn&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">create_solution_response</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
  &quot;solutionArn&quot;: &quot;arn:aws:personalize:us-east-1:284105231590:solution/personalize-demo-soln-user-personalization&quot;,
  &quot;ResponseMetadata&quot;: {
    &quot;RequestId&quot;: &quot;4b7f984a-bd8a-4cd1-b7a5-6a9f578a577c&quot;,
    &quot;HTTPStatusCode&quot;: 200,
    &quot;HTTPHeaders&quot;: {
      &quot;content-type&quot;: &quot;application/x-amz-json-1.1&quot;,
      &quot;date&quot;: &quot;Sun, 20 Jun 2021 02:52:04 GMT&quot;,
      &quot;x-amzn-requestid&quot;: &quot;4b7f984a-bd8a-4cd1-b7a5-6a9f578a577c&quot;,
      &quot;content-length&quot;: &quot;112&quot;,
      &quot;connection&quot;: &quot;keep-alive&quot;
    },
    &quot;RetryAttempts&quot;: 0
  }
}
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="create-solution-version">
<h5>Create Solution Version<a class="headerlink" href="#create-solution-version" title="Permalink to this headline">¶</a></h5>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">create_solution_version_response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">create_solution_version</span><span class="p">(</span>
    <span class="n">solutionArn</span> <span class="o">=</span> <span class="n">solution_arn</span>
<span class="p">)</span>

<span class="n">solution_version_arn</span> <span class="o">=</span> <span class="n">create_solution_version_response</span><span class="p">[</span><span class="s1">&#39;solutionVersionArn&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">create_solution_version_response</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
  &quot;solutionVersionArn&quot;: &quot;arn:aws:personalize:us-east-1:284105231590:solution/personalize-demo-soln-user-personalization/c8dd176c&quot;,
  &quot;ResponseMetadata&quot;: {
    &quot;RequestId&quot;: &quot;2613b4c0-67f5-4186-8db3-27aeb17a326f&quot;,
    &quot;HTTPStatusCode&quot;: 200,
    &quot;HTTPHeaders&quot;: {
      &quot;content-type&quot;: &quot;application/x-amz-json-1.1&quot;,
      &quot;date&quot;: &quot;Sun, 20 Jun 2021 02:52:05 GMT&quot;,
      &quot;x-amzn-requestid&quot;: &quot;2613b4c0-67f5-4186-8db3-27aeb17a326f&quot;,
      &quot;content-length&quot;: &quot;128&quot;,
      &quot;connection&quot;: &quot;keep-alive&quot;
    },
    &quot;RetryAttempts&quot;: 0
  }
}
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="wait-for-solution-version-to-have-active-status">
<h5>Wait for Solution Version to Have ACTIVE Status<a class="headerlink" href="#wait-for-solution-version-to-have-active-status" title="Permalink to this headline">¶</a></h5>
<p>This will take approximately 40-50 minutes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">max_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span> <span class="c1"># 3 hours</span>
<span class="k">while</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">max_time</span><span class="p">:</span>
    <span class="n">describe_solution_version_response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">describe_solution_version</span><span class="p">(</span>
        <span class="n">solutionVersionArn</span> <span class="o">=</span> <span class="n">solution_version_arn</span>
    <span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">describe_solution_version_response</span><span class="p">[</span><span class="s2">&quot;solutionVersion&quot;</span><span class="p">][</span><span class="s2">&quot;status&quot;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SolutionVersion: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">status</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;ACTIVE&quot;</span> <span class="ow">or</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;CREATE FAILED&quot;</span><span class="p">:</span>
        <span class="k">break</span>
        
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SolutionVersion: ACTIVE
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="get-metrics-of-solution-version">
<h5>Get Metrics of Solution Version<a class="headerlink" href="#get-metrics-of-solution-version" title="Permalink to this headline">¶</a></h5>
<p>Now that your solution and version exists, you can obtain the metrics for it to judge its performance. These metrics are not particularly good as it is a demo set of data, but with larger more complex datasets you should see improvements.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">get_solution_metrics_response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">get_solution_metrics</span><span class="p">(</span>
    <span class="n">solutionVersionArn</span> <span class="o">=</span> <span class="n">solution_version_arn</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">get_solution_metrics_response</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
  &quot;solutionVersionArn&quot;: &quot;arn:aws:personalize:us-east-1:284105231590:solution/personalize-demo-soln-user-personalization/c8dd176c&quot;,
  &quot;metrics&quot;: {
    &quot;coverage&quot;: 0.3184,
    &quot;mean_reciprocal_rank_at_25&quot;: 0.1395,
    &quot;normalized_discounted_cumulative_gain_at_10&quot;: 0.174,
    &quot;normalized_discounted_cumulative_gain_at_25&quot;: 0.2434,
    &quot;normalized_discounted_cumulative_gain_at_5&quot;: 0.1339,
    &quot;precision_at_10&quot;: 0.0427,
    &quot;precision_at_25&quot;: 0.0342,
    &quot;precision_at_5&quot;: 0.0449
  },
  &quot;ResponseMetadata&quot;: {
    &quot;RequestId&quot;: &quot;31f4c894-2e81-400a-aa82-af6c459d0d24&quot;,
    &quot;HTTPStatusCode&quot;: 200,
    &quot;HTTPHeaders&quot;: {
      &quot;content-type&quot;: &quot;application/x-amz-json-1.1&quot;,
      &quot;date&quot;: &quot;Sun, 20 Jun 2021 03:42:46 GMT&quot;,
      &quot;x-amzn-requestid&quot;: &quot;31f4c894-2e81-400a-aa82-af6c459d0d24&quot;,
      &quot;content-length&quot;: &quot;425&quot;,
      &quot;connection&quot;: &quot;keep-alive&quot;
    },
    &quot;RetryAttempts&quot;: 0
  }
}
</pre></div>
</div>
</div>
</div>
<p>We recommend reading <a class="reference external" href="https://docs.aws.amazon.com/personalize/latest/dg/working-with-training-metrics.html">the documentation</a> to understand the metrics, but we have also copied parts of the documentation below for convenience.</p>
<p>You need to understand the following terms regarding evaluation in Personalize:</p>
<ul class="simple">
<li><p><em>Relevant recommendation</em> refers to a recommendation that matches a value in the testing data for the particular user.</p></li>
<li><p><em>Rank</em> refers to the position of a recommended item in the list of recommendations. Position 1 (the top of the list) is presumed to be the most relevant to the user.</p></li>
<li><p><em>Query</em> refers to the internal equivalent of a GetRecommendations call.</p></li>
</ul>
<p>The metrics produced by Personalize are:</p>
<ul class="simple">
<li><p>coverage: The proportion of unique recommended items from all queries out of the total number of unique items in the training data (includes both the Items and Interactions datasets).</p></li>
<li><p>mean_reciprocal_rank_at_25: The <a class="reference external" href="https://en.wikipedia.org/wiki/Mean_reciprocal_rank">mean of the reciprocal ranks</a> of the first relevant recommendation out of the top 25 recommendations over all queries. This metric is appropriate if you’re interested in the single highest ranked recommendation.</p></li>
<li><p>normalized_discounted_cumulative_gain_at_K: Discounted gain assumes that recommendations lower on a list of recommendations are less relevant than higher recommendations. Therefore, each recommendation is discounted (given a lower weight) by a factor dependent on its position. To produce the <a class="reference external" href="https://en.wikipedia.org/wiki/Discounted_cumulative_gain">cumulative discounted gain</a> (DCG) at K, each relevant discounted recommendation in the top K recommendations is summed together. The normalized discounted cumulative gain (NDCG) is the DCG divided by the ideal DCG such that NDCG is between 0 - 1. (The ideal DCG is where the top K recommendations are sorted by relevance.) Amazon Personalize uses a weighting factor of 1/log(1 + position), where the top of the list is position 1. This metric rewards relevant items that appear near the top of the list, because the top of a list usually draws more attention.</p></li>
<li><p>precision_at_K: The number of relevant recommendations out of the top K recommendations divided by K. This metric rewards precise recommendation of the relevant items.</p></li>
</ul>
</div>
</div>
</div>
<div class="section" id="create-and-wait-for-the-campaign">
<h3>Create and Wait for the Campaign<a class="headerlink" href="#create-and-wait-for-the-campaign" title="Permalink to this headline">¶</a></h3>
<p>Now that you have a working solution version you will need to create a campaign to use it with your applications. A campaign is a hosted solution version; an endpoint which you can query for recommendations. Pricing is set by estimating throughput capacity (requests from users for personalization per second). When deploying a campaign, you set a minimum transactions per second (TPS) value (<code class="docutils literal notranslate"><span class="pre">minProvisionedTPS</span></code>). This service, like many within AWS, will automatically scale based on demand, but if latency is critical, you may want to provision ahead for larger demand. For this demo, the minimum throughput threshold is set to 1. For more information, see the <a class="reference external" href="https://aws.amazon.com/personalize/pricing/">pricing</a> page.</p>
<p>As mentioned above, the user-personalization recipe used for our solution supports automatic exploration of “cold” items. You can control how much exploration is performed when creating your campaign. The <code class="docutils literal notranslate"><span class="pre">itemExplorationConfig</span></code> data type supports <code class="docutils literal notranslate"><span class="pre">explorationWeight</span></code> and <code class="docutils literal notranslate"><span class="pre">explorationItemAgeCutOff</span></code> parameters. Exploration weight determines how frequently recommendations include items with less interactions data or relevance. The closer the value is to 1.0, the more exploration. At zero, no exploration occurs and recommendations are based on current data (relevance). Exploration item age cut-off determines items to be explored based on time frame since latest interaction. Provide the maximum item age, in days since the latest interaction, to define the scope of item exploration. The larger the value, the more items are considered during exploration. For our campaign below, we’ll specify an exploration weight of 0.5.</p>
<div class="section" id="create-campaign">
<h4>Create Campaign<a class="headerlink" href="#create-campaign" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">create_campaign_response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">create_campaign</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;personalize-demo-camp&quot;</span><span class="p">,</span>
    <span class="n">solutionVersionArn</span> <span class="o">=</span> <span class="n">solution_version_arn</span><span class="p">,</span>
    <span class="n">minProvisionedTPS</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">campaignConfig</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;itemExplorationConfig&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;explorationWeight&quot;</span><span class="p">:</span> <span class="s2">&quot;0.5&quot;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="n">campaign_arn</span> <span class="o">=</span> <span class="n">create_campaign_response</span><span class="p">[</span><span class="s1">&#39;campaignArn&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">create_campaign_response</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
  &quot;campaignArn&quot;: &quot;arn:aws:personalize:us-east-1:284105231590:campaign/personalize-demo-camp&quot;,
  &quot;ResponseMetadata&quot;: {
    &quot;RequestId&quot;: &quot;6f9fbb78-aa32-40f0-9bbb-fef8ce90d612&quot;,
    &quot;HTTPStatusCode&quot;: 200,
    &quot;HTTPHeaders&quot;: {
      &quot;content-type&quot;: &quot;application/x-amz-json-1.1&quot;,
      &quot;date&quot;: &quot;Sun, 20 Jun 2021 03:43:29 GMT&quot;,
      &quot;x-amzn-requestid&quot;: &quot;6f9fbb78-aa32-40f0-9bbb-fef8ce90d612&quot;,
      &quot;content-length&quot;: &quot;91&quot;,
      &quot;connection&quot;: &quot;keep-alive&quot;
    },
    &quot;RetryAttempts&quot;: 0
  }
}
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="wait-for-campaign-to-have-active-status">
<h4>Wait for Campaign to Have ACTIVE Status<a class="headerlink" href="#wait-for-campaign-to-have-active-status" title="Permalink to this headline">¶</a></h4>
<p>This should take about 10 minutes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">max_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span> <span class="c1"># 3 hours</span>
<span class="k">while</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">max_time</span><span class="p">:</span>
    <span class="n">describe_campaign_response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">describe_campaign</span><span class="p">(</span>
        <span class="n">campaignArn</span> <span class="o">=</span> <span class="n">campaign_arn</span>
    <span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">describe_campaign_response</span><span class="p">[</span><span class="s2">&quot;campaign&quot;</span><span class="p">][</span><span class="s2">&quot;status&quot;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Campaign: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">status</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;ACTIVE&quot;</span> <span class="ow">or</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;CREATE FAILED&quot;</span><span class="p">:</span>
        <span class="k">break</span>
        
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Campaign: CREATE PENDING
Campaign: CREATE IN_PROGRESS
Campaign: CREATE IN_PROGRESS
Campaign: CREATE IN_PROGRESS
Campaign: CREATE IN_PROGRESS
Campaign: CREATE IN_PROGRESS
Campaign: CREATE IN_PROGRESS
Campaign: CREATE IN_PROGRESS
Campaign: CREATE IN_PROGRESS
Campaign: CREATE IN_PROGRESS
Campaign: ACTIVE
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="get-sample-recommendations">
<h3>Get Sample Recommendations<a class="headerlink" href="#get-sample-recommendations" title="Permalink to this headline">¶</a></h3>
<p>After the campaign is active you are ready to get recommendations. First we need to select a random user from the collection. Then we will create a few helper functions for getting movie information to show for recommendations instead of just IDs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># data = pd.read_csv(&#39;./ml-100k/u.data&#39;, sep=&#39;\t&#39;, names=[&#39;USER_ID&#39;, &#39;ITEM_ID&#39;, &#39;RATING&#39;, &#39;TIMESTAMP&#39;])</span>
<span class="c1"># data.head()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>USER_ID</th>
      <th>ITEM_ID</th>
      <th>RATING</th>
      <th>TIMESTAMP</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>196</td>
      <td>242</td>
      <td>3</td>
      <td>881250949</td>
    </tr>
    <tr>
      <th>1</th>
      <td>186</td>
      <td>302</td>
      <td>3</td>
      <td>891717742</td>
    </tr>
    <tr>
      <th>2</th>
      <td>22</td>
      <td>377</td>
      <td>1</td>
      <td>878887116</td>
    </tr>
    <tr>
      <th>3</th>
      <td>244</td>
      <td>51</td>
      <td>2</td>
      <td>880606923</td>
    </tr>
    <tr>
      <th>4</th>
      <td>166</td>
      <td>346</td>
      <td>1</td>
      <td>886397596</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Getting a random user:</span>
<span class="n">user_id</span><span class="p">,</span> <span class="n">item_id</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;USER: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">user_id</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>USER: 839
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># First load items into memory</span>
<span class="n">items</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./ml-100k/u.item&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;latin-1&#39;</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ITEM_ID&#39;</span><span class="p">,</span> <span class="s1">&#39;TITLE&#39;</span><span class="p">],</span> <span class="n">index_col</span><span class="o">=</span><span class="s1">&#39;ITEM_ID&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_movie_title</span><span class="p">(</span><span class="n">movie_id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes in an ID, returns a title</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">movie_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">movie_id</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
    <span class="k">return</span> <span class="n">items</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">movie_id</span><span class="p">][</span><span class="s1">&#39;TITLE&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="call-getrecommendations">
<h4>Call GetRecommendations<a class="headerlink" href="#call-getrecommendations" title="Permalink to this headline">¶</a></h4>
<p>Using the user that you obtained above, the lines below will get recommendations for you and return the list of movies that are recommended.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">get_recommendations_response</span> <span class="o">=</span> <span class="n">personalize_runtime</span><span class="o">.</span><span class="n">get_recommendations</span><span class="p">(</span>
    <span class="n">campaignArn</span> <span class="o">=</span> <span class="n">campaign_arn</span><span class="p">,</span>
    <span class="n">userId</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">user_id</span><span class="p">),</span>
<span class="p">)</span>
<span class="c1"># Update DF rendering</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_rows&#39;</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Recommendations for user: &quot;</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>

<span class="n">item_list</span> <span class="o">=</span> <span class="n">get_recommendations_response</span><span class="p">[</span><span class="s1">&#39;itemList&#39;</span><span class="p">]</span>

<span class="n">recommendation_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">item_list</span><span class="p">:</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">get_movie_title</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;itemId&#39;</span><span class="p">])</span>
    <span class="n">recommendation_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    
<span class="n">recommendations_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">recommendation_list</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;OriginalRecs&#39;</span><span class="p">])</span>
<span class="n">recommendations_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Recommendations for user:  839
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>OriginalRecs</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Schindler's List (1993)</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Pulp Fiction (1994)</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Usual Suspects, The (1995)</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Raiders of the Lost Ark (1981)</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Silence of the Lambs, The (1991)</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Casablanca (1942)</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Fugitive, The (1993)</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Shawshank Redemption, The (1994)</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Amadeus (1984)</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Braveheart (1995)</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Truth About Cats &amp; Dogs, The (1996)</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Sling Blade (1996)</td>
    </tr>
    <tr>
      <th>12</th>
      <td>One Flew Over the Cuckoo's Nest (1975)</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Aladdin (1992)</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Back to the Future (1985)</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Time to Kill, A (1996)</td>
    </tr>
    <tr>
      <th>16</th>
      <td>Seven (Se7en) (1995)</td>
    </tr>
    <tr>
      <th>17</th>
      <td>E.T. the Extra-Terrestrial (1982)</td>
    </tr>
    <tr>
      <th>18</th>
      <td>Princess Bride, The (1987)</td>
    </tr>
    <tr>
      <th>19</th>
      <td>Godfather, The (1972)</td>
    </tr>
    <tr>
      <th>20</th>
      <td>Sleepers (1996)</td>
    </tr>
    <tr>
      <th>21</th>
      <td>Long Kiss Goodnight, The (1996)</td>
    </tr>
    <tr>
      <th>22</th>
      <td>Monty Python and the Holy Grail (1974)</td>
    </tr>
    <tr>
      <th>23</th>
      <td>Willy Wonka and the Chocolate Factory (1971)</td>
    </tr>
    <tr>
      <th>24</th>
      <td>GoodFellas (1990)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
</div>
<div class="section" id="review">
<h3>Review<a class="headerlink" href="#review" title="Permalink to this headline">¶</a></h3>
<p>Using the codes above you have successfully trained a deep learning model to generate movie recommendations based on prior user behavior. Think about other types of problems where this data is available and what it might look like to build a system like this to offer those recommendations.</p>
<p>Now you are ready to move onto the next notebook.</p>
</div>
<div class="section" id="notes-for-the-next-notebook">
<h3>Notes for the Next Notebook:<a class="headerlink" href="#notes-for-the-next-notebook" title="Permalink to this headline">¶</a></h3>
<p>There are a few values you will need for the next notebook, execute the cells below to store them so they can be copied and pasted into the next part of the exercise.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">store</span> <span class="n">campaign_arn</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Stored &#39;campaign_arn&#39; (str)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">store</span> <span class="n">dataset_group_arn</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Stored &#39;dataset_group_arn&#39; (str)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">store</span> <span class="n">solution_version_arn</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Stored &#39;solution_version_arn&#39; (str)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">store</span> <span class="n">solution_arn</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Stored &#39;solution_arn&#39; (str)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">store</span> <span class="n">dataset_arn</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Stored &#39;dataset_arn&#39; (str)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">store</span> <span class="n">campaign_arn</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Stored &#39;campaign_arn&#39; (str)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">store</span> <span class="n">schema_arn</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Stored &#39;schema_arn&#39; (str)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">store</span> <span class="n">bucket</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Stored &#39;bucket&#39; (str)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">store</span> <span class="n">filename</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Stored &#39;filename&#39; (str)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">store</span> <span class="n">role_name</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Stored &#39;role_name&#39; (str)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">store</span> <span class="n">recommendations_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Stored &#39;recommendations_df&#39; (DataFrame)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">store</span> <span class="n">user_id</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Stored &#39;user_id&#39; (int64)
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="part-2-view-campaign-and-interactions">
<h2>Part 2 - View Campaign and Interactions<a class="headerlink" href="#part-2-view-campaign-and-interactions" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>In the first part, you successfully built and deployed a recommendation model using deep learning with Amazon Personalize. This notebook will expand on that and will walk you through adding the ability to react to real time behavior of users. If their intent changes while browsing a movie, you will see revised recommendations based on that behavior. It will also showcase demo code for simulating user behavior selecting movies before the recommendations are returned.</p>
</div></blockquote>
<p>Below we start with just importing libraries that we need to interact with Personalize</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Imports</span>
<span class="kn">import</span> <span class="nn">boto3</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">uuid</span>
</pre></div>
</div>
</div>
</div>
<p>The line below will retrieve your shared variables from the first notebook.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">store</span> <span class="o">-</span><span class="n">r</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup and Config</span>
<span class="c1"># Recommendations from Event data</span>
<span class="n">personalize</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;personalize&#39;</span><span class="p">)</span>
<span class="n">personalize_runtime</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;personalize-runtime&#39;</span><span class="p">)</span>

<span class="c1"># Establish a connection to Personalize&#39;s Event Streaming</span>
<span class="n">personalize_events</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="n">service_name</span><span class="o">=</span><span class="s1">&#39;personalize-events&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="creating-an-event-tracker">
<h3>Creating an Event Tracker<a class="headerlink" href="#creating-an-event-tracker" title="Permalink to this headline">¶</a></h3>
<p>Before your recommendation system can respond to real time events you will need an event tracker, the code below will generate one and can be used going forward with this lab. Feel free to name it something more clever.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">create_event_tracker</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;MovieClickTracker&#39;</span><span class="p">,</span>
    <span class="n">datasetGroupArn</span><span class="o">=</span><span class="n">dataset_group_arn</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;eventTrackerArn&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;trackingId&#39;</span><span class="p">])</span>
<span class="n">TRACKING_ID</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;trackingId&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>arn:aws:personalize:us-east-1:284105231590:event-tracker/a1b7dce4
f252168d-a73d-467a-b2e7-66071f5d6d78
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">event_tracker_arn</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;eventTrackerArn&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="configuring-source-data">
<h3>Configuring Source Data<a class="headerlink" href="#configuring-source-data" title="Permalink to this headline">¶</a></h3>
<p>Above you’ll see your tracking ID and this has been assigned to a variable so no further action is needed by you. The lines below are going to setup the data used for recommendations so you can render the list of movies later.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># First load items into memory</span>
<span class="n">items</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./ml-100k/u.item&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;latin-1&#39;</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ITEM_ID&#39;</span><span class="p">,</span> <span class="s1">&#39;TITLE&#39;</span><span class="p">],</span> <span class="n">index_col</span><span class="o">=</span><span class="s1">&#39;ITEM_ID&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_movie_title</span><span class="p">(</span><span class="n">movie_id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes in an ID, returns a title</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">movie_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">movie_id</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
    <span class="k">return</span> <span class="n">items</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">movie_id</span><span class="p">][</span><span class="s1">&#39;TITLE&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="getting-recommendations">
<h3>Getting Recommendations<a class="headerlink" href="#getting-recommendations" title="Permalink to this headline">¶</a></h3>
<p>First we will render the recommendations again from the previous notebook:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">recommendations_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>OriginalRecs</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Schindler's List (1993)</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Pulp Fiction (1994)</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Usual Suspects, The (1995)</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Raiders of the Lost Ark (1981)</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Silence of the Lambs, The (1991)</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Casablanca (1942)</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Fugitive, The (1993)</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Shawshank Redemption, The (1994)</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Amadeus (1984)</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Braveheart (1995)</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Truth About Cats &amp; Dogs, The (1996)</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Sling Blade (1996)</td>
    </tr>
    <tr>
      <th>12</th>
      <td>One Flew Over the Cuckoo's Nest (1975)</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Aladdin (1992)</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Back to the Future (1985)</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Time to Kill, A (1996)</td>
    </tr>
    <tr>
      <th>16</th>
      <td>Seven (Se7en) (1995)</td>
    </tr>
    <tr>
      <th>17</th>
      <td>E.T. the Extra-Terrestrial (1982)</td>
    </tr>
    <tr>
      <th>18</th>
      <td>Princess Bride, The (1987)</td>
    </tr>
    <tr>
      <th>19</th>
      <td>Godfather, The (1972)</td>
    </tr>
    <tr>
      <th>20</th>
      <td>Sleepers (1996)</td>
    </tr>
    <tr>
      <th>21</th>
      <td>Long Kiss Goodnight, The (1996)</td>
    </tr>
    <tr>
      <th>22</th>
      <td>Monty Python and the Holy Grail (1974)</td>
    </tr>
    <tr>
      <th>23</th>
      <td>Willy Wonka and the Chocolate Factory (1971)</td>
    </tr>
    <tr>
      <th>24</th>
      <td>GoodFellas (1990)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="simulating-user-behavior">
<h3>Simulating User Behavior<a class="headerlink" href="#simulating-user-behavior" title="Permalink to this headline">¶</a></h3>
<p>The lines below provide a code sample that simulates a user interacting with a particular item, you will then get recommendations that differ from those when you started.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">session_dict</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">send_movie_click</span><span class="p">(</span><span class="n">USER_ID</span><span class="p">,</span> <span class="n">ITEM_ID</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simulates a click as an event</span>
<span class="sd">    to send an event to Amazon Personalize&#39;s Event Tracker</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Configure Session</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">session_ID</span> <span class="o">=</span> <span class="n">session_dict</span><span class="p">[</span><span class="n">USER_ID</span><span class="p">]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">session_dict</span><span class="p">[</span><span class="n">USER_ID</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid1</span><span class="p">())</span>
        <span class="n">session_ID</span> <span class="o">=</span> <span class="n">session_dict</span><span class="p">[</span><span class="n">USER_ID</span><span class="p">]</span>
        
    <span class="c1"># Configure Properties:</span>
    <span class="n">event</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;itemId&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">ITEM_ID</span><span class="p">),</span>
    <span class="p">}</span>
    <span class="n">event_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        
    <span class="c1"># Make Call</span>
    <span class="n">personalize_events</span><span class="o">.</span><span class="n">put_events</span><span class="p">(</span>
    <span class="n">trackingId</span> <span class="o">=</span> <span class="n">TRACKING_ID</span><span class="p">,</span>
    <span class="n">userId</span><span class="o">=</span> <span class="n">USER_ID</span><span class="p">,</span>
    <span class="n">sessionId</span> <span class="o">=</span> <span class="n">session_ID</span><span class="p">,</span>
    <span class="n">eventList</span> <span class="o">=</span> <span class="p">[{</span>
        <span class="s1">&#39;sentAt&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()),</span>
        <span class="s1">&#39;eventType&#39;</span><span class="p">:</span> <span class="s1">&#39;EVENT_TYPE&#39;</span><span class="p">,</span>
        <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="n">event_json</span>
        <span class="p">}]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Immediately below this line will update the tracker as if the user has clicked a particular title.</p>
<p>If the table generated by the cells below does not shift the recommendations simply try another random 3 digit number in the cell above and run both cells again. You’ll see a third column generated of recommendations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Pick a movie, we will use ID 270 or Gattaca</span>
<span class="n">movie_to_click</span> <span class="o">=</span> <span class="mi">270</span>
<span class="n">movie_title_clicked</span> <span class="o">=</span> <span class="n">get_movie_title</span><span class="p">(</span><span class="n">movie_to_click</span><span class="p">)</span>
<span class="n">send_movie_click</span><span class="p">(</span><span class="n">USER_ID</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">user_id</span><span class="p">),</span> <span class="n">ITEM_ID</span><span class="o">=</span><span class="n">movie_to_click</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>After executing this block you will see the alterations in the recommendations now that you have event tracking enabled and that you have sent the events to the service.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">get_recommendations_response</span> <span class="o">=</span> <span class="n">personalize_runtime</span><span class="o">.</span><span class="n">get_recommendations</span><span class="p">(</span>
    <span class="n">campaignArn</span> <span class="o">=</span> <span class="n">campaign_arn</span><span class="p">,</span>
    <span class="n">userId</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">user_id</span><span class="p">),</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Recommendations for user: &quot;</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>

<span class="n">item_list</span> <span class="o">=</span> <span class="n">get_recommendations_response</span><span class="p">[</span><span class="s1">&#39;itemList&#39;</span><span class="p">]</span>

<span class="n">recommendation_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">item_list</span><span class="p">:</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">get_movie_title</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;itemId&#39;</span><span class="p">])</span>
    <span class="n">recommendation_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    
<span class="n">new_rec_DF</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">recommendation_list</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">movie_title_clicked</span><span class="p">])</span>

<span class="n">recommendations_df</span> <span class="o">=</span> <span class="n">recommendations_df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">new_rec_DF</span><span class="p">)</span>
<span class="n">recommendations_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Recommendations for user:  839
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>OriginalRecs</th>
      <th>Full Monty, The (1997)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Schindler's List (1993)</td>
      <td>Professional, The (1994)</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Pulp Fiction (1994)</td>
      <td>unknown</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Usual Suspects, The (1995)</td>
      <td>Amistad (1997)</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Raiders of the Lost Ark (1981)</td>
      <td>Chasing Amy (1997)</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Silence of the Lambs, The (1991)</td>
      <td>Muppet Treasure Island (1996)</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Casablanca (1942)</td>
      <td>Empire Strikes Back, The (1980)</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Fugitive, The (1993)</td>
      <td>River Wild, The (1994)</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Shawshank Redemption, The (1994)</td>
      <td>Midnight in the Garden of Good and Evil (1997)</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Amadeus (1984)</td>
      <td>Last of the Mohicans, The (1992)</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Braveheart (1995)</td>
      <td>Marvin's Room (1996)</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Truth About Cats &amp; Dogs, The (1996)</td>
      <td>Seven (Se7en) (1995)</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Sling Blade (1996)</td>
      <td>Spitfire Grill, The (1996)</td>
    </tr>
    <tr>
      <th>12</th>
      <td>One Flew Over the Cuckoo's Nest (1975)</td>
      <td>Citizen Ruth (1996)</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Aladdin (1992)</td>
      <td>Hoodlum (1997)</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Back to the Future (1985)</td>
      <td>Henry V (1989)</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Time to Kill, A (1996)</td>
      <td>I.Q. (1994)</td>
    </tr>
    <tr>
      <th>16</th>
      <td>Seven (Se7en) (1995)</td>
      <td>Dr. Strangelove or: How I Learned to Stop Worr...</td>
    </tr>
    <tr>
      <th>17</th>
      <td>E.T. the Extra-Terrestrial (1982)</td>
      <td>Starship Troopers (1997)</td>
    </tr>
    <tr>
      <th>18</th>
      <td>Princess Bride, The (1987)</td>
      <td>Santa Clause, The (1994)</td>
    </tr>
    <tr>
      <th>19</th>
      <td>Godfather, The (1972)</td>
      <td>Ref, The (1994)</td>
    </tr>
    <tr>
      <th>20</th>
      <td>Sleepers (1996)</td>
      <td>Apocalypse Now (1979)</td>
    </tr>
    <tr>
      <th>21</th>
      <td>Long Kiss Goodnight, The (1996)</td>
      <td>Star Trek: First Contact (1996)</td>
    </tr>
    <tr>
      <th>22</th>
      <td>Monty Python and the Holy Grail (1974)</td>
      <td>Free Willy (1993)</td>
    </tr>
    <tr>
      <th>23</th>
      <td>Willy Wonka and the Chocolate Factory (1971)</td>
      <td>Princess Bride, The (1987)</td>
    </tr>
    <tr>
      <th>24</th>
      <td>GoodFellas (1990)</td>
      <td>Shanghai Triad (Yao a yao yao dao waipo qiao) ...</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="conclusion">
<h3>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h3>
<p>You can see now that recommendations are altered by changing the movie that a user interacts with, this system can be modified to any application where users are interacting with a collection of items. These tools are available at any time to pull down and start exploring what is possible with the data you have.</p>
<p>Execute the cell below to store values needed for the cleanup notebook.</p>
<p>Finally when you are ready to remove the items from your account, open the <code class="docutils literal notranslate"><span class="pre">Cleanup.ipynb</span></code> notebook and execute the steps there.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">store</span> <span class="n">event_tracker_arn</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Stored &#39;event_tracker_arn&#39; (str)
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="part-3-cleanup-the-resources">
<h2>Part 3 - Cleanup the resources<a class="headerlink" href="#part-3-cleanup-the-resources" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>After building your model you may want to delete your campaign, solutions, and datasets.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Imports</span>
<span class="kn">import</span> <span class="nn">boto3</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">time</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Configure the SDK to Personalize:</span>
<span class="n">personalize</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;personalize&#39;</span><span class="p">)</span>
<span class="n">personalize_runtime</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;personalize-runtime&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="defining-the-things-to-cleanup">
<h3>Defining the Things to Cleanup<a class="headerlink" href="#defining-the-things-to-cleanup" title="Permalink to this headline">¶</a></h3>
<p>Using the store command we will retrieve all the values needed to cleanup our work.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">store</span> <span class="o">-</span><span class="n">r</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Delete the campaign:</span>
<span class="n">personalize</span><span class="o">.</span><span class="n">delete_campaign</span><span class="p">(</span><span class="n">campaignArn</span><span class="o">=</span><span class="n">campaign_arn</span><span class="p">)</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Delete the solution</span>
<span class="n">personalize</span><span class="o">.</span><span class="n">delete_solution</span><span class="p">(</span><span class="n">solutionArn</span><span class="o">=</span><span class="n">solution_arn</span><span class="p">)</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Delete the event tracker</span>
<span class="n">personalize</span><span class="o">.</span><span class="n">delete_event_tracker</span><span class="p">(</span><span class="n">eventTrackerArn</span><span class="o">=</span><span class="n">event_tracker_arn</span><span class="p">)</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Delete the interaction dataset</span>
<span class="n">personalize</span><span class="o">.</span><span class="n">delete_dataset</span><span class="p">(</span><span class="n">datasetArn</span><span class="o">=</span><span class="n">dataset_arn</span><span class="p">)</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Delete the event dataset</span>
<span class="n">event_interactions_dataset_arn</span> <span class="o">=</span> <span class="n">dataset_arn</span>
<span class="n">event_interactions_dataset_arn</span> <span class="o">=</span> <span class="n">event_interactions_dataset_arn</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;INTERACTIONS&quot;</span><span class="p">,</span> <span class="s2">&quot;EVENT_INTERACTIONS&quot;</span><span class="p">)</span>
<span class="n">personalize</span><span class="o">.</span><span class="n">delete_dataset</span><span class="p">(</span><span class="n">datasetArn</span><span class="o">=</span><span class="n">event_interactions_dataset_arn</span><span class="p">)</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Delete the schema</span>
<span class="n">personalize</span><span class="o">.</span><span class="n">delete_schema</span><span class="p">(</span><span class="n">schemaArn</span><span class="o">=</span><span class="n">schema_arn</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="empty-your-s3-bucket">
<h3>Empty Your S3 Bucket<a class="headerlink" href="#empty-your-s3-bucket" title="Permalink to this headline">¶</a></h3>
<p>Next empty your S3 bucket, you uploaded a movie file to it in the first notebook.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">boto3</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">Bucket</span><span class="p">(</span><span class="n">bucket</span><span class="p">)</span><span class="o">.</span><span class="n">Object</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="iam-policy-cleanup">
<h3>IAM Policy Cleanup<a class="headerlink" href="#iam-policy-cleanup" title="Permalink to this headline">¶</a></h3>
<p>The very last step in the notebooks is to remove the policies that were attached to a role and then to delete it. No changes should need to be made here, just execute the cell.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># IAM policies should also be removed</span>
<span class="n">iam</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s2">&quot;iam&quot;</span><span class="p">)</span>
<span class="n">iam</span><span class="o">.</span><span class="n">detach_role_policy</span><span class="p">(</span><span class="n">PolicyArn</span><span class="o">=</span><span class="s2">&quot;arn:aws:iam::aws:policy/AmazonS3FullAccess&quot;</span><span class="p">,</span> <span class="n">RoleName</span><span class="o">=</span><span class="n">role_name</span><span class="p">)</span>
<span class="n">iam</span><span class="o">.</span><span class="n">detach_role_policy</span><span class="p">(</span><span class="n">PolicyArn</span><span class="o">=</span><span class="s2">&quot;arn:aws:iam::aws:policy/service-role/AmazonPersonalizeFullAccess&quot;</span><span class="p">,</span><span class="n">RoleName</span><span class="o">=</span><span class="n">role_name</span><span class="p">)</span>

<span class="n">iam</span><span class="o">.</span><span class="n">delete_role</span><span class="p">(</span><span class="n">RoleName</span><span class="o">=</span><span class="n">role_name</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="last-step">
<h4>Last Step<a class="headerlink" href="#last-step" title="Permalink to this headline">¶</a></h4>
<p>After cleaning up all of the resources you can now close this window and go back to the github page you stareted on. At the bottom of the Readme file are steps to delete the CloudFormation stack you created earlier. Once that is done you are 100% done with the lab.</p>
<p>Congratulations!</p>
</div>
</div>
</div>
<div class="section" id="part-4-security-best-practices-optional">
<h2>Part 4 - Security best practices (optional)<a class="headerlink" href="#part-4-security-best-practices-optional" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>We are using a pre-made dataset that hasn’t been encrypted so there is no need to decrypt this dataset. However, it would be a good security practice to store your datasets encrypted.</p>
</div></blockquote>
<div class="section" id="get-the-personalize-boto3-client">
<h3>Get the Personalize boto3 Client<a class="headerlink" href="#get-the-personalize-boto3-client" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">boto3</span>

<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">personalize</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;personalize&#39;</span><span class="p">)</span>
<span class="n">personalize_runtime</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;personalize-runtime&#39;</span><span class="p">)</span>
<span class="n">iam</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s2">&quot;iam&quot;</span><span class="p">)</span>
<span class="n">s3</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s2">&quot;s3&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id1">
<h3>Specify a Bucket and Data Output Location<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bucket</span> <span class="o">=</span> <span class="s2">&quot;personalize-demo&quot;</span>       <span class="c1"># replace with the name of your S3 bucket</span>
<span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;movie-lens-100k.csv&quot;</span>  <span class="c1"># replace with a name that you want to save the dataset under</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id2">
<h3>Download, Prepare, and Upload Training Data<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id3">
<h4>Download and Explore the Dataset<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!wget -N http://files.grouplens.org/datasets/movielens/ml-100k.zip
!unzip -o ml-100k.zip
data = pd.read_csv(&#39;./ml-100k/u.data&#39;, sep=&#39;\t&#39;, names=[&#39;USER_ID&#39;, &#39;ITEM_ID&#39;, &#39;RATING&#39;, &#39;TIMESTAMP&#39;])
pd.set_option(&#39;display.max_rows&#39;, 5)
data
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--2020-05-05 09:38:29--  http://files.grouplens.org/datasets/movielens/ml-100k.zip
Resolving files.grouplens.org (files.grouplens.org)... 128.101.65.152
Connecting to files.grouplens.org (files.grouplens.org)|128.101.65.152|:80... connected.
HTTP request sent, awaiting response... 304 Not Modified
File ‘ml-100k.zip’ not modified on server. Omitting download.

Archive:  ml-100k.zip
  inflating: ml-100k/allbut.pl       
  inflating: ml-100k/mku.sh          
  inflating: ml-100k/README          
  inflating: ml-100k/u.data          
  inflating: ml-100k/u.genre         
  inflating: ml-100k/u.info          
  inflating: ml-100k/u.item          
  inflating: ml-100k/u.occupation    
  inflating: ml-100k/u.user          
  inflating: ml-100k/u1.base         
  inflating: ml-100k/u1.test         
  inflating: ml-100k/u2.base         
  inflating: ml-100k/u2.test         
  inflating: ml-100k/u3.base         
  inflating: ml-100k/u3.test         
  inflating: ml-100k/u4.base         
  inflating: ml-100k/u4.test         
  inflating: ml-100k/u5.base         
  inflating: ml-100k/u5.test         
  inflating: ml-100k/ua.base         
  inflating: ml-100k/ua.test         
  inflating: ml-100k/ub.base         
  inflating: ml-100k/ub.test         
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>USER_ID</th>
      <th>ITEM_ID</th>
      <th>RATING</th>
      <th>TIMESTAMP</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>196</td>
      <td>242</td>
      <td>3</td>
      <td>881250949</td>
    </tr>
    <tr>
      <th>1</th>
      <td>186</td>
      <td>302</td>
      <td>3</td>
      <td>891717742</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>99998</th>
      <td>13</td>
      <td>225</td>
      <td>2</td>
      <td>882399156</td>
    </tr>
    <tr>
      <th>99999</th>
      <td>12</td>
      <td>203</td>
      <td>3</td>
      <td>879959583</td>
    </tr>
  </tbody>
</table>
<p>100000 rows × 4 columns</p>
</div></div></div>
</div>
</div>
<div class="section" id="optional-security-practice-protect-data-at-rest-encrypt-decrypt-your-dataset">
<h4>Optional security practice: Protect data at rest - Encrypt/decrypt your dataset<a class="headerlink" href="#optional-security-practice-protect-data-at-rest-encrypt-decrypt-your-dataset" title="Permalink to this headline">¶</a></h4>
<p>We are using a pre-made dataset that hasn’t been encrypted so there is no need to decrypt this dataset. However, it would be a good security practice to store your datasets encrypted.</p>
<p>For more information on encrypting your data when using S3, visit <a class="reference external" href="https://docs.aws.amazon.com/AmazonS3/latest/dev/KMSUsingRESTAPI.html">https://docs.aws.amazon.com/AmazonS3/latest/dev/KMSUsingRESTAPI.html</a></p>
</div>
<div class="section" id="optional-security-practice-protect-data-in-transit-ssl-access-only-for-s3-bucket">
<h4>Optional security practice: Protect data in transit - SSL access only for S3 bucket<a class="headerlink" href="#optional-security-practice-protect-data-in-transit-ssl-access-only-for-s3-bucket" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">requires_ssl_access_policy</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Version&quot;</span><span class="p">:</span> <span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Id&quot;</span><span class="p">:</span> <span class="s2">&quot;RequireSSLAccess&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Statement&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;Sid&quot;</span><span class="p">:</span> <span class="s2">&quot;RequireSSLAccess&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Effect&quot;</span><span class="p">:</span> <span class="s2">&quot;Deny&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Principal&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Action&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Resource&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;arn:aws:s3:::</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bucket</span><span class="p">),</span>
                <span class="s2">&quot;arn:aws:s3:::</span><span class="si">{}</span><span class="s2">/*&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bucket</span><span class="p">)</span>
            <span class="p">],</span>
            <span class="s2">&quot;Condition&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;Bool&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;aws:SecureTransport&quot;</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>

<span class="n">s3</span><span class="o">.</span><span class="n">put_bucket_policy</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">,</span> <span class="n">Policy</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">requires_ssl_access_policy</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;ResponseMetadata&#39;: {&#39;RequestId&#39;: &#39;FA2BA6A24A738415&#39;,
  &#39;HostId&#39;: &#39;PWU2HsPCLALBFzYHzVEUK5EuODQkMTrj2l9IuCs3x+GBDlM24tg2k4BF1fMlnmzCAwy/KRVplQw=&#39;,
  &#39;HTTPStatusCode&#39;: 204,
  &#39;HTTPHeaders&#39;: {&#39;x-amz-id-2&#39;: &#39;PWU2HsPCLALBFzYHzVEUK5EuODQkMTrj2l9IuCs3x+GBDlM24tg2k4BF1fMlnmzCAwy/KRVplQw=&#39;,
   &#39;x-amz-request-id&#39;: &#39;FA2BA6A24A738415&#39;,
   &#39;date&#39;: &#39;Tue, 05 May 2020 16:38:34 GMT&#39;,
   &#39;server&#39;: &#39;AmazonS3&#39;},
  &#39;RetryAttempts&#39;: 0}}
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="additional-security-note">
<h4>Additional security note:<a class="headerlink" href="#additional-security-note" title="Permalink to this headline">¶</a></h4>
<p>Some users prevent accidental information disclosure by limiting S3 access to only come from a VPC. Another common security practice is to validate this limited access. It should be noted that this security check will fail when performed against S3 buckets used for Personalize - as Personalize copies data from the user’s S3 into the internal systems used by Personalize (during dataset import jobs).</p>
</div>
<div class="section" id="optional-security-practice-validate-bucket-owner-matches-your-account-canonical-id">
<h4>Optional security practice: validate bucket owner matches your account canonical id<a class="headerlink" href="#optional-security-practice-validate-bucket-owner-matches-your-account-canonical-id" title="Permalink to this headline">¶</a></h4>
<p><a class="reference external" href="https://docs.aws.amazon.com/general/latest/gr/acct-identifiers.html#FindingCanonicalId">More information about canonical ids here</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bucket_owner_id</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_bucket_acl</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">)[</span><span class="s1">&#39;Owner&#39;</span><span class="p">][</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This bucket belongs to: </span><span class="si">{}</span><span class="s2"> &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bucket_owner_id</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>This bucket belongs to: 28398dc6b1acac01a4a73b246b5f9c9a688f50b9ce70240f74c0f90ebf5e2c61 
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="optional-security-practice-protect-data-integrity-enable-s3-bucket-versioning">
<h4>Optional security practice: Protect data integrity - Enable S3 bucket versioning<a class="headerlink" href="#optional-security-practice-protect-data-integrity-enable-s3-bucket-versioning" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">s3_resource</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">)</span>
<span class="n">bucket_versioning</span> <span class="o">=</span> <span class="n">s3_resource</span><span class="o">.</span><span class="n">BucketVersioning</span><span class="p">(</span><span class="n">bucket</span><span class="p">)</span>
<span class="n">bucket_versioning</span><span class="o">.</span><span class="n">enable</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;ResponseMetadata&#39;: {&#39;RequestId&#39;: &#39;4C3AA32EF96CA240&#39;,
  &#39;HostId&#39;: &#39;HQaKmMvUTbXTRsxLL/9BubrfD09xisEO8x72cpQP0syhAH9dXKRx7gqmzchq3TbERdwprUKcRmQ=&#39;,
  &#39;HTTPStatusCode&#39;: 200,
  &#39;HTTPHeaders&#39;: {&#39;x-amz-id-2&#39;: &#39;HQaKmMvUTbXTRsxLL/9BubrfD09xisEO8x72cpQP0syhAH9dXKRx7gqmzchq3TbERdwprUKcRmQ=&#39;,
   &#39;x-amz-request-id&#39;: &#39;4C3AA32EF96CA240&#39;,
   &#39;date&#39;: &#39;Mon, 04 May 2020 20:46:23 GMT&#39;,
   &#39;content-length&#39;: &#39;0&#39;,
   &#39;server&#39;: &#39;AmazonS3&#39;},
  &#39;RetryAttempts&#39;: 0}}
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id4">
<h4>Prepare and Upload Data<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;RATING&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">3.6</span><span class="p">]</span>                <span class="c1"># keep only movies rated 3.6 and above</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[[</span><span class="s1">&#39;USER_ID&#39;</span><span class="p">,</span> <span class="s1">&#39;ITEM_ID&#39;</span><span class="p">,</span> <span class="s1">&#39;TIMESTAMP&#39;</span><span class="p">]]</span> <span class="c1"># select columns that match the columns in the schema below</span>
<span class="n">data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">boto3</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">Bucket</span><span class="p">(</span><span class="n">bucket</span><span class="p">)</span><span class="o">.</span><span class="n">Object</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">upload_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="id5">
<h3>Create Schema<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">schema</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;record&quot;</span><span class="p">,</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Interactions&quot;</span><span class="p">,</span>
    <span class="s2">&quot;namespace&quot;</span><span class="p">:</span> <span class="s2">&quot;com.amazonaws.personalize.schema&quot;</span><span class="p">,</span>
    <span class="s2">&quot;fields&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;USER_ID&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;ITEM_ID&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;TIMESTAMP&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;long&quot;</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0&quot;</span>
<span class="p">}</span>

<span class="n">create_schema_response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">create_schema</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;DEMO-schema&quot;</span><span class="p">,</span>
    <span class="n">schema</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">schema_arn</span> <span class="o">=</span> <span class="n">create_schema_response</span><span class="p">[</span><span class="s1">&#39;schemaArn&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">create_schema_response</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
  &quot;schemaArn&quot;: &quot;arn:aws:personalize:us-west-2:237539672711:schema/DEMO-schema&quot;, 
  &quot;ResponseMetadata&quot;: {
    &quot;RetryAttempts&quot;: 0, 
    &quot;HTTPStatusCode&quot;: 200, 
    &quot;RequestId&quot;: &quot;12eb7cba-2b64-4be9-9f6e-eeebff7629a5&quot;, 
    &quot;HTTPHeaders&quot;: {
      &quot;date&quot;: &quot;Tue, 04 Dec 2018 05:49:04 GMT&quot;, 
      &quot;x-amzn-requestid&quot;: &quot;12eb7cba-2b64-4be9-9f6e-eeebff7629a5&quot;, 
      &quot;content-length&quot;: &quot;79&quot;, 
      &quot;content-type&quot;: &quot;application/x-amz-json-1.1&quot;, 
      &quot;connection&quot;: &quot;keep-alive&quot;
    }
  }
}
</pre></div>
</div>
</div>
</div>
<div class="section" id="optional-security-practice-protect-data-at-rest-encrypt-datasets-under-personalize">
<h4>Optional security practice - Protect data at rest - Encrypt datasets under Personalize<a class="headerlink" href="#optional-security-practice-protect-data-at-rest-encrypt-datasets-under-personalize" title="Permalink to this headline">¶</a></h4>
<p>If you skip this step, do not pass kmsKeyArn or roleArn when you create your dataset group.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kmsKeyArn</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;kms&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">create_key</span><span class="p">(</span><span class="n">Description</span><span class="o">=</span><span class="s2">&quot;personalize-data&quot;</span><span class="p">)[</span><span class="s1">&#39;KeyMetadata&#39;</span><span class="p">][</span><span class="s1">&#39;Arn&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">kmsKeyArn</span><span class="p">)</span>
<span class="n">key_accessor_policy_name</span> <span class="o">=</span> <span class="s2">&quot;AccessPersonalizeDatasetPolicy&quot;</span>
<span class="n">key_accessor_policy</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">&quot;Version&quot;</span><span class="p">:</span> <span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
  <span class="s2">&quot;Statement&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;Effect&quot;</span><span class="p">:</span> <span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Action&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="s2">&quot;kms:*&quot;</span>
    <span class="p">],</span>
    <span class="s2">&quot;Resource&quot;</span><span class="p">:</span> <span class="p">[</span> <span class="n">kmsKeyArn</span> <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="n">key_access_policy</span> <span class="o">=</span> <span class="n">iam</span><span class="o">.</span><span class="n">create_policy</span><span class="p">(</span>
    <span class="n">PolicyName</span> <span class="o">=</span> <span class="n">key_accessor_policy_name</span><span class="p">,</span>
    <span class="n">PolicyDocument</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">key_accessor_policy</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">key_access_role_name</span> <span class="o">=</span> <span class="s2">&quot;AccessPersonalizeDatasetRole&quot;</span>
<span class="n">assume_role_policy_document</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Version&quot;</span><span class="p">:</span> <span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Statement&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">&quot;Effect&quot;</span><span class="p">:</span> <span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Principal&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;Service&quot;</span><span class="p">:</span> <span class="s2">&quot;personalize.amazonaws.com&quot;</span>
          <span class="p">},</span>
          <span class="s2">&quot;Action&quot;</span><span class="p">:</span> <span class="s2">&quot;sts:AssumeRole&quot;</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>

<span class="n">create_role_response</span> <span class="o">=</span> <span class="n">iam</span><span class="o">.</span><span class="n">create_role</span><span class="p">(</span>
    <span class="n">RoleName</span> <span class="o">=</span> <span class="n">key_access_role_name</span><span class="p">,</span>
    <span class="n">AssumeRolePolicyDocument</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">assume_role_policy_document</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">iam</span><span class="o">.</span><span class="n">attach_role_policy</span><span class="p">(</span>
    <span class="n">RoleName</span> <span class="o">=</span> <span class="n">create_role_response</span><span class="p">[</span><span class="s2">&quot;Role&quot;</span><span class="p">][</span><span class="s2">&quot;RoleName&quot;</span><span class="p">],</span>
    <span class="n">PolicyArn</span> <span class="o">=</span> <span class="n">key_access_policy</span><span class="p">[</span><span class="s2">&quot;Policy&quot;</span><span class="p">][</span><span class="s2">&quot;Arn&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">keyAccessRoleArn</span> <span class="o">=</span> <span class="n">create_role_response</span><span class="p">[</span><span class="s2">&quot;Role&quot;</span><span class="p">][</span><span class="s2">&quot;Arn&quot;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">keyAccessRoleArn</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>arn:aws:kms:us-west-2:001513653716:key/f5be82af-a160-4c49-813e-e5448fa95693
arn:aws:iam::001513653716:role/AccessPersonalizeDatasetRole
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="create-and-wait-for-encrypted-dataset-group">
<h3>Create and Wait for Encrypted Dataset Group<a class="headerlink" href="#create-and-wait-for-encrypted-dataset-group" title="Permalink to this headline">¶</a></h3>
<div class="section" id="create-encrypted-dataset-group">
<h4>Create Encrypted Dataset Group<a class="headerlink" href="#create-encrypted-dataset-group" title="Permalink to this headline">¶</a></h4>
<p>If you did not create a KMS Key and IAM role from the last step, then do not pass in roleArn or kmsKeyArn.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">create_dataset_group_response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">create_dataset_group</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;DEMO-dataset-group&quot;</span><span class="p">,</span>
    <span class="n">roleArn</span> <span class="o">=</span> <span class="n">keyAccessRoleArn</span><span class="p">,</span>
    <span class="n">kmsKeyArn</span> <span class="o">=</span> <span class="n">kmsKeyArn</span>
<span class="p">)</span>

<span class="n">dataset_group_arn</span> <span class="o">=</span> <span class="n">create_dataset_group_response</span><span class="p">[</span><span class="s1">&#39;datasetGroupArn&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">create_dataset_group_response</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ClientError</span><span class="g g-Whitespace">                               </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="n">d867662faf2d</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span>     <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;DEMO-dataset-group-aadata&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="n">roleArn</span> <span class="o">=</span> <span class="s2">&quot;arn:aws:iam::261294318658:role/AccessPersonalizeDatasetRole&quot;</span><span class="p">,</span>
<span class="ne">----&gt; </span><span class="mi">4</span>     <span class="n">kmsKeyArn</span> <span class="o">=</span> <span class="s2">&quot;arn:aws:kms:us-west-2:261294318658:key/be6db2bb-1fe8-43a5-8134-0762740a22b9&quot;</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> 

<span class="nn">~/boto3/src/botocore/botocore/client.py</span> in <span class="ni">_api_call</span><span class="nt">(self, *args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">314</span>                     <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">() only accepts keyword arguments.&quot;</span> <span class="o">%</span> <span class="n">py_operation_name</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">315</span>             <span class="c1"># The &quot;self&quot; in this scope is referring to the BaseClient.</span>
<span class="ne">--&gt; </span><span class="mi">316</span>             <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_api_call</span><span class="p">(</span><span class="n">operation_name</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">317</span> 
<span class="g g-Whitespace">    </span><span class="mi">318</span>         <span class="n">_api_call</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">py_operation_name</span><span class="p">)</span>

<span class="nn">~/boto3/src/botocore/botocore/client.py</span> in <span class="ni">_make_api_call</span><span class="nt">(self, operation_name, api_params)</span>
<span class="g g-Whitespace">    </span><span class="mi">633</span>             <span class="n">error_code</span> <span class="o">=</span> <span class="n">parsed_response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Code&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">634</span>             <span class="n">error_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">from_code</span><span class="p">(</span><span class="n">error_code</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">635</span>             <span class="k">raise</span> <span class="n">error_class</span><span class="p">(</span><span class="n">parsed_response</span><span class="p">,</span> <span class="n">operation_name</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">636</span>         <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">637</span>             <span class="k">return</span> <span class="n">parsed_response</span>

<span class="ne">ClientError</span>: An error occurred (AccessDeniedException) when calling the CreateDatasetGroup operation: Cross-account pass role is not allowed.
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id6">
<h4>Wait for Dataset Group to Have ACTIVE Status<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">max_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span> <span class="c1"># 3 hours</span>
<span class="k">while</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">max_time</span><span class="p">:</span>
    <span class="n">describe_dataset_group_response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">describe_dataset_group</span><span class="p">(</span>
        <span class="n">datasetGroupArn</span> <span class="o">=</span> <span class="n">dataset_group_arn</span>
    <span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">describe_dataset_group_response</span><span class="p">[</span><span class="s2">&quot;datasetGroup&quot;</span><span class="p">][</span><span class="s2">&quot;status&quot;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DatasetGroup: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">status</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;ACTIVE&quot;</span> <span class="ow">or</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;CREATE FAILED&quot;</span><span class="p">:</span>
        <span class="k">break</span>
        
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DatasetGroup: CREATE PENDING
DatasetGroup: CREATE FAILED
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="id7">
<h3>Create Dataset<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dataset_type</span> <span class="o">=</span> <span class="s2">&quot;INTERACTIONS&quot;</span>
<span class="n">create_dataset_response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;DEMO-dataset&quot;</span><span class="p">,</span>
    <span class="n">datasetType</span> <span class="o">=</span> <span class="n">dataset_type</span><span class="p">,</span>
    <span class="n">datasetGroupArn</span> <span class="o">=</span> <span class="n">dataset_group_arn</span><span class="p">,</span>
    <span class="n">schemaArn</span> <span class="o">=</span> <span class="n">schema_arn</span>
<span class="p">)</span>

<span class="n">dataset_arn</span> <span class="o">=</span> <span class="n">create_dataset_response</span><span class="p">[</span><span class="s1">&#39;datasetArn&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">create_dataset_response</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
  &quot;ResponseMetadata&quot;: {
    &quot;RetryAttempts&quot;: 0, 
    &quot;HTTPStatusCode&quot;: 200, 
    &quot;RequestId&quot;: &quot;29ab75c8-df6e-4807-943f-1b48014181d1&quot;, 
    &quot;HTTPHeaders&quot;: {
      &quot;date&quot;: &quot;Tue, 04 Dec 2018 05:50:19 GMT&quot;, 
      &quot;x-amzn-requestid&quot;: &quot;29ab75c8-df6e-4807-943f-1b48014181d1&quot;, 
      &quot;content-length&quot;: &quot;101&quot;, 
      &quot;content-type&quot;: &quot;application/x-amz-json-1.1&quot;, 
      &quot;connection&quot;: &quot;keep-alive&quot;
    }
  }, 
  &quot;datasetArn&quot;: &quot;arn:aws:personalize:us-west-2:237539672711:dataset/DEMO-dataset-group/INTERACTIONS&quot;
}
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="prepare-create-and-wait-for-dataset-import-job">
<h3>Prepare, Create, and Wait for Dataset Import Job<a class="headerlink" href="#prepare-create-and-wait-for-dataset-import-job" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id8">
<h4>Attach Policy to S3 Bucket<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">policy</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Version&quot;</span><span class="p">:</span> <span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Id&quot;</span><span class="p">:</span> <span class="s2">&quot;PersonalizeS3BucketAccessPolicy&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Statement&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;Sid&quot;</span><span class="p">:</span> <span class="s2">&quot;PersonalizeS3BucketAccessPolicy&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Effect&quot;</span><span class="p">:</span> <span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Principal&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;Service&quot;</span><span class="p">:</span> <span class="s2">&quot;personalize.amazonaws.com&quot;</span>
            <span class="p">},</span>
            <span class="s2">&quot;Action&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;s3:GetObject&quot;</span><span class="p">,</span>
                <span class="s2">&quot;s3:ListBucket&quot;</span>
            <span class="p">],</span>
            <span class="s2">&quot;Resource&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&quot;arn:aws:s3:::</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bucket</span><span class="p">),</span>
                <span class="s2">&quot;arn:aws:s3:::</span><span class="si">{}</span><span class="s2">/*&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bucket</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>

<span class="n">s3</span><span class="o">.</span><span class="n">put_bucket_policy</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">,</span> <span class="n">Policy</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">policy</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id9">
<h4>Create Personalize Role<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">role_name</span> <span class="o">=</span> <span class="s2">&quot;PersonalizeRole&quot;</span>
<span class="n">assume_role_policy_document</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Version&quot;</span><span class="p">:</span> <span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Statement&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">&quot;Effect&quot;</span><span class="p">:</span> <span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Principal&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;Service&quot;</span><span class="p">:</span> <span class="s2">&quot;personalize.amazonaws.com&quot;</span>
          <span class="p">},</span>
          <span class="s2">&quot;Action&quot;</span><span class="p">:</span> <span class="s2">&quot;sts:AssumeRole&quot;</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>

<span class="n">create_role_response</span> <span class="o">=</span> <span class="n">iam</span><span class="o">.</span><span class="n">create_role</span><span class="p">(</span>
    <span class="n">RoleName</span> <span class="o">=</span> <span class="n">role_name</span><span class="p">,</span>
    <span class="n">AssumeRolePolicyDocument</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">assume_role_policy_document</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># AmazonPersonalizeFullAccess provides access to any S3 bucket with a name that includes &quot;personalize&quot; or &quot;Personalize&quot; </span>
<span class="c1"># if you would like to use a bucket with a different name, please consider creating and attaching a new policy</span>
<span class="c1"># that provides read access to your bucket or attaching the AmazonS3ReadOnlyAccess policy to the role</span>
<span class="n">policy_arn</span> <span class="o">=</span> <span class="s2">&quot;arn:aws:iam::aws:policy/service-role/AmazonPersonalizeFullAccess&quot;</span>
<span class="n">iam</span><span class="o">.</span><span class="n">attach_role_policy</span><span class="p">(</span>
    <span class="n">RoleName</span> <span class="o">=</span> <span class="n">role_name</span><span class="p">,</span>
    <span class="n">PolicyArn</span> <span class="o">=</span> <span class="n">policy_arn</span>
<span class="p">)</span>

<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span> <span class="c1"># wait for a minute to allow IAM role policy attachment to propagate</span>

<span class="n">role_arn</span> <span class="o">=</span> <span class="n">create_role_response</span><span class="p">[</span><span class="s2">&quot;Role&quot;</span><span class="p">][</span><span class="s2">&quot;Arn&quot;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">role_arn</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>arn:aws:iam::660166145966:role/PersonalizeRole2
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id10">
<h4>Create Dataset Import Job<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">create_dataset_import_job_response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">create_dataset_import_job</span><span class="p">(</span>
    <span class="n">jobName</span> <span class="o">=</span> <span class="s2">&quot;DEMO-dataset-import-job&quot;</span><span class="p">,</span>
    <span class="n">datasetArn</span> <span class="o">=</span> <span class="n">dataset_arn</span><span class="p">,</span>
    <span class="n">dataSource</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;dataLocation&quot;</span><span class="p">:</span> <span class="s2">&quot;s3://</span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
    <span class="p">},</span>
    <span class="n">roleArn</span> <span class="o">=</span> <span class="n">role_arn</span>
<span class="p">)</span>

<span class="n">dataset_import_job_arn</span> <span class="o">=</span> <span class="n">create_dataset_import_job_response</span><span class="p">[</span><span class="s1">&#39;datasetImportJobArn&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">create_dataset_import_job_response</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
  &quot;datasetImportJobArn&quot;: &quot;arn:aws:personalize:us-west-2:237539672711:dataset-import-job/DEMO-dataset-import-job&quot;, 
  &quot;ResponseMetadata&quot;: {
    &quot;RetryAttempts&quot;: 0, 
    &quot;HTTPStatusCode&quot;: 200, 
    &quot;RequestId&quot;: &quot;3c77fe8d-d9fe-4ca5-ad03-b18e937acbb3&quot;, 
    &quot;HTTPHeaders&quot;: {
      &quot;date&quot;: &quot;Tue, 04 Dec 2018 05:50:55 GMT&quot;, 
      &quot;x-amzn-requestid&quot;: &quot;3c77fe8d-d9fe-4ca5-ad03-b18e937acbb3&quot;, 
      &quot;content-length&quot;: &quot;113&quot;, 
      &quot;content-type&quot;: &quot;application/x-amz-json-1.1&quot;, 
      &quot;connection&quot;: &quot;keep-alive&quot;
    }
  }
}
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id11">
<h4>Wait for Dataset Import Job to Have ACTIVE Status<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">max_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span> <span class="c1"># 3 hours</span>
<span class="k">while</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">max_time</span><span class="p">:</span>
    <span class="n">describe_dataset_import_job_response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">describe_dataset_import_job</span><span class="p">(</span>
        <span class="n">datasetImportJobArn</span> <span class="o">=</span> <span class="n">dataset_import_job_arn</span>
    <span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">describe_dataset_import_job_response</span><span class="p">[</span><span class="s2">&quot;datasetImportJob&quot;</span><span class="p">][</span><span class="s1">&#39;status&#39;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DatasetImportJob: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">status</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;ACTIVE&quot;</span> <span class="ow">or</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;CREATE FAILED&quot;</span><span class="p">:</span>
        <span class="k">break</span>
        
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DatasetImportJob: CREATE PENDING
DatasetImportJob: CREATE IN_PROGRESS
DatasetImportJob: CREATE IN_PROGRESS
DatasetImportJob: CREATE IN_PROGRESS
DatasetImportJob: CREATE IN_PROGRESS
DatasetImportJob: CREATE IN_PROGRESS
DatasetImportJob: CREATE IN_PROGRESS
DatasetImportJob: CREATE IN_PROGRESS
DatasetImportJob: CREATE IN_PROGRESS
DatasetImportJob: CREATE IN_PROGRESS
DatasetImportJob: CREATE IN_PROGRESS
DatasetImportJob: CREATE IN_PROGRESS
DatasetImportJob: CREATE IN_PROGRESS
DatasetImportJob: CREATE IN_PROGRESS
DatasetImportJob: CREATE IN_PROGRESS
DatasetImportJob: CREATE IN_PROGRESS
DatasetImportJob: ACTIVE
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="id12">
<h3>Select Recipe<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">list_recipes_response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">list_recipes</span><span class="p">()</span>
<span class="n">recipe_arn</span> <span class="o">=</span> <span class="s2">&quot;arn:aws:personalize:::recipe/aws-hrnn&quot;</span> <span class="c1"># aws-hrnn selected for demo purposes</span>
<span class="n">list_recipes_response</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;ResponseMetadata&#39;: {&#39;HTTPHeaders&#39;: {&#39;connection&#39;: &#39;keep-alive&#39;,
   &#39;content-length&#39;: &#39;1287&#39;,
   &#39;content-type&#39;: &#39;application/x-amz-json-1.1&#39;,
   &#39;date&#39;: &#39;Fri, 22 Mar 2019 19:28:37 GMT&#39;,
   &#39;x-amzn-requestid&#39;: &#39;275695de-45b2-4077-82d4-c961ceeaf367&#39;},
  &#39;HTTPStatusCode&#39;: 200,
  &#39;RequestId&#39;: &#39;275695de-45b2-4077-82d4-c961ceeaf367&#39;,
  &#39;RetryAttempts&#39;: 0},
 u&#39;recipes&#39;: [{u&#39;creationDateTime&#39;: datetime.datetime(2018, 11, 25, 16, 0, tzinfo=tzlocal()),
   u&#39;lastUpdatedDateTime&#39;: datetime.datetime(1969, 12, 31, 16, 0, tzinfo=tzlocal()),
   u&#39;name&#39;: u&#39;aws-hrnn&#39;,
   u&#39;recipeArn&#39;: u&#39;arn:aws:personalize:::recipe/aws-hrnn&#39;,
   u&#39;status&#39;: u&#39;ACTIVE&#39;},
  {u&#39;creationDateTime&#39;: datetime.datetime(2018, 11, 25, 16, 0, tzinfo=tzlocal()),
   u&#39;lastUpdatedDateTime&#39;: datetime.datetime(1969, 12, 31, 16, 0, tzinfo=tzlocal()),
   u&#39;name&#39;: u&#39;aws-hrnn-coldstart&#39;,
   u&#39;recipeArn&#39;: u&#39;arn:aws:personalize:::recipe/aws-hrnn-coldstart&#39;,
   u&#39;status&#39;: u&#39;ACTIVE&#39;},
  {u&#39;creationDateTime&#39;: datetime.datetime(2018, 11, 25, 16, 0, tzinfo=tzlocal()),
   u&#39;lastUpdatedDateTime&#39;: datetime.datetime(1969, 12, 31, 16, 0, tzinfo=tzlocal()),
   u&#39;name&#39;: u&#39;aws-hrnn-metadata&#39;,
   u&#39;recipeArn&#39;: u&#39;arn:aws:personalize:::recipe/aws-hrnn-metadata&#39;,
   u&#39;status&#39;: u&#39;ACTIVE&#39;},
  {u&#39;creationDateTime&#39;: datetime.datetime(2018, 11, 25, 16, 0, tzinfo=tzlocal()),
   u&#39;lastUpdatedDateTime&#39;: datetime.datetime(1969, 12, 31, 16, 0, tzinfo=tzlocal()),
   u&#39;name&#39;: u&#39;aws-personalized-ranking&#39;,
   u&#39;recipeArn&#39;: u&#39;arn:aws:personalize:::recipe/aws-personalized-ranking&#39;,
   u&#39;status&#39;: u&#39;ACTIVE&#39;},
  {u&#39;creationDateTime&#39;: datetime.datetime(2018, 11, 25, 16, 0, tzinfo=tzlocal()),
   u&#39;lastUpdatedDateTime&#39;: datetime.datetime(1969, 12, 31, 16, 0, tzinfo=tzlocal()),
   u&#39;name&#39;: u&#39;aws-popularity-count&#39;,
   u&#39;recipeArn&#39;: u&#39;arn:aws:personalize:::recipe/aws-popularity-count&#39;,
   u&#39;status&#39;: u&#39;ACTIVE&#39;},
  {u&#39;creationDateTime&#39;: datetime.datetime(2018, 11, 25, 16, 0, tzinfo=tzlocal()),
   u&#39;lastUpdatedDateTime&#39;: datetime.datetime(1969, 12, 31, 16, 0, tzinfo=tzlocal()),
   u&#39;name&#39;: u&#39;aws-sims&#39;,
   u&#39;recipeArn&#39;: u&#39;arn:aws:personalize:::recipe/aws-sims&#39;,
   u&#39;status&#39;: u&#39;ACTIVE&#39;}]}
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id13">
<h3>Create and Wait for Solution<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id14">
<h4>Create Solution<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">create_solution_response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">create_solution</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;DEMO-solution&quot;</span><span class="p">,</span>
    <span class="n">datasetGroupArn</span> <span class="o">=</span> <span class="n">dataset_group_arn</span><span class="p">,</span>
    <span class="n">recipeArn</span> <span class="o">=</span> <span class="n">recipe_arn</span>
<span class="p">)</span>

<span class="n">solution_arn</span> <span class="o">=</span> <span class="n">create_solution_response</span><span class="p">[</span><span class="s1">&#39;solutionArn&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">create_solution_response</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
  &quot;solutionArn&quot;: &quot;arn:aws:personalize:us-west-2:237539672711:solution/DEMO-solution&quot;, 
  &quot;ResponseMetadata&quot;: {
    &quot;RetryAttempts&quot;: 0, 
    &quot;HTTPStatusCode&quot;: 200, 
    &quot;RequestId&quot;: &quot;2042832f-0775-43e2-86de-53a061be1f63&quot;, 
    &quot;HTTPHeaders&quot;: {
      &quot;date&quot;: &quot;Mon, 03 Dec 2018 23:55:17 GMT&quot;, 
      &quot;x-amzn-requestid&quot;: &quot;2042832f-0775-43e2-86de-53a061be1f63&quot;, 
      &quot;content-length&quot;: &quot;83&quot;, 
      &quot;content-type&quot;: &quot;application/x-amz-json-1.1&quot;, 
      &quot;connection&quot;: &quot;keep-alive&quot;
    }
  }
}
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id15">
<h4>Create Solution Version<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">create_solution_version_response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">create_solution_version</span><span class="p">(</span>
    <span class="n">solutionArn</span> <span class="o">=</span> <span class="n">solution_arn</span>
<span class="p">)</span>

<span class="n">solution_version_arn</span> <span class="o">=</span> <span class="n">create_solution_version_response</span><span class="p">[</span><span class="s1">&#39;solutionVersionArn&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">create_solution_version_response</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
  &quot;solutionVersionArn&quot;: &quot;arn:aws:personalize:us-west-2:237539672711:solution/DEMO-solution/702e0792&quot;, 
  &quot;ResponseMetadata&quot;: {
    &quot;RetryAttempts&quot;: 0, 
    &quot;HTTPStatusCode&quot;: 200, 
    &quot;RequestId&quot;: &quot;2042832f-0775-43e2-86de-53a061be1f65&quot;, 
    &quot;HTTPHeaders&quot;: {
      &quot;date&quot;: &quot;Mon, 03 Dec 2018 23:55:17 GMT&quot;, 
      &quot;x-amzn-requestid&quot;: &quot;2042832f-0775-43e2-86de-53a061be1f65&quot;, 
      &quot;content-length&quot;: &quot;90&quot;, 
      &quot;content-type&quot;: &quot;application/x-amz-json-1.1&quot;, 
      &quot;connection&quot;: &quot;keep-alive&quot;
    }
  }
}
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id16">
<h4>Wait for Solution Version to Have ACTIVE Status<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">max_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span> <span class="c1"># 3 hours</span>
<span class="k">while</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">max_time</span><span class="p">:</span>
    <span class="n">describe_solution_version_response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">describe_solution_version</span><span class="p">(</span>
        <span class="n">solutionVersionArn</span> <span class="o">=</span> <span class="n">solution_version_arn</span>
    <span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">describe_solution_version_response</span><span class="p">[</span><span class="s2">&quot;solutionVersion&quot;</span><span class="p">][</span><span class="s2">&quot;status&quot;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SolutionVersion: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">status</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;ACTIVE&quot;</span> <span class="ow">or</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;CREATE FAILED&quot;</span><span class="p">:</span>
        <span class="k">break</span>
        
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SolutionVersion: CREATE PENDING
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: CREATE IN_PROGRESS
SolutionVersion: ACTIVE
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="get-metrics-of-solution">
<h4>Get Metrics of Solution<a class="headerlink" href="#get-metrics-of-solution" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">get_solution_metrics_response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">get_solution_metrics</span><span class="p">(</span>
    <span class="n">solutionVersionArn</span> <span class="o">=</span> <span class="n">solution_version_arn</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">get_solution_metrics_response</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
  &quot;metrics&quot;: {
    &quot;coverage&quot;: 0.2603, 
    &quot;mean_reciprocal_rank_at_25&quot;: 0.0539, 
    &quot;normalized_discounted_cumulative_gain_at_5&quot;: 0.0486, 
    &quot;normalized_discounted_cumulative_gain_at_10&quot;: 0.0649, 
    &quot;normalized_discounted_cumulative_gain_at_25&quot;: 0.0918, 
    &quot;precision_at_5&quot;: 0.0109, 
    &quot;precision_at_10&quot;: 0.0098, 
    &quot;precision_at_25&quot;: 0.0083, 
  }, 
  &quot;solutionVersionArn&quot;: &quot;arn:aws:personalize:us-west-2:237539672711:solution/DEMO-solution/702e0792&quot;, 
  &quot;ResponseMetadata&quot;: {
    &quot;RetryAttempts&quot;: 0, 
    &quot;HTTPStatusCode&quot;: 200, 
    &quot;RequestId&quot;: &quot;5b5f4f4f-5249-4c0e-9f83-45e3fe22f09f&quot;, 
    &quot;HTTPHeaders&quot;: {
      &quot;date&quot;: &quot;Tue, 04 Dec 2018 00:53:54 GMT&quot;, 
      &quot;x-amzn-requestid&quot;: &quot;5b5f4f4f-5249-4c0e-9f83-45e3fe22f09f&quot;, 
      &quot;content-length&quot;: &quot;724&quot;, 
      &quot;content-type&quot;: &quot;application/x-amz-json-1.1&quot;, 
      &quot;connection&quot;: &quot;keep-alive&quot;
    }
  }
}
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="create-and-wait-for-campaign">
<h3>Create and Wait for Campaign<a class="headerlink" href="#create-and-wait-for-campaign" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id17">
<h4>Create Campaign<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">create_campaign_response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">create_campaign</span><span class="p">(</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;DEMO-campaign&quot;</span><span class="p">,</span>
    <span class="n">solutionVersionArn</span> <span class="o">=</span> <span class="n">solution_version_arn</span><span class="p">,</span>
    <span class="n">minProvisionedTPS</span> <span class="o">=</span> <span class="mi">1</span>
<span class="p">)</span>

<span class="n">campaign_arn</span> <span class="o">=</span> <span class="n">create_campaign_response</span><span class="p">[</span><span class="s1">&#39;campaignArn&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">create_campaign_response</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{
  &quot;campaignArn&quot;: &quot;arn:aws:personalize:us-west-2:237539672711:campaign/DEMO-campaign&quot;, 
  &quot;ResponseMetadata&quot;: {
    &quot;RetryAttempts&quot;: 0, 
    &quot;HTTPStatusCode&quot;: 200, 
    &quot;RequestId&quot;: &quot;527e97ba-683c-4dc7-8218-00716f22c904&quot;, 
    &quot;HTTPHeaders&quot;: {
      &quot;date&quot;: &quot;Tue, 04 Dec 2018 00:54:17 GMT&quot;, 
      &quot;x-amzn-requestid&quot;: &quot;527e97ba-683c-4dc7-8218-00716f22c904&quot;, 
      &quot;content-length&quot;: &quot;83&quot;, 
      &quot;content-type&quot;: &quot;application/x-amz-json-1.1&quot;, 
      &quot;connection&quot;: &quot;keep-alive&quot;
    }
  }
}
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id18">
<h4>Wait for Campaign to Have ACTIVE Status<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">max_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span> <span class="c1"># 3 hours</span>
<span class="k">while</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">max_time</span><span class="p">:</span>
    <span class="n">describe_campaign_response</span> <span class="o">=</span> <span class="n">personalize</span><span class="o">.</span><span class="n">describe_campaign</span><span class="p">(</span>
        <span class="n">campaignArn</span> <span class="o">=</span> <span class="n">campaign_arn</span>
    <span class="p">)</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">describe_campaign_response</span><span class="p">[</span><span class="s2">&quot;campaign&quot;</span><span class="p">][</span><span class="s2">&quot;status&quot;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Campaign: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">status</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;ACTIVE&quot;</span> <span class="ow">or</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;CREATE FAILED&quot;</span><span class="p">:</span>
        <span class="k">break</span>
        
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Campaign: CREATE PENDING
Campaign: CREATE IN_PROGRESS
Campaign: CREATE IN_PROGRESS
Campaign: CREATE IN_PROGRESS
Campaign: CREATE IN_PROGRESS
Campaign: CREATE IN_PROGRESS
Campaign: CREATE IN_PROGRESS
Campaign: CREATE IN_PROGRESS
Campaign: CREATE IN_PROGRESS
Campaign: ACTIVE
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="get-recommendations">
<h3>Get Recommendations<a class="headerlink" href="#get-recommendations" title="Permalink to this headline">¶</a></h3>
<div class="section" id="select-a-user-and-an-item">
<h4>Select a User and an Item<a class="headerlink" href="#select-a-user-and-an-item" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">items</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./ml-100k/u.item&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;latin-1&#39;</span><span class="p">)</span>
<span class="n">items</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ITEM_ID&#39;</span><span class="p">,</span> <span class="s1">&#39;TITLE&#39;</span><span class="p">]</span>

<span class="n">user_id</span><span class="p">,</span> <span class="n">item_id</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">item_title</span> <span class="o">=</span> <span class="n">items</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">items</span><span class="p">[</span><span class="s1">&#39;ITEM_ID&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">item_id</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;USER: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">user_id</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ITEM: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item_title</span><span class="p">))</span>

<span class="n">items</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>USER: 711
ITEM: Silence of the Lambs, The (1991)
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ITEM_ID</th>
      <th>TITLE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Toy Story (1995)</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>GoldenEye (1995)</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1680</th>
      <td>1681</td>
      <td>You So Crazy (1994)</td>
    </tr>
    <tr>
      <th>1681</th>
      <td>1682</td>
      <td>Scream of Stone (Schrei aus Stein) (1991)</td>
    </tr>
  </tbody>
</table>
<p>1682 rows × 2 columns</p>
</div></div></div>
</div>
</div>
<div class="section" id="id19">
<h4>Call GetRecommendations<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">get_recommendations_response</span> <span class="o">=</span> <span class="n">personalize_runtime</span><span class="o">.</span><span class="n">get_recommendations</span><span class="p">(</span>
    <span class="n">campaignArn</span> <span class="o">=</span> <span class="n">campaign_arn</span><span class="p">,</span>
    <span class="n">userId</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">user_id</span><span class="p">),</span>
    <span class="n">itemId</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">item_id</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">item_list</span> <span class="o">=</span> <span class="n">get_recommendations_response</span><span class="p">[</span><span class="s1">&#39;itemList&#39;</span><span class="p">]</span>
<span class="n">title_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">items</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">items</span><span class="p">[</span><span class="s1">&#39;ITEM_ID&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;itemId&#39;</span><span class="p">])]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">item_list</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Recommendations: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">title_list</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Recommendations: [
  &quot;Godfather, The (1972)&quot;, 
  &quot;Contact (1997)&quot;, 
  &quot;Titanic (1997)&quot;, 
  &quot;Star Wars (1977)&quot;, 
  &quot;Fargo (1996)&quot;, 
  &quot;Liar Liar (1997)&quot;, 
  &quot;Evita (1996)&quot;, 
  &quot;Jerry Maguire (1996)&quot;, 
  &quot;Scream (1996)&quot;, 
  &quot;Devil&#39;s Advocate, The (1997)&quot;, 
  &quot;Full Monty, The (1997)&quot;, 
  &quot;Conspiracy Theory (1997)&quot;, 
  &quot;Edge, The (1997)&quot;, 
  &quot;Sense and Sensibility (1995)&quot;, 
  &quot;English Patient, The (1996)&quot;, 
  &quot;Twelve Monkeys (1995)&quot;, 
  &quot;L.A. Confidential (1997)&quot;, 
  &quot;As Good As It Gets (1997)&quot;, 
  &quot;In &amp; Out (1997)&quot;, 
  &quot;Rock, The (1996)&quot;, 
  &quot;Return of the Jedi (1983)&quot;, 
  &quot;Amistad (1997)&quot;, 
  &quot;Men in Black (1997)&quot;, 
  &quot;Truth About Cats &amp; Dogs, The (1996)&quot;, 
  &quot;Alien: Resurrection (1997)&quot;
]
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./nbs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="T227901_amazon_personalize_batch_job.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">Amazon Personalize Batch Job</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="T424437_Collaborative_Filtering_on_ML_latest_small.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">Collaborative Filtering on ML-latest-small</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Sparsh A.<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>